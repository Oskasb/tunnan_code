/*!
* transparency - v0.9.7 - 2013-03-04
* https://github.com/leonidas/transparency
* Copyright (c) 2013 Jarno Keskikangas <jarno.keskikangas@leonidasoy.fi>; Licensed MIT
*/

/*!
 * VERSION: beta 1.9.0
 * DATE: 2013-03-01
 * JavaScript (ActionScript 3 and 2 also available)
 * UPDATES AND DOCS AT: http://www.greensock.com
 * 
 * Includes all of the following: TweenLite, TweenMax, TimelineLite, TimelineMax, easing.EasePack, plugins.CSSPlugin, plugins.RoundPropsPlugin, plugins.BezierPlugin
 *
 * @license Copyright (c) 2008-2013, GreenSock. All rights reserved.
 * This work is subject to the terms in http://www.greensock.com/terms_of_use.html or for 
 * Club GreenSock members, the software agreement that was issued with your membership.
 * 
 * @author: Jack Doyle, jack@greensock.com
 **/

/*
 * Copyright (c) 2012 Brandon Jones
 *
 * This software is provided 'as-is', without any express or implied
 * warranty. In no event will the authors be held liable for any damages
 * arising from the use of this software.
 *
 * Permission is granted to anyone to use this software for any purpose,
 * including commercial applications, and to alter it and redistribute it
 * freely, subject to the following restrictions:
 *
 *    1. The origin of this software must not be misrepresented; you must not
 *    claim that you wrote the original software. If you use this software
 *    in a product, an acknowledgment in the product documentation would be
 *    appreciated but is not required.
 *
 *    2. Altered source versions must be plainly marked as such, and must not
 *    be misrepresented as being the original software.
 *
 *    3. This notice may not be removed or altered from any source
 *    distribution.
 */

define("application/EventList",[],function(){var e=function(){};return{LOAD_PROGRESS:{type:"LOAD_PROGRESS",eArgs:{started:0,completed:0,errors:0,id:""}},LOADING_COMPLETED:{type:"LOADING_COMPLETED",eArgs:{started:0,completed:0,errors:0}},LOAD_3D:{type:"LOAD_3D",eArgs:{}},UN_LOAD_3D:{type:"UN_LOAD_3D",eArgs:{}},GOO_TICK:{type:"GOO_TICK",eArgs:{tpf:0}},LOAD_JSON:{type:"LOAD_JSON",eArgs:{callback:function(){},url:""}},LOAD_GOO_PROJECT:{type:"LOAD_GOO_PROJECT",eArgs:{callback:function(){},refFile:"",projectPath:""}},LOAD_UI_TEMPLATE:{type:"LOAD_UI_TEMPLATE",eArgs:{templateId:""}},UNLOAD_UI_TEMPLATE:{type:"UNLOAD_UI_TEMPLATE",eArgs:{templateId:""}},CLIENT_SETUP_OK:{type:"CLIENT_SETUP_OK",eArgs:{}},REGISTER_SPRITE:{type:"REGISTER_SPRITE",eArgs:{elementId:""}},GOT_GAME_CONFIGURATION:{type:"GOT_GAME_CONFIGURATION",eArgs:{gameConfig:{}}},MENU_NAVIGATE:{type:"MENU_NAVIGATE",eArgs:{destination:"",elementId:""}},RENDER_TICK:{type:"RENDER_TICK",eArgs:{frameTime:0,lastFrameDuration:0}},POST_UPDATE:{type:"POST_UPDATE",eArgs:{}},WINDOW_RESIZED:{type:"WINDOW_RESIZED",eArgs:{}},SEQUENCE_CALLBACK:{type:"SEQUENCE_CALLBACK",eArgs:{callback:function(){},wait:0}},ANALYTICS_EVENT:{type:"ANALYTICS_EVENT",eArgs:{category:"",action:"",labels:"",value:0}},SET_ELEMENT_TEXT:{type:"SET_ELEMENT_TEXT",eArgs:{elementId:"",data:{},propertyId:""}},LAYOUT_LINES:{type:"LAYOUT_LINES",eArgs:{elementId:"",data:{}}},LAYOUT_RADIO_BUTTONS:{type:"LAYOUT_RADIO_BUTTONS",eArgs:{elementId:"",data:{},property:"",onClick:function(){}}},SET_SETTING_INDEX:{type:"SET_SETTING_INDEX",eArgs:{elementId:"",settingId:"",properties:{}}},ENABLE_SETTING_VALUE:{type:"ENABLE_SETTING_VALUE",eArgs:{settingId:"",values:{}}},REGISTER_SETTING:{type:"REGISTER_SETTING",eArgs:{elementId:"",settingId:"",properties:{}}},PAUSE_UPDATES:{type:"PAUSE_UPDATES",eArgs:{}},UNPAUSE_UPDATES:{type:"UNPAUSE_UPDATES",eArgs:{}},FETCH_TIME:{type:"FETCH_TIME",eArgs:{callback:function(){}}},CLIENT_READY:{type:"CLIENT_READY",eArgs:{}},ENINGE_READY:{type:"ENINGE_READY",eArgs:{goo:{},mainLight:{}}},LOADING_ENDED:{type:"LOADING_ENDED",eArgs:{}},RESTART_GAME_BOARD:{type:"RESTART_GAME_BOARD",eArgs:{}},OPEN_UI_PAGE:{type:"OPEN_UI_PAGE",eArgs:{page:"",parentId:""}},CLOSE_OVERLAY:{type:"CLOSE_OVERLAY",eArgs:{elementId:""}},TEST_EVENT:{type:"TEST_EVENT",eArgs:{msg:""}},START_POINTER_DRAG:{type:"START_POINTER_DRAG",eArgs:{xy:[]}},STOP_POINTER_DRAG:{type:"STOP_POINTER_DRAG",eArgs:{xy:[]}},START_CAMERA_DRAG:{type:"START_CAMERA_DRAG",eArgs:{xy:[]}},STOP_CAMERA_DRAG:{type:"STOP_CAMERA_DRAG",eArgs:{}},FETCH_DRAG_DELTA:{type:"FETCH_DRAG_DELTA",eArgs:{callback:function(){},xy:[]}},CLEAR_ALL_VALUE_ELEMENTS:{type:"CLEAR_ALL_VALUE_ELEMENTS",eArgs:{}},REGISTER_STATE_LIGHT:{type:"REGISTER_STATE_LIGHT",eArgs:{elementId:"",control:""}},REGISTER_STATE_LEVER:{type:"REGISTER_STATE_LEVER",eArgs:{elementId:"",control:""}},REGISTER_STATE_VALUE:{type:"REGISTER_STATE_VALUE",eArgs:{elementId:"",value:""}},REGISTER_STATE_LEVER_TARGET:{type:"REGISTER_STATE_LEVER_TARGET",eArgs:{elementId:"",control:""}},REGISTER_STATE_AXIS:{type:"REGISTER_STATE_AXIS",eArgs:{elementId:"",control:"",axis:""}},PLAYER_VALUE_UPDATE:{type:"PLAYER_VALUE_UPDATE",eArgs:{value:"",amount:0}},STICK_INPUT:{type:"STICK_INPUT",eArgs:{xy:[]}},MOUSE_ACTION:{type:"MOUSE_ACTION",eArgs:{action:[],xy:[]}},MOUSE_WHEEL_UPDATE:{type:"MOUSE_WHEEL_UPDATE",eArgs:{delta:0}},MOUSE_POSITION_UPDATE:{type:"MOUSE_POSITION_UPDATE",eArgs:{xy:[]}},ADD_KEYBINDINGS:{type:"ADD_KEYBINDINGS",eArgs:{bindings:{}}},CLEAR_KEYBINDINGS:{type:"CLEAR_KEYBINDINGS",eArgs:{bindings:{}}},UPDATE_KEYBINDING:{type:"UPDATE_KEYBINDING",eArgs:{control:"",value:0}},POP_SPHERE:{type:"POP_SPHERE",eArgs:{}},USE_NEAREST_ENTITY:{type:"USE_NEAREST_ENTITY",eArgs:{}},EXIT_CONTROLLED_ENTITY:{type:"EXIT_CONTROLLED_ENTITY",eArgs:{}},PILOT_VEHICLE:{type:"PILOT_VEHICLE",eArgs:{pilot:{},vehicle:{}}},SET_PLAYER_CONTROLLED_ENTITY:{type:"SET_PLAYER_CONTROLLED_ENTITY",eArgs:{entity:[]}},PLAYER_MOVE_TO_POINT:{type:"PLAYER_MOVE_TO_POINT",eArgs:{pos:[]}},PLAYER_MOVEMENT_INPUT:{type:"PLAYER_MOVEMENT_INPUT",eArgs:{movestate:"",turnSpeed:0}},PLAYER_CONTROL_EVENT:{type:"PLAYER_CONTROL_EVENT",eArgs:{control:"",value:0}},INIT_PLAYER_CONTROL_STATE:{type:"INIT_PLAYER_CONTROL_STATE",eArgs:{control:"",controlState:0}},PLAYER_CONTROL_STATE_UPDATE:{type:"PLAYER_CONTROL_STATE_UPDATE",eArgs:{control:"",currentState:0}},SET_CAMERA_TARGET:{type:"SET_CAMERA_TARGET",eArgs:{spatial:{},geometry:{},controlScript:""}},SET_CAMERA_ANALOGS:{type:"SET_CAMERA_ANALOGS",eArgs:{rotX:0,rotY:0,rotZ:0}},SPAWN_PHYSICAL:{type:"SPAWN_PHYSICAL",eArgs:{pos:[],callback:function(){}}},UPDATE_ENTITY_SPATIAL:{type:"UPDATE_PLAYER_SPATIAL",eArgs:{entityId:"",spatial:{}}},SCENARIO_SELECTED:{type:"SCENARIO_SELECTED",eArgs:{scenario:{}}},SCENARIO_LOADED:{type:"SCENARIO_LOADED",eArgs:{}},EXIT_SCENARIO:{type:"EXIT_SCENARIO",eArgs:{}},ADD_GAME_ENTITY:{type:"ADD_GAME_ENTITY",eArgs:{entityId:"",type:"",callback:function(){}}},FETCH_LEVEL_ENTITY:{type:"FETCH_LEVEL_ENTITY",eArgs:{entityId:"",type:"",pos:[],callback:function(){}}},DAMAGE_ENTITY:{type:"DAMAGE_ENTITY",eArgs:{entity:{},damage:0}},REMOVE_GAME_ENTITY:{type:"REMOVE_GAME_ENTITY",eArgs:{entityId:"",callback:function(){}}},CARRIER_HOOK_ENTITY:{type:"CARRIER_HOOK_PLANE",eArgs:{carrier:{},plane:{}}},ADD_ENTITY_MODEL:{type:"ADD_ENTITY_MODEL",eArgs:{entityId:"",modelDefinition:{},callback:function(){}}},LOAD_GOO_MESH:{type:"LOAD_GOO_MESH",eArgs:{modelUrl:"",callback:function(){}}},LOAD_GOO_SKELETON:{type:"LOAD_GOO_SKELETON",eArgs:{skeletonUrl:"",callback:function(){}}},LOAD_GOO_ANIMATION:{type:"LOAD_GOO_ANIMATION",eArgs:{animationUrl:"",callback:function(){}}},LOAD_GOO_MATERIAL:{type:"LOAD_GOO_MATERIAL",eArgs:{materialUrl:"",callback:function(){}}},LOAD_GOO_TEXTURE:{type:"LOAD_GOO_TEXTURE",eArgs:{textureUrl:"",callback:function(){}}},LOAD_GOO_SHADER:{type:"LOAD_GOO_SHADER",eArgs:{shaderFiles:{},shaderId:"",callback:function(){}}},REGISTER_GOO_MESH:{type:"REGISTER_GOO_MESH",eArgs:{url:"",mesh:""}},REGISTER_GOO_SKELETON:{type:"REGISTER_GOO_SKELETON",eArgs:{url:"",skeleton:""}},REGISTER_GOO_ANIMATION:{type:"REGISTER_GOO_ANIMATION",eArgs:{url:"",animation:""}},REGISTER_GOO_MATERIAL:{type:"REGISTER_GOO_MATERIAL",eArgs:{url:"",material:""}},REGISTER_GOO_TEXTURE:{type:"REGISTER_GOO_TEXTURE",eArgs:{url:"",texture:{}}},REGISTER_GOO_SHADER:{type:"REGISTER_GOO_SHADER",eArgs:{shaderId:"",type:"",data:""}},BUILD_GOO_GAMEPIECE:{type:"BUILD_GOO_GAMEPIECE",eArgs:{projPath:"",modelPath:"",callback:function(){}}},BUILD_GOO_PRIMITIVE:{type:"BUILD_GOO_PRIMITIVE",eArgs:{parentGooEntity:{},shape:"",pos:{},rot:{},size:{},color:[],callback:function(){}}},BUILD_GOO_PARTICLES:{type:"BUILD_GOO_PARTICLES",eArgs:{parentGooEntity:{},systemParams:{},emitFunctions:{},callback:function(){}}},SET_ENVIRONMENT:{type:"SET_ENVIRONMENT",eArgs:{fogColor:[],sunLight:[],ambientLight:[],sunDir:[],skyColor:[],fogDistance:[]}},SET_EFFECT_PARAMETER:{type:"SET_EFFECT_PARAMETER",eArgs:{effect:"",parameter:"",value:0}},SPLASH_WATER:{type:"SPLASH_WATER",eArgs:{pos:[],count:0,dir:[]}},FLASH_SHOCKWAVE:{type:"FLASH_SHOCKWAVE",eArgs:{pos:[],count:0,dir:[]}},FLASH_SPARKS:{type:"FLASH_SPARKS",eArgs:{pos:[],count:0,dir:[]}},PUFF_BLACK_SMOKE:{type:"PUFF_BLACK_SMOKE",eArgs:{pos:[],count:0,dir:[]}},PUFF_WHITE_SMOKE:{type:"PUFF_WHITE_SMOKE",eArgs:{pos:[],count:0,dir:[]}},PUFF_SMALL_WHITE:{type:"PUFF_SMALL_WHITE",eArgs:{pos:[],count:0,dir:[]}},PUFF_RAPID_WHITE:{type:"PUFF_RAPID_WHITE",eArgs:{pos:[],count:0,dir:[]}},PUFF_CLOUD_VAPOR:{type:"PUFF_CLOUD_VAPOR",eArgs:{pos:[],count:0,dir:[]}},ACROBATIC_SMOKE:{type:"ACROBATIC_SMOKE",eArgs:{pos:[],count:0,dir:[]}},FLASH_MUZZLE_FIRE:{type:"FLASH_MUZZLE_FIRE",eArgs:{pos:[],count:0,dir:[]}},SPLASH_RINGLET:{type:"SPLASH_RINGLET",eArgs:{pos:[],count:0,dir:[]}},SPLASH_FOAM:{type:"SPLASH_FOAM",eArgs:{pos:[],count:0,dir:[]}},LOAD_MODEL_URL:{type:"LOAD_MODEL_URL",eArgs:{modelUrl:"",callback:function(){}}},ACTIVATE_GOO_ENTITY:{type:"ACTIVATE_GOO_ENTITY",eArgs:{gooEntity:{},gameEntity:{}}},REGISTER_ACTIVE_ENTITY:{type:"REGISTER_ACTIVE_ENTITY",eArgs:{entity:{}}},UPDATE_ACTIVE_ENTITIES:{type:"UPDATE_ACTIVE_ENTITIES",eArgs:{frameTime:0}},UPDATE_ENVIRONMENT:{type:"UPDATE_ENVIRONMENT",eArgs:{envVars:{}}},SPAWN_CLOUDS:{type:"SPAWN_CLOUDS",eArgs:{pos:[],size:[],intensity:0}},SLIDE_OVERLAY_UP:{type:"SLIDE_OVERLAY_UP",eArgs:{elementId:""}},SLIDE_OVERLAY_IN:{type:"SLIDE_OVERLAY_IN",eArgs:{elementId:""}},TRIGGER_ANIMATION:{type:"TRIGGER_ANIMATION",eArgs:{elementId:"",animData:{}}},TRIGGER_FEEDBACK:{type:"TRIGGER_FEEDBACK",eArgs:{elementId:"",feedback:{}}},FETCH_SOUND:{type:"FETCH_SOUND",eArgs:{soundData:{},callback:e}},FETCH_BUFFER:{type:"FETCH_BUFFER",eArgs:{soundData:{},callback:e}},STOP_SOUND:{type:"STOP_SOUND",eArgs:{playId:""}},ONESHOT_SOUND:{type:"ONESHOT_SOUND",eArgs:{soundData:{}}},START_SOUND_LOOP:{type:"START_SOUND_LOOP",eArgs:{soundData:{},loopId:"",callback:function(){}}},STOP_SOUND_LOOP:{type:"STOP_SOUND_LOOP",eArgs:{loopId:""}},SEND_SOUND_TO_REVERB:{type:"SEND_SOUND_TO_REVERB",eArgs:{node:{}}},SEND_SOUND_TO_LISTENER:{type:"SEND_SOUND_TO_LISTENER",eArgs:{node:{}}},SEND_SOUND_TO_MASTER:{type:"SEND_SOUND_TO_MASTER",eArgs:{node:{}}},SEND_SOUND_TO_DESTINATION:{type:"SEND_SOUND_TO_DESTINATION",eArgs:{node:{}}},MOVE_AUDIO_LISTENER:{type:"MOVE_AUDIO_LISTENER",eArgs:{pos:[],rot:[],vel:[]}},REGISTER_AUDIO_CONTEXT:{type:"REGISTER_AUDIO_CONTEXT",eArgs:{context:{},model:""}},MIX_CHANNEL_VALUE:{type:"MIX_CHANNEL_VALUE",eArgs:{channelId:"",valueId:"",amount:0}},ONESHOT_AMBIENT_SOUND:{type:"ONESHOT_AMBIENT_SOUND",eArgs:{soundData:{},pos:[],vel:[],dir:[]}},LOOP_AMBIENT_SOUND:{type:"LOOP_AMBIENT_SOUND",eArgs:{soundData:{},playId:"",callback:e}},UPDATE_FEEDBACK_VALUE:{type:"UPDATE_FEEDBACK_VALUE",eArgs:{elementId:"",number:0,text:""}},BROADCAST_VIDEO:{type:"BROADCAST_VIDEO",eArgs:{source:"",channel:""}},PLAY_PARTICLE:{type:"PLAY_PARTICLE",eArgs:{effectType:"",duration:0}},CONFIGURE_CONTROLLER:{type:"CONFIGURE_CONTROLLER",eArgs:{}}}}),define("feedback/AnimationList",[],function(){return{REMOVE_LOADING_SCREEN:{mode:"to",time:3.2,values:{x:"0px",y:"-300%",rotationX:"-270deg",scale:"0",delay:.5}},ROLLING_BUTTON_OUT:{mode:"to",time:1.2,values:{x:"0px",y:"100%",rotationX:"-370deg",scale:"0.8",opacity:0}},ROLLING_BUTTON_IN:{mode:"to",time:.6,values:{x:"0px",y:"0px",rotationX:"0deg",scale:"1",opacity:1}},BUTTON_BUMP:{mode:"from",time:.4,values:{scale:"1.2",ease:"Elastic.easeOut"}},BUTTON_CLEAR:{mode:"to",time:.001,values:{scale:"1"}},NUMBER_BUMP:{mode:"from",time:.7,values:{scale:"0.1",ease:"Elastic.easeOut"}},RESET_SCALE:{mode:"to",time:.03,values:{scale:"1"}},QUICK_BUMP:{mode:"from",time:.4,values:{scale:"0.3",ease:"Back.easeOut"}},QUICK_SHRINK:{mode:"to",time:.2,values:{scale:"0.01",ease:"Back.easeIn"}},QUICK_SCALE:{mode:"to",time:.45,values:{scale:"1",ease:"Back.easeOut"}},BIGWIN_BUMP:{mode:"to",time:.5,values:{scale:"1",ease:"Elastic.easeOut"}},BIGWIN_FLASH_IN:{mode:"to",time:.12,values:{scale:"1",ease:"Back.easeIn"}},BIGWIN_FLASH_OUT:{mode:"to",time:.22,values:{scale:"0",ease:"Linear.easeOut"}},STAR_FLASH_IN:{mode:"to",time:.12,values:{scale:"1",ease:"Quad.easeIn"}},STAR_FLASH_OUT:{mode:"to",time:1.02,values:{scale:"0",opacity:0,rotationX:"0deg",rotationY:"0deg",rotationZ:"25deg",ease:"Quad.easeOut"}},BUMP_UP:{mode:"to",time:.14,values:{scale:"1.12",ease:"Back.easeIn"}},BUMP_BACK:{mode:"to",time:.2,values:{scale:"1",ease:"Back.easeOut"}},TEXT_FLASH_TO_WHITE:{mode:"from",time:.08,values:{color:"#fff",ease:"Linear.easeIn"}},TEXT_FLASH_TO_BLUE:{mode:"from",time:.2,values:{color:"#ade9ff",ease:"Linear.easeIn"}},LOAD_HIDE:{mode:"to",time:1.1,values:{opacity:"0",ease:"Quad.easeIn"}},LOAD_SHOW:{mode:"to",time:.5,values:{opacity:"1",ease:"Quad.easeIn"}},HIDE_CONTAINER_UP:{mode:"to",time:0,toPercent:{y:-100},values:{y:"0"}},SLIDE_CONTAINER_DOWN:{mode:"to",time:1.1,toPercent:{y:100},values:{y:"0",ease:"Quad.easeIn"}},SLIDE_CONTAINER_UP:{mode:"to",time:1.1,toPercent:{y:-100},values:{y:"0",ease:"Quad.easeIn"}},SLIDE_CONTAINER_IN:{mode:"to",time:1.1,toPercent:{y:0},values:{y:"0",ease:"Quad.easeIn"}},PREP_FLIP_IN:{mode:"to",time:.001,values:{scale:"0.8",rotationX:"-90deg"}},VALUE_UPDATE_FLIP:{mode:"to",time:.35,values:{rotationX:"0deg",scale:"1"}},FLICK:{mode:"to",time:.4,values:{rotationZ:"0deg",scale:"1"}},ROLL_WORD_OUT:{mode:"to",time:1.3,values:{y:"-20%",rotationX:"-770deg",scale:"0.6",opacity:0,delay:.1,ease:"Back.easeIn"}},PREP_WORD_UPDATE:{mode:"to",time:.001,values:{x:"0px",y:"-40px",rotationZ:"-24deg",rotationX:"-90deg",scale:"1"}},WORD_UPDATE:{mode:"to",time:.55,values:{y:"0px",rotationZ:"0deg",rotationX:"0deg",scale:"1",opacity:1}},LIFT_WORD_0:{mode:"to",time:1.75,values:{x:"-170%",y:"-20px",rotationZ:"-20deg",rotationX:"0deg",scale:"1.2",ease:"Linear.easeIn"}},LIFT_WORD_1:{mode:"to",time:1.95,values:{x:"0px",y:"-50px",rotationZ:"0deg",rotationX:"0deg",scale:"1.2",ease:"Linear.easeIn"}},LIFT_WORD_2:{mode:"to",time:1.75,values:{x:"170%",y:"-20px",rotationZ:"20deg",rotationX:"0deg",scale:"1.2",ease:"Linear.easeIn"}},PRESENT_LEVEL_SHOW:{mode:"to",time:.45,values:{y:"0px",rotationX:"0deg",rotationZ:"2deg",scale:"0.93",delay:.05,ease:"Linear.easeIn"}},PRESENT_LEVEL_NONE:{mode:"to",time:.55,values:{y:"-25px",ease:"Back.easeOut",rotationX:"-20deg",rotationZ:"4deg",scale:"1.3",opacity:1,backgroundColor:"#888",color:"#ccc",textShadow:"0px 0px 0.2em #aaa"}},PRESENT_LEVEL_SMALL:{mode:"to",time:.65,values:{y:"-45px",ease:"Linear.easeOut",rotationX:"30deg",rotationZ:"10deg",scale:"1.4",opacity:1,backgroundColor:"#2a2",color:"#9f9",textShadow:"0px 0px 0.3em rgb(75, 255, 75)"}},PRESENT_LEVEL_MEDIUM:{mode:"to",time:.75,values:{y:"-55px",ease:"Linear.easeOut",rotationX:"10deg",rotationZ:"-16deg",scale:"1.5",opacity:1,backgroundColor:"rgb(26, 230, 204)",color:"rgb(184, 255, 252)",textShadow:"0px 0px 0.4em rgb(26, 230, 204)"}},PRESENT_LEVEL_BIG:{mode:"to",time:.85,values:{y:"-60px",ease:"Linear.easeOut",rotationX:"340deg",rotationZ:"-14deg",scale:"1.6",opacity:1,backgroundColor:"rgb(230, 179, 16)",color:"rgb(255, 249, 184)",textShadow:"0px 0px 0.5em rgb(230, 179, 16)",delay:.4}},PRESENT_LEVEL_RARE:{mode:"to",time:.95,values:{y:"-75px",ease:"Linear.easeOut",rotationX:"360deg",rotationZ:"354deg",scale:"1.7",opacity:1,backgroundColor:"rgb(230, 16, 179)",color:"rgb(255, 184, 255)",textShadow:"0px 0px 0.6em rgb(230, 16, 179)",delay:.6}},PRESENT_LEVEL_EPIC:{mode:"to",time:1,values:{y:"-80px",ease:"Linear.easeOut",rotationX:"0deg",rotationZ:"-714deg",scale:"1.8",opacity:1,backgroundColor:"rgb(197, 144, 253)",color:"rgb(235, 195, 243)",textShadow:"0px 0px 0.9em rgb(197, 144, 253)",delay:.6}},PRESENT_LEVEL_HIDE:{mode:"to",time:.85,values:{y:"500%",rotationX:"-20deg",scale:"0",backgroundColor:"#000",color:"#000",textShadow:"0px 0px 0.2em #000",delay:.2}},SYMBOL_HIDE:{mode:"to",time:0,toPercent:{y:-100},values:{y:"-1"}},SYMBOL_SPIN:{mode:"to",time:0,toPercent:{y:100},values:{y:"1",ease:"Back.easeIn"}},SYMBOL_LAND:{mode:"to",time:0,values:{y:"0",ease:"Back.easeOut"}},CLEAR_DICE_POTENTIAL:{mode:"to",time:.35,values:{rotationZ:"-690deg",scale:0,ease:"Linear.easeIn"}},PRESENT_DICE_POTENTIAL_1:{mode:"to",time:.52,values:{scale:"1.5",opacity:1,ease:"Back.easeIn"}},PRESENT_DICE_POTENTIAL_2:{mode:"to",time:.85,values:{scale:"1.5",opacity:1,ease:"Back.easeIn"}},SPIN_CW:{mode:"to",time:3,values:{rotationZ:"+=390deg",ease:"Linear.easeIn"}},SPIN_CCW_1:{mode:"to",time:3,values:{rotationZ:"+=-290deg",ease:"Linear.easeIn"}},SPIN_CCW_2:{mode:"to",time:3,values:{rotationZ:"+=190deg",ease:"Linear.easeIn"}},PREPOS_PARTICLE:{mode:"to",time:.01,toPercent:{y:0},values:{scale:0,y:-1,rotationZ:"0deg",rotationY:"0deg",rotationX:"0deg",ease:"Linear.easeIn"}},WIN_PARTICLE_1:{mode:"to",time:1,toPercent:{y:150},values:{y:1,delay:.1,ease:"Quad.easeIn"}},LOAD_WILD:{mode:"to",time:0,toPercent:{y:0,x:-15},values:{y:1,x:1,ease:"Cubic.easeIn"}},EXIT_WILD:{mode:"to",time:.21,toPercent:{y:-35},values:{y:1,ease:"Cubic.easeIn"}},WHEEL_LIFT:{mode:"to",time:.16,toPercent:{y:-8},values:{y:1,ease:"Cubic.easeOut"}},WHEEL_PULL:{mode:"to",time:.13,values:{y:0,ease:"Quad.easeIn"}},WHEEL_STOP:{mode:"to",time:.21,toPercent:{y:5},values:{y:1,ease:"Quad.easeOut"}}}}),define("game/GameConfiguration",[],function(){return{GAME_IDENTITY:{title:"Tunnan & Friends",tagLine:"Early test version for you to fly"},WORLD_PROPERTIES:{gravity:[0,-9.81,0],newton:9.81,speedOfSound:340.29},PLAYER_INIT:{startSpatial:{pos:[342,18.2,2880],vel:[0,1e-4,0],rot:[0,Math.PI*.5,0]},landingStrip:{pos:[2861,15,2388]},approach:{pos:[650,620,1e3]},stratosphere:{pos:[-1050,35690,3e3]},battle:{pos:[2750,820,2310]}},AERODYNAMICS:{airMassDensity:1.229,densityPerMeter:8e-5,kelvinsAtSeaLevel:288,kelvinDropByMeterUp:.0065,seaLevelPressure:1.01,gasConstant:8.3,airMolarMass:.0289644},RENDER_SETUP:{targetFPS:60,physicsFPS:100},GAME_SETTINGS:{soundDisable:{values:[0,1],loadIndex:1}},INTRO:{containerId:"intro",stages:[{id:"intro_1",time:2e3},{id:"intro_2",time:1e3},{id:"intro_3",time:1e3}]},MIX_TRACKS:{game:{id:"Game",gain:.5,spatial:!0,fxSend:.9},ambient:{id:"Ambient",gain:.5,spatial:!1,fxSend:1},ui:{id:"UI",gain:.5,spatial:!1,fxSend:.8},music:{id:"Music",gain:.5,spatial:!1}},PRELOAD_IMAGES:["resources/goo/bundles/images/r_back.jpg","resources/goo/bundles/images/r_bottom.jpg","resources/goo/bundles/images/r_front.jpg","resources/goo/bundles/images/r_left.jpg","resources/goo/bundles/images/r_right.jpg","resources/goo/bundles/images/r_top.jpg","resources/goo/bundles/images/PlaneAtlas.png","resources/goo/bundles/images/PlaneAtlasEmit.png","resources/goo/bundles/images/PlaneAtlasSpec.png","resources/goo/bundles/images/PlaneAtlas_Normal.png","resources/goo/bundles/images/nature1024.png"],PRELOAD_GOO_MATERIALS:{},PRELOAD_GOO_MESHES:{},GOO_PROJECTS:{environment:{refFile:"environment.bundle",projectPath:"bundles"},car_pv_9031:{refFile:"pv_9031.bundle",projectPath:"bundles",pv_9031:"pv_9031"},cougar_f9f:{refFile:"cougar_f9f.bundle",projectPath:"bundles",cougar_f9f:"cougar_f9f"},stratofortress:{refFile:"stratofortress.bundle",projectPath:"bundles",b_52:"b_52"},draken:{refFile:"draken.bundle",projectPath:"bundles",draken:"draken"},human:{refFile:"human.bundle",projectPath:"bundles",pilot:"pilot_bind_AO"},tunnan:{refFile:"tunnan.bundle",projectPath:"bundles",tunnan:"tunnan_f"},tre_kronor:{refFile:"tre_kronor.bundle",projectPath:"bundles",tre_kronor:"tre_kronor"},battleship:{refFile:"battleship.bundle",projectPath:"bundles",battleship:"battleship_skinned"},carrier:{refFile:"carrier.bundle",projectPath:"bundles",carrier:"carrier"},nature:{refFile:"trees_rocks.bundle",projectPath:"bundles",tree_leafy:"tree_leafy_30m",tree_40:"tree_leafy_40m",tree_leafy_small:"tree_leafy_small",rock_mossy:"rock_mossy",rock_plain:"rock_plain",rock_tiny:"rock_tiny"},houses:{refFile:"houses.bundle",projectPath:"bundles",hangar_building:"hangar_building",seventeen_big_floors:"17_big_floors",seventeen_floor:"17_floors",ten_floors:"10_floors",cube_22:"cube_22",air_tower:"air_tower",cottage:"cottage"},targets:{refFile:"targets.bundle",projectPath:"bundles",ground_flat:"ground_flat",house_box_3:"house_box_3"},house_t:{refFile:"house_T.bundle",projectPath:"bundles",house_t:"house_T"},air_base:{refFile:"air_base.bundle",projectPath:"bundles",base:"base",roof:"roof",lockers:"lockers",lamps:"lamps"},hilltop_base:{refFile:"hilltop_base.bundle",projectPath:"bundles",base:"hilltop_base",roof:"hilltop_roof",lamps:"hilltop_lights",lamps_inner:"hilltop_lights_inner"},harbor:{refFile:"harbor.bundle",projectPath:"bundles",base:"harbor_base"},tomcat:{refFile:"tomcat.bundle",projectPath:"bundles",tomcat:"tomcat_skinned"},elevator:{refFile:"elevator.bundle",projectPath:"bundles",base:"elevator_base",roof:"elevator_roof"},top_base:{refFile:"top_base.bundle",projectPath:"bundles",base:"top_base",roof:"top_base_roof"},tv_screen:{refFile:"tv_monitors.bundle",projectPath:"bundles",tv:"tv_crt",tv_2:"tv_2",tv_3:"tv_3"},monitor_console:{refFile:"monitor_console.bundle",projectPath:"bundles",monitor_console:"monitor_console"},armaments:{refFile:"armaments.bundle",projectPath:"bundles",bomb_200kg:"bomb_200kg",rocket_7cm:"rocket_7cm",rocket_18cm:"rocket_18cm"},bullet_20:{refFile:"project.project",projectPath:"bullet_project",piecePath:"bullet_red"}},PRELOAD_GOO_SKELETON:{},PRELOAD_GOO_ANIMATION:{},VIDEOS:{sources:{hsi:{funnyCat:"resources/video/funny_cat_352x240.mp4",cuteCat:"resources/video/cute_cat_320x240.mp4",angryCat:"resources/video/angry_cat_screams_at_enemy_cat_640x360.mp4"},vdi:{tunnanPromo:"resources/video/tunnan_short.mp4",marineAd:"resources/video/united_states_marine_corps_640x480.mp4",jetEngine:"resources/video/jet_engine_-_cinema_4d_animation_640x360.mp4"},hud:{memorial:"resources/video/the_collings_foundation_vietnam_memorial_flight.__f-4_phantom_a-4_skyhawk_uh-1_huey_480x240.mp4",dayTrap:"resources/video/day_trap_aboard_the_jfk_640x480.mp4",carrierOps:"resources/video/aircraft_carrier_operation_640x360.mp4"},cats:{funnyCat:"resources/video/funny_cat_352x240.mp4",cuteCat:"resources/video/cute_cat_320x240.mp4",angryCat:"resources/video/angry_cat_screams_at_enemy_cat_640x360.mp4"},promos:{tunnanPromo:"resources/video/tunnan_short.mp4",marineAd:"resources/video/united_states_marine_corps_640x480.mp4",jetEngine:"resources/video/jet_engine_-_cinema_4d_animation_640x360.mp4"},military:{memorial:"resources/video/the_collings_foundation_vietnam_memorial_flight.__f-4_phantom_a-4_skyhawk_uh-1_huey_480x240.mp4",dayTrap:"resources/video/day_trap_aboard_the_jfk_640x480.mp4",carrierOps:"resources/video/aircraft_carrier_operation_640x360.mp4"},history:{strangelove:"resources/video/dr._strangelove_-_ending_640x384.mp4",submarine:"resources/video/submarine_480x272.mp4",bomber:"bomber_480x270.mp4"},animals:{alaska:"resources/video/alaska_mammals_tour_640x350.mp4",frogYear:"resources/video/year_of_the_frog_campaign_568x320.mp4",unFrog:"resources/video/un_frog_640x272.mp4"},planes:{blackbird:"resources/video/sr-71_blackbird_-_the_worlds_fastest_and_highest_flying_aircraft_(jet)_-_youtube_640x480.mp4"},doge:{moonLaunch:"shopdoge.com-_dogecoin_moon_launch_hd__________much_trust_must_doge_640x358"}},channels:{vdi:"vdi",cats:"cats",animals:"animals",promos:"promos",military:"military",history:"history",planes:"planes"}},PRELOAD_GOO_TEXTURES:{jet_particle:"resources/images/particles/shockwave.png",splash_particle:"resources/images/particles/splash.png",shockwave_particle:"resources/images/particles/shockwave.png",fieldring_particle:"resources/images/particles/fieldring.png",spark_particle:"resources/images/particles/spark.png",dot_particle:"resources/images/particles/dot.png",foam_particle:"resources/images/particles/water_foam.png",smoke_particle:"resources/images/particles/smoke.png"},PRELOAD_GOO_SHADERS:{},KEY_BINDINGS:{plane:{cannons:["1",32],throttleUp:["R",107],throttleDown:["F",109],pitchUp:["S",40],pitchDown:["W",38],rollLeft:["A",37],rollRight:["D",39],yawLeft:["Q"],yawRight:["E"],canopy:["C"],gears:["G"],breaksOn:["B"],breaksOff:["V"],flapsDown:["X"],flapsUp:["Z"],eject:["P"],trimPitchUp:["K"],trimPitchDown:["I"],trimRollLeft:["J"],trimRollRight:["L"],trimYawLeft:["U"],trimYawRight:["O"]},car:{breaksOn:["B","X"],breaksOff:["V","Q"],throttleUp:["W",107],throttleDown:["S",109],yawLeft:["A",37],yawRight:["D",39]},move:{forward:["W",38],back:["S",40],turnleft:["A",37],turnright:["D",39],strafeModifier:["-"],jump:[" ","E"]},carrier:{}}}}),define("sound/SoundList",["game/GameConfiguration"],function(e){var t=e.MIX_TRACKS;return{UI_HOVER:{folder:"ui",file:"blipp1",gain:.18,track:t.ui,options:{preload:!0}},UI_ACTIVE:{folder:"ui",file:"blipp2",gain:.16,track:t.ui,options:{preload:!0}},UI_CLICK:{folder:"ui",file:"blipp3",gain:.28,track:t.ui,options:{preload:!0}},UI_OUT:{folder:"ui",file:"blipp4",gain:.05,track:t.ui,options:{preload:!0}},SEATOWN_AMB:{folder:"ambient",file:"seatown_birds",gain:1.45,track:t.game,options:{preload:!0}},DARK_SUSPENS:{folder:"ambient",file:"dark_suspens",gain:.85,track:t.game,options:{preload:!0}},CANNON_20_0:{folder:"shots",file:"cannon_0",gain:1.11,track:t.game,options:{preload:!0,refDist:18,rolloff:1.1}},CANNON_20_1:{folder:"shots",file:"cannon_1",gain:1.11,track:t.game,options:{preload:!0,refDist:18,rolloff:1.1}},CANNON_20_2:{folder:"shots",file:"cannon_2",gain:1.11,track:t.game,options:{preload:!0,refDist:18,rolloff:1.1}},CANNON_20_3:{folder:"shots",file:"cannon_3",gain:1.11,track:t.game,options:{preload:!0,refDist:18,rolloff:1.1}},MAIN_GUN_0:{folder:"shots",file:"main_gun_1",gain:.68,track:t.game,options:{preload:!0,refDist:39,rolloff:.3}},MAIN_GUN_1:{folder:"shots",file:"main_gun_2",gain:.78,track:t.game,options:{preload:!0,refDist:39,rolloff:.3}},MAIN_GUN_2:{folder:"shots",file:"main_gun_3",gain:.98,track:t.game,options:{preload:!0,refDist:39,rolloff:.3}},AAA_0:{folder:"shots",file:"aaa_1",gain:.38,track:t.game,options:{preload:!0,refDist:26,rolloff:.5}},AAA_1:{folder:"shots",file:"aaa_2",gain:.54,track:t.game,options:{preload:!0,refDist:26,rolloff:.5}},AAA_2:{folder:"shots",file:"aaa_3",gain:.68,track:t.game,options:{preload:!0,refDist:26,rolloff:.5}},BULLET_HIT_0:{folder:"hits",file:"cannon_hit_0",gain:.55,track:t.game,options:{preload:!0,refDist:15,rolloff:.1}},BULLET_HIT_1:{folder:"hits",file:"cannon_hit_1",gain:.55,track:t.game,options:{preload:!0,refDist:15,rolloff:.1}},BULLET_HIT_2:{folder:"hits",file:"cannon_hit_2",gain:.55,track:t.game,options:{preload:!0,refDist:25,rolloff:.3}},BULLET_HIT_3:{folder:"hits",file:"cannon_hit_3",gain:.55,track:t.game,options:{preload:!0,refDist:45,rolloff:.5}},MAIN_HIT_0:{folder:"hits",file:"main_hit_0",gain:.58,track:t.game,options:{preload:!0,refDist:36,rolloff:.6}},MAIN_HIT_1:{folder:"hits",file:"main_hit_1",gain:.74,track:t.game,options:{preload:!0,refDist:36,rolloff:.6}},MAIN_HIT_2:{folder:"hits",file:"main_hit_2",gain:.98,track:t.game,options:{preload:!0,refDist:36,rolloff:.6}},AAA_HIT_0:{folder:"hits",file:"aaa_hit_0",gain:.22,track:t.game,options:{preload:!0,refDist:26,rolloff:.6}},AAA_HIT_1:{folder:"hits",file:"aaa_hit_1",gain:.32,track:t.game,options:{preload:!0,refDist:26,rolloff:.6}},AAA_HIT_2:{folder:"hits",file:"aaa_hit_2",gain:.42,track:t.game,options:{preload:!0,refDist:26,rolloff:.6}},SPLASH_0:{folder:"water",file:"splash_0",gain:.41,track:t.game,options:{preload:!0,refDist:6,rolloff:.1}},SPLASH_1:{folder:"water",file:"splash_1",gain:.41,track:t.game,options:{preload:!0,refDist:9,rolloff:.2}},SPLASH_2:{folder:"water",file:"splash_2",gain:.41,track:t.game,options:{preload:!0,refDist:18,rolloff:.4}},SPLASH_3:{folder:"water",file:"splash_3",gain:.41,track:t.game,options:{preload:!0,refDist:26,rolloff:.6}},ENGINE_START:{folder:"jet",file:"jet_start",gain:.5,track:t.game,options:{preload:!0,refDist:32,rolloff:.6}},ENGINE_STOP:{folder:"jet",file:"jetbase_start",gain:1,track:t.game,options:{preload:!0,refDist:22,rolloff:.2}},ENGINE_ON:{folder:"jet",file:"jet_idle",gain:1,track:t.game,options:{preload:!0,refDist:22,rolloff:.3}},ENGINE_GAS:{folder:"jet",file:"jet_wide",gain:1,track:t.game,options:{preload:!0,refDist:12,rolloff:.2}},ENGINE_TONE:{folder:"jet",file:"base_quint",gain:1,track:t.game,options:{preload:!0,refDist:32,rolloff:.7}},STEP_ROAD_1:{folder:"steps",file:"road_step_1",gain:5.46,track:t.ambient,options:{preload:!1,refDist:4,rolloff:.84}},STEP_ROAD_2:{folder:"steps",file:"road_step_2",gain:5.46,track:t.ambient,options:{preload:!1,refDist:4,rolloff:.84}},STEP_ROAD_3:{folder:"steps",file:"road_step_3",gain:5.46,track:t.ambient,options:{preload:!1,refDist:4,rolloff:.84}},STEP_ROAD_4:{folder:"steps",file:"road_step_4",gain:5.46,track:t.ambient,options:{preload:!1,refDist:4,rolloff:.84}},STEP_GRAVEL_1:{folder:"steps",file:"gravel_step_1",gain:10.46,track:t.ambient,options:{preload:!1,refDist:4,rolloff:.84}},STEP_GRAVEL_2:{folder:"steps",file:"gravel_step_2",gain:10.46,track:t.ambient,options:{preload:!1,refDist:4,rolloff:.84}},STEP_GRAVEL_3:{folder:"steps",file:"gravel_step_3",gain:10.46,track:t.ambient,options:{preload:!1,refDist:4,rolloff:.84}},FOUNTAIN_LOOP:{folder:"water",file:"fountain",gain:1,track:t.game,options:{preload:!1,refDist:4,rolloff:.44}},FX_VERB:{folder:"fx",file:"AmbMix",gain:1,track:t.ambient,options:{preload:!0,refDist:4,rolloff:.04}}}}),define("application/EventManager",["application/EventList","feedback/AnimationList","sound/SoundList"],function(e,t,n){var r=document.createElement("div"),i={},s=function(e){this.name="EventArgumentException",this.message=e};s.prototype=Error.prototype;var o=function(){return e},u=function(){return t},a=function(){return n};2;var f=function(e,t){e||console.log("NO EVENT",e);for(index in t)if(typeof e.eArgs[index]!=typeof t[index])throw new s("Invalid event arguments, "+e.type+" does not match type for supplied argument: "+index)},l=function(e,t){return f(e,t),new CustomEvent(e.type,{detail:{arguments:t},bubbles:!1,cancelable:!1})},c=function(e){return e.detail.arguments},h=function(e,t){r.dispatchEvent(l(e,t))},p=function(e,t){i[e.type]=t,r.addEventListener(e.type,t)},d=function(e){r.removeEventListener(e.type,i[e.type],null),delete i[e.type]},v=function(e){alert("test msg:"+c(e).msg)};return{removeListener:d,registerListener:p,eventArgs:c,fireEvent:h,list:o,anim:u,sound:a}});var _gaq=_gaq||[];define("application/AnalyticsWrapper",["application/EventManager"],function(e){var t=0,n={count:0,controls:{}},r=function(e,t,n,r){if(r==undefined)return;console.log("TRACK:",[e,t,n,r]),_gaq.push(["_trackEvent",e,t,n,r])},i=function(i){var s=e.eventArgs(i);if(s.value==undefined)return;if(s.value!=1)return;n.count+=1,n.controls[s.control]||(n.controls[s.control]=0),n.controls[s.control]+=1,n.count>=20&&(t+=1,r("PLAYER_CONTROL",JSON.stringify(n.controls),""+t,n.count),n={count:0,controls:{}})},s=function(t){var n=t.type,i=e.eventArgs(t),s="";for(var o in i)s+=o+" "+i[o]+" ";r("USER ACTION",n,s,1)},o=function(t){var n=e.eventArgs(t);r(n.category,n.action,n.labels,n.value)};e.registerListener(e.list().ANALYTICS_EVENT,o),e.registerListener(e.list().LOADING_COMPLETED,s),e.registerListener(e.list().PLAYER_CONTROL_EVENT,i)}),define("io/Requests",{utils:{LOAD_TEMPLATE:"LOAD_TEMPLATE",LOAD_CONTEXT_SOUND:"LOAD_CONTEXT_SOUND",LOAD_JSON:"LOAD_JSON"},game:{GAME_INIT:"GAME_INIT"}}),define("game/world/ZoneData",[],function(){var e={big_1_1:"big_1_1",big_2_1:"big_2_1",ocean:"Open Ocean",start:"Runway Island",cove:"Cove",peak:"Peak Island"};return{ZONE_ID_LIST:e,FREEFLIGHT_ZONES:{ocean:{id:e.ocean,width:15e3,depth:15e3,height:800,pos:[0,0,0],clouds:{intensity:1},playerSpawn:{plane:{pos:[-1342,620,3280],vel:[0,1e-4,-1],rot:[0,Math.PI*0+9,0],state:0},human:{pos:[-1e3,25.75,0],vel:[0,0,.001],rot:[0,Math.PI*.5,0],state:1}}}},TERRAIN_ZONES:{big_1_1:{id:e.big_1_1,width:5e3,depth:5e3,height:4e3,pos:[5e3,-1e3,5500],heightData:"resources/heightmap/hf_large.png",texture1:"resources/heightmap/tx_large.jpg",tree_spread:1400,clouds:{intensity:0},playerSpawn:{plane:{pos:[2885,218.2,2652],vel:[0,0,.001],rot:[0,Math.PI*.5,0],state:1},human:{pos:[2840,218.5,2528],vel:[0,0,.001],rot:[0,Math.PI*.5,0],state:1},car:{pos:[2868,218.2,2372],vel:[0,0,.001],rot:[0,Math.PI*.5,0],state:1}}},big_2_1:{id:e.big_2_1,width:25e3,depth:25e3,height:4e3,pos:[0,-300,-17500],heightData:"resources/heightmap/hf_large.png",texture1:"resources/heightmap/tx_large.png",tree_spread:3400,clouds:{intensity:0},playerSpawn:{plane:{pos:[2885,218.2,2652],vel:[0,0,.001],rot:[0,Math.PI*.5,0],state:1},human:{pos:[2840,218.5,2528],vel:[0,0,.001],rot:[0,Math.PI*.5,0],state:1},car:{pos:[2868,218.2,2372],vel:[0,0,.001],rot:[0,Math.PI*.5,0],state:1}}},start:{id:e.start,width:5e3,depth:5e3,height:890,pos:[0,-200,0],heightData:"resources/heightmap/128_hf.png",texture1:"resources/heightmap/tx_start.png",tree_spread:600,clouds:{intensity:0},playerSpawn:{plane:{pos:[2885,218.2,2652],vel:[0,0,.001],rot:[0,Math.PI*.5,0],state:1},human:{pos:[2840,214.5,2528],vel:[0,0,.001],rot:[0,Math.PI*.5,0],state:1},car:{pos:[2868,218.2,2372],vel:[0,0,.001],rot:[0,Math.PI*.5,0],state:1}}},cove:{id:e.cove,width:5e3,depth:5e3,height:650,pos:[-7500,-137,500],heightData:"resources/heightmap/hf_cove.png",texture1:"resources/heightmap/tx_cove.png",tree_spread:750,clouds:{intensity:0},playerSpawn:{plane:{pos:[2885,218.2,2652],vel:[0,0,.001],rot:[0,Math.PI*.5,0],state:1},human:{pos:[2840,218.5,2528],vel:[0,0,.001],rot:[0,Math.PI*.5,0],state:1},car:{pos:[2868,218.2,2372],vel:[0,0,.001],rot:[0,Math.PI*.5,0],state:1}}},peak:{id:e.peak,width:5e3,depth:5e3,height:950,pos:[-5128,-350,-5128],heightData:"resources/heightmap/hf_small.png",texture1:"resources/heightmap/tx_small.png",tree_spread:650,clouds:{intensity:.3}}},SPAWN_POINTS:{pilot_runway:{humans:{PILOT:[{pos:[2824,218.2,2370],vel:[0,1e-4,0],rot:[0,Math.PI*.5,0]}]}},air_patrol:{planes:{B52:[{pos:[3700,5e3,4300],vel:[1.04,0,-0.51],rot:[0,0,0],state:2}]}},battleship_assault:{boats:{BATTLESHIP:[{pos:[5700,0,1300],vel:[-0.02,0,-0.08],rot:[0,0,0]},{pos:[6700,0,4300],vel:[-0.02,0,-0.08],rot:[0,0,0]}],TRE_KRONOR:[{pos:[4811,0,3235],vel:[-0.07,0,.1],rot:[0,0,0]},{pos:[6811,0,-1235],vel:[-0.07,0,.1],rot:[0,0,0]},{pos:[8811,0,5235],vel:[-0.07,0,.1],rot:[0,0,0]}]}},carrier:{boats:{CARRIER:[{pos:[4850,0,2700],vel:[0,0,.08],rot:[0,0,0]}]}},ocean:{boats:{CARRIER:[{pos:[-1e3,0,0],vel:[0,0,.08],rot:[0,0,0]}]}},cougar:{planes:{COUGAR:[{pos:[2855,218.2,2390],vel:[0,1e-4,0],rot:[0,Math.PI*.5,0],state:1}]}},draken:{planes:{DRAKEN:[{pos:[2855,218.2,2390],vel:[0,1e-4,0],rot:[0,Math.PI*.5,0],state:1}]}},tunnan:{planes:{TUNNAN:[{pos:[2870,215.75,2515],vel:[0,1e-6,0],rot:[0,Math.PI,0],state:1}]}},tomcat:{planes:{TOMCAT:[{pos:[2840,215.75,2445],vel:[0,1e-6,0],rot:[0,Math.PI*.7,0],state:1}]}},air_base:{targets:{MONITOR_CONSOLE:[{pos:[2826.5,214,2534],vel:[0,1e-4,0],rot:[0,3.14,0],state:1},{pos:[2835.5,214,2534],vel:[0,1e-4,0],rot:[0,3.14,0],state:1},{pos:[2844.5,214,2534],vel:[0,1e-4,0],rot:[0,3.14,0],state:1},{pos:[2836,214,2506.5],vel:[0,1e-4,0],rot:[0,0,0],state:1}]}},practice_range:{targets:{GROUND_FLAT:[{pos:[1250,339.5,1185],vel:[0,1e-4,0],rot:[0,Math.PI,0],state:1},{pos:[1340,339.5,1185],vel:[0,1e-4,0],rot:[0,Math.PI,0],state:1},{pos:[1250,339.5,1255],vel:[0,1e-4,0],rot:[0,Math.PI,0],state:1},{pos:[1340,339.5,1255],vel:[0,1e-4,0],rot:[0,Math.PI,0],state:1},{pos:[1020,339.5,1315],vel:[0,1e-4,0],rot:[0,Math.PI,0],state:1},{pos:[1420,339.5,1395],vel:[0,1e-4,0],rot:[0,Math.PI,0],state:1},{pos:[1020,339.5,1415],vel:[0,1e-4,0],rot:[0,Math.PI,0],state:1},{pos:[1420,339.5,1495],vel:[0,1e-4,0],rot:[0,Math.PI,0],state:1},{pos:[1020,339.5,1515],vel:[0,1e-4,0],rot:[0,Math.PI,0],state:1},{pos:[1420,339.5,1595],vel:[0,1e-4,0],rot:[0,Math.PI,0],state:1},{pos:[1120,339.5,1315],vel:[0,1e-4,0],rot:[0,Math.PI,0],state:1},{pos:[1320,339.5,1395],vel:[0,1e-4,0],rot:[0,Math.PI,0],state:1},{pos:[1120,339.5,1415],vel:[0,1e-4,0],rot:[0,Math.PI,0],state:1},{pos:[1320,339.5,1495],vel:[0,1e-4,0],rot:[0,Math.PI,0],state:1},{pos:[1120,339.5,1515],vel:[0,1e-4,0],rot:[0,Math.PI,0],state:1},{pos:[1320,339.5,1595],vel:[0,1e-4,0],rot:[0,Math.PI,0],state:1}],HOUSE_BOX_30:[{pos:[1260,339.5,3330],vel:[0,1e-4,0],rot:[0,Math.PI*1.1,0],state:1},{pos:[1350,339.5,3410],vel:[0,1e-4,0],rot:[0,Math.PI*1.2,0],state:1},{pos:[1250,339.5,3510],vel:[0,1e-4,0],rot:[0,Math.PI*1.1,0],state:1},{pos:[1135,339.5,3505],vel:[0,1e-4,0],rot:[0,Math.PI*1.1,0],state:1},{pos:[1170,339.5,3400],vel:[0,1e-4,0],rot:[0,Math.PI*1.2,0],state:1},{pos:[1040,339.5,3480],vel:[0,1e-4,0],rot:[0,Math.PI*1.02,0],state:1},{pos:[1025,339.5,3585],vel:[0,1e-4,0],rot:[0,Math.PI*1.1,0],state:1},{pos:[950,339.5,3445],vel:[0,1e-4,0],rot:[0,Math.PI*1.03,0],state:1},{pos:[925,339.5,3545],vel:[0,1e-4,0],rot:[0,Math.PI*1.06,0],state:1}]}},start:{planes:{COUGAR:[{pos:[2865,218.2,2410],vel:[0,1e-4,0],rot:[0,Math.PI*.5,0],state:1}],DRAKEN:[{pos:[2868,218.2,2466],vel:[0,1e-4,0],rot:[0,Math.PI*.5,0],state:1}]},cars:{PV_9031:[{pos:[2832,218.2,2370],vel:[0,1e-4,0],rot:[0,Math.PI*.5,0]}]}}}}}),define("game/world/levels/ZoneLevels",["game/GameConfiguration","game/world/ZoneData"],function(e,t){var n={start:{zoneId:t.ZONE_ID_LIST.start,gooProjects:[e.GOO_PROJECTS.harbor,e.GOO_PROJECTS.top_base,e.GOO_PROJECTS.elevator,e.GOO_PROJECTS.hilltop_base,e.GOO_PROJECTS.air_base,e.GOO_PROJECTS.houses],buildings:[{model:e.GOO_PROJECTS.harbor.base,entries:[{pos:[3605,13.7,4615],rot:[0,4.71,0]}]},{model:e.GOO_PROJECTS.top_base.base,entries:[{pos:[3014,381,3605],rot:[0,2.5*3.14,0]}]},{model:e.GOO_PROJECTS.top_base.roof,entries:[{pos:[3014,381,3605],rot:[0,2.5*3.14,0]}]},{model:e.GOO_PROJECTS.elevator.base,entries:[{pos:[3839,84,858],rot:[0,2.5*3.14,0]}]},{model:e.GOO_PROJECTS.elevator.roof,entries:[{pos:[3839,84,858],rot:[0,2.5*3.14,0]}]},{model:e.GOO_PROJECTS.hilltop_base.base,entries:[{pos:[3753,293,1515],rot:[0,2.5*3.14,0]}]},{model:e.GOO_PROJECTS.hilltop_base.roof,entries:[{pos:[3753,293,1515],rot:[0,2.5*3.14,0]}]},{model:e.GOO_PROJECTS.hilltop_base.lamps,entries:[{pos:[3753,293,1515],rot:[0,2.5*3.14,0]}]},{model:e.GOO_PROJECTS.hilltop_base.lamps_inner,entries:[{pos:[3753,293,1515],rot:[0,2.5*3.14,0]}]},{model:e.GOO_PROJECTS.air_base.base,entries:[{pos:[2791,218.2,2515],rot:[0,3.14,0]}]},{model:e.GOO_PROJECTS.air_base.roof,entries:[{pos:[2791,218.2,2515],rot:[0,3.14,0]}]},{model:e.GOO_PROJECTS.air_base.lamps,entries:[{pos:[2791,218.2,2515],rot:[0,3.14,0]}]},{model:e.GOO_PROJECTS.air_base.lockers,entries:[{pos:[2791,218.2,2515],rot:[0,3.14,0]}]},{model:e.GOO_PROJECTS.houses.hangar_building,entries:[{pos:[3040,218.2,2515],rot:[0,0,0]},{pos:[3100,218.2,2515],rot:[0,0,0]}]}]},cove:{zoneId:t.ZONE_ID_LIST.cove,gooProjects:[e.GOO_PROJECTS.harbor,e.GOO_PROJECTS.top_base,e.GOO_PROJECTS.elevator,e.GOO_PROJECTS.hilltop_base,e.GOO_PROJECTS.air_base,e.GOO_PROJECTS.houses],buildings:[{model:e.GOO_PROJECTS.air_base.base,entries:[{pos:[2791,218.2,2515],rot:[0,3.14,0]}]},{model:e.GOO_PROJECTS.air_base.roof,entries:[{pos:[2791,218.2,2515],rot:[0,3.14,0]}]},{model:e.GOO_PROJECTS.air_base.lamps,entries:[{pos:[2791,218.2,2515],rot:[0,3.14,0]}]},{model:e.GOO_PROJECTS.air_base.lockers,entries:[{pos:[2791,218.2,2515],rot:[0,3.14,0]}]}]}};return{ZONES:n}}),define("game/scenario/ScenarioDefinitions",["game/world/ZoneData","game/world/levels/ZoneLevels","game/GameConfiguration"],function(e,t,n){return{SCENARIOS:{carrier_patrol:{IDENTITY:{title:"Carrier at sea",tagLine:"Play around with the Carrier."},playerVehicle:"TOMCAT",playerCharacter:"PILOT",loadZones:[e.FREEFLIGHT_ZONES.ocean],loadLevels:[],loadPlayer:e.FREEFLIGHT_ZONES.ocean,loadVehicles:[[e.SPAWN_POINTS.ocean],[],[]]},tomcat_freeflight:{IDENTITY:{title:"F-14 Tomcat",tagLine:"Free flight over ocean"},playerVehicle:"TOMCAT",playerCharacter:"PILOT",loadLevels:[],loadZones:[e.FREEFLIGHT_ZONES.ocean],loadPlayer:e.FREEFLIGHT_ZONES.ocean,loadVehicles:[[]]},tunnan_freeflight:{IDENTITY:{title:"J-29 Tunnan",tagLine:"Free flight over ocean"},playerVehicle:"TUNNAN",playerCharacter:"PILOT",loadZones:[e.FREEFLIGHT_ZONES.ocean],loadPlayer:e.FREEFLIGHT_ZONES.ocean,loadVehicles:[[]],loadLevels:[]},draken_freeflight:{IDENTITY:{title:"J-35 Draken",tagLine:"Free flight over ocean"},playerVehicle:"DRAKEN",loadZones:[e.FREEFLIGHT_ZONES.ocean],loadPlayer:e.FREEFLIGHT_ZONES.ocean,loadVehicles:[[]],loadProjects:{human:n.GOO_PROJECTS.human,vehicles:n.GOO_PROJECTS.draken,bullet_20:n.GOO_PROJECTS.bullet_20,environment:n.GOO_PROJECTS.environment}},cougar_freeflight:{IDENTITY:{title:"Cougar F9F",tagLine:"Free flight over ocean"},playerVehicle:"COUGAR",loadZones:[e.FREEFLIGHT_ZONES.ocean],loadPlayer:e.FREEFLIGHT_ZONES.ocean,loadVehicles:[[]],loadProjects:{human:n.GOO_PROJECTS.human,vehicles:n.GOO_PROJECTS.cougar_f9f,bullet_20:n.GOO_PROJECTS.bullet_20}},b52_freeflight:{IDENTITY:{title:"B-52",tagLine:"Free flight over ocean"},playerVehicle:"B52",loadZones:[e.FREEFLIGHT_ZONES.ocean],loadPlayer:e.FREEFLIGHT_ZONES.ocean,loadVehicles:[[]],loadProjects:{human:n.GOO_PROJECTS.human,stratofortress:n.GOO_PROJECTS.stratofortress}},tunnan_takeoff:{IDENTITY:{title:"Mysterious Island",tagLine:"An island with things to land on and shoot at"},playerCharacter:"PILOT",loadZones:[e.TERRAIN_ZONES.start],loadLevels:[t.ZONES.start],loadPlayer:e.TERRAIN_ZONES.start,loadVehicles:[[e.SPAWN_POINTS.air_base,e.SPAWN_POINTS.tomcat,e.SPAWN_POINTS.tunnan,e.SPAWN_POINTS.practice_range,e.SPAWN_POINTS.carrier],[],[]],loadProjects:{}},draken_takeoff:{IDENTITY:{title:"J-35 Draken",tagLine:"Island runway takeoff"},playerCharacter:"PILOT",loadZones:[e.TERRAIN_ZONES.start],loadLevels:[t.ZONES.start],loadPlayer:e.TERRAIN_ZONES.start,loadVehicles:[[e.SPAWN_POINTS.draken]],loadProjects:{human:n.GOO_PROJECTS.human,environment:n.GOO_PROJECTS.environment,houses:n.GOO_PROJECTS.houses,house_t:n.GOO_PROJECTS.house_t,draken:n.GOO_PROJECTS.draken,nature:n.GOO_PROJECTS.nature,air_base:n.GOO_PROJECTS.air_base,bullet_20:n.GOO_PROJECTS.bullet_20}},cougar_takeoff:{IDENTITY:{title:"Cougar F9F",tagLine:"Island runway takeoff"},playerCharacter:"PILOT",loadZones:[e.TERRAIN_ZONES.start],loadLevels:[t.ZONES.start],loadPlayer:e.TERRAIN_ZONES.start,loadVehicles:[[e.SPAWN_POINTS.cougar]],loadProjects:{human:n.GOO_PROJECTS.human,environment:n.GOO_PROJECTS.environment,houses:n.GOO_PROJECTS.houses,house_t:n.GOO_PROJECTS.house_t,cougar_f9f:n.GOO_PROJECTS.cougar_f9f,nature:n.GOO_PROJECTS.nature,air_base:n.GOO_PROJECTS.air_base,bullet_20:n.GOO_PROJECTS.bullet_20}},human_pilot:{IDENTITY:{title:"Purity of Essence",tagLine:"Intercept the Rogue B-52"},playerCharacter:"PILOT",loadZones:[e.TERRAIN_ZONES.start,e.FREEFLIGHT_ZONES.ocean],loadPlayer:e.TERRAIN_ZONES.start,loadLevels:[t.ZONES.start],loadVehicles:[[e.SPAWN_POINTS.start,e.SPAWN_POINTS.air_patrol],[],[],[]],loadProjects:{human:n.GOO_PROJECTS.human,environment:n.GOO_PROJECTS.environment,houses:n.GOO_PROJECTS.houses,house_t:n.GOO_PROJECTS.house_t,draken:n.GOO_PROJECTS.draken,cougar_f9f:n.GOO_PROJECTS.cougar_f9f,car_pv_9031:n.GOO_PROJECTS.car_pv_9031,nature:n.GOO_PROJECTS.nature,stratofortress:n.GOO_PROJECTS.stratofortress,air_base:n.GOO_PROJECTS.air_base,bullet_20:n.GOO_PROJECTS.bullet_20}},battleship_battle:{IDENTITY:{title:"Fleet Battle",tagLine:"A fleet of ships are battling it out at the island."},playerCharacter:"PILOT",loadZones:[e.TERRAIN_ZONES.start,e.FREEFLIGHT_ZONES.ocean],loadPlayer:e.TERRAIN_ZONES.start,loadLevels:[t.ZONES.start],loadVehicles:[[e.SPAWN_POINTS.air_base,e.SPAWN_POINTS.tunnan,e.SPAWN_POINTS.practice_range,e.SPAWN_POINTS.battleship_assault,e.SPAWN_POINTS.carrier],[]],loadProjects:{human:n.GOO_PROJECTS.human,houses:n.GOO_PROJECTS.houses,tre_kronor:n.GOO_PROJECTS.tre_kronor,battleship:n.GOO_PROJECTS.battleship,carrier:n.GOO_PROJECTS.carrier,tunnan:n.GOO_PROJECTS.tunnan,nature:n.GOO_PROJECTS.nature,air_base:n.GOO_PROJECTS.air_base,top_base:n.GOO_PROJECTS.top_base,harbor:n.GOO_PROJECTS.harbor,hilltop_base:n.GOO_PROJECTS.hilltop_base,elevator:n.GOO_PROJECTS.elevator,targets:n.GOO_PROJECTS.targets,bullet_20:n.GOO_PROJECTS.bullet_20,environment:n.GOO_PROJECTS.environment}},b52_chase:{IDENTITY:{title:"B-52 Chase",tagLine:"Chase the B-52"},playerVehicle:"DRAKEN",loadZones:[e.FREEFLIGHT_ZONES.ocean],loadPlayer:e.FREEFLIGHT_ZONES.ocean,loadVehicles:[[e.SPAWN_POINTS.air_patrol]],loadProjects:{human:n.GOO_PROJECTS.human,draken:n.GOO_PROJECTS.draken,stratofortress:n.GOO_PROJECTS.stratofortress,bullet_20:n.GOO_PROJECTS.bullet_20}},three_world_islands:{IDENTITY:{title:"Tri Isles",tagLine:"Explore the three islands "},playerVehicle:"TUNNAN",loadZones:[e.TERRAIN_ZONES.start,e.TERRAIN_ZONES.peak,e.TERRAIN_ZONES.cove,e.FREEFLIGHT_ZONES.ocean],loadPlayer:e.TERRAIN_ZONES.start,loadVehicles:[[e.SPAWN_POINTS.start,e.SPAWN_POINTS.battleship_assault],[],[],[]],loadProjects:{human:n.GOO_PROJECTS.human,tre_kronor:n.GOO_PROJECTS.tre_kronor,battleship:n.GOO_PROJECTS.battleship,tunnan:n.GOO_PROJECTS.tunnan,cougar_f9f:n.GOO_PROJECTS.cougar_f9f,draken:n.GOO_PROJECTS.draken,car_pv_9031:n.GOO_PROJECTS.car_pv_9031,nature:n.GOO_PROJECTS.nature,bullet_20:n.GOO_PROJECTS.bullet_20}}}}}),require(["application/EventManager","io/InputSettersGetters"],function(e,t){var n=[],r=!1,i=(new Date).getTime(),s=10,o={cameraDrag:!1,pointerDrag:!1},u={movestate:"stop",forward:0,mouseSteer:0,mouseForward:[0,0],back:0,turnright:0,turnleft:0,jump:0},a,f=function(e){u.mouseForward=e,r==1,c(u)},l=function(t,n){e.fireEvent(e.list().PLAYER_MOVEMENT_INPUT,{movestate:t,turnSpeed:n});return;var r,i,s},c=function(e){var t="stop",n=e.turnleft-e.turnright;e.forward+e.mouseForward[0]*e.mouseForward[1]-e.back>0&&(t="walk"),e.forward-e.back<0&&(t="back"),u.mouseSteer==1&&n!=0&&(t=="walk"&&(e.turnright==1&&(t="st_f_r"),e.turnleft==1&&(t="st_f_l")),t=="back"&&(e.turnright==1&&(t="st_b_r"),e.turnleft==1&&(t="st_b_l")),t=="stop"&&(e.turnright==1&&(t="st_r"),e.turnleft==1&&(t="st_l")),n=0),u.movestate=t,u=e,l(u.movestate,n)},h=function(e){if(u.mouseSteer==1){var t=-e.visuals.pointer.getRotY(),n=-e.visuals.head.collada.getRotY();Math.abs(t-n)<.13,e.spatial.dir[0]=scene.camEntity.spatial.dir[0],e.spatial.dir[2]=scene.camEntity.spatial.dir[2]}},p=function(t,n){t[1]==1?u.mouseSteer=1:u.mouseSteer=0,t[1]==1&&!o.cameraDrag?(o.cameraDrag=!0,e.fireEvent(e.list().START_CAMERA_DRAG,{xy:n})):o.cameraDrag==1&&(o.cameraDrag=!1,e.fireEvent(e.list().STOP_CAMERA_DRAG,{})),t[0]==1&&!o.pointerDrag?(o.pointerDrag=!0,e.fireEvent(e.list().START_POINTER_DRAG,{xy:n})):t[0]==0&&o.pointerDrag==1&&(o.pointerDrag=!1,e.fireEvent(e.list().STOP_POINTER_DRAG,{})),f(t)},d=function(e){for(var n in e)for(var r=0;r<e[n].length;r++){var i=e[n][r];t.registeKeyBinding(n,i)}},v=function(e){for(var n in e)for(var r=0;r<e[n].length;r++){var i=e[n][r];t.unregisteKeyBinding(n,i)}},m=function(t){var n=e.eventArgs(t);p(n.action,n.xy)},g=function(t){d(e.eventArgs(t).bindings)},y=function(t){v(e.eventArgs(t).bindings)};return e.registerListener(e.list().CLEAR_KEYBINDINGS,y),e.registerListener(e.list().ADD_KEYBINDINGS,g),e.registerListener(e.list().MOUSE_ACTION,m),{setMouseForward:f,setMouseAction:p}}),define("io/PlayerMovementInput",function(){}),define("io/MouseListener",["application/EventManager"],function(e){var t=[0,0],n=function(e,n){var r=[0,0];switch(n){case"RIGHT":switch(e){case"mousedown":t[1]=1,r=t;break;case"mouseup":t[1]=0,r=t;break;case"mouseout":break;case"click":}break;case"LEFT":switch(e){case"mousedown":t[0]=1,r=t;break;case"mouseup":t[0]=0,r=t;break;case"click":t[1]==0}break;case"MIDDLE":switch(e){case"mousedown":r=[1,1];break;case"mouseup":r=[0,0];break;case"click":}}return r},r=function(e){var t="LEFT";return e.which?(e.which==3&&(t="RIGHT"),e.which==2&&(t="MIDDLE")):e.button&&(e.button==2&&(t="RIGHT"),e.button==4&&(t="MIDDLE")),n(e.type,t)},i=function(t,n){function i(t){t.stopPropagation();var i=t==null?e:t;n(r(i))}t.onmouseup=i,t.onclick=i,t.onmousedown=i,t.onmouseout=i};return{setElementClickFunction:i}}),define("goo/math/MathUtils",[],function(){function e(){}return e.DEG_TO_RAD=Math.PI/180,e.RAD_TO_DEG=180/Math.PI,e.HALF_PI=.5*Math.PI,e.TWO_PI=2*Math.PI,e.EPSILON=1e-7,e.radFromDeg=function(t){return t*e.DEG_TO_RAD},e.degFromRad=function(t){return t*e.RAD_TO_DEG},e.lerp=function(e,t,n){return t===n?t:t+(n-t)*e},e.clamp=function(e,t,n){return t<n?e<t?t:e>n?n:e:e<n?n:e>t?t:e},e.moduloPositive=function(e,t){var n=e%t;return n+=n<0?t:0,n},e.scurve3=function(e){return(-2*e+3)*e*e},e.scurve5=function(e){return((6*e-15)*e+10)*e*e*e},e.sphericalToCartesian=function(e,t,n,r){var i=e*Math.cos(n);r.x=i*Math.cos(t),r.y=e*Math.sin(n),r.z=i*Math.sin(t)},e.cartesianToSpherical=function(e,t,n,r){var i=Math.sqrt(e*e+n*n);r.x=Math.sqrt(e*e+t*t+n*n),r.y=Math.atan2(n,e),r.z=Math.atan2(t,i)},e.getTriangleNormal=function(e,t,n,r,i,s,o,u,a){var f=r-e,l=i-t,c=s-n,h=o-e,p=u-t,d=a-n,v=l*d-c*p,m=c*h-f*d,g=f*p-l*h;return[v,m,g]},e.isPowerOfTwo=function(e){return(e&e-1)===0},e.nearestHigherPowerOfTwo=function(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))},e.closeTo=function(e,t,n){return n=typeof n!="undefined"?n:.001,Math.abs(e-t)<=n},e.sign=function(e){return e<0?-1:e>0?1:0},e.triangleArea=function(e,t,n){return Math.abs(e.x*t.y+t.x*n.y+n.x*e.y-t.y*n.x-n.y*e.x-e.y*t.x)/2},e.barycentricInterpolation=function(t,n,r,i){var s=e.triangleArea(n,r,i),o=e.triangleArea(t,r,i),u=e.triangleArea(t,n,i),a=s+o+u;if(!a){if(i[0]===t[0]&&i[2]===t[2])return t;if(i[0]===n[0]&&i[2]===n[2])return n;if(i[0]===r[0]&&i[2]===r[2])return r}return i.z=(s*t.z+o*n.z+u*r.z)/a,i},e}),define("goo/math/Vector",["goo/math/MathUtils"],function(e){function t(e){this.data=new Float32Array(e||0)}return t.prototype.setupAliases=function(e){var t=this;for(var n=0;n<e.length;n++)(function(r){for(var s=0;s<e[r].length;s++)Object.defineProperty(t,e[r][s],{get:function(){return this.data[r]},set:function(e){this.data[r]=e}});Object.defineProperty(t,n,{get:function(){return this.data[r]},set:function(e){this.data[r]=e}})})(n)},t.add=function(e,n,r){var i=e.data||e,s=n.data||n,o=i.length;r||(r=new t(o));if(s.length!==o||r.data.length!==o)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var u=0;u<o;u++)r.data[u]=i[u]+s[u];return r},t.prototype.add=function(e){return t.add(this,e,this)},t.sub=function(e,n,r){var i=e.data||e,s=n.data||n,o=i.length;r||(r=new t(o));if(s.length!==o||r.data.length!==o)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var u=0;u<o;u++)r.data[u]=i[u]-s[u];return r},t.prototype.sub=function(e){return t.sub(this,e,this)},t.mul=function(e,n,r){var i=e.data||e,s=n.data||n,o=i.length;r||(r=new t(o));if(s.length!==o||r.data.length!==o)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var u=0;u<o;u++)r.data[u]=i[u]*s[u];return r},t.prototype.mul=function(e){return t.mul(this,e,this)},t.div=function(e,n,r){var i=e.data||e,s=n.data||n,o=i.length;r||(r=new t(o));if(s.length!==o||r.data.length!==o)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var u=0;u<o;u++)r.data[u]=i[u]/s[u];return r},t.prototype.div=function(e){return t.div(this,e,this)},t.copy=function(e,n){var r=e.data.length;n||(n=new t(r));if(n.data.length!==r)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return n.data.set(e.data),n},t.prototype.copy=function(e){return t.copy(e,this)},t.dot=function(e,t){var n=e.data||e,r=t.data||t,i=n.length;if(r.length!==i)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var s=0;for(var o=0;o<i;o++)s+=n[o]*r[o];return s},t.prototype.dot=function(e){return t.dot(this,e)},t.apply=function(e,n,r){var i=e.rows,s=e.cols,o=n.data.length;r||(r=new t(i));if(r.data.length!==i||s!==o)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};if(r===n)return t.copy(t.apply(e,n),r);for(var u=0;u<s;u++){var a=u*i;for(var f=0;f<i;f++){var l=0;for(var c=0;c<o;c++)l+=e.data[c*e.rows+f]*n.data[c];r.data[a+f]=l}}return r},t.prototype.apply=function(e){return t.apply(e,this,this)},t.equals=function(t,n){var r=t.data.length;if(r!==n.data.length)return!1;for(var i=0;i<r;i++)if(Math.abs(t.data[i]-n.data[i])>e.EPSILON)return!1;return!0},t.prototype.equals=function(e){return t.equals(this,e)},t.distanceSquared=function(e,n){return t.sub(e,n).lengthSquared()},t.prototype.distanceSquared=function(e){return t.sub(this,e).lengthSquared()},t.distance=function(e,n){return t.sub(e,n).length()},t.prototype.distance=function(e){return t.sub(this,e).length()},t.prototype.lengthSquared=function(){return t.dot(this,this)},t.prototype.length=function(){return Math.sqrt(t.dot(this,this))},t.prototype.scale=function(e){for(var t=this.data.length-1;t>=0;t--)this.data[t]*=e;return this},t.prototype.invert=function(){for(var e=0;e<this.data.length;e++)this.data[e]=0-this.data[e];return this},t.prototype.normalize=function(){var t=this.length(),n=this.data.length;if(t<e.EPSILON)for(var r=0;r<n;r++)this.data[r]=0;else{t=1/t;for(var r=0;r<n;r++)this.data[r]*=t}return this},t.prototype.clone=function(){return t.copy(this)},t.prototype.set=function(){if(arguments.length===1&&typeof arguments[0]=="object")if(arguments[0]instanceof t)this.copy(arguments[0]);else if(arguments[0].length>1)for(var e=0;e<arguments[0].length;e++)this.data[e]=arguments[0][e];else this.set(arguments[0][0]);else for(var e=0;e<arguments.length;e++)this.data[e]=arguments[e];return this},t.prototype.toString=function(){var e="";e+="[";for(var t=0;t<this.data.length;t++)e+=this.data[t],e+=t!==this.data.length-1?", ":"";return e+="]",e},t}),define("goo/math/Vector3",["goo/math/Vector"],function(e){function t(){e.call(this,3),arguments.length!==0?this.set(arguments):this.setd(0,0,0)}return t.prototype=Object.create(e.prototype),t.prototype.setupAliases([["x","u","r"],["y","v","g"],["z","w","b"]]),t.ZERO=new t(0,0,0),t.ONE=new t(1,1,1),t.UNIT_X=new t(1,0,0),t.UNIT_Y=new t(0,1,0),t.UNIT_Z=new t(0,0,1),t.add=function(e,n,r){typeof e=="number"&&(e=[e,e,e]),typeof n=="number"&&(n=[n,n,n]),r||(r=new t);var i=e.data||e,s=n.data||n;if(i.length!==3||s.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return r.data[0]=i[0]+s[0],r.data[1]=i[1]+s[1],r.data[2]=i[2]+s[2],r},t.addv=function(e,n,r){return r||(r=new t),r.data[0]=e.data[0]+n.data[0],r.data[1]=e.data[1]+n.data[1],r.data[2]=e.data[2]+n.data[2],r},t.prototype.add=function(e){return t.add(this,e,this)},t.sub=function(e,n,r){typeof e=="number"&&(e=[e,e,e]),typeof n=="number"&&(n=[n,n,n]),r||(r=new t);var i=e.data||e,s=n.data||n;if(i.length!==3||s.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return r.data[0]=i[0]-s[0],r.data[1]=i[1]-s[1],r.data[2]=i[2]-s[2],r},t.subv=function(e,n,r){return r||(r=new t),r.data[0]=e.data[0]-n.data[0],r.data[1]=e.data[1]-n.data[1],r.data[2]=e.data[2]-n.data[2],r},t.prototype.sub=function(e){return t.sub(this,e,this)},t.mul=function(e,n,r){typeof e=="number"&&(e=[e,e,e]),typeof n=="number"&&(n=[n,n,n]),r||(r=new t);var i=e.data||e,s=n.data||n;if(i.length!==3||s.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return r.data[0]=i[0]*s[0],r.data[1]=i[1]*s[1],r.data[2]=i[2]*s[2],r},t.prototype.mul=function(e){return t.mul(this,e,this)},t.div=function(e,n,r){typeof e=="number"&&(e=[e,e,e]),typeof n=="number"&&(n=[n,n,n]),r||(r=new t);var i=e.data||e,s=n.data||n;if(i.length!==3||s.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return r.data[0]=i[0]/s[0],r.data[1]=i[1]/s[1],r.data[2]=i[2]/s[2],r},t.prototype.div=function(e){return t.div(this,e,this)},t.dot=function(e,t){typeof e=="number"&&(e=[e,e,e]),typeof t=="number"&&(t=[t,t,t]);var n=e.data||e,r=t.data||t;if(n.length!==3||r.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var i=0;return i+=n[0]*r[0],i+=n[1]*r[1],i+=n[2]*r[2],i},t.prototype.dot=function(e){return t.dot(this,e)},t.cross=function(e,n,r){r||(r=new t);var i=e.data||e,s=n.data||n;if(i.length!==3||s.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var o=n.data[2]*e.data[1]-n.data[1]*e.data[2],u=n.data[0]*e.data[2]-n.data[2]*e.data[0],a=n.data[1]*e.data[0]-n.data[0]*e.data[1];return r.data[0]=o,r.data[1]=u,r.data[2]=a,r},t.prototype.cross=function(e){return t.cross(this,e,this)},t.prototype.lerp=function(e,t){return this.data[0]=(1-t)*this.data[0]+t*e.data[0],this.data[1]=(1-t)*this.data[1]+t*e.data[1],this.data[2]=(1-t)*this.data[2]+t*e.data[2],this},t.prototype.setd=function(e,t,n){return this.data[0]=e,this.data[1]=t,this.data[2]=n,this},t.prototype.seta=function(e){return this.data[0]=e[0],this.data[1]=e[1],this.data[2]=e[2],this},t.prototype.setv=function(e){return this.data[0]=e.data[0],this.data[1]=e.data[1],this.data[2]=e.data[2],this},t.prototype.add_d=function(e,t,n){return this.data[0]+=e,this.data[1]+=t,this.data[2]+=n,this},t.prototype.addv=function(e){return this.data[0]+=e.data[0],this.data[1]+=e.data[1],this.data[2]+=e.data[2],this},t.prototype.mulv=function(e){return this.data[0]*=e.data[0],this.data[1]*=e.data[1],this.data[2]*=e.data[2],this},t.prototype.muld=function(e,t,n){return this.data[0]*=e,this.data[1]*=t,this.data[2]*=n,this},t.prototype.subv=function(e){return this.data[0]-=e.data[0],this.data[1]-=e.data[1],this.data[2]-=e.data[2],this},t.prototype.sub_d=function(e,t,n){return this.data[0]-=e,this.data[1]-=t,this.data[2]-=n,this},t.prototype.lengthSquared=function(){return this.data[0]*this.data[0]+this.data[1]*this.data[1]+this.data[2]*this.data[2]},t.distanceSquared=function(e,t){var n=e.data[0]-t.data[0],r=e.data[1]-t.data[1],i=e.data[2]-t.data[2];return n*n+r*r+i*i},t.distance=function(e,n){return Math.sqrt(t.distanceSquared(e,n))},t.prototype.distanceSquared=function(e){return t.distanceSquared(this,e)},t.prototype.distance=function(e){return t.distance(this,e)},t}),define("io/TouchListener",["application/EventManager"],function(e){var t="ontouchstart"in document.documentElement,n=function(e){t=e},r=function(){return t};TouchListener=function(){this.releaseRange=20};var s=function(e){var t=new CustomEvent("touchClick",{detail:{},bubbles:!1,cancelable:!0}),n=new CustomEvent("touchstart",{detail:{},bubbles:!1,cancelable:!0}),r=new CustomEvent("touchCancel",{detail:{},bubbles:!0,cancelable:!1});e.addEventListener("touchstart",function(t){t.stopPropagation(),e.touch=t.touches[0],e.active=!0,text+=e.touch.target.id+" "+i+" <br>"},!1),e.addEventListener("touchend",function(n){n.stopPropagation();var i=document.elementFromPoint(e.touch.clientX,e.touch.clientY);n.srcElement.id==i.id?(setTimeout(function(){e.dispatchEvent(t)},10),setTimeout(function(){},100)):e.dispatchEvent(r)},!1)},o=function(e){var t=new CustomEvent("touchCancel",{detail:{},bubbles:!0,cancelable:!1}),n=new CustomEvent("touchPress",{detail:{},bubbles:!1,cancelable:!0});e.addEventListener("touchstart",function(t){t.stopPropagation();var r="";for(var i=0;i<t.touches.length;i++)t.targetTouches[i].target.id==e.id&&(t.targetTouches[i].target.active=e.id,t.targetTouches[i].target.dispatchEvent(n))},!1),e.addEventListener("touchend",function(n){n.srcElement.active==n.srcElement.id&&(e.dispatchEvent(t),e.active=null)},!1)},u=function(e){var t=new CustomEvent("moveEnd",{detail:{},bubbles:!0,cancelable:!1}),n=new CustomEvent("moveStart",{detail:{},bubbles:!1,cancelable:!0}),r=new CustomEvent("touchMove",{detail:{},bubbles:!1,cancelable:!1});e.addEventListener("touchstart",function(t){var r="";for(var i=0;i<t.touches.length;i++)t.targetTouches[i].target.id==e.id&&(t.targetTouches[i].target.touch=t.targetTouches[i],t.targetTouches[i].target.active=e.id,t.targetTouches[i].target.dispatchEvent(n))},!1),e.addEventListener("touchmove",function(t){for(var n=0;n<t.touches.length;n++)t.targetTouches[n].target.id==e.id&&t.targetTouches[n].target.dispatchEvent(r)},!1),e.addEventListener("touchend",function(n){n.srcElement.active==e.id&&e.dispatchEvent(t)},!1)};return{isTouch:r,registerClickableElement:s}}),define("view/DomUtils",["application/EventManager","io/TouchListener"],function(e,t){var n=document.getElementById("loading_screen"),r=function(e){return document.getElementById(e)},i=function(e){e.parentNode.removeChild(e)},s=function(e){if(n.style[e]=="")return e},o=function(e){for(var t in e){var n=s(e[t]);if(n)return n}},u=function(){var e=["transform","webkitTransform","MozTransform","msTransform","OTransform"];return o(e)},a=function(){var e=["transition","WebkitTransition","MozTransition","msTransition","OTransition"];return o(e)},f=function(e,t){var n=document.getElementById(e),r=document.getElementById(t);r.appendChild(n)},l=function(e,t){for(index in t)e.style[index]=t[index]},c=function(e,t){for(index in t)e.style[index]=""},h=function(e,t){e.classList.add(t)},p=function(e,t){e.classList.remove(t)},d=function(e,t){e.className=t},v=function(e,t,n,r){typeof e=="string"&&(e=document.getElementById(e));var i=y(e,t,"div",n,r);return i},m=function(e,t,n,r,i){var s=document.getElementById(e),o=y(s,t,"canvas","",r),u=new Image;return u.setAttribute("src",n),o.setAttribute("name",t),u.onload=function(){o.image=u,i()},o},g=function(e,t,n,r,i){var s=document.getElementById(e),o=y(s,t,"iframe","",r);return o.setAttribute("src",n),o.setAttribute("name",t),o.onload=function(){i()},o},y=function(e,t,n,r,i){var s=e.getElementsByTagName("*"),o=document.createElement(n,[s]);return o.setAttribute("id",t),o.className=i,r&&w(o,r),e.appendChild(o),o},b=function(e,t,n,r){var i=document.getElementById(e),s=i.getElementsByTagName("*"),o=document.createElement("input",[s]);o.setAttribute("id",t),o.setAttribute("type","text"),o.setAttribute("name",n),o.className=r,i.appendChild(o)},w=function(e,t){typeof e=="string"&&(e=r(e)),setTimeout(function(){e.innerHTML=t},1)},E=function(e,t){setTimeout(function(){e.style.backgroundImage="url("+t+")"},1)},S=function(e,t,n){n||(n=0);var r=u();e.style[r]=t},x=function(e,t){var n=a();e.style[n]=t},T=function(e){N(e),i(e)},N=function(e){if(e.childNodes)while(e.childNodes.length>=1)e.removeChild(e.firstChild)},C=function(e,n){L(e),e.interactionListeners={};var r="click";t.isTouch()&&(r="touchClick",t.registerClickableElement(e)),e.interactionListeners[r]={clickFunc:n,isEnabled:!1},k(e,r,"UI_HOVER","UI_ACTIVE","UI_CLICK","UI_OUT"),A(e)},k=function(t,n,r,i,s,o){var u=function(){e.fireEvent(e.list().ONESHOT_SOUND,{soundData:e.sound()[r]})},a=function(){e.fireEvent(e.list().ONESHOT_SOUND,{soundData:e.sound()[i]})},f=function(){e.fireEvent(e.list().ONESHOT_SOUND,{soundData:e.sound()[o]})},l=function(){e.fireEvent(e.list().ONESHOT_SOUND,{soundData:e.sound()[s]})},c={click:{mouseover:u,mousedown:a,mouseout:f,mousedown:a,mouseup:f,click:l},touchClick:{touchstart:a,touchcancel:f,touchClick:l}};t.soundInteractionListeners=c[n],t.soundInteractionListeners[n]=l;for(index in t.soundInteractionListeners)t.addEventListener(index,t.soundInteractionListeners[index],!1)},L=function(e){e.style.pointerEvents="none",e.style.cursor="";for(index in e.soundInteractionListeners)e.removeEventListener(index,e.soundInteractionListeners[index],null);for(index in e.interactionListeners)e.interactionListeners[index].isEnabled==1&&(e.removeEventListener(index,e.interactionListeners[index].clickFunc,!1),e.interactionListeners[index].isEnabled=!1)},A=function(e){e.style.pointerEvents="",e.style.cursor="pointer";for(index in e.soundInteractionListeners)e.addEventListener(index,e.soundInteractionListeners[index],null);for(index in e.interactionListeners)e.interactionListeners[index].isEnabled==0&&(e.addEventListener(index,e.interactionListeners[index].clickFunc,!1),e.interactionListeners[index].isEnabled=!0)},O=function(){return;var e,t,n},M=function(e){e.style.display="none";return;var t,n},_=function(e){e.style.display=""};return{quickHideElement:M,quickShowElement:_,performifyAllElements:O,setElementTransition:x,applyElementTransform:S,addElementClass:h,removeElementClass:p,setElementClass:d,createIframeElement:g,createCanvasElement:m,getElementById:r,removeElement:T,createDivElement:v,addElementClickFunction:C,disableElementInteraction:L,enableElementInteraction:A,setElementHtml:w}}),define("io/AnalogFeedback",["application/EventManager","io/InputSettersGetters","goo/math/Vector3","view/DomUtils"],function(e,t,n,r){var i=function(e,t){this.controllerOverlay=r.createDivElement("viewporter","ctrl_overlay","","full_size config_overlay"),this.title=r.createDivElement(this.controllerOverlay,"ctrl_title","Analog Control v:"+e.version,"title_label"),this.buttonsBox=r.createDivElement(this.controllerOverlay,"ctrl_buttons","","ctrl_buttons"),this.axesBox=r.createDivElement(this.controllerOverlay,"ctrl_buttons","","ctrl_axes"),this.samplePrompt=r.createDivElement(this.controllerOverlay,"sample_prompt","Connect controller or press a button to detect controller","sample_prompt"),this.ctrlDetectBox=r.createDivElement(this.controllerOverlay,"ctrl_detect","Controller...","ctrl_detect"),this.analogMap=e,this.axesDirections={pitch:{up:1,left:0},roll:{up:0,left:1},yaw:{up:0,left:1},throttle:{up:1,left:0},flaps:{up:1,left:0},look_up:{up:1,left:0},look_left:{up:0,left:1}},this.allButtonElems=[],this.allAxesElems=[],this.buttonElems=[],this.axesElems=[],this.analogElems=[],this.updateElem=null;var n=function(){this.loadButtonDetect(e.buttons),this.loadAxesDetect(e.axes),this.addCancelButton()}.bind(this);setTimeout(function(){n()},100),this.done=t};return i.prototype.showDetectedButtonsAndAxes=function(e,t){for(var n=0;n<e.length;n++)this.allButtonElems[n]=r.createDivElement(this.allButtons,"all_buttons_"+n,""+n,"possible_button");var i=this.allAxesElems,s=function(e,t){setTimeout(function(){i[t]=r.createDivElement(e,"all_axes_"+t,"","crtl_axis")},200)};for(n=0;n<t.length;n++){var o=r.createDivElement(this.allAxes,"all_axes_"+n,""+n,"possible_axis");s(o,n)}},i.prototype.loadButtonDetect=function(e){this.allButtons=r.createDivElement(this.buttonsBox,"all_buttons","Controller Buttons:","all_candidates");for(var t=0;t<e.length;t++)this.buttonElems[t]=r.createDivElement(this.buttonsBox,"ctrl_button_detect_"+e[t],e[t],"ctrl_button_detect")},i.prototype.loadAxesDetect=function(e){var t=function(e,t){var n=this.analogElems;setTimeout(function(){console.log("Elems: ",n),n[t]=r.createDivElement(e,"ctrl_axes_value_"+t,t,"ctrl_axes_value")},200*t)}.bind(this);this.allAxes=r.createDivElement(this.axesBox,"all_axes","Controller Axes:","all_candidates");for(var n=0;n<e.length;n++)this.axesElems[n]=r.createDivElement(this.axesBox,"ctrl_axes_detect_"+e[n],e[n],"ctrl_axes_detect"),t(this.axesElems[n],n)},i.prototype.addCancelButton=function(){var e=function(){r.removeElement(this.controllerOverlay),this.done()}.bind(this);this.cancelButton=r.createDivElement(this.controllerOverlay,"config_cancel","Close","config_cancel"),r.addElementClickFunction(this.cancelButton,e)},i.prototype.startControllerDetect=function(){return this.setupDetectElement(this.ctrlDetectBox)},i.prototype.startButtonDetect=function(e){var t="Press [ "+this.analogMap.buttons[e]+" ]";return e!=0&&(t+=" (or press [ "+this.analogMap.buttons[0]+" ] to skip)"),this.samplePrompt.innerHTML=t,this.setupDetectElement(this.buttonElems[e])},i.prototype.startAxisDetect=function(e){return this.samplePrompt.innerHTML="Move [ "+this.analogMap.axes[e]+" ] (or press [ "+this.analogMap.buttons[0]+" ] to skip)",this.analogStateElem=this.analogElems[e],this.setupDetectElement(this.axesElems[e])},i.prototype.setupDetectElement=function(e){this.updateElem=e;var t=function(t){setTimeout(function(){r.removeElementClass(e,"sampling_activated"),e.innerHTML=t,r.addElementClass(e,"sampling_successful")},200)};return r.addElementClass(e,"sampling_activated"),t},i.prototype.skipMappingOfRequestedControl=function(){r.removeElementClass(this.updateElem,"sampling_activated"),this.updateElem.style.opactiy=.5},i.prototype.controllerSetupDone=function(e){var t=function(){r.removeElement(this.controllerOverlay),e(),this.done()}.bind(this);this.doneButton=r.createDivElement(this.controllerOverlay,"config_done","Done","config_done"),r.addElementClickFunction(this.doneButton,t)},i.prototype.controllerSetupLoaded=function(e,t){var n=function(){r.removeElement(this.controllerOverlay),e(),this.done()}.bind(this);this.doneButton=r.createDivElement(this.controllerOverlay,"config_done","UseLoaded","config_done"),r.addElementClickFunction(this.doneButton,n);var i=function(){r.removeElement(this.doneButton),r.removeElement(this.redoButton),t()}.bind(this);this.redoButton=r.createDivElement(this.controllerOverlay,"config_use","Replace","config_use"),r.addElementClickFunction(this.redoButton,i)},i.prototype.updateSampleState=function(e){this.updateElem.innerHTML=e},i.prototype.showControllerButtonState=function(e,t){this.allButtonElems[e].style.backgroundColor="rgba(100, 255, 100, "+t+")"},i.prototype.showControllerAxisState=function(e,t){if(!this.allAxesElems[e])return;this.allAxesElems[e].style.backgroundColor="rgba(125"+125*t+", 125"-125*t+", 100, 1)",this.allAxesElems[e].style.left=50+50*t+"%"},i.prototype.showMappedButtonState=function(e,t,n){this.buttonElems[this.analogMap.buttons.indexOf(e.control)].style.backgroundColor="rgba(100, 255, 100, "+n+")"},i.prototype.showSamplePercent=function(e,t){this.analogStateElem.style.top=50+t*50*this.axesDirections[e].up+"%",this.analogStateElem.style.left=50+t*50*this.axesDirections[e].left+"%"},i}),define("io/AnalogState",["application/EventManager"],function(e){var t=function(e,t){this.version=t,this.controllerId=e.id,this.axesMap={},this.buttonMap={},this.altAxes=0,this.altAxesShift=e.axes.length,this.controlMap={fire_1:"cannons",fire_2:"taxi_lights",pitch:"elevator",roll:"aeilrons",yaw:"rudder",throttle:"throttle",reset_trim:"reset_trim",adjust_trim:"adjust_trim",alt_axes:"alt_axes",flaps:"flaps",canopy:"canopy",gear:"gears",brake:"breaks",look_up:"look_up",look_left:"look_left"},this.controlState={fire_1:0,fire_2:0,pitch:0,roll:0,yaw:0,throttle:0}};t.prototype.checkButtonMapping=function(e){return this.buttonMap[e]},t.prototype.checkAxesMapping=function(e){return this.axesMap[e]},t.prototype.mapButtonToControl=function(e,t){this.buttonMap[e]={control:t},console.log("MapButtonToCtrl: ",this.buttonMap,e,t)},t.prototype.mapAxisToControl=function(e,t,n,r){this.axesMap[e]&&this.axesMap[e].factor>r*n&&(r=this.axesMap[e].factor*n),this.axesMap[e]={control:t,factor:r*n},console.log("MapAxisToCtrl: ",this.axesMap,e,t,r,n)},t.prototype.mapAxes=function(e){for(var t in e)this.mapAxisToControl(e[t].key,t,e[t].factor)};var n=!1;return t.prototype.updateAxes=function(t,r,i){var s,o;n=!1;for(var u=0;u<t.length;u++){s=u+r*this.altAxesShift;if(this.axesMap[s]){o=t[u];var a=this.controlMap[this.axesMap[s].control];a&&(i?e.fireEvent(e.list().PLAYER_CONTROL_EVENT,{control:"trim_"+a,value:Math.abs(o*o)*o*this.axesMap[s].factor*.2}):a=="look_up"||a=="look_left"?(this.controlState[this.axesMap[s].control]=o,n=!0):o!=this.controlState[this.axesMap[s].control]&&(e.fireEvent(e.list().PLAYER_CONTROL_EVENT,{control:a,value:Math.abs(o*o)*o*this.axesMap[s].factor}),this.controlState[this.axesMap[s].control]=o))}}if(n)e.fireEvent(e.list().SET_CAMERA_ANALOGS,{rotX:this.controlState.look_left,rotY:this.controlState.look_up,rotZ:0});else if(this.controlState["look_left"]!=0||this.controlState[!0])this.controlState.look_left=0,this.controlState.look_up=0,e.fireEvent(e.list().SET_CAMERA_ANALOGS,{rotX:this.controlState.look_left,rotY:this.controlState.look_up,rotZ:0})},t.prototype.updateButtons=function(t){for(var n in this.buttonMap)t[n].value!=this.controlState[this.buttonMap[n].control]&&(console.log("Button changed",n,this.buttonMap[n],t[n]),this.controlMap[this.buttonMap[n].control]&&(e.fireEvent(e.list().PLAYER_CONTROL_EVENT,{control:this.controlMap[this.buttonMap[n].control],value:t[n].value}),this.controlState[this.buttonMap[n].control]=t[n].value))},t}),define("io/AnalogInput",["application/EventManager","io/AnalogFeedback","io/AnalogState"],function(e,t,n){var r,i,s={version:"0.1",axes:["pitch","roll","yaw","throttle","flaps","look_up","look_left"],buttons:["fire_1","alt_axes","adjust_trim","reset_trim","adjust_yaw","gear","canopy","brake"]},o=function(e,t,n){e(n+"<br>button: "+t),r.mapButtonToControl(t,n)},u=function(e,t){for(var n=0;n<e.buttons.length;n++){var i=r.checkButtonMapping(n);if(i&&i.control==s.buttons[s.buttons.indexOf(t)]&&e.buttons[n].pressed)return 1}return 0},a=function(e){i.showDetectedButtonsAndAxes(e.buttons,e.axes);var t=!1,n=0,a=0,f={},l={},c=function(e,s){l.buttonId||(l.onDetect=i.startButtonDetect(n));for(var u=0;u<e.buttons.length;u++)f[u]!=e.buttons[u].pressed&&t&&(r.checkButtonMapping(u)||(i.updateSampleState(e.buttons[u].value),l.buttonNr=u,l.buttonId=s)),f[u]=e.buttons[u].pressed;t=!0;for(u=0;u<e.buttons.length;u++)e.buttons[u].pressed&&(t=!1);t&&l.buttonId&&(o(l.onDetect,l.buttonNr,l.buttonId),l={},n+=1)},p=!1,d=function(e,t){for(var o=0;o<t.buttons.length;o++){var u=r.checkButtonMapping(o);u&&(u.control==s.buttons[0]&&(!p&&t.buttons[o].pressed&&(p=!0),p&&!t.buttons[o].pressed&&(a!=0?a+=1:n+=1,i.skipMappingOfRequestedControl(),p=!1)),i.showMappedButtonState(u,o,t.buttons[o].value)),i.showControllerButtonState(o,t.buttons[o].value)}for(o=0;o<t.axes.length;o++)i.showControllerAxisState(o,t.axes[o]);var f=function(){c(t,s.buttons[n])};s.buttons[n]?f():e(t)},v={},m=0,g=0,y=.5,b,E=0,S=0,x={axes:{}},T=function(e,t){var n=0,s=i.startAxisDetect(a),o=u(e,"alt_axes"),f=e.axes.length*o;for(var l=0;l<e.axes.length;l++)x.axes[l]!=e.axes[l]&&(Math.abs(e.axes[l])>Math.abs(e.axes[n])&&(n=l),x.axes[l]=e.axes[l]);console.log("Biggest:",n,"AltAxis:",o);if(Math.abs(e.axes[n])>y){if(Math.abs(m)<Math.abs(e.axes[n])){v[n]!=e.axes[n]&&(g+=1),S=m,console.log("Growing: ",t,g,m),i.showSamplePercent(t,e.axes[n]);if(g>5){E=n;if(!r.checkAxesMapping(E+f)){clearTimeout(b);var c=1-Math.abs(S);r.mapAxisToControl(E+f,t,N,Math.round(S)),y=.5,a+=1;var h=t+"<br> axis: "+E;o&&(h+=" alt"),s(h),g=0}}}m=e.axes[n],v[n]=e.axes[n]}else t&&i.showSamplePercent(t,0),clearTimeout(b)},N=1,C=function(){localStorage.setItem(r.controllerId,JSON.stringify(r)),w(r.controllerId)},k=function(e){var t=function(){T(e,s.axes[a])};s.axes[a]?t():L=function(){i.controllerSetupDone(C),console.log("Axes Mapping ended")}},L=function(){d(k,h()),requestAnimationFrame(function(){L()})};L()},f,l=function(e){var t=function(){console.log("Loaded controller from localStorage: ",e,f),r.axesMap=f.axesMap,r.buttonMap=f.buttonMap,w(e.id),document.getElementById("config_controller").innerHTML="Edit Loaded"},i=function(){};r=new n(e,s.version),f=JSON.parse(localStorage.getItem(e.id)),f&&f.version==s.version&&t()},c=function(e){console.log("Configure Controller: ",e),p=!0,r=null;var o=function(e){console.log("Remap Controller: ",e),r=new n(e,s.version),i=new t(s,b);var o=i.startControllerDetect();setTimeout(function(){o(e.id),a(e)},300)};d(o)};e.registerListener(e.list().CONFIGURE_CONTROLLER,c);var h=function(){var e=navigator.getGamepads();for(var t=0;t<e.length;t++)if(e[t])return e[t]},p=!1,d=function(e){if(!p)return;var t=(new Date).getTime()*.005,n=Math.round(99+Math.sin(t)*88),i=Math.round(100+Math.cos(t)*25),s=Math.round(99+Math.sin(.5+t)*44);document.getElementById("config_controller").style.backgroundColor="rgb(40 , "+i+" , 25)",document.getElementById("controller_enabled").style.color="rgb("+n*2+","+i*2+","+s+")";var o=h();o&&!r?(p=!1,e(o)):requestAnimationFrame(function(){d(e)})},v=function(e){l(e),document.getElementById("config_controller").style.backgroundColor="rgb(117, 200, 37)",document.getElementById("controller_enabled").innerHTML=e.id,document.getElementById("controller_enabled").style.color="#FEA"},m=!1,g=function(){if(p||m)return;p=!0,r=null;var e=function(e){v(e)};setTimeout(function(){d(e),document.getElementById("config_controller").style.backgroundColor="rgb(137, 100, 37)",document.getElementById("config_controller").innerHTML="Press Button",document.getElementById("controller_enabled").innerHTML="Seeking Gamepad",document.getElementById("controller_enabled").style.color="#FC7"},1300)},y=function(){m=!0,b()},b=function(){console.log("End GamePad config"),p=!1},w=function(e){document.getElementById("config_controller").style.backgroundColor="rgb(37, 219, 37)",document.getElementById("controller_enabled").innerHTML=e,document.getElementById("controller_enabled").style.color="#EFE"},E=function(){if(r){var e=h();r.updateButtons(e.buttons),r.updateAxes(e.axes,u(e,"alt_axes"),u(e,"adjust_trim"))}};e.registerListener(e.list().SCENARIO_SELECTED,y),e.registerListener(e.list().GOO_TICK,E),e.registerListener(e.list().LOADING_COMPLETED,g)}),define("io/KeyboardHandler",["application/EventManager","game/GameConfiguration"],function(e,t){var n={eject:{control:"eject",value:1},canopy:{control:"canopy",value:1},gears:{control:"gears",value:1},cannons:{control:"cannons",value:1},flapsDown:{control:"flaps",value:1},flapsUp:{control:"flaps",value:-1},throttleUp:{control:"throttle",value:1},throttleDown:{control:"throttle",value:-1},breaksOn:{control:"breaks",value:1},breaksOff:{control:"breaks",value:-1},pitchUp:{control:"elevator",value:1},pitchDown:{control:"elevator",value:-1},trimPitchUp:{control:"trim_elevator",value:.3},trimPitchDown:{control:"trim_elevator",value:-0.3},rollLeft:{control:"aeilrons",value:1},rollRight:{control:"aeilrons",value:-1},trimRollLeft:{control:"trim_aeilrons",value:.3},trimRollRight:{control:"trim_aeilrons",value:-0.3},yawLeft:{control:"rudder",value:1},yawRight:{control:"rudder",value:-1},trimYawLeft:{control:"trim_rudder",value:.3},trimYawRight:{control:"trim_rudder",value:-0.3},wingSmoke:{control:"wing_smoke",value:1},forward:{control:"forward",value:1},back:{control:"back",value:1},turnleft:{control:"turnleft",value:1},turnright:{control:"turnright",value:1},strafeModifier:{control:"strafe",value:1},jump:{control:"jump",value:1}},r=function(t,r){r?e.fireEvent(e.list().PLAYER_CONTROL_EVENT,{control:n[t].control,value:n[t].value}):e.fireEvent(e.list().PLAYER_CONTROL_EVENT,{control:n[t].control})},i=function(t){r(e.eventArgs(t).control,e.eventArgs(t).value)};return e.registerListener(e.list().UPDATE_KEYBINDING,i),{}}),define("io/InputSettersGetters",["application/EventManager","io/PlayerMovementInput","io/MouseListener","io/AnalogInput","io/KeyboardHandler"],function(t,n,r,i,s){var o=0,u=0,a=0,f=0,l=0,c=0,h=0,p=!1,d={},v=0,m=0,g=!1,y={},b={},w="game",E,S=function(e){if(typeof e=="number")n||(n=e);else var t=""+e+"",n=t.charCodeAt(0);return n},x=function(e,t){var n=S(t);console.log("--------->> Bind Key Code:",n,e),b[n]=e},T=function(e){var t=S(e);console.log("--------->> Remove Key Code:",t),delete b[t]},N=function(){document.getElementById("body").onkeydown=function(e){e.preventDefault();var n=e.keyCode;w=="game"&&(y[n],b[n]&&!d[n]&&(d[n]=1,t.fireEvent(t.list().UPDATE_KEYBINDING,{control:b[e.keyCode],value:1})))},document.getElementById("body").onkeyup=function(e){var n=e.keyCode;w=="game"&&b[n]&&(d[n]=0,t.fireEvent(t.list().UPDATE_KEYBINDING,{control:b[e.keyCode],value:0}))}},C=function(e,t){var n=t.charCodeAt(0);y[n]=e},k=function(e){E=!0,o=e,t.fireEvent(t.list().MOUSE_WHEEL_UPDATE,{delta:e})},L=function(){return[c,h]},A=function(){return g},O=function(e,n){c=e,h=n,t.fireEvent(t.list().MOUSE_POSITION_UPDATE,{xy:[e,n]})},M=function(){f=0,l=0},_,D=function(e,t){f=u-e,l=a-t,u=e,a=t,clearTimeout(_),_=setTimeout(function(){M()},100)},P=function(){return[u,a]},H=function(e){v=e[0],m=e[1],g=!0},B=function(t){var n=document.getElementById(t);n.onmousemove=function(e){e.stopPropagation();var t=e.clientX,r=e.clientY,i=2*(t-n.offsetWidth/2)/n.offsetWidth,s=2*(r-n.offsetHeight/2)/n.offsetHeight;O(t,r),D(i,s)},n.onmouseout=function(){e.stopPropagation(),D(0,0)},n.onmousewheel=function(e){e.stopPropagation();var t=e.wheelDelta/1200;t!=0&&k(t)}},j=function(e){t.fireEvent(t.list().MOUSE_ACTION,{action:e,xy:[c,h]})},F=function(){var e=document.getElementById("game_window");B("game_window"),r.setElementClickFunction(e,j)},I=function(e){H(t.eventArgs(e).xy)},q=function(){g=!1},R=function(e){q()},U=function(){return[v-c,m-h]},z=function(){return[f,l]};N();var W=function(e){t.eventArgs(e).callback(z())},X=function(){return b};return t.registerListener(t.list().SCENARIO_LOADED,F),t.registerListener(t.list().START_POINTER_DRAG,I),t.registerListener(t.list().START_CAMERA_DRAG,I),t.registerListener(t.list().STOP_CAMERA_DRAG,R),t.registerListener(t.list().FETCH_DRAG_DELTA,W),{getMouseXY:L,getDragState:A,registeKeyBinding:x,unregisteKeyBinding:T,getDragDeltaXY:U,getBoundKeys:X,getMouseMove:P,setMouseMove:D,setMouseWheelDelta:k,setMouseCoords:O}}),define("io/PointerInputHandler",["application/EventManager","io/InputSettersGetters","goo/math/Vector3","view/DomUtils"],function(e,t,n,r){var i=!1,s,o,u,a,f={},l,c,h,p,d,v,m,g,y,b=!1,w,E,S,x,T={},N,C,k=function(e,t,n,r,i,s,o,u,a,f,l){this.label=l,this.entity=e,this.control=t,this.xMin=n,this.yMin=r,this.xMax=i,this.yMax=s,this.axis=o,this.max=u,this.min=a,this.factor=f,this.stateActive=!1,this.startFromValue=0,this.triggerTime=0;var c=(this.min+this.max)*.5;this.value=this.entity.controls[this.control].value,this.value-this.entity.pieceInput[this.control].value!=0&&(this.entity.pieceInput[this.control].update=!0),this.entity.pieceInput[this.control].value=this.value};k.prototype.beginValueManipulation=function(){var e=(new Date).getTime();e-this.triggerTime<350?this.startFromValue=0:this.startFromValue=w.controls[this.control].value,this.triggerTime=e,d.style.opacity=.45},k.prototype.endValueManipulation=function(){var t=(new Date).getTime();t-this.triggerTime<200&&(this.entity.pieceInput[this.control].value=0,this.entity.pieceInput[this.control].update=!1,e.fireEvent(e.list().PLAYER_CONTROL_EVENT,{control:this.control,value:0}),this.entity.controls[this.control].value=0,this.entity.controls[this.control].controlState=1,this.value=0,L(this.control)),this.stateActive=!1},k.prototype.setDragValue=function(t){var n=x.offsetWidth,r=x.offsetHeight,i=[n*((this.xMax-this.xMin)/100),r*((this.yMax-this.yMin)/100)],s=this.startFromValue+1*t[this.axis]/i[this.axis];s=Math.max(s,this.min),s=Math.min(s,this.max),e.fireEvent(e.list().PLAYER_CONTROL_EVENT,{control:this.control,value:s}),this.entity.pieceInput[this.control].value=s,this.entity.pieceInput[this.control].update=!0,this.value=s,L(this.control)},k.prototype.activateAxisStateElement=function(){this.axis==1?m.style.display="block":v.style.display="block",this.stateActive=!0},k.prototype.showControlState=function(){this.stateActive||this.activateAxisStateElement();var e=w.controls[this.control].value;e=Math.max(e,this.min),e=Math.min(e,this.max);var t=this.max-this.min,n=e/t-this.min/t;if(this.axis==1){var i=d.offsetHeight*n;r.applyElementTransform(m,"translate3d(0px, "+ -i+"px, 0px)")}else{var s=d.offsetWidth*n;r.applyElementTransform(v,"translate3d("+ -s+"px, 0px,  0px)")}};var L=function(e){var t=T[e];t.showControlState()},A=function(e,t){for(var n in t){var r=t[n].rect;T[n]=new k(e,n,r[0],r[1],r[2],r[3],t[n].axis,t[n].max,t[n].min,t[n].factor,t[n].label)}},O=function(e){b=!0,console.log("Pointer input elems: ",e,f);for(var t in e)f[t]=e[t],f[t]||console.log("Drag feedback elem missing:",t,f);x=r.getElementById("game_window"),console.log("Pointer input elems: ",f)},M=function(e){r.applyElementTransform(l,"translate3d("+e[0]+"px, "+e[1]+"px, 0px)")},_=function(e,t){r.applyElementTransform(c,"translate3d("+e+"px, "+t+"px, 0px)")},D=function(e,t,n){var i=e.offsetHeight,s=t[0],o=t[1],u=n[0],a=n[1],f=Math.sqrt((u-s)*(u-s)+(a-o)*(a-o)),l=(s+u)/2-f/2,c=(o+a)/2-i/2,h=Math.atan2(o-a,s-u)*(180/Math.PI);e.style.width=f+"px",r.applyElementTransform(e,"translate3d("+l+"px, "+c+"px, 0px) rotate3d(0, 0, 1, "+h+"deg)")},P=function(){if(i){s=t.getDragDeltaXY(),_(a[0]-s[0],a[1]-s[1]),D(h,a,[a[0]-s[0],a[1]-s[1]]);for(var e=0;e<S.length;e++)S[e].setDragValue(s);o=s[0],u=s[1]}else N&&(d.style.opacity*=.95)},H=function(){l=r.getElementById(f.start),c=r.getElementById(f.end),h=r.getElementById(f.vector),p=r.getElementById(f.frame),l.style.display="block",c.style.display="block",h.style.display="block",p.style.display="block",p.style.top=S[0].yMin+"%",p.style.left=S[0].xMin+"%",p.style.height=S[0].yMax-S[0].yMin+"%",p.style.width=S[0].xMax-S[0].xMin+"%"},B=function(e){var t=T[e];return N=e,v=r.getElementById(f.state_h),m=r.getElementById(f.state_v),m.style.display="none",v.style.display="none",d=r.getElementById(f.hover),y=r.getElementById(f.hover_label),d.style.opacity=1,d.style.top=t.yMin+"%",d.style.left=t.xMin+"%",d.style.height=t.yMax-t.yMin+"%",d.style.width=t.xMax-t.xMin+"%",d},j=function(t){if(i||C||!b)return;var n=e.eventArgs(t).xy,s=F(n[0],n[1]);if(s.length>0){if(N==s[0])return;var o=B(s[0]);y.innerHTML="",o.style.display="block";for(var u=0;u<s.length;u++)y.innerHTML+=T[s[u]].label+"<br>",L(s[u])}else{N&&(r.getElementById(f.hover).style.display="none"),m.style.display="none",v.style.display="none";for(var a in T)T[a].stateActive=!1;N=null}},F=function(e,t){var n=x.offsetWidth,r=x.offsetHeight,i=100*e/n,s=100*t/r,o=[];for(var u in T){var a=T[u];i>a.xMin&&i<a.xMax&&s>a.yMin&&s<a.yMax&&o.push(u)}return o},I=function(e,t){var n=F(e,t);S=[];for(var r=0;r<n.length;r++)S.push(T[n[r]]),T[n[r]].beginValueManipulation();return S},q=function(t){if(!b)return;o=0,u=0,a=e.eventArgs(t).xy,I(a[0],a[1]),S.length>0&&(H(),i=!0,M(a))},R=function(){l.style.display="none",c.style.display="none",h.style.display="none",p.style.display="none";for(var e in T)T[e].endValueManipulation()},U=function(e){i&&R(),i=!1},z=function(t){w=e.eventArgs(t).entity,E=w.pieceData,E.onScreenInput?A(w,E.onScreenInput):b=!1},W=function(){C=!0,N&&(d.style.display="none",N=null)},X=function(){C=!1};return e.registerListener(e.list().MOUSE_POSITION_UPDATE,j),e.registerListener(e.list().RENDER_TICK,P),e.registerListener(e.list().START_POINTER_DRAG,q),e.registerListener(e.list().STOP_POINTER_DRAG,U),e.registerListener(e.list().SET_PLAYER_CONTROLLED_ENTITY,z),e.registerListener(e.list().START_CAMERA_DRAG,W),e.registerListener(e.list().STOP_CAMERA_DRAG,X),{registerDragFeedbackElements:O}}),define("feedback/LightController",["application/EventManager","view/DomUtils"],function(e,t){var n={},r=function(e,r,i){var s=t.getElementById(e);i!=n[r].currentClass&&(t.removeElementClass(s,n[r].currentClass),t.addElementClass(s,i))},i=function(t){s(e.eventArgs(t).control,e.eventArgs(t).currentState)},s=function(e,t){if(!n[e])return;for(var i=0;i<n[e].elements.length;i++){var s="light_transition";t>=1&&(s="light_on"),t<=0&&(s="light_off"),r(n[e].elements[i],e,s)}n[e].currentClass=s},o=function(t){var i=e.eventArgs(t).elementId,s=e.eventArgs(t).control,o="light_off";n[s]||(n[s]={elements:[],currentClass:o}),n[s].elements.push(i),r(i,s,o)},u=function(){n={}},a=function(t){s(e.eventArgs(t).control,e.eventArgs(t).controlState)};return e.registerListener(e.list().INIT_PLAYER_CONTROL_STATE,a),e.registerListener(e.list().CLEAR_ALL_VALUE_ELEMENTS,u),e.registerListener(e.list().PLAYER_CONTROL_STATE_UPDATE,i),e.registerListener(e.list().REGISTER_STATE_LIGHT,o),{}}),define("feedback/LeverController",["application/EventManager","view/DomUtils"],function(e,t){var n={},r={},i={},s=function(t){a(e.eventArgs(t).control,e.eventArgs(t).currentState)},o=function(t){u(e.eventArgs(t).control,e.eventArgs(t).value)},u=function(e,n){if(i[e])for(var r=0;r<i[e].elements.length;r++){var s=t.getElementById(i[e].elements[r]);if(!s)return;s.style.height=n*100+"%"}},a=function(e,i){if(n[e])for(var s=0;s<n[e].elements.length;s++){var o=t.getElementById(n[e].elements[s]);if(!o)return;o.style.bottom=i*100+"%"}if(r[e])for(var s=0;s<r[e].elements.length;s++){var o=t.getElementById(r[e].elements[s]);if(!o)return;var u=r[e].axis[s],a=o.parentNode.offsetHeight,f=o.parentNode.offsetWidth,l=0,c=0,h=0;u=="pitch"&&(c+=Math.floor(a*i*.45)),u=="yaw"&&(l-=Math.floor(f*i*.45)),u=="roll"&&(h-=Math.floor(90*i));var p="translate3d("+l+"px,"+c+"px, 0px) rotate3d(0, 0, 90, "+h+"deg)";t.applyElementTransform(o,p)}},f=function(t){var r=e.eventArgs(t).elementId,i=e.eventArgs(t).control;n[i]||(n[i]={elements:[]}),n[i].elements.push(r)},l=function(t){var n=e.eventArgs(t).elementId,i=e.eventArgs(t).control,s=e.eventArgs(t).axis;r[i]||(r[i]={axis:[],elements:[]}),r[i].elements.push(n),r[i].axis.push(s)},c=function(t){var n=e.eventArgs(t).elementId,r=e.eventArgs(t).control;i[r]||(i[r]={elements:[]}),i[r].elements.push(n)},h=function(){var e={},t={}},p=function(t){a(e.eventArgs(t).control,e.eventArgs(t).controlState)};return e.registerListener(e.list().INIT_PLAYER_CONTROL_STATE,p),e.registerListener(e.list().CLEAR_ALL_VALUE_ELEMENTS,h),e.registerListener(e.list().PLAYER_CONTROL_EVENT,o),e.registerListener(e.list().PLAYER_CONTROL_STATE_UPDATE,s),e.registerListener(e.list().REGISTER_STATE_LEVER,f),e.registerListener(e.list().REGISTER_STATE_LEVER_TARGET,c),e.registerListener(e.list().REGISTER_STATE_AXIS,l),{}}),define("feedback/ValueController",["application/EventManager","view/DomUtils"],function(e,t){var n={},r=function(r){var i=e.eventArgs(r).value,s=e.eventArgs(r).amount;if(!n[i])return;for(var o=0;o<n[i].elements.length;o++){var u=t.getElementById(n[i].elements[o]);if(!u)return;var s=Math.round(s*100)/100;Math.abs(s)>10&&(s=Math.round(s)),u.innerHTML=s}},i=function(t){var r=e.eventArgs(t).elementId,i=e.eventArgs(t).value;n[i]||(n[i]={elements:[]}),n[i].elements.push(r)},s=function(){n={}};e.registerListener(e.list().CLEAR_ALL_VALUE_ELEMENTS,s),e.registerListener(e.list().PLAYER_VALUE_UPDATE,r),e.registerListener(e.list().REGISTER_STATE_VALUE,i)}),define("template/Directives",["application/EventManager","io/PointerInputHandler","feedback/LightController","feedback/LeverController","feedback/ValueController"],function(e,t,n,r,i){var s=function(t){return function(){e.fireEvent(e.list().LAYOUT_RADIO_BUTTONS,t)}},o=function(t){return function(){e.fireEvent(e.list().SET_ELEMENT_TEXT,t)}},u=function(t){return function(){e.fireEvent(e.list().LAYOUT_LINES,t)}},a=function(t){return function(){e.fireEvent(e.list().MENU_NAVIGATE,t)}},f=function(t){return function(){e.fireEvent(e.list().SLIDE_OVERLAY_UP,t)}},l=function(t){return function(){e.fireEvent(e.list().SLIDE_OVERLAY_IN,t)}},c=function(t){return function(){e.fireEvent(e.list().MENU_NAVIGATE,t)}},h=function(t){return function(){e.fireEvent(e.list().SLIDE_OVERLAY_IN,{elementId:t.elementId}),e.fireEvent(e.list().MENU_NAVIGATE,{destination:t.destination,elementId:"navigate_settings"})}},p=function(t){return function(){e.fireEvent(e.list().CLOSE_OVERLAY,t)}},d=function(t){return e.fireEvent(e.list().REGISTER_SETTING,t),function(){e.fireEvent(e.list().SET_SETTING_INDEX,t)}},v=function(t){return function(){e.fireEvent(e.list().PLAYER_CONTROL_EVENT,t),setTimeout(function(){},60)}},m=function(t){e.fireEvent(e.list().REGISTER_STATE_LIGHT,t)},g=function(t){e.fireEvent(e.list().REGISTER_STATE_LEVER,t)},y=function(t){e.fireEvent(e.list().REGISTER_STATE_LEVER_TARGET,t)},b=function(t){e.fireEvent(e.list().REGISTER_STATE_VALUE,t)},w=function(t){e.fireEvent(e.list().REGISTER_STATE_AXIS,t)},E=function(t){return function(){e.fireEvent(e.list()[t.event],t.eArgs)}},S,x=function(t){return function(){S&&e.fireEvent(e.list().UNLOAD_UI_TEMPLATE,{templateId:S}),S!=t.templateId?(e.fireEvent(e.list().LOAD_UI_TEMPLATE,{templateId:t.templateId}),e.fireEvent(e.list().ANALYTICS_EVENT,{category:"OPEN_MENU",action:t.templateId,labels:"",value:0}),S=t.templateId):S=null}},T=function(t){return function(){e.fireEvent(e.list().OPEN_UI_PAGE,{page:t.uiContent,parentId:t.elementId})}},N=function(e){return function(){console.log("TRIGGER DYNAMIC DIRECTIVE: ",e),t.registerDragFeedbackElements(e)}};return{REGISTER_DRAG_ELEMENTS:N,OPEN_UI_CONTENT:T,TOGGLE_UI_TEMPLATE:x,TRIGGER_EVENT:E,LOAD_ELEMENT_DATA:o,LINES_LAYOUT:u,RADIO_SELECT_LAYOUT:s,NAVIGATION_BUTTON:a,CLICK_CLOSE_OVERLAY:p,SHOW_OVERLAY:l,MENU_NAVIGATE:c,OPEN_MENU:h,REMOVE_OVERLAY:f,SELECT_SETTING:d,PLANE_UI_INPUT:v,PLANE_UI_LIGHT:m,PLANE_UI_LEVER:g,PLANE_UI_LEVER_TARGET:y,PLANE_UI_VALUE:b,PLANE_UI_PITCH_ROLL_YAW:w}}),define("navigation/Destinations",{START:[{label:"Go to Lobby",targetPage:"LOBBY_PAGE"}],LOBBY:[{label:"Go to Game",targetPage:"GAME_PAGE"},{label:"Back to Start",targetPage:"START_PAGE"}],GAME:[{label:"Back to Lobby",targetPage:"LOBBY_PAGE"}],MENU:[{label:"Bet levels",targetPage:"BET_LEVELS_PAGE"},{label:"Settings",targetPage:"SETTINGS_PAGE"},{label:"Pay table",targetPages:["PAYTABLE_PAGE_0","PAYTABLE_PAGE_1","PAYTABLE_PAGE_2","PAYTABLE_PAGE_3"]}]}),define("template/TemplateData",["game/GameConfiguration","game/scenario/ScenarioDefinitions","template/Directives","navigation/Destinations"],function(e,t,n,r){return{start_screen:{text:{welcome_text:"Welcome to the start screen",start_button:r.START[0].label},directives:{start_button:{hasClick:n.NAVIGATION_BUTTON({destination:r.START[0].targetPage})}}},settings_data:{text:{},directives:{}},bottom_bar:{text:{},directives:{debug_mechanics_light:n.PLANE_UI_LIGHT({control:"debug_mechanics",elementId:"debug_mechanics_light"}),debug_mechanics:{hasClick:n.PLANE_UI_INPUT({control:"debug_mechanics",value:1})},open_help_ui:{hasClick:n.TOGGLE_UI_TEMPLATE({templateId:"UI_HELP_MENU"})},open_sound_ui:{hasClick:n.TOGGLE_UI_TEMPLATE({templateId:"UI_SOUND_MENU"})},open_key_bindings:{hasClick:n.TOGGLE_UI_TEMPLATE({templateId:"UI_KEY_BINDINGS"})},open_vfx_ui:{hasClick:n.TOGGLE_UI_TEMPLATE({templateId:"UI_VFX_MENU"})},exit_scenario:{hasClick:n.TRIGGER_EVENT({event:"EXIT_SCENARIO",eArgs:{}})}}},help_menu:{text:{},directives:{close_x:{hasClick:n.TOGGLE_UI_TEMPLATE({templateId:"UI_HELP_MENU"})}}},vfx_menu:{text:{},directives:{close_x:{hasClick:n.TOGGLE_UI_TEMPLATE({templateId:"UI_VFX_MENU"})},key_bindings_container:{dynamicDirective:n.OPEN_UI_CONTENT({uiContent:"VFX_MENU",elementId:"vfx_menu_container"})}}},sound_menu:{text:{},directives:{close_x:{hasClick:n.TOGGLE_UI_TEMPLATE({templateId:"UI_SOUND_MENU"})},key_bindings_container:{dynamicDirective:n.OPEN_UI_CONTENT({uiContent:"SOUND_MENU",elementId:"sound_menu_container"})}}},key_bindings:{text:{},directives:{close_x:{hasClick:n.TOGGLE_UI_TEMPLATE({templateId:"UI_KEY_BINDINGS"})},key_bindings_container:{dynamicDirective:n.OPEN_UI_CONTENT({uiContent:"KEY_BINDINGS",elementId:"key_bindings_container"})}}},scenario_select:{text:{},directives:{config_controller:{hasClick:n.TRIGGER_EVENT({event:"CONFIGURE_CONTROLLER",eArgs:{}})},carrier_patrol:{hasClick:n.TRIGGER_EVENT({event:"SCENARIO_SELECTED",eArgs:{scenario:t.SCENARIOS.carrier_patrol}})},flight_tomcat:{hasClick:n.TRIGGER_EVENT({event:"SCENARIO_SELECTED",eArgs:{scenario:t.SCENARIOS.tomcat_freeflight}})},flight_tunnan:{hasClick:n.TRIGGER_EVENT({event:"SCENARIO_SELECTED",eArgs:{scenario:t.SCENARIOS.tunnan_freeflight}})},flight_draken:{hasClick:n.TRIGGER_EVENT({event:"SCENARIO_SELECTED",eArgs:{scenario:t.SCENARIOS.draken_freeflight}})},flight_cougar:{hasClick:n.TRIGGER_EVENT({event:"SCENARIO_SELECTED",eArgs:{scenario:t.SCENARIOS.cougar_freeflight}})},flight_b52:{hasClick:n.TRIGGER_EVENT({event:"SCENARIO_SELECTED",eArgs:{scenario:t.SCENARIOS.b52_freeflight}})},takeoff_tunnan:{hasClick:n.TRIGGER_EVENT({event:"SCENARIO_SELECTED",eArgs:{scenario:t.SCENARIOS.tunnan_takeoff}})},takeoff_draken:{hasClick:n.TRIGGER_EVENT({event:"SCENARIO_SELECTED",eArgs:{scenario:t.SCENARIOS.draken_takeoff}})},takeoff_cougar:{hasClick:n.TRIGGER_EVENT({event:"SCENARIO_SELECTED",eArgs:{scenario:t.SCENARIOS.cougar_takeoff}})},runway_pilot:{hasClick:n.TRIGGER_EVENT({event:"SCENARIO_SELECTED",eArgs:{scenario:t.SCENARIOS.human_pilot}})},battleship_assault:{hasClick:n.TRIGGER_EVENT({event:"SCENARIO_SELECTED",eArgs:{scenario:t.SCENARIOS.battleship_battle}})},b52_chase:{hasClick:n.TRIGGER_EVENT({event:"SCENARIO_SELECTED",eArgs:{scenario:t.SCENARIOS.b52_chase}})},three_islands:{hasClick:n.TRIGGER_EVENT({event:"SCENARIO_SELECTED",eArgs:{scenario:t.SCENARIOS.three_world_islands}})},options_container:{dynamicDirective:n.OPEN_UI_CONTENT({uiContent:"OPTIONS_MENU",elementId:"options_container"})}}},flight_values:{text:{},directives:{thr_container:n.PLANE_UI_VALUE({value:"throttle",elementId:"thr_container"}),alt_container:n.PLANE_UI_VALUE({value:"altitude",elementId:"alt_container"}),ias_container:n.PLANE_UI_VALUE({value:"speed",elementId:"ias_container"}),afl_x:n.PLANE_UI_VALUE({value:"airflowx",elementId:"afl_x"}),afl_y:n.PLANE_UI_VALUE({value:"airflowy",elementId:"afl_y"}),afl_z:n.PLANE_UI_VALUE({value:"airflowz",elementId:"afl_z"}),g_force:n.PLANE_UI_VALUE({value:"gForce",elementId:"g_force"})}},ui_pilot:{text:{},directives:{enter_vehicle:{hasClick:n.TRIGGER_EVENT({event:"USE_NEAREST_ENTITY",eArgs:{}})},pop_sphere_char:{hasClick:n.TRIGGER_EVENT({event:"POP_SPHERE",eArgs:{}})},debug_mechanics_light:n.PLANE_UI_LIGHT({control:"debug_mechanics",elementId:"debug_mechanics_light"}),debug_mechanics:{hasClick:n.PLANE_UI_INPUT({control:"debug_mechanics",value:1})},go_approach:{hasClick:n.TRIGGER_EVENT({event:"PLAYER_MOVE_TO_POINT",eArgs:{pos:e.PLAYER_INIT.approach.pos}})},go_base_plane:{hasClick:n.TRIGGER_EVENT({event:"PLAYER_MOVE_TO_POINT",eArgs:{pos:e.PLAYER_INIT.landingStrip.pos}})},go_battle:{hasClick:n.TRIGGER_EVENT({event:"PLAYER_MOVE_TO_POINT",eArgs:{pos:e.PLAYER_INIT.battle.pos}})}}},ui_pv_9031:{text:{},directives:{engine_light:n.PLANE_UI_LIGHT({control:"engines",elementId:"engine_light"}),throttle_lever:n.PLANE_UI_LEVER({control:"engines",elementId:"throttle_lever"}),throttle_target:n.PLANE_UI_LEVER_TARGET({control:"throttle",elementId:"throttle_target"}),throttle_0:{hasClick:n.PLANE_UI_INPUT({control:"throttle",value:0})},throttle_20:{hasClick:n.PLANE_UI_INPUT({control:"throttle",value:.2})},throttle_60:{hasClick:n.PLANE_UI_INPUT({control:"throttle",value:.6})},throttle_100:{hasClick:n.PLANE_UI_INPUT({control:"throttle",value:1})},break_light:n.PLANE_UI_LIGHT({control:"breaks",elementId:"break_light"}),break_lever:n.PLANE_UI_LEVER({control:"breaks",elementId:"break_lever"}),break_0:{hasClick:n.PLANE_UI_INPUT({control:"breaks",value:0})},break_20:{hasClick:n.PLANE_UI_INPUT({control:"breaks",value:.2})},break_60:{hasClick:n.PLANE_UI_INPUT({control:"breaks",value:.6})},break_100:{hasClick:n.PLANE_UI_INPUT({control:"breaks",value:1})},pedal_yaw_lever:n.PLANE_UI_PITCH_ROLL_YAW({control:"rudder",elementId:"pedal_yaw_lever",axis:"yaw"}),exit_car:{hasClick:n.TRIGGER_EVENT({event:"EXIT_CONTROLLED_ENTITY",eArgs:{}})},pop_sphere_car:{hasClick:n.TRIGGER_EVENT({event:"POP_SPHERE",eArgs:{}})},debug_mechanics_light:n.PLANE_UI_LIGHT({control:"debug_mechanics",elementId:"debug_mechanics_light"}),debug_mechanics:{hasClick:n.PLANE_UI_INPUT({control:"debug_mechanics",value:1})},go_approach:{hasClick:n.TRIGGER_EVENT({event:"PLAYER_MOVE_TO_POINT",eArgs:{pos:e.PLAYER_INIT.approach.pos}})},go_base_plane:{hasClick:n.TRIGGER_EVENT({event:"PLAYER_MOVE_TO_POINT",eArgs:{pos:e.PLAYER_INIT.landingStrip.pos}})},go_battle:{hasClick:n.TRIGGER_EVENT({event:"PLAYER_MOVE_TO_POINT",eArgs:{pos:e.PLAYER_INIT.battle.pos}})}}},carrier_ui:{text:{},directives:{service_plane:{hasClick:n.TRIGGER_EVENT({event:"PLAYER_MOVE_TO_POINT",eArgs:{pos:e.PLAYER_INIT.stratosphere.pos}})},ready_plane:{hasClick:n.TRIGGER_EVENT({event:"PLAYER_MOVE_TO_POINT",eArgs:{pos:e.PLAYER_INIT.stratosphere.pos}})},control_plane:{hasClick:n.TRIGGER_EVENT({event:"PLAYER_MOVE_TO_POINT",eArgs:{pos:e.PLAYER_INIT.stratosphere.pos}})}}},drag_feedback:{text:{},directives:{drag_from_point:{dynamicDirective:n.REGISTER_DRAG_ELEMENTS({start:"drag_from_point"})},drag_to_point:{dynamicDirective:n.REGISTER_DRAG_ELEMENTS({end:"drag_to_point"})},drag_vector:{dynamicDirective:n.REGISTER_DRAG_ELEMENTS({vector:"drag_vector"})},drag_target_frame:{dynamicDirective:n.REGISTER_DRAG_ELEMENTS({frame:"drag_target_frame"})},hover_target_frame:{dynamicDirective:n.REGISTER_DRAG_ELEMENTS({hover:"hover_target_frame"})},horizontal_state:{dynamicDirective:n.REGISTER_DRAG_ELEMENTS({state_h:"horizontal_state"})},vertical_state:{dynamicDirective:n.REGISTER_DRAG_ELEMENTS({state_v:"vertical_state"})},hover_state_label:{dynamicDirective:n.REGISTER_DRAG_ELEMENTS({hover_label:"hover_state_label"})}}},ui_tunnan:{text:{},directives:{gear_button:{hasClick:n.PLANE_UI_INPUT({control:"gears",value:1})},gear_light:{hasClick:n.PLANE_UI_LIGHT({control:"gears",elementId:"gear_light"})},nose_gear_light:n.PLANE_UI_LIGHT({control:"gears",elementId:"nose_gear_light"}),left_gear_light:n.PLANE_UI_LIGHT({control:"gears",elementId:"left_gear_light"}),right_gear_light:n.PLANE_UI_LIGHT({control:"gears",elementId:"right_gear_light"}),engine_light:n.PLANE_UI_LIGHT({control:"engines",elementId:"engine_light"}),throttle_lever:n.PLANE_UI_LEVER({control:"engines",elementId:"throttle_lever"}),throttle_target:n.PLANE_UI_LEVER_TARGET({control:"throttle",elementId:"throttle_target"}),throttle_0:{hasClick:n.PLANE_UI_INPUT({control:"throttle",value:0})},throttle_20:{hasClick:n.PLANE_UI_INPUT({control:"throttle",value:.2})},throttle_60:{hasClick:n.PLANE_UI_INPUT({control:"throttle",value:.6})},throttle_100:{hasClick:n.PLANE_UI_INPUT({control:"throttle",value:1})},flap_light:n.PLANE_UI_LIGHT({control:"flaps",elementId:"flap_light"}),flap_lever:n.PLANE_UI_LEVER({control:"flaps",elementId:"flap_lever"}),flap_target:n.PLANE_UI_LEVER_TARGET({control:"flaps",elementId:"flap_target"}),flap_0:{hasClick:n.PLANE_UI_INPUT({control:"flaps",value:0})},flap_30:{hasClick:n.PLANE_UI_INPUT({control:"flaps",value:.33})},flap_60:{hasClick:n.PLANE_UI_INPUT({control:"flaps",value:.66})},flap_90:{hasClick:n.PLANE_UI_INPUT({control:"flaps",value:1})},break_light:n.PLANE_UI_LIGHT({control:"breaks",elementId:"break_light"}),break_lever:n.PLANE_UI_LEVER({control:"breaks",elementId:"break_lever"}),break_target:n.PLANE_UI_LEVER_TARGET({control:"breaks",elementId:"break_target"}),break_0:{hasClick:n.PLANE_UI_INPUT({control:"breaks",value:0})},break_20:{hasClick:n.PLANE_UI_INPUT({control:"breaks",value:.2})},break_60:{hasClick:n.PLANE_UI_INPUT({control:"breaks",value:.6})},break_100:{hasClick:n.PLANE_UI_INPUT({control:"breaks",value:1})},wing_smoke_light:n.PLANE_UI_LIGHT({control:"wing_smoke",elementId:"wing_smoke_light"}),wing_smoke_button:{hasClick:n.PLANE_UI_INPUT({control:"wing_smoke",value:1})},canopy_light:n.PLANE_UI_LIGHT({control:"canopy",elementId:"canopy_light"}),canopy_button:{hasClick:n.PLANE_UI_INPUT({control:"canopy",value:1})},auto_trim:{hasClick:n.PLANE_UI_INPUT({control:"auto_trim",value:1})},reset_trim:{hasClick:n.PLANE_UI_INPUT({control:"reset_trim",value:1})},trim_light:n.PLANE_UI_LIGHT({control:"auto_trim",elementId:"trim_light"}),elevation_lever:n.PLANE_UI_PITCH_ROLL_YAW({control:"trim_elevator",elementId:"elevation_lever",axis:"pitch"}),yaw_lever:n.PLANE_UI_PITCH_ROLL_YAW({control:"trim_rudder",elementId:"yaw_lever",axis:"yaw"}),roll_lever:n.PLANE_UI_PITCH_ROLL_YAW({control:"trim_aeilrons",elementId:"roll_lever",axis:"roll"}),stick_elevation_lever:n.PLANE_UI_PITCH_ROLL_YAW({control:"elevator",elementId:"stick_elevation_lever",axis:"pitch"}),pedal_yaw_lever:n.PLANE_UI_PITCH_ROLL_YAW({control:"rudder",elementId:"pedal_yaw_lever",axis:"yaw"}),stick_roll_lever:n.PLANE_UI_PITCH_ROLL_YAW({control:"aeilrons",elementId:"stick_roll_lever",axis:"roll"}),cannon_light:n.PLANE_UI_LIGHT({control:"cannons",elementId:"cannon_light"}),cannon_button:{hasClick:n.PLANE_UI_INPUT({control:"cannons",value:1})},exit_plane:{hasClick:n.TRIGGER_EVENT({event:"EXIT_CONTROLLED_ENTITY",eArgs:{}})},go_strat:{hasClick:n.TRIGGER_EVENT({event:"PLAYER_MOVE_TO_POINT",eArgs:{pos:e.PLAYER_INIT.stratosphere.pos}})},go_approach:{hasClick:n.TRIGGER_EVENT({event:"PLAYER_MOVE_TO_POINT",eArgs:{pos:e.PLAYER_INIT.approach.pos}})},go_base_plane:{hasClick:n.TRIGGER_EVENT({event:"PLAYER_MOVE_TO_POINT",eArgs:{pos:e.PLAYER_INIT.landingStrip.pos}})},go_battle:{hasClick:n.TRIGGER_EVENT({event:"PLAYER_MOVE_TO_POINT",eArgs:{pos:e.PLAYER_INIT.battle.pos}})}}},menu_navigation:{text:{close_settings_button:""},directives:{close_settings_button:{hasClick:n.REMOVE_OVERLAY({elementId:"menu_parent"})},navigate_bet_levels:{hasClick:n.MENU_NAVIGATE({destination:r.MENU[0].targetPage,elementId:"navigate_bet_levels"})},navigate_settings:{hasClick:n.MENU_NAVIGATE({destination:r.MENU[1].targetPage,elementId:"navigate_settings"})},navigate_paytable:{hasClick:n.MENU_NAVIGATE({destination:r.MENU[2].targetPages[0],elementId:"navigate_paytable"})}}},game_page:{text:{},directives:{}}}}),define("template/Templates",["template/TemplateData"],function(e){return{UI_SCENARIOS_TEMPLATE:{file:"scenario_select",html:"",data:e.scenario_select},HELP_MENU_TEMPLATE:{file:"help_menu",html:"",data:e.help_menu},VFX_MENU_TEMPLATE:{file:"vfx_menu",html:"",data:e.vfx_menu},KEY_BINDINGS_TEMPLATE:{file:"key_bindings",html:"",data:e.key_bindings},SOUND_MENU_TEMPLATE:{file:"sound_menu",html:"",data:e.sound_menu},SETTINGS_TEMPLATE:{file:"settings",html:"",data:e.settings_data},BOTTOM_BAR_TEMPLATE:{file:"bottom_bar",html:"",data:e.bottom_bar},UI_AIR_PARAMS_TEMPLATE:{file:"flight_values",html:"",data:e.flight_values},UI_CARRIER_TEMPLATE:{file:"carrier_ui",html:"",data:e.carrier_ui},UI_TUNNAN_TEMPLATE:{file:"ui_tunnan",html:"",data:e.ui_tunnan},DRAG_FEEDBACK_TEMPLATE:{file:"drag_feedback",html:"",data:e.drag_feedback},UI_PV_9031_TEMPLATE:{file:"ui_pv_9031",html:"",data:e.ui_pv_9031},UI_PILOT_TEMPLATE:{file:"pilot",html:"",data:e.ui_pilot}}}),define("feedback/FeedbackList",["feedback/AnimationList","sound/SoundList"],function(e,t){return{pages:{LOAD_FINISHED:{animData:e.LOAD_HIDE,soundData:t.WHEEL_START_1},HIDE_PAGE_UP:{animData:e.HIDE_CONTAINER_UP},SLIDE_PAGE_UP:{animData:e.SLIDE_CONTAINER_UP,soundData:t.FLIP},SLIDE_PAGE_IN:{animData:e.SLIDE_CONTAINER_IN,soundData:t.FLIP_2}},potentials:{POTENTIAL_0:{animData:e.CLEAR_DICE_POTENTIAL},POTENTIAL_1:{animData:e.PRESENT_DICE_POTENTIAL_1,soundData:t.RES_MEDIUM},POTENTIAL_2:{animData:e.PRESENT_DICE_POTENTIAL_2,soundData:t.RES_RARE}},win_levels:{NONE:{animData:e.PRESENT_LEVEL_NONE,soundData:t.RES_NONE},SMALL:{animData:e.PRESENT_LEVEL_SMALL,soundData:t.RES_SMALL},MEDIUM:{animData:e.PRESENT_LEVEL_MEDIUM,soundData:t.RES_MEDIUM},BIG:{animData:e.PRESENT_LEVEL_BIG,soundData:t.RES_BIG},RARE:{animData:e.PRESENT_LEVEL_RARE,soundData:t.RES_RARE},EPIC:{animData:e.PRESENT_LEVEL_EPIC,soundData:t.RES_EPIC}},dice:{REVEAL_1:{animData:e.DICE_PRESENT_VALUE_1,soundData:t.REVEAL_VALUE_1},REVEAL_2:{animData:e.DICE_PRESENT_VALUE_2,soundData:t.REVEAL_VALUE_2},REVEAL_3:{animData:e.DICE_PRESENT_VALUE_3,soundData:t.REVEAL_VALUE_3},REVEAL_4:{animData:e.DICE_PRESENT_VALUE_4,soundData:t.REVEAL_VALUE_4},REVEAL_5:{animData:e.DICE_PRESENT_VALUE_5,soundData:t.REVEAL_VALUE_5},REVEAL_6:{animData:e.DICE_PRESENT_VALUE_6,soundData:t.REVEAL_VALUE_6}},wheels:{WHEEL_START:{animData:e.WHEEL_START,soundData:t.WHEEL_STOP_1},WHEEL_STOP:{animData:e.WHEEL_STOP,soundData:t.WHEEL_START_1}},moves:{SLAP:{animData:e.ROLLING_BUTTON_OUT,soundData:t.BUTTON_FAT_UP},VALUE_FLIP_IN:{animData:e.PRESENT_LEVEL_SHOW,soundData:t.THUMP_C},BUMP:{animData:e.FLICK,soundData:t.THUMP_G}},buttons:{ROLL_OUT:{animData:e.ROLLING_BUTTON_OUT,soundData:t.SPIN_BUTTON_OUT},ROLL_IN:{animData:e.ROLLING_BUTTON_IN,soundData:t.ROLL_FLIPS},BUMP:{animData:e.BUTTON_BUMP,soundData:t.UI_CLICK}}}}),define("navigation/Pages",["navigation/Destinations","template/Templates"],function(e,t){return{UI_DRAG_FEEDBACK:{parentId:"game_window",template:t.DRAG_FEEDBACK_TEMPLATE,navigation:{}},UI_VFX_MENU:{parentId:"viewporter",template:t.VFX_MENU_TEMPLATE,navigation:{}},UI_HELP_MENU:{parentId:"viewporter",template:t.HELP_MENU_TEMPLATE,navigation:{}},UI_SOUND_MENU:{parentId:"viewporter",template:t.SOUND_MENU_TEMPLATE,navigation:{}},UI_KEY_BINDINGS:{parentId:"viewporter",template:t.KEY_BINDINGS_TEMPLATE,navigation:{}},UI_BOTTOM_BAR:{parentId:"bottom_bar",template:t.BOTTOM_BAR_TEMPLATE,navigation:{}},UI_SCENARIOS:{parentId:"viewporter",template:t.UI_SCENARIOS_TEMPLATE,navigation:{}},UI_TUNNAN:{parentId:"plane_controls",template:t.UI_TUNNAN_TEMPLATE,navigation:{}},UI_CARRIER:{parentId:"plane_controls",template:t.UI_CARRIER_TEMPLATE,navigation:{}},UI_PV_9031:{parentId:"plane_controls",template:t.UI_PV_9031_TEMPLATE,navigation:{}},UI_PILOT:{parentId:"plane_controls",template:t.UI_PILOT_TEMPLATE,navigation:{}},UI_AIR_PARAMS:{parentId:"air_params",template:t.UI_AIR_PARAMS_TEMPLATE,navigation:{}},SETTINGS_PAGE:{parentId:"menu_content",template:t.SETTINGS_TEMPLATE,navigation:{}}}}),define("load/TrackProgress",["application/EventManager","view/DomUtils","feedback/FeedbackList","navigation/Pages"],function(e,t,n,r){var i=0,s=0,o=0,u=[],a=[],f=[],l=[],c,h,p,d,v=function(n){p=t.getElementById("progress_label"),h=t.getElementById("progress_bar"),c=t.getElementById("file_feedback"),i=0,s=0,o=0,u=[],a=[],h.style.width="0%",t.setElementHtml(p,"0%"),d=t.getElementById("loading_screen"),t.setElementHtml("load_title",n.title),t.setElementHtml("load_tagline",n.tagLine),t.quickShowElement(d),e.fireEvent(e.list().TRIGGER_ANIMATION,{elementId:d.id,animData:e.anim().LOAD_SHOW})},m=function(){e.fireEvent(e.list().TRIGGER_ANIMATION,{elementId:d.id,animData:e.anim().LOAD_HIDE});var n=function(){t.quickHideElement(d)};e.fireEvent(e.list().LOADING_ENDED,{}),e.fireEvent(e.list().SEQUENCE_CALLBACK,{callback:n,wait:e.anim().LOAD_HIDE.time*800})},g=function(e,t){return 100*(t/e)},y=function(e,n,r,o){var u=g(i,s);h.style.width=u+"%",t.setElementHtml(p,Math.floor(u)+"%");var a="#2d5",f="";for(var d=0;d<l.length;d++)f+=l[d]+"<br>";t.setElementHtml(c,f),c.style.color=a,t.setElementHtml(h,o),h.style.color=a},b=function(){d=t.getElementById("loading_screen"),console.log("Track Progress - Loading Completed"),e.fireEvent(e.list().LOADING_COMPLETED,{started:i,completed:s,errors:o})},w=function(e,t,n,r){function h(){clearTimeout(c),c=setTimeout(function(){b()},1300)}i+=e,s+=t,o+=n,r&&(e&&(u.push(r),l.push(r)),t&&(a.push(r),l.splice(l.indexOf(r),1)),n&&f.push(r)),y(i,s,o,r);var c;i==s+o&&h()},E=function(){return{started:i,finished:s,errors:o,remaining:l,load:u,done:a,error:f}},S=function(t){var n=e.eventArgs(t);w(n.started,n.completed,n.errors,n.id)};return e.registerListener(e.list().LOAD_PROGRESS,S),{showLoadingScreen:v,removeLoadingScreen:m,loadingProgress:w,getLoadedCount:E}}),define("template/TemplateRepository",["template/Templates","load/TrackProgress"],function(e,t){var n=function(n,r){e[r.id].html=n,t.loadingProgress(0,1,0,r.id)};return{storeTemplate:n}}),define("io/Receive",["application/EventManager","io/Requests","template/TemplateRepository"],function(e,t,n){var r=function(e,t){if(!e)return;t.action&&s(JSON.parse(e),t),t.util&&i(e,t)},i=function(e,r){switch(r.util){case t.utils.LOAD_JSON:r.responseCallback(e);break;case t.utils.LOAD_TEMPLATE:n.storeTemplate(e,r.params);break;case t.utils.LOAD_CONTEXT_SOUND:r.params.callback(r.params.sound,e);break;default:alert("Unhandled response from utility packet")}},s=function(n,r){switch(r.action){case t.game.GAME_INIT:e.fireEvent(e.list().GOT_GAME_CONFIGURATION,{gameConfig:n});break;default:alert("Unhandled game response from action packet")}};return{handleResponse:r}}),define("io/XhrWrapper",["io/Receive"],function(e){var t=0,n={},r=function(){return t+=1,"requestId_"+t},i=function(e){e.packetId=r(),s(e)},s=function(t){var r=t.packetId,i="",s=new XMLHttpRequest;s.packet=t;var o=!0;s.open(t.type,t.url,o),t.responseType&&(s.responseType=t.responseType),t.contentType=="application/json"&&(i=JSON.stringify(t.body),s.setRequestHeader("Content-Type",t.contentType)),t.contentType=="application/x-www-form-urlencoded"&&(i=t.params,s.setRequestHeader("Content-Type",t.contentType)),t.auth&&s.setRequestHeader("Authorization",t.auth.header),s.onreadystatechange=function(){s.readyState==4&&e.handleResponse(s.response,s.packet)},s.onError=function(){alert("XHR Error! "+s.packet.packetId)},s.send(i),n[r]=s};return{sendRequest:i}}),define("io/Send",["game/GameConfiguration","application/EventManager","io/Requests","io/XhrWrapper"],function(e,t,n,r){var i,s=function(e){i=e},o=function(){return i},u=function(){return n.game},a=function(e,t){var i=p(n.utils.LOAD_JSON,{url:e});i.responseCallback=t,r.sendRequest(i)},f=function(e,t){var n=p(e,t);r.sendRequest(n)},l=function(e,t){return"&"+e+"="+t},c=function(t,n){var i=h(t,n);if(!i)return;i.url=e.CONNECTION.configuration.url,r.sendRequest(i)},h=function(t,r){var i;switch(t){case n.game.GAME_BET:console.log("Send Data: ",r);var s=e.CONNECTION.serverMap.gameId+"="+e.CONNECTION.configuration.gameId;s+=l(e.CONNECTION.serverMap.authToken,e.CONNECTION.configuration.authToken),s+=l(e.CONNECTION.serverMap.actionName,e.CONNECTION.serverMap.spin),s+=l("betsize",""+r.betsize),s+=l("coinvalue",r.coinvalue),s+=l("sessionid",r.sessionId),i={type:"POST",contentType:"application/x-www-form-urlencoded",params:s};break;case n.game.GAME_INIT:var s=e.CONNECTION.serverMap.gameId+"="+e.CONNECTION.configuration.gameId;s+=l(e.CONNECTION.serverMap.authToken,e.CONNECTION.configuration.authToken),s+=l(e.CONNECTION.serverMap.actionName,e.CONNECTION.serverMap.launch),i={type:"POST",contentType:"application/x-www-form-urlencoded",params:s};break;case n.game.BET_CONFIRMED:var s=e.CONNECTION.serverMap.gameId+"="+e.CONNECTION.configuration.gameId;s+=l(e.CONNECTION.serverMap.authToken,e.CONNECTION.configuration.authToken),s+=l(e.CONNECTION.serverMap.actionName,e.CONNECTION.serverMap.confirm),s+=l("sessionid",s.sessionId),i={type:"POST",contentType:"application/x-www-form-urlencoded",params:s}}return i.action=t,i.params=s,i},p=function(e,t){var r=t.url;switch(e){case n.utils.LOAD_JSON:var i={responseType:"application/json",type:"GET",url:r};break;case n.utils.LOAD_TEMPLATE:var i={type:"GET",url:r};break;case n.utils.LOAD_CONTEXT_SOUND:var i={responseType:"arraybuffer",type:"GET",url:r}}return i.util=e,i.params=t,i},d=function(e){a(t.eventArgs(e).url,t.eventArgs(e).callback)};return t.registerListener(t.list().LOAD_JSON,d),{setRestParams:s,gameAction:u,gameRequest:c,utilRequest:f}}),define("sound/SourceFactory",["io/Requests","io/Send","view/DomUtils","application/EventManager"],function(e,t,n,r){var i="./resources/sounds/",s,o,u,a=function(){return s},f=function(){if(!Audio in window)return alert("Browser does not support sounds."),"";var e=new Audio,t=!!e.canPlayType&&e.canPlayType("audio/ogg")!=="",n=!!e.canPlayType&&e.canPlayType("audio/mp3")!=="";return t?s="ogg":n?s="mp3":alert("Browser can not play the sounds needed for this game."),s},l=function(){var e=["AudioContext","webkitAudioContext","Audio"];for(var t=0;t<e.length;t++)if(e[t]in window)return o=e[t],o;return""},c=function(){s=f(),o=l();if(!o)return;if(o!="Audio")return u=new window[o],r.fireEvent(r.list().REGISTER_AUDIO_CONTEXT,{context:u,model:o}),typeof u.createGain!="function"&&(u.createGain=u.createGainNode),u;alert("This browser does not support the Web Audio Api. Will run with limited sounds.")},h=function(e){var t=e,n=1,r=function(e){n=e},i=function(e){typeof e.stop=="function"?e.stop(0):e.noteOff(0)},s=function(e){r(e)},o=function(){var e=u.createBufferSource();return e.buffer=t,e},a=function(e){var i=u.createGain();return e.buffer=t,e.connect(i),i.gain.value=n,r=function(e){i.gain.value=e},i},f=function(e,t){e.loop=t,typeof e.start=="function"?e.start(0):e.noteOn(0)};return{getSource:o,wire:a,play:f,pause:i,setGain:s}},p=function(e){var t=1,n=function(e){e.pause()},r=function(e){t=e},i=function(n){var r=e.cloneNode(!1);r.volume=t,r.loop=n,r.play();var i=function(){r=null};return r.addEventListener("pause",i,!1),r};return{play:i,pause:n,setGain:r}},d=function(n,r,i,s){var o=function(e,t){var n=function(){i(0,0,1,s),console.log("Decode Error: ",e,t),alert("Sound decoding Error")};u.decodeAudioData(t,function(t){e.source=new h(t),i(0,1,0,s)},n)};t.utilRequest(e.utils.LOAD_CONTEXT_SOUND,{url:r,sound:n,callback:o})},v=function(e,t,n){var r={play:function(){},setGain:function(){},pause:function(){}};e.source=r,t(0,1,0,n)},m=function(e,t,n){if(!o){v(e,t,n);return}var r=i+e.folder+"/"+e.file+"."+s;if(u){d(e,r,t,n);return}if(o=="Audio"){var a=new Audio([r]),f=function(){t(0,1,0,n)};a.addEventListener("canplaythrough",f,!1),e.source=p(a)}};return{runSourceFactoryConfig:c,addSourceToSound:m}}),define("sound/SoundLoader",["sound/SoundList","sound/SourceFactory","load/TrackProgress"],function(e,t,n){var r,i=function(e,t,r,i){n.loadingProgress(0,1,0,i)},s=function(){r=t.runSourceFactoryConfig()},o=function(){console.log("Load Sound List: ",e);for(var r in e){var s=function(e,t,n){n&&console.log("Sound Loading Error")};e[r].options.preload&&(n.loadingProgress(1,0,0,e[r].file),s=i),t.addSourceToSound(e[r],s,e[r].file)}},u=function(){return r};return{initSoundSystem:s,loadSoundList:o,getPlayerContext:u}}),define("application/SettingsView",["application/EventManager","view/DomUtils"],function(e,t){var n,r={},i={},s=function(e){n=e},o=function(){return n},u=function(e,t){for(var n in r)if(r[n].settingId==e&&r[n].selectionIndex==t)return n},a=function(e){var n=i[e],r=u(e,n),s=t.getElementById(r);if(!s)return;t.disableElementInteraction(s),t.addElementClass(s,"setting_active")},f=function(){switch(o()){case"BET_LEVELS_PAGE":a("bet_sizes"),a("coin_values");break;case"SETTINGS_PAGE":a("numberSpins"),a("autoplayOn"),a("stopOnFreespin"),a("soundsOn"),a("soundDisable")}},l=function(t){e.fireEvent(e.list().ONESHOT_SOUND,{soundData:e.sound().HIGH_SWEEP});var n=e.eventArgs(t).destination;s(n),setTimeout(function(){f()},100)},c=function(e,n){console.log("Show Setting Index",e,n);if(i[e]!=undefined){var r=u(e,i[e]),s=t.getElementById(r);if(!s)return;t.enableElementInteraction(s),t.removeElementClass(s,"setting_active")}i[e]=n,f()},h=function(e,t,n,i){r[e]={settingId:t,value:n,selectionIndex:i}};return e.registerListener(e.list().MENU_NAVIGATE,l),{registerSettingElement:h,setActiveSettingIndex:c}}),define("application/SettingsModel",["game/GameConfiguration","application/EventManager","application/SettingsView"],function(e,t,n){var r={},i={},s=function(e){return r[e].values[i[e]]},o=function(e){var t=i[e],n=r[e].values.length,s=t+1;return s>=n&&(s=0),s},u=function(e,t,i,s,o){r[e]={values:i,loadIndex:s},n.registerSettingElement(t,e,i[o],o)},a=function(e,s){i[e]=s,t.fireEvent(t.list().ENABLE_SETTING_VALUE,{settingId:e,values:{value:r[e].values[s]}}),n.setActiveSettingIndex(e,s)},f=function(){for(var e in r)a(e,r[e].loadIndex)};return{getNextSettingIndex:o,loadSettingDefaults:f,addSetting:u,readSettingValue:s,enableSettingIndex:a}}),define("application/SettingsController",["application/EventManager","application/SettingsModel"],function(e,t){var n=function(e){return!0},r=function(n){var r=e.eventArgs(n),i=r.elementId,s=r.settingId,o=r.value;t.enableSettingIndex(s,r.properties.index)},i=function(n){var r=e.eventArgs(n),i=r.elementId,s=r.settingId,o=r.properties.data;t.addSetting(s,i,o.values,o.loadIndex,r.properties.index)},s=function(e){var n=t.getNextSettingIndex(e);t.enableSettingIndex(e,n)},o=function(){t.loadSettingDefaults()},u=function(t){var n=e.eventArgs(t).gameConfig,r=function(t){for(var r=0;r<n[t].length;r++){var i=t+"_"+r,s={values:n[t],loadIndex:1},o={elementId:i,settingId:t,properties:{data:s,index:r}};e.fireEvent(e.list().REGISTER_SETTING,o)}};setTimeout(function(){r("bet_sizes"),r("coin_values"),o()},1e3)},a=function(){s("bet_sizes")},f=function(){s("coin_values")};return e.registerListener(e.list().REGISTER_SETTING,i),e.registerListener(e.list().SET_SETTING_INDEX,r),{stepSettingState:s,readSetting:n}}),define("application/DeviceHandler",["application/EventManager"],function(e){function t(){var e=navigator.appName,t=navigator.userAgent,n,r=t.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);return r&&(n=t.match(/version\/([\.\d]+)/i))!=null&&(r[2]=n[1]),r=r?[r[1],r[2]]:[e,navigator.appVersion,"-?"],r[0]}function n(){var e=navigator.appName,t=navigator.userAgent,n,r=t.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);return r&&(n=t.match(/version\/([\.\d]+)/i))!=null&&(r[2]=n[1]),r=r?[r[1],r[2]]:[e,navigator.appVersion,"-?"],r[1]}function s(){if(t()=="Chrome")return!0;if(t()=="Firefox")return!1}var r=function(){window.scrollTo(0,0)},i=function(){document.ontouchmove=function(e){e.preventDefault()}};return e.registerListener(e.list().WINDOW_RESIZED,r),{handleClientSetupDone:i,getBrowser:t,hasPowerSound:s,getVersion:n}}),define("sound/EffectTrack",["application/EventManager","application/DeviceHandler"],function(e,t){var n,r,i,s=t.hasPowerSound(),o=function(e){n=e,r=n.createGain(),s?(i=n.createConvolver(),r.connect(i)):r.connect(n.destination),r.gain.value=.5},u=function(e){i.buffer=e,i.connect(n.destination)},a=function(){var t=function(e){u(e)};e.fireEvent(e.list().FETCH_BUFFER,{soundData:e.sound().FX_VERB,callback:t})},f=function(e){e.connect(r)},l=function(t){var n=e.eventArgs(t).node;n.connect(r)},c=function(){s&&a()};return s&&e.registerListener(e.list().SEND_SOUND_TO_REVERB,l),{setContext:o,setupFxTrack:c,connectTrackToFx:f}}),define("sound/SoundManager",["sound/SoundLoader","application/SettingsController","application/EventManager","sound/EffectTrack"],function(e,t,n,r){var i="soundDisable",s,o=function(){console.log("Load Sounds"),s||(f(),s=!0)},u=function(){r.setupFxTrack()},a=function(){e.initSoundSystem()},f=function(){e.loadSoundList()},l=function(e){var t=n.eventArgs(e),r=t.settingId;r==i&&o()};window.performance||(window.performance={}),performance.now=function(){return performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return(new Date).getTime()}}();var c=function(e){var t=n.eventArgs(e).callback;t(performance.now())};return n.registerListener(n.list().FETCH_TIME,c),n.registerListener(n.list().SET_SETTING_INDEX,l),{loadSounds:o,initSounds:a,initFx:u}}),define("template/TemplateLoader",["template/Templates","io/Requests","io/Send","load/TrackProgress"],function(e,t,n,r){var i=function(){for(var t in e){var n=e[t].file;o(t,n)}},s=function(e){setTimeout(function(){n.utilRequest(t.utils.LOAD_TEMPLATE,e)},100)},o=function(e,t){r.loadingProgress(1,0,0,e);var n="./templates/transparency/"+t+".transparency";s({id:e,url:n})};return{fetchTemplates:i}}),define("game/ModelDefinitions",["game/GameConfiguration"],function(e){var t={smoke:{blending:"CustomBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"},fire:{blending:"CustomBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneFactor"}};return{BULLETS:{cannon:{fire:{mesh:e.PRELOAD_GOO_MESHES.bullet_20,material:e.PRELOAD_GOO_MATERIALS.fire,textures:{DIFFUSE_MAP:e.PRELOAD_GOO_TEXTURES.machinery_diffuse,EMISSIVE_MAP:e.PRELOAD_GOO_TEXTURES.machinery_diffuse},shaderId:"uberShader"}}},GOO_PROJECTS:e.GOO_PROJECTS,GOO_MODELS:{nevada:{metal:{mesh:e.PRELOAD_GOO_MESHES.nevada_metal,material:e.PRELOAD_GOO_MATERIALS.metal,textures:{DIFFUSE_MAP:e.PRELOAD_GOO_TEXTURES.machinery_diffuse,SPECULAR_MAP:e.PRELOAD_GOO_TEXTURES.machinery_spec},shaderId:"uberShader"}}},GOO_PARTICLES:{smokestack:{name:"smokestack",blendState:t.smoke,targetSpace:null,textures:{PARTICLE_TX:e.PRELOAD_GOO_TEXTURES.smoke_particle},emitters:[{totalParticlesToSpawn:-1,releaseRatePerSecond:8,minLifetime:3,maxLifetime:21}],timeline:[{timeOffset:0,spin:0,mass:1,size:5.1,color:[0,0,0,.15]},{timeOffset:.2,size:25,color:[0,0,0,.05]},{timeOffset:.4,size:44.2,color:[0,0,0,.03]},{timeOffset:.3,size:70.5,color:[0,0,0,0]}]},jet_smoke:{name:"jet_smoke",blendState:t.smoke,targetSpace:null,textures:{PARTICLE_TX:e.PRELOAD_GOO_TEXTURES.smoke_particle},emitters:[{totalParticlesToSpawn:-1,releaseRatePerSecond:45,minLifetime:1,maxLifetime:9,posOffset:[0,-0.22,-4.5]}],timeline:[{timeOffset:0,spin:0,mass:1,size:.2,color:[.25,.12,.11,.08]},{timeOffset:.05,size:1,color:[.1,.1,.1,.03]},{timeOffset:.3,size:8.2,color:[0,0,0,.02]},{timeOffset:.3,size:22.5,color:[0,0,0,0]}]},tomcat_jet:{name:"tomcat_jet",blendState:t.fire,targetSpace:"parent",textures:{PARTICLE_TX:e.PRELOAD_GOO_TEXTURES.dot_particle},emitters:[{totalParticlesToSpawn:-1,releaseRatePerSecond:1400,minLifetime:.03,maxLifetime:.07}],timeline:[{timeOffset:0,mass:1,size:.7,color:[.5,.5,.6,.38]},{timeOffset:.3,size:.95,color:[.4,.3,.3,.12]},{timeOffset:.2,size:.35,color:[.6,.6,.3,.04]},{timeOffset:.3,size:1.57,color:[1,.6,.1,.03]},{timeOffset:.2,size:.85,color:[1,.3,0,0]}]},basic_jet:{name:"basic_jet",blendState:t.fire,targetSpace:"parent",textures:{PARTICLE_TX:e.PRELOAD_GOO_TEXTURES.dot_particle},emitters:[{totalParticlesToSpawn:-1,releaseRatePerSecond:600,minLifetime:.06,maxLifetime:.14},{totalParticlesToSpawn:-1,releaseRatePerSecond:600,minLifetime:.04,maxLifetime:.08}],timeline:[{timeOffset:0,spin:0,mass:1,size:.3,color:[.1,.3,1,.04]},{timeOffset:.2,size:.35,color:[.2,.5,.9,.18]},{timeOffset:.2,size:.45,color:[.6,.6,.5,.06]},{timeOffset:.3,size:.47,color:[1,.4,0,.02]},{timeOffset:.2,size:.75,color:[1,.3,0,0]}]},black_puff:{name:"black_puff",blendState:t.smoke,targetSpace:"null",textures:{PARTICLE_TX:e.PRELOAD_GOO_TEXTURES.smoke_particle},emitters:[{totalParticlesToSpawn:-1,releaseRatePerSecond:50,minLifetime:4.8,maxLifetime:12.8}],timeline:[{timeOffset:0,spin:0,mass:1,size:4.1,color:[1,1,1,0]},{timeOffset:.02,size:8,color:[.3,.3,.3,.27]},{timeOffset:.3,size:34.2,color:[0,0,0,.12]},{timeOffset:.7,size:50.5,color:[.2,.2,.2,0]}]},cloud_puff:{name:"cloud_puff",blendState:t.smoke,targetSpace:"null",textures:{PARTICLE_TX:e.PRELOAD_GOO_TEXTURES.smoke_particle},emitters:[{totalParticlesToSpawn:-1,releaseRatePerSecond:10,minLifetime:7,maxLifetime:15}],timeline:[{timeOffset:0,spin:0,mass:1,size:1245,color:[.98,.98,.98,0]},{timeOffset:.15,size:1355,color:[.98,.98,.98,.21]},{timeOffset:.5,size:1475,color:[.96,.96,.96,.28]},{timeOffset:.34,size:1594,color:[.95,.95,.95,0]}]},acrobatic_puff:{name:"acrobatic_puff",blendState:t.smoke,targetSpace:"null",textures:{PARTICLE_TX:e.PRELOAD_GOO_TEXTURES.smoke_particle},emitters:[{totalParticlesToSpawn:-1,releaseRatePerSecond:120,minLifetime:15,maxLifetime:22}],timeline:[{timeOffset:0,spin:0,mass:1,size:.65,color:[1,1,1,.02]},{timeOffset:.02,size:2.5,color:[.94,.94,.94,.18]},{timeOffset:.1,size:9,color:[.9,.9,.9,.05]},{timeOffset:.6,size:34,color:[.85,.85,.85,.02]},{timeOffset:.2,size:124,color:[.85,.85,.85,0]}]},small_puff:{name:"small_puff",blendState:t.smoke,targetSpace:"null",textures:{PARTICLE_TX:e.PRELOAD_GOO_TEXTURES.smoke_particle},emitters:[{totalParticlesToSpawn:-1,releaseRatePerSecond:120,minLifetime:.4,maxLifetime:1.5}],timeline:[{timeOffset:0,spin:0,mass:1,size:.25,color:[1,1,1,.11]},{timeOffset:.15,size:1.2,color:[.99,.99,.99,.14]},{timeOffset:.3,size:2.5,color:[.97,.97,.97,.07]},{timeOffset:.5,size:7,color:[.95,.95,.95,0]}]},rapid_puff:{name:"rapid_puff",blendState:t.smoke,targetSpace:"null",textures:{PARTICLE_TX:e.PRELOAD_GOO_TEXTURES.smoke_particle},emitters:[{totalParticlesToSpawn:-1,releaseRatePerSecond:1420,minLifetime:.04,maxLifetime:.13}],timeline:[{timeOffset:0,spin:0,mass:1,size:.85,color:[1,1,1,.51]},{timeOffset:.3,size:2.2,color:[1,1,1,.27]},{timeOffset:.5,size:5,color:[1,1,1,0]}]},white_puff:{name:"white_puff",blendState:t.smoke,targetSpace:"null",textures:{PARTICLE_TX:e.PRELOAD_GOO_TEXTURES.smoke_particle},emitters:[{totalParticlesToSpawn:-1,releaseRatePerSecond:150,minLifetime:1.8,maxLifetime:3.8}],timeline:[{timeOffset:0,spin:0,mass:1,size:5.66,color:[.3,.3,.3,0]},{timeOffset:.3,size:8,color:[.7,.7,.7,.13]},{timeOffset:.9,size:64.2,color:[.95,.95,.95,0]}]},water_splash:{name:"water_splash",blendState:t.smoke,targetSpace:"null",textures:{PARTICLE_TX:e.PRELOAD_GOO_TEXTURES.splash_particle},emitters:[{totalParticlesToSpawn:-1,releaseRatePerSecond:150,minLifetime:.8,maxLifetime:2.1}],timeline:[{timeOffset:.01,spin:.1,mass:1,size:.06,color:[.95,.95,1,.6]},{timeOffset:.3,spin:-0.1,size:7.22,color:[.85,.9,1,.48]},{timeOffset:.6,spin:0,size:16.2,color:[1,1,1,0]}]},spark_flash:{name:"spark_flash",blendState:t.fire,targetSpace:"null",textures:{PARTICLE_TX:e.PRELOAD_GOO_TEXTURES.spark_particle},emitters:[{totalParticlesToSpawn:-1,releaseRatePerSecond:55,minLifetime:.21,maxLifetime:.46}],timeline:[{timeOffset:.01,spin:53.1,mass:1,size:.06,color:[.55,.65,1,.9]},{timeOffset:.6,spin:0,size:12.22,color:[.85,.8,.9,.28]},{timeOffset:.4,spin:0,size:18.2,color:[1,1,1,0]}]},shockwave_hit:{name:"shockwave_hit",blendState:t.fire,targetSpace:"null",textures:{PARTICLE_TX:e.PRELOAD_GOO_TEXTURES.shockwave_particle},emitters:[{totalParticlesToSpawn:-1,releaseRatePerSecond:55,minLifetime:.26,maxLifetime:.46}],timeline:[{timeOffset:.01,spin:.1,mass:1,size:8,color:[.95,.95,1,.4]},{timeOffset:.15,spin:-0.1,size:.22,color:[.95,.9,.5,.6]},{timeOffset:.85,spin:0,size:28.2,color:[1,.8,.4,0]}]},muzzle_flash:{name:"muzzle_flash",blendState:t.fire,targetSpace:"null",textures:{PARTICLE_TX:e.PRELOAD_GOO_TEXTURES.dot_particle},emitters:[{totalParticlesToSpawn:-1,releaseRatePerSecond:150,minLifetime:.28,maxLifetime:.66}],timeline:[{timeOffset:.01,spin:.1,mass:1,size:2,color:[.95,.5,.4,.6]},{timeOffset:.3,spin:-0.1,size:12.22,color:[.85,.5,.1,.48]},{timeOffset:.6,spin:0,size:8,color:[1,.3,0,0]}]},muzzle_flame:{name:"muzzle_flame",blendState:t.fire,targetSpace:"parent",textures:{PARTICLE_TX:e.PRELOAD_GOO_TEXTURES.dot_particle},emitters:[{totalParticlesToSpawn:-1,releaseRatePerSecond:200,minLifetime:.04,maxLifetime:.08}],timeline:[{timeOffset:0,spin:0,mass:1,size:.06,color:[.7,.6,.9,.44]},{timeOffset:.4,size:.62,color:[1,.9,.6,.18]},{timeOffset:.6,size:.2,color:[.6,.3,.01,0]}]},muzzle_smoke:{name:"muzzle_smoke",blendState:t.smoke,targetSpace:"parent",textures:{PARTICLE_TX:e.PRELOAD_GOO_TEXTURES.smoke_particle},emitters:[{totalParticlesToSpawn:-1,releaseRatePerSecond:50,minLifetime:.19,maxLifetime:.55}],timeline:[{timeOffset:0,spin:0,mass:1,size:.36,color:[.3,.3,.3,.3]},{timeOffset:.4,size:.92,color:[.5,.5,.5,.18]},{timeOffset:.6,size:2.2,color:[0,0,0,0]}]},water_ringlet:{name:"water_ringlet",blendState:t.smoke,targetSpace:"null",billboard:{bbx:[1,0,0],bby:[0,0,1]},textures:{PARTICLE_TX:e.PRELOAD_GOO_TEXTURES.fieldring_particle},emitters:[{totalParticlesToSpawn:-1,releaseRatePerSecond:20,minLifetime:52,maxLifetime:88}],timeline:[{timeOffset:0,spin:.1,mass:1,size:12,color:[.85,.95,1,0]},{timeOffset:.03,spin:.1,mass:1,size:18,color:[.85,.85,.9,.1]},{timeOffset:.3,spin:-0.1,size:80,color:[.75,.9,1,.03]},{timeOffset:.6,spin:0,size:250,color:[.4,.7,1,0]}]},water_foam:{name:"water_foam",blendState:t.smoke,targetSpace:"null",billboard:{bbx:[1,0,0],bby:[0,0,1]},textures:{PARTICLE_TX:e.PRELOAD_GOO_TEXTURES.foam_particle},emitters:[{totalParticlesToSpawn:-1,releaseRatePerSecond:20,minLifetime:22,maxLifetime:88}],timeline:[{timeOffset:0,spin:.1,mass:1,size:15,color:[.85,.95,1,0]},{timeOffset:.2,spin:.1,mass:1,size:15,color:[1,1,1,.5]},{timeOffset:.3,spin:-0.1,size:25,color:[1,1,1,.23]},{timeOffset:.6,spin:0,size:57,color:[1,1,1,0]}]}}}}),define("game/weapons/WeaponData",["game/ModelDefinitions"],function(e){return{BOMB_200:{modelPath:e.GOO_PROJECTS.armaments.bomb_200kg,damageEffects:[{kinetic:{points:5}},{fire:{intensity:.2,size:9}}],onHitSounds:["BULLET_HIT_0","BULLET_HIT_1","BULLET_HIT_2","BULLET_HIT_3"],onHitEffects:{FLASH_SPARKS:{count:1},FLASH_SHOCKWAVE:{count:1},PUFF_BLACK_SMOKE:{count:2},PUFF_WHITE_SMOKE:{count:1}}},BULLET_20:{modelPath:e.GOO_PROJECTS.bullet_20.piecePath,damageEffects:[{kinetic:{points:5}},{fire:{intensity:.2,size:9}}],onHitSounds:["BULLET_HIT_0","BULLET_HIT_1","BULLET_HIT_2","BULLET_HIT_3"],onHitEffects:{FLASH_SPARKS:{count:1},FLASH_SHOCKWAVE:{count:1},PUFF_BLACK_SMOKE:{count:1},PUFF_WHITE_SMOKE:{count:1}}},BULLET_AAA:{modelPath:e.GOO_PROJECTS.bullet_20.piecePath,damageEffects:[{kinetic:{points:20}},{fire:{intensity:.5,size:16}}],onHitSounds:["AAA_HIT_0","AAA_HIT_1","AAA_HIT_2"],onHitEffects:{PUFF_BLACK_SMOKE:{count:5},PUFF_WHITE_SMOKE:{count:2},FLASH_SPARKS:{count:5},FLASH_SHOCKWAVE:{count:1}}},BULLET_MAIN:{modelPath:e.GOO_PROJECTS.bullet_20.piecePath,damageEffects:[{kinetic:{points:100}},{fire:{intensity:.7,size:20}}],onHitSounds:["MAIN_HIT_0","MAIN_HIT_1","MAIN_HIT_2"],onHitEffects:{PUFF_WHITE_SMOKE:{count:12},PUFF_BLACK_SMOKE:{count:12},FLASH_SHOCKWAVE:{count:3},FLASH_SPARKS:{count:4},FLASH_MUZZLE_FIRE:{count:8}}},MAIN_GUNS:{main_gun_16:{name:"Main Gun 16",caliber:250,barrelLength:25,exitVelocity:230,rateOfFire:.07,onFireSounds:["MAIN_GUN_0","MAIN_GUN_1","MAIN_GUN_2"],onFireEffects:{PUFF_WHITE_SMOKE:{count:5},PUFF_BLACK_SMOKE:{count:8},FLASH_MUZZLE_FIRE:{count:14}},lifetime:92e3}},AAA:{midship_80:{name:"Midship Gun 8",caliber:80,barrelLength:10,exitVelocity:380,rateOfFire:2.3,onFireSounds:["AAA_0","AAA_1","AAA_2"],onFireEffects:{PUFF_WHITE_SMOKE:{count:1},FLASH_MUZZLE_FIRE:{count:4}},lifetime:7e3}},CANNONS:{hispano_20:{name:"Hispano 20",caliber:20,exitVelocity:720,rateOfFire:4,onFireSounds:["CANNON_20_0","CANNON_20_1","CANNON_20_2","CANNON_20_3"],flameEffect:e.GOO_PARTICLES.muzzle_flame,smokeEffect:e.GOO_PARTICLES.muzzle_smoke,lifetime:7e3},vulcan_20:{name:"Vulcan 20",caliber:20,exitVelocity:1120,rateOfFire:20,onFireSounds:["CANNON_20_0","CANNON_20_1","CANNON_20_2","CANNON_20_3"],flameEffect:e.GOO_PARTICLES.muzzle_flame,smokeEffect:e.GOO_PARTICLES.muzzle_smoke,lifetime:7e3}}}}),define("game/GameUtil",[],function(){var e,t,n=function(e,t,n){var r=[n[0]-e[0],n[1]-e[1],n[2]-e[2]];return Math.atan2(r[0],r[2])-t[1]},r=function(e,t){return e.transformComponent?e.transformComponent.transform.rotation.applyPost(t):e.spatial?e.spatial.rot.applyPost(t):(console.log("NO ROTATION MATRIX"),t)},i=function(e,t,n){return t[n][1]+(e-t[n][0])/(t[n+1][0]-t[n][0])*(t[n+1][1]-t[n][1])},s=function(e,t){for(var n=0;n<t.length;n++)if(t[n+1][0]>e)return i(e,t,n);return 0};return{determineYAngleFromPosAndRotToPos:n,applyRotationToVelocity:r,fitValueInCurve:s}}),define("game/ships/CarrierCable",["application/EventManager","game/GameUtil","goo/math/Vector3"],function(e,t,n){var r=new n,i=function(e,t){this.boat=e,this.cableNr=t,this.entity=e.entity};return i.prototype.catchPlane=function(e){console.log("CATCH PLANE: ",this.cableNr,e),e.spatial.velocity.data[1]*=.4,e.spatial.velocity.mul(.9),e.cable=this},i.prototype.updateHookedPlane=function(t){t.spatial.velocity.mul(.998),t.spatial.velocity.data[1]*=.95,Math.abs(t.spatial.velocity.lengthSquared()-this.entity.spatial.velocity.lengthSquared())<.01&&(e.fireEvent(e.list().ANALYTICS_EVENT,{category:"GAME_EVENT",action:"CARRIER_LANDING",labels:t.id+" on: "+this.entity.id+" cableNr:"+this.cableNr,value:1}),console.log("HOOKED PLANE MATCH",t),this.boat.attachPassenger(t,this.entity.pieceData.parkingLots.service),t.cable=null)},i}),define("game/ships/BoatData",["game/GameConfiguration","game/ModelDefinitions","game/weapons/WeaponData","game/ships/CarrierCable"],function(e,t,n,r){return{CARRIER:{gooProject:e.GOO_PROJECTS.carrier,piecePath:e.GOO_PROJECTS.carrier.carrier,hitPoints:235e3,dimensions:{pilotSeatPos:[23,41.5,44],length:310,wingspan:280},parkingLots:{launch:{posOffset:[18.2,20.5,-48],rot:[0,-3.101,0]},service:{posOffset:[31,19,90],rot:[0,-2,0]}},uiPages:["UI_CARRIER"],keyBindings:e.KEY_BINDINGS.plane,physicalShapes:[{partId:"cable",posOffset:[4,13,125],radius:14,cableNr:1},{partId:"cable",posOffset:[0,13,100],radius:14,cableNr:2},{partId:"cable",posOffset:[-2,13,75],radius:14,cableNr:3},{partId:"cable",posOffset:[-6,13,50],radius:14,cableNr:4},{partId:"hull",posOffset:[0,2,0],radius:14},{partId:"hull",posOffset:[0,2,-62],radius:14},{partId:"hull",posOffset:[0,2,-125],radius:14},{partId:"hull",posOffset:[0,2,-158],radius:14},{partId:"hull",posOffset:[0,2,51],radius:14},{partId:"hull",posOffset:[0,2,118],radius:14},{partId:"hull",posOffset:[0,2,172],radius:14},{partId:"bridge",posOffset:[0,45,-14],radius:14},{partId:"bridge",posOffset:[0,45,29],radius:14}],physicalRadius:220,chimneys:[],wakes:[{posOffset:[0,0,-155],spread:.001},{posOffset:[0,0,170],spread:.5},{posOffset:[-21,0,150],spread:.2},{posOffset:[3,-1,-145.7],spread:.07},{posOffset:[-3,-1,-145.7],spread:.07},{posOffset:[-7,0,-135.7],spread:.18},{posOffset:[7,0,-135.7],spread:.18},{posOffset:[21,0,150],spread:.2}],radars:[],flags:[],turrets:[],instruments:{},measurements:{},systems:{}},BATTLESHIP:{gooProject:e.GOO_PROJECTS.battleship,piecePath:e.GOO_PROJECTS.battleship.battleship,hitPoints:225e3,physicalShapes:[{partId:"hull",posOffset:[0,0,0],radius:30},{partId:"hull",posOffset:[0,0,-62],radius:26},{partId:"hull",posOffset:[0,0,-125],radius:16},{partId:"hull",posOffset:[0,5,-158],radius:10},{partId:"hull",posOffset:[0,0,51],radius:20},{partId:"hull",posOffset:[0,0,118],radius:20},{partId:"hull",posOffset:[0,3,172],radius:30},{partId:"bridge",posOffset:[0,45,-14],radius:14},{partId:"bridge",posOffset:[0,45,29],radius:11}],physicalRadius:180,chimneys:[{posOffset:[0,60,2]},{posOffset:[15,45,12]},{posOffset:[-15,45,12]}],wakes:[{posOffset:[0,0,-180],spread:.001},{posOffset:[0,0,-138.8],spread:.21},{posOffset:[7,-1,-171.7],spread:.07},{posOffset:[-7,-1,-171.7],spread:.07},{posOffset:[-12,0,-115.7],spread:.18},{posOffset:[12,0,-115.7],spread:.18}],radars:[],flags:[],turrets:[{targets:["boat"],bonePivot:"gun_main_1",boneElevate:"main_elev_1",bulletData:n.BULLET_MAIN,cannonData:n.MAIN_GUNS.main_gun_16,baseRot:Math.PI,speed:.2,swivel:2.4,posOffset:[.01,25.6,-96.34]},{targets:["boat"],bonePivot:"gun_main_2",boneElevate:"main_elev_2",bulletData:n.BULLET_MAIN,cannonData:n.MAIN_GUNS.main_gun_16,baseRot:Math.PI,speed:.2,swivel:2.4,posOffset:[.01,35.6,-65.74]},{targets:["boat"],bonePivot:"gun_main_3",boneElevate:"main_elev_3",bulletData:n.BULLET_MAIN,cannonData:n.MAIN_GUNS.main_gun_16,baseRot:0,speed:.2,swivel:2.4,posOffset:[.01,25.6,73.54]},{targets:["boat"],bonePivot:"gun_main_4",boneElevate:"main_elev_4",bulletData:n.BULLET_MAIN,cannonData:n.MAIN_GUNS.main_gun_16,baseRot:0,speed:.2,swivel:2.4,posOffset:[.01,18.6,109.54]},{targets:["plane"],bonePivot:"gun_port_1",boneElevate:"port_elev_1",bulletData:n.BULLET_AAA,cannonData:n.AAA.midship_80,baseRot:-0.5*Math.PI,speed:.6,swivel:1.6,posOffset:[-26.94,23.9,-52.04]},{targets:["plane"],bonePivot:"gun_port_2",boneElevate:"port_elev_2",bulletData:n.BULLET_AAA,cannonData:n.AAA.midship_80,baseRot:-0.5*Math.PI,speed:.6,swivel:1.6,posOffset:[-29.64,23.9,-7.34]},{targets:["plane"],bonePivot:"gun_port_3",boneElevate:"port_elev_3",bulletData:n.BULLET_AAA,cannonData:n.AAA.midship_80,baseRot:-0.5*Math.PI,speed:.6,swivel:1.6,posOffset:[-29.64,17.3,34.84]},{targets:["plane"],bonePivot:"gun_port_4",boneElevate:"port_elev_4",bulletData:n.BULLET_AAA,cannonData:n.AAA.midship_80,baseRot:-0.5*Math.PI,speed:.6,swivel:1.6,posOffset:[-27.04,17.2,74.04]},{targets:["plane"],bonePivot:"gun_sb_1",boneElevate:"sb_elev_1",bulletData:n.BULLET_AAA,cannonData:n.AAA.midship_80,baseRot:.5*Math.PI,speed:.6,swivel:1.6,posOffset:[26.94,23.9,-52.04]},{targets:["plane"],bonePivot:"gun_sb_2",boneElevate:"sb_elev_2",bulletData:n.BULLET_AAA,cannonData:n.AAA.midship_80,baseRot:.5*Math.PI,speed:.6,swivel:1.6,posOffset:[29.64,23.9,-7.34]},{targets:["plane"],bonePivot:"gun_sb_3",boneElevate:"sb_elev_3",bulletData:n.BULLET_AAA,cannonData:n.AAA.midship_80,baseRot:.5*Math.PI,speed:.6,swivel:1.6,posOffset:[29.64,17.3,34.84]},{targets:["plane"],bonePivot:"gun_sb_4",boneElevate:"sb_elev_4",bulletData:n.BULLET_AAA,cannonData:n.AAA.midship_80,baseRot:.5*Math.PI,speed:.6,swivel:1.6,posOffset:[27.04,17.2,74.04]}]},TRE_KRONOR:{gooProject:e.GOO_PROJECTS.tre_kronor,piecePath:e.GOO_PROJECTS.tre_kronor.tre_kronor,hitPoints:82e3,physicalShapes:[{partId:"hull",posOffset:[0,5,-88],radius:6},{partId:"hull",posOffset:[0,1.5,-74],radius:8},{partId:"hull",posOffset:[0,1,-60],radius:8},{partId:"hull",posOffset:[0,.5,-42],radius:8},{partId:"hull",posOffset:[0,.5,-29],radius:8},{partId:"hull",posOffset:[0,.5,-15],radius:8},{partId:"hull",posOffset:[0,.5,0],radius:8},{partId:"hull",posOffset:[0,.5,15],radius:8},{partId:"hull",posOffset:[0,.5,29],radius:8},{partId:"hull",posOffset:[0,-0.5,42],radius:8},{partId:"hull",posOffset:[0,-0.5,56],radius:8},{partId:"hull",posOffset:[0,-0.5,71],radius:8},{partId:"hull",posOffset:[0,-0.5,86],radius:6},{partId:"bridge",posOffset:[0,13,-31],radius:7},{partId:"bridge",posOffset:[0,9,-8],radius:11}],physicalRadius:200,wakes:[{posOffset:[0,-1,-86.7],spread:.001},{posOffset:[2,-5,-81.7],spread:.03},{posOffset:[-2,-5,-81.7],spread:.03},{posOffset:[0,-3,-91.8],spread:.001}],chimneys:[{posOffset:[0,16,-15]},{posOffset:[0,15,3]}],radars:[{bonePivot:"radar",rotVel:.06},{bonePivot:"parabolic_antenna",rotVel:-0.02}],flags:[{baseBone:"flag_base",flapBone:"flag_flap",flapFreq:1.3}],turrets:[{targets:["boat"],bonePivot:"main_gun_fore",boneElevate:"main_fore_elev",bulletData:n.BULLET_MAIN,cannonData:n.MAIN_GUNS.main_gun_16,baseRot:Math.PI,speed:.2,swivel:2.4,posOffset:[0,8.3,-46.74]},{targets:["boat"],bonePivot:"main_gun_aft_1",boneElevate:"main_aft_elev_1",bulletData:n.BULLET_MAIN,cannonData:n.MAIN_GUNS.main_gun_16,baseRot:0,speed:.2,swivel:2.4,posOffset:[0,9.1,45.54]},{targets:["boat"],bonePivot:"main_gun_aft_2",boneElevate:"main_aft_elev_2",bulletData:n.BULLET_MAIN,cannonData:n.MAIN_GUNS.main_gun_16,baseRot:0,speed:.2,swivel:2.4,posOffset:[0,12,22.1]},{targets:["plane"],bonePivot:"port_gun_1",boneElevate:"port_elev_1",bulletData:n.BULLET_AAA,cannonData:n.AAA.midship_80,baseRot:-0.5*Math.PI,speed:.6,swivel:1.6,posOffset:[-5.5,7.2,-26.6]},{targets:["plane"],bonePivot:"port_gun_2",boneElevate:"port_elev_2",bulletData:n.BULLET_AAA,cannonData:n.AAA.midship_80,baseRot:-0.5*Math.PI,speed:.6,swivel:1.6,posOffset:[-5.5,7.2,-8.4]},{targets:["plane"],bonePivot:"port_gun_3",boneElevate:"port_elev_3",bulletData:n.BULLET_AAA,cannonData:n.AAA.midship_80,baseRot:-0.5*Math.PI,speed:.6,swivel:1.6,posOffset:[-5.5,17.3,10.14]},{targets:["plane"],bonePivot:"sb_gun_1",boneElevate:"sb_elev_1",bulletData:n.BULLET_AAA,cannonData:n.AAA.midship_80,baseRot:.5*Math.PI,speed:.6,swivel:1.6,posOffset:[5.5,7.2,-26.6]},{targets:["plane"],bonePivot:"sb_gun_2",boneElevate:"sb_elev_2",bulletData:n.BULLET_AAA,cannonData:n.AAA.midship_80,baseRot:.5*Math.PI,speed:.6,swivel:1.6,posOffset:[5.5,7.2,-8.4]},{targets:["plane"],bonePivot:"sb_gun_3",boneElevate:"sb_elev_3",bulletData:n.BULLET_AAA,cannonData:n.AAA.midship_80,baseRot:.5*Math.PI,speed:.6,swivel:1.6,posOffset:[5.5,17.3,10.14]},{targets:["plane"],bonePivot:"fore_gun_mid",boneElevate:"gun_fore_mid",bulletData:n.BULLET_AAA,cannonData:n.AAA.midship_80,baseRot:Math.PI,speed:.6,swivel:2.7,posOffset:[0,6.2,71.5]},{targets:["plane"],bonePivot:"aft_gun_mid",boneElevate:"aft_mid_elev",bulletData:n.BULLET_AAA,cannonData:n.AAA.midship_80,baseRot:0,speed:.6,swivel:2.7,posOffset:[0,9.02,-70.4]}]}}}),define("game/cars/CarData",["game/GameConfiguration","game/ModelDefinitions","game/weapons/WeaponData"],function(e,t,n){return{PV_9031:{modelPath:"pv_9031",dimensions:{massEmpty:845,massMax:2375,weightDistribution:[1.2,.6,1.2],length:4,pilotSeatPos:[0,.9,1.72],wingspan:2.23,height:1.75},keyBindings:e.KEY_BINDINGS.car,uiPages:["UI_PV_9031","UI_BOTTOM_BAR"],wings:{body:{pos:[0,1,0],size:[2.6,1.19,4.8],rot:[0,0,0],stallAngle:[.5,1,1],stallLiftCoeff:[4.5,0,0],formDragCoeff:10.21}},gooProjectUrl:e.GOO_PROJECTS.car_pv_9031.projectPath,piecePath:e.GOO_PROJECTS.car_pv_9031.pv_9031,uiPage:"UI_CAR",instruments:{},measurements:{},surfaces:{rudder:{inputBehavior:{release:1,speed:.1},controls:{rudder:{right_f_susp:.2,left_f_susp:-0.2,steer:4.7}},speed:.02}},systems:{drive:{inputBehavior:{type:"toggle",speed:1},controls:{doors:{},stands:{}},wheels:{right_f_wheel:{control:"rudder",radius:.3,pos:[-0.9,-0.84,2.1],breakMax:1251,drag:5,suspension:{boneId:"right_f_susp",range:.25,axis:[0,0,1],stiffness:7850}},left_f_wheel:{control:"rudder",radius:.3,pos:[.9,-0.84,2.1],breakMax:1251,drag:5,suspension:{boneId:"left_f_susp",range:.25,axis:[0,0,1],stiffness:7850}},wheel_right:{control:null,radius:.3,pos:[-0.9,-0.84,-2.1],breakMax:1251,drag:5,suspension:{boneId:"right_suspend",range:.25,axis:[0,0,1],stiffness:7850}},wheel_left:{control:null,radius:.3,pos:[.9,-0.84,-2.1],breakMax:1251,drag:5,suspension:{boneId:"left_suspend",range:.25,axis:[0,0,1],stiffness:7850}}},speed:.01},breaks:{inputBehavior:{type:"slide",speed:.1},controls:{breaks:{}},speed:.01},engines:{inputBehavior:{type:"slide",speed:.1},controls:{throttle:{}},mounts:[{maxThrust:27e3,jet_flame:t.GOO_PARTICLES.basic_jet,posOffset:[0,1,-1]}],speed:.005}}}}}),define("game/piece/TargetData",["game/GameConfiguration"],function(e){return{TV_CRT:{dimensions:{massEmpty:2,massMax:3,mobRadius:1.05},screens:{meshData:[{meshEntityName:"tv_crt/entities/screen.entity"}],displays:{tv_crt:{mapcoords:[125,94,250,180],instruments:{tv_crt_video:{script:"VideoPlayer",meshIndex:0,txcoords:[125,94,250,180],sources:{video:[0,0,240,180]},channel:e.VIDEOS.channels.hud}}}}},hitPoints:5,physicalShapes:[{partId:"bullseye",posOffset:[0,.5,0],radius:2}],physicalRadius:2,gooProject:e.GOO_PROJECTS.tv_screen,piecePath:e.GOO_PROJECTS.tv_screen.tv},MONITOR_CONSOLE:{dimensions:{massEmpty:2,massMax:3,mobRadius:1.05},screens:{meshData:[{meshEntityName:"monitor_console/entities/console_screens.entity"}],displays:{console_main:{mapcoords:[127,94,254,190],instruments:{console_main_video:{script:"VideoPlayer",meshIndex:0,txcoords:[127,94,254,190],sources:{video:[0,0,240,180]},channel:e.VIDEOS.channels.animals}}},console_right:{mapcoords:[383,95,254,190],instruments:{console_right_video:{script:"VideoPlayer",meshIndex:0,txcoords:[383,95,254,190],sources:{video:[0,0,240,180]},channel:e.VIDEOS.channels.promos}}},console_left:{mapcoords:[85,248,170,105],instruments:{console_left_video:{script:"VideoPlayer",meshIndex:0,txcoords:[85,248,170,105],sources:{video:[0,0,240,180]},channel:e.VIDEOS.channels.cats}}},console_top_1:{mapcoords:[256,248,170,105],instruments:{console_top_1_video:{script:"VideoPlayer",meshIndex:0,txcoords:[256,248,170,105],sources:{video:[0,0,240,180]},channel:e.VIDEOS.channels.history}}},console_top_2:{mapcoords:[427,248,170,105],instruments:{console_top_2_video:{script:"VideoPlayer",meshIndex:0,txcoords:[427,248,170,105],sources:{video:[0,0,240,180]},channel:e.VIDEOS.channels.military}}},console_left_3:{mapcoords:[85,358,170,105],instruments:{console_top_3_video:{script:"VideoPlayer",meshIndex:0,txcoords:[85,358,170,105],sources:{video:[0,0,240,180]},channel:e.VIDEOS.channels.planes}}},console_top_4:{mapcoords:[254,358,170,105],instruments:{console_top_4_video:{script:"VideoPlayer",meshIndex:0,txcoords:[254,355,170,105],sources:{video:[0,0,240,180]},channel:e.VIDEOS.channels.vdi}}},console_top_5:{mapcoords:[425,358,170,105],instruments:{console_top_5_video:{script:"VideoPlayer",meshIndex:0,txcoords:[425,358,170,105],sources:{video:[0,0,240,180]},channel:e.VIDEOS.channels.hud}}}}},hitPoints:5,physicalShapes:[{partId:"bullseye",posOffset:[0,.5,0],radius:2}],physicalRadius:8,gooProject:e.GOO_PROJECTS.monitor_console,piecePath:e.GOO_PROJECTS.monitor_console.monitor_console},GROUND_FLAT:{dimensions:{massEmpty:845,massMax:2375,mobRadius:1},hitPoints:5,physicalShapes:[{partId:"bullseye",posOffset:[0,3,0],radius:6},{partId:"edge",posOffset:[10,2,10],radius:8},{partId:"edge",posOffset:[-10,2,10],radius:8},{partId:"edge",posOffset:[10,2,-10],radius:8},{partId:"edge",posOffset:[-10,2,-10],radius:8},{partId:"edge",posOffset:[0,2,10],radius:8},{partId:"edge",posOffset:[-10,2,0],radius:8},{partId:"edge",posOffset:[10,2,0],radius:8},{partId:"edge",posOffset:[0,2,-10],radius:8}],physicalRadius:130,gooProject:e.GOO_PROJECTS.targets,piecePath:e.GOO_PROJECTS.targets.ground_flat},HOUSE_BOX_30:{dimensions:{massEmpty:845,massMax:2375,mobRadius:1},hitPoints:3e3,physicalShapes:[{partId:"bullseye",posOffset:[0,15,0],radius:14},{partId:"edge",posOffset:[16,7,16],radius:18},{partId:"edge",posOffset:[-16,7,16],radius:18},{partId:"edge",posOffset:[16,7,-16],radius:18},{partId:"edge",posOffset:[-16,7,-16],radius:18},{partId:"edge",posOffset:[0,7,16],radius:18},{partId:"edge",posOffset:[-16,7,0],radius:18},{partId:"edge",posOffset:[16,7,0],radius:18},{partId:"edge",posOffset:[0,7,-16],radius:18},{partId:"edge",posOffset:[16,16,16],radius:18},{partId:"edge",posOffset:[-16,16,16],radius:18},{partId:"edge",posOffset:[16,16,-16],radius:18},{partId:"edge",posOffset:[-16,16,-16],radius:18},{partId:"edge",posOffset:[0,16,16],radius:18},{partId:"edge",posOffset:[-16,16,0],radius:18},{partId:"edge",posOffset:[16,16,0],radius:18},{partId:"edge",posOffset:[0,16,-16],radius:18}],physicalRadius:180,gooProject:e.GOO_PROJECTS.targets,piecePath:e.GOO_PROJECTS.targets.house_box_3}}}),define("game/planes/tunnan/TunnanSystems",["game/ModelDefinitions","game/weapons/WeaponData"],function(e,t){return{SYSTEMS:{auto_trim:{inputBehavior:{type:"toggle",speed:1},speed:1},gears:{inputBehavior:{type:"toggle",speed:1},controls:{doors:{door_nose_r:[-1.4,0,0],door_nose_l:[1.4,0,0],door_left:[.8,0,0],door_right:[-0.8,0,0]},stands:{nose_gear:[-1.5,0,0],gear_right:[1.8,0,0],gear_left:[-1.8,0,0],right_suspend:[-0.6,0,0],left_suspend:[.6,0,0]}},wheels:{wheel_nose:{control:"rudder",radius:.3,pos:[0,-1.5,3.4],axis:[1,0,0],breakMax:155.02,drag:5,suspension:{boneId:"nose_suspend",range:.31,axis:[0,0,-1],stiffness:22550}},wheel_right:{control:null,radius:-0.5,pos:[-0.9,-1.43,-0.17],breakMax:2225,drag:5,suspension:{boneId:"right_suspend",range:.31,axis:[0,1,0],stiffness:75e3}},wheel_left:{control:null,radius:.5,pos:[.9,-1.43,-0.17],breakMax:2225,drag:5,suspension:{boneId:"left_suspend",range:.31,axis:[0,-1,0],stiffness:75e3}},wheel_rear:{control:null,radius:.3,pos:[0,-1.1,-4.4],breakMax:1555.02,drag:5,suspension:{boneId:null,range:.31,axis:[0,0,-1],stiffness:14550}}},speed:.01},breaks:{inputBehavior:{type:"slide",speed:.1},controls:{},speed:.01},canopy:{inputBehavior:{type:"toggle",speed:1},controls:{xform:"slide",doors:{canopy:[-0.7,0,-0.09]}},speed:.01},seat:{inputBehavior:{type:"button",speed:1},type:"ejection",controls:{seats:{seat:[-2.15,0,-0.5]}},speed:.4},engines:{inputBehavior:{type:"slide",speed:.02,inputAnim:{bone:"throttle",rot:[-1,0,0]}},controls:{throttle:{throttle:.8}},mounts:[{maxThrust:27e3,afterBurner:22e3,jet_flame:e.GOO_PARTICLES.basic_jet,jet_smoke:e.GOO_PARTICLES.jet_smoke,posOffset:[0,-0.3,-4]}],speed:8e-4},weapons:{inputBehavior:{type:"button",speed:1},controls:{cannons:{bones:[{trigger:.3}]}},cannons:[{data:t.CANNONS.hispano_20,bulletData:t.BULLET_20,posOffset:[.44,-0.54,3.6]},{data:t.CANNONS.hispano_20,bulletData:t.BULLET_20,posOffset:[.32,-0.75,3.35]},{data:t.CANNONS.hispano_20,bulletData:t.BULLET_20,posOffset:[-0.32,-0.75,3.35]},{data:t.CANNONS.hispano_20,bulletData:t.BULLET_20,posOffset:[-0.44,-0.54,3.6]}],speed:2}}}}),define("game/planes/tunnan/TunnanInstruments",[],function(){var e={climb:[[-1e3,-10],[-18,-9],[-5,-5],[5,5],[18,9],[1e3,10]]};return{INSTRUMENTS:{horizon:{boneName:"horizon",sample:"rotVec",axisAmp:[[2,.0025],[1,0],[2,-0.021]]},gyro_roll:{boneName:"gyro_horizon",sample:"rollAng",axisAmp:1},gyro_horizon:{boneName:"gyro_roll",sample:"rotVec",axisAmp:[[2,0],[1,0],[2,-0.032]]},engine_rpm:{boneName:"engine_rpm",sample:"rpm",axisAmp:-Math.PI*1.8},exhaust_temp:{boneName:"exhaust_temp",sample:"temp",axisAmp:-Math.PI*90.45},accelerometer:{boneName:"accelerometer",sample:"g",axisAmp:-5},turn_quality:{boneName:"turn_quality",sample:"acc",axisAmp:[[0,0],[0,7.25],[0,0]]},roll_indicator:{boneName:"roll_indicator",sample:"rollAng",axisAmp:-1},gyro_compass:{boneName:"gyro_compass",sample:"xyHeading",axisAmp:1},mag_compass:{boneName:"mag_compass",sample:"xyHeading",axisAmp:-1},gyro_steer:{boneName:"gyro_steer",sample:"xyHeading",axisAmp:1.4},climb_indicator:{boneName:"climb_indicator",sample:"climbRate",curve:e.climb,axisAmp:-0.315},speed_indicator:{boneName:"speed_indicator",sample:"speed",axisAmp:-3.14*.006},alt_outer:{boneName:"alt_outer",sample:"altitude",axisAmp:-0.00314},alt_inner:{boneName:"alt_inner",sample:"altitude",axisAmp:-3.14*1e-4}}}}),define("game/planes/tunnan/TunnanSurfaces",[],function(){return{SURFACES:{elevator:{inputBehavior:{release:1,speed:.1,inputAnim:{bone:"stick",rot:[.4,.5,0]}},controls:{elevator:{elevator:.6}},speed:.2},aeilrons:{inputBehavior:{release:1,speed:.1},controls:{aeilrons:{aeilron_right:-0.5,aeilron_left:-0.5}},speed:.2},rudder:{inputBehavior:{release:1,speed:.1},controls:{rudder:{rudder:.8,pedal_left:-0.7,pedal_right:-0.7}},speed:.2},flaps:{inputBehavior:{release:0,speed:.1},controls:{flaps:{flap_right:-1.1,flap_left:1.1}},speed:.005},breaks:{inputBehavior:{release:0,speed:.1},controls:{breaks:{airbreak_right:-0.65,airbreak_left:.65}},speed:.02}}}}),define("game/planes/tunnan/TunnanOnScreenInput",[],function(){return{ON_SCREEN_INPUT:{elevator:{rect:[43,55,57,82],axis:1,max:1,min:-1,factor:.7,label:"Pitch"},aeilrons:{rect:[43,55,57,82],axis:0,max:1,min:-1,factor:1,label:"Roll"},rudder:{rect:[43,82,57,86],axis:0,max:1,min:-1,factor:1,label:"Yaw"},trim_elevator:{rect:[57,55,61,80],axis:1,max:.5,min:-0.5,factor:.3,label:"Trim</br>Pitch"},trim_aeilrons:{rect:[45,50,55,54],axis:0,max:.5,min:-0.5,factor:.3,label:"Trim Roll"},trim_rudder:{rect:[44,87,56,91],axis:0,max:.5,min:-0.5,factor:.3,label:"Trim Yaw"},throttle:{rect:[36,65,42,85],axis:1,max:1,min:0,factor:1,label:"Throttle"},flaps:{rect:[30,70,35,85],axis:1,max:1,min:0,factor:1,label:"Flaps"},breaks:{rect:[24,70,29,85],axis:1,max:1,min:0,factor:1,label:"Brake"},gears:{rect:[2,55,7,62],axis:1,max:0,min:-1,factor:80,label:"Gear"},canopy:{rect:[2,65,7,72],axis:1,max:1,min:0,factor:80,label:"Canopy"}}}}),define("game/world/Curves",[],function(){var e={wing:[[-30,0],[-3.15,0],[-2.65,.7],[-2.3,.9],[-2.1,.85],[-1.67,0],[-1.1,-0.75],[-1,-0.8],[-0.65,-0.5],[-0.5,-0.4],[-0.4,-0.5],[-0.3,-0.7],[-0.01,-0.004],[0,0],[.01,.004],[.3,.7],[.4,.5],[.45,.8],[.5,.5],[.65,.7],[1,.9],[1.1,.85],[1.67,0],[2.1,-0.75],[2.3,-0.8],[2.65,-0.5],[3.15,0],[30,0]],stab:[[-30,0],[-3.15,0],[-2.65,.7],[-2.3,.9],[-2.1,.85],[-1.67,0],[-1.1,-0.75],[-1,-0.8],[-0.6,-0.5],[-0.4,-0.5],[-0.3,-0.8],[-0.2,-0.3],[-0.01,-0.013],[0,0],[.01,.013],[.2,.3],[.3,.8],[.4,.5],[.6,.5],[1,.8],[1.1,.75],[1.67,0],[2.1,-0.75],[2.3,-0.8],[2.65,-0.5],[3.15,0],[30,0]],cone:[[-30,0],[-3.15,0],[-2.65,.7],[-2.3,.9],[-2.1,.85],[-1.67,0],[-1.1,-0.75],[-1,-0.8],[-0.6,-0.5],[-0.4,-0.5],[-0.3,-0.2],[-0.01,-0.033],[0,0],[.01,.033],[.3,.2],[.4,.5],[.6,.5],[1,.8],[1.1,.75],[1.67,0],[2.1,-0.75],[2.3,-0.8],[2.65,-0.5],[3.15,0],[30,0]],rudder:[[-30,0],[-3.14,0],[-3,.01],[-2.65,.1],[-2.3,.8],[-2.1,.85],[-1.67,0],[-1.1,-0.75],[-1,-1],[-0.6,-0.8],[-0.3,-0.1],[-0.01,-0.013],[0,0],[.01,.013],[.3,.1],[.6,.8],[1,1],[1.1,.75],[1.67,0],[2.1,-0.75],[2.3,-0.8],[2.65,-0.1],[3.1,0],[3.14,0],[30,0]]};return{WINGS:e}}),define("game/planes/tunnan/TunnanWings",["game/world/Curves"],function(e){var t=.09,n=8,r=15,i=20;return{WINGS:{fuselageFore:{pos:[0,-0.2,3],size:[1.3,1.3,2],rot:[.02,0,0],stallAngle:[.5,1,1],liftCurve:e.WINGS.cone,stallLiftCoeff:[4.5,0,0],formDragCoeff:.02},fuselageSkid:{pos:[0,-1.2,0],size:[.2,.1,3],rot:[0,0,0],stallAngle:[1.3,0,0],liftCurve:e.WINGS.stab,stallLiftCoeff:[0,r,0],formDragCoeff:t},vert_lift:{pos:[0,0,-0.2],size:[2,.2,4],rot:[0,0,-Math.PI/2],stallAngle:[1.3,0,0],liftCurve:e.WINGS.stab,stallLiftCoeff:[0,r,0],formDragCoeff:t},fuselageCore:{pos:[0,-0.3,0],size:[1.5,1.5,1.9],rot:[0,0,0],stallAngle:[.5,1,1],liftCurve:e.WINGS.cone,stallLiftCoeff:[3.5,0,0],formDragCoeff:.02},fuselageAft:{pos:[0,-0.1,-2.3],size:[1.5,1.5,1.9],rot:[.03,0,0],stallAngle:[.5,1,1],liftCurve:e.WINGS.cone,stallLiftCoeff:[2.5,0,0],formDragCoeff:.01},mainInnerRight:{pos:[1.3,.24,.41],size:[2.5,.2,2.2],rot:[.004,.55,0],stallAngle:[.5,.5,.2],liftCurve:e.WINGS.wing,stallLiftCoeff:[r,0,0],formDragCoeff:.01},mainInnerLeft:{pos:[-1.3,.24,.41],size:[2.5,.2,2.2],rot:[.004,-0.55,0],stallAngle:[.5,.5,.2],liftCurve:e.WINGS.wing,stallLiftCoeff:[r,0,0],formDragCoeff:.01},mainOuterRight:{pos:[5,.2,-0.6],size:[3.5,.15,1.7],rot:[.002,.49,0],stallAngle:[.65,.3,.2],liftCurve:e.WINGS.wing,stallLiftCoeff:[r,0,0],formDragCoeff:.01},mainOuterLeft:{pos:[-5,.2,-0.6],size:[3.5,.15,1.7],rot:[.002,-0.49,0],stallAngle:[.65,.3,.2],liftCurve:e.WINGS.wing,stallLiftCoeff:[r,0,0],formDragCoeff:.01},flapRight:{controls:{flaps:[-1.1,0,0]},pos:[1.6,.265,-0.05],size:[1.8,.2,1.2],rot:[0,.2,0],stallAngle:[1.5,.7,.2],liftCurve:e.WINGS.rudder,stallLiftCoeff:[i,0,0],formDragCoeff:.1},flapLeft:{controls:{flaps:[-1.1,0,0]},pos:[-1.6,.265,-0.05],size:[1.8,.2,1.2],rot:[0,-0.2,0],stallAngle:[1.5,.7,.2],liftCurve:e.WINGS.rudder,stallLiftCoeff:[i,0,0],formDragCoeff:.1},aeilronRight:{controls:{aeilrons:[.7,0,0]},pos:[4,.15,-1.8],size:[3,.2,.5],rot:[0,.2,0],stallAngle:[.8,.4,.2],liftCurve:e.WINGS.rudder,stallLiftCoeff:[8,0,0],formDragCoeff:.002},aeilronLeft:{controls:{aeilrons:[-0.7,0,0]},pos:[-4,.15,-1.8],size:[3,.2,.5],rot:[0,-0.2,0],stallAngle:[.8,.4,.2],liftCurve:e.WINGS.rudder,stallLiftCoeff:[8,0,0],formDragCoeff:.002},tailplaneR:{pos:[.9,1.1,-5.5],size:[2,.2,.7],rot:[-0.1,.55,0],stallAngle:[1.3,.5,.4],liftCurve:e.WINGS.stab,stallLiftCoeff:[r,0,0],formDragCoeff:.01},tailplaneL:{pos:[-0.9,1.1,-5.5],size:[2,.2,.7],rot:[-0.1,-0.55,0],stallAngle:[1.3,.5,.4],liftCurve:e.WINGS.stab,stallLiftCoeff:[r,0,0],formDragCoeff:.01},elevator:{controls:{elevator:[.7,0,0]},pos:[0,1.1,-6.3],size:[4,.2,.9],rot:[0,0,0],stallAngle:[1.5,.4,.3],liftCurve:e.WINGS.rudder,stallLiftCoeff:[r,0,0],formDragCoeff:.001},rudder:{controls:{rudder:[-0.8,0,0]},pos:[0,1.6,-6],size:[1.4,.2,.8],rot:[0,0,-Math.PI/2],stallAngle:[1.15,.5,1],liftCurve:e.WINGS.rudder,stallLiftCoeff:[0,r,0],formDragCoeff:.01},stabiliser:{pos:[0,1.1,-5],size:[2,.2,1.5],rot:[0,0,-Math.PI/2],stallAngle:[1.3,.4,1],liftCurve:e.WINGS.stab,stallLiftCoeff:[0,r,0],formDragCoeff:.01},break_up:{controls:{breaks:[1.5,0,0]},pos:[0,-0.5,-1.1],size:[2,.2,1],rot:[0,0,0],stallAngle:[1.9,1,1],liftCurve:e.WINGS.rudder,stallLiftCoeff:[r,0,0],formDragCoeff:.001},break_down:{controls:{breaks:[-1.5,0,0]},pos:[0,-0.5,-1.1],size:[2,.2,1],rot:[0,0,0],stallAngle:[1.9,1,1],liftCurve:e.WINGS.rudder,stallLiftCoeff:[r,0,0],formDragCoeff:.001}}}}),define("game/planes/tunnan/TunnanLights",[],function(){return{LIGHTS:{meshData:[],feedback:{},systems:{}}}}),define("game/planes/tunnan/TunnanScreens",["game/GameConfiguration"],function(e){return{SCREENS:{meshData:[],displays:{}}}}),define("game/planes/tunnan/TunnanData",["game/planes/tunnan/TunnanSystems","game/planes/tunnan/TunnanInstruments","game/planes/tunnan/TunnanSurfaces","game/planes/tunnan/TunnanOnScreenInput","game/planes/tunnan/TunnanWings","game/planes/tunnan/TunnanLights","game/planes/tunnan/TunnanScreens","game/GameConfiguration","game/ModelDefinitions","game/weapons/WeaponData"],function(e,t,n,r,i,s,o,u,a,f){return{TUNNAN:{modelPath:"tunnan",dimensions:{massEmpty:4845,massMax:8375,weightDistribution:[2,2,2],length:11,wingspan:10.23,pilotSeatPos:[0,.14,1.82],wingAngle:.2,height:3.75},hitPoints:300,physicalShapes:[{partId:"fuselage",posOffset:[0,0,0],radius:5},{partId:"fuselage",posOffset:[0,0,4],radius:5},{partId:"fuselage",posOffset:[0,0,-4],radius:5},{partId:"wing",posOffset:[4,0,-4],radius:5},{partId:"wing",posOffset:[-4,0,-4],radius:5}],physicalRadius:30,keyBindings:u.KEY_BINDINGS.plane,gooProjectUrl:u.GOO_PROJECTS.tunnan.projectPath,gooProject:u.GOO_PROJECTS.tunnan,piecePath:u.GOO_PROJECTS.tunnan.tunnan,contrail_effect:a.GOO_PARTICLES.wing_smoke,uiPages:["UI_TUNNAN","UI_AIR_PARAMS","UI_BOTTOM_BAR","UI_DRAG_FEEDBACK"],wing_smoke:[[-5.8,0,-2],[5.8,0,-2]],onScreenInput:r.ON_SCREEN_INPUT,instruments:t.INSTRUMENTS,measurements:{throttle:1,speed:1,altitude:1,airflowx:1,airflowy:1,airflowz:1,gForce:1},wings:i.WINGS,surfaces:n.SURFACES,systems:e.SYSTEMS}}}),define("game/planes/tomcat/TomcatInstruments",[],function(){var e={climb:[[-1e3,-10],[-18,-9],[-5,-5],[5,5],[18,9],[1e3,10]],speed:[[-1e3,0],[0,0],[500,2],[1e3,2]],acc:[[-4,-1],[0,0],[9,2]],alt:[[-1e3,0],[0,0],[12e3,3],[5e4,4]],ground:[[-1e3,0],[0,0],[100,.6],[250,.9],[400,1.2],[1e3,1.5],[2e3,1.8],[5e3,2.1],[5e4,2.5]]};return{INSTRUMENTS:{horizon:{sample:"rotVec",axisAmp:[[2,.0025],[1,0],[2,-0.021]]},roll_indicator:{sample:"rollAng",axisAmp:-1},gyro_compass:{boneName:"compass_2",sample:"xyHeading",axisAmp:1},turn_quality:{boneName:"turn_quality",sample:"acc",axisAmp:[[0,30],[0,0],[0,0]]},accelerometer:{boneName:"acceleration",sample:"g",axisAmp:-1},climb_indicator:{boneName:"climb",sample:"climbRate",curve:e.climb,axisAmp:-0.315},aoa_indicator:{axisAmp:1},sample:"aoa",ground_alt:{boneName:"ground_alt",sample:"altitude",curve:e.ground,axisAmp:-1},altimeter:{boneName:"altimeter",sample:"altitude",curve:e.alt,axisAmp:-1},ground_speed:{sample:"speed",axisAmp:-3.14},speed_indicator:{boneName:"airspeed",sample:"speed",curve:e.speed,axisAmp:-3.14},gyro_roll:{boneName:"gyro_roll",sample:"rollAng",axisAmp:-1},gyro_pitch:{boneName:"gyro_pitch",sample:"pitch",axisAmp:1}}}}),define("game/planes/tomcat/TomcatSystems",["game/ModelDefinitions","game/weapons/WeaponData"],function(e,t){return{SYSTEMS:{auto_trim:{inputBehavior:{type:"toggle",speed:1},speed:1},gears:{inputBehavior:{type:"toggle",speed:1},controls:{lights:["wheels"],doors:{door_nose_r:[-1.9,0,0],door_nose_l:[1.9,0,0],door_main_l:[1.3,0,0],door_main_r:[-1.3,0,0],door_rear_l:[1.2,0,0],door_rear_r:[-1.2,0,0],door_inner_l:[-1.5,0,0],door_inner_r:[1.5,0,0]},stands:{gear_nose:[-1.66,0,0],gear_r:[-1.66,0,0],gear_l:[1.66,0,0],gear_susp_l:[1.5,0,0],gear_susp_r:[-1.5,0,0]}},wheels:{nose_wheel:{control:"rudder",radius:-0.4,pos:[0,-1.71,5.9],axis:[1,0,0],breakMax:755.02,drag:5,suspension:{boneId:"nose_susp",range:.41,axis:[0,0,10],stiffness:32550}},wheel_r:{control:null,radius:-0.5,pos:[-2.6,-1.7,-1.07],breakMax:5225,drag:5,suspension:{boneId:"gear_susp_r",range:.41,axis:[0,0,10],stiffness:115e3}},wheel_l:{control:null,radius:.5,pos:[2.6,-1.7,-1.07],breakMax:5225,drag:5,suspension:{boneId:"gear_susp_l",range:.41,axis:[0,0,10],stiffness:115e3}}},speed:.01},breaks:{inputBehavior:{type:"slide",speed:.1},lights:["brakes"],controls:{},speed:.01},canopy:{inputBehavior:{type:"toggle",speed:1},controls:{xform:"rotate",doors:{canopy:[-0.45,0,0]}},speed:.01},seat:{inputBehavior:{type:"button",speed:1},type:"ejection",controls:{seats:{seat:[-2.15,0,-0.5]}},speed:.4},engines:{inputBehavior:{type:"slide",speed:.02,inputAnim:{bone:"throttle_r",rot:[-1,0,0]}},controls:{throttle:{throttle:.8}},mounts:[{maxThrust:77e3,afterBurner:42e3,nozzle:"nozzle_l",flame_light:"engine_l",jet_flame:e.GOO_PARTICLES.tomcat_jet,jet_smoke:e.GOO_PARTICLES.jet_smoke,posOffset:[-1.47,.3,-8],rot:[0,.08,0]},{maxThrust:77e3,afterBurner:42e3,nozzle:"nozzle_r",flame_light:"engine_r",jet_flame:e.GOO_PARTICLES.tomcat_jet,jet_smoke:e.GOO_PARTICLES.jet_smoke,posOffset:[1.47,.3,-8],rot:[0,-0.08,0]}],speed:8e-4},weapons:{inputBehavior:{type:"button",speed:6},controls:{cannons:{lights:["hot_trig"]}},cannons:[{data:t.CANNONS.vulcan_20,bulletData:t.BULLET_20,posOffset:[.71,.23,8]}],speed:1}}}}),define("game/planes/tomcat/TomcatSurfaces",[],function(){return{SURFACES:{elevator:{inputBehavior:{release:1,speed:.02},controls:{elevator:{stab_inner_r:-0.5,stab_inner_l:.5,stick_pitch:.15}},speed:.2},aeilrons:{inputBehavior:{release:1,speed:.02},controls:{aeilrons:{stab_outer_r:.6,stab_outer_l:.6,stick_roll:-0.15},spoiler:{spoiler_r:1.5,spoiler_l:-1.5}},speed:.2},rudder:{inputBehavior:{release:1,speed:.02},controls:{rudder:{rudder_l:-0.8,rudder_r:-0.8,pedal_l:.5,pedal_r:.5}},speed:.2},flaps:{inputBehavior:{release:0,speed:.1},controls:{flaps:{slat_r:-0.5,slat_l:.5,flap_r:.8,flap_l:-0.8,flaps_lever:.6}},speed:.008},breaks:{inputBehavior:{release:0,speed:.1},controls:{breaks:{break_top:-1.25,break_bottom:1.05}},speed:.01},wing_sweep:{inputBehavior:{release:0,speed:.08},lights:["wing_sweep"],controls:{wing_sweep:{pivot_r:-0.84,pivot_l:.84,canard_r:.3,canard_l:-0.3}},speed:.003}}}}),define("game/planes/tomcat/TomcatOnScreenInput",[],function(){return{ON_SCREEN_INPUT:{elevator:{rect:[43,55,57,82],axis:1,max:1,min:-1,factor:.7,label:"Pitch"},aeilrons:{rect:[43,55,57,82],axis:0,max:1,min:-1,factor:1,label:"Roll"},rudder:{rect:[43,82,57,86],axis:0,max:1,min:-1,factor:1,label:"Yaw"},trim_elevator:{rect:[57,55,61,80],axis:1,max:.5,min:-0.5,factor:.3,label:"Trim</br>Pitch"},trim_aeilrons:{rect:[45,50,55,54],axis:0,max:.5,min:-0.5,factor:.3,label:"Trim Roll"},trim_rudder:{rect:[44,87,56,91],axis:0,max:.5,min:-0.5,factor:.3,label:"Trim Yaw"},throttle:{rect:[36,65,42,85],axis:1,max:1,min:0,factor:1,label:"Throttle"},flaps:{rect:[30,70,35,85],axis:1,max:1,min:0,factor:1,label:"Flaps"},breaks:{rect:[24,70,29,85],axis:1,max:1,min:0,factor:1,label:"Brake"},hook:{rect:[2,45,7,52],axis:1,max:0,min:-1,factor:80,label:"Hook"},gears:{rect:[2,55,7,62],axis:1,max:0,min:-1,factor:80,label:"Gear"},canopy:{rect:[2,65,7,72],axis:1,max:1,min:0,factor:80,label:"Canopy"},wing_sweep:{rect:[52,2,60,23],axis:1,max:1,min:0,factor:1,label:"Wing<br>Sweep"},screen_intensity:{rect:[95,42,98,60],axis:1,max:1,min:.2,factor:1,label:"Screens"},hud_intensity:{rect:[90,42,93,60],axis:1,max:.9,min:.2,factor:1,label:"Hud"},hdd_intensity:{rect:[85,42,88,60],axis:1,max:1,min:.2,factor:1,label:"HDD"},cockpit_lights:{rect:[95,28,98,40],axis:1,max:1,min:.3,factor:1,label:"Inst"},cockpit_mode:{rect:[95,22,98,28],axis:0,max:1,min:-1,factor:1,label:"Mode"},formation_lights:{rect:[90,28,93,40],axis:1,max:1,min:.1,factor:1,label:"Form"},formation_mode:{rect:[90,22,93,28],axis:0,max:1,min:-1,factor:1,label:"Mode"},position_lights:{rect:[85,28,88,40],axis:1,max:1,min:.1,factor:1,label:"Pos"},position_mode:{rect:[85,22,88,28],axis:0,max:1,min:-1,factor:1,label:"Mode"},collision_lights:{rect:[80,28,83,40],axis:1,max:1,min:.1,factor:1,label:"Coll"},collision_mode:{rect:[80,22,83,28],axis:0,max:1,min:-1,factor:1,label:"Mode"},taxi_lights:{rect:[75,28,78,40],axis:1,max:1,min:.1,factor:1,label:"Taxi"},taxi_mode:{rect:[75,22,78,28],axis:0,max:1,min:-1,factor:1,label:"Mode"}}}}),define("game/planes/tomcat/TomcatWings",["game/world/Curves"],function(e){var t=.06,n=.1,r=8,i=18,s=20;return{WINGS:{fuselageMid:{pos:[0,.6,0],size:[3.4,.4,6.1],rot:[.003,0,0],stallAngle:[1.3,1,1],liftCurve:e.WINGS.wing,stallLiftCoeff:[r,0,0],formDragCoeff:t},fuselageTip:{pos:[0,-0.4,7.8],size:[1.2,.6,4.8],rot:[0,0,0],stallAngle:[1.4,1,1],liftCurve:e.WINGS.cone,stallLiftCoeff:[.5,0,0],formDragCoeff:t},fuselageForeR:{pos:[1.5,.5,3.1],size:[2.6,.1,2.5],rot:[.001,0,0],stallAngle:[.9,1,1],liftCurve:e.WINGS.wing,stallLiftCoeff:[r,0,0],formDragCoeff:t},fuselageForeL:{pos:[-1.5,.5,3.1],size:[2.6,.1,2.5],rot:[.001,0,0],stallAngle:[.9,1,1],liftCurve:e.WINGS.wing,stallLiftCoeff:[r,0,0],formDragCoeff:t},fuselageAft:{pos:[0,.2,-4.1],size:[3.2,.4,4],rot:[.001,0,0],stallAngle:[.8,1,1],liftCurve:e.WINGS.wing,stallLiftCoeff:[r,0,0],formDragCoeff:t},mainInnerRight:{controls:{wing_sweep:[-0.01,-0.3,0]},pos:[2.4,.9,.7],size:[2.3,.05,3.2],rot:[-0.005,.35,0],stallAngle:[.55,.3,.2],liftCurve:e.WINGS.wing,stallLiftCoeff:[i,0,0],formDragCoeff:t},mainInnerLeft:{controls:{wing_sweep:[-0.01,.3,0]},pos:[-2.4,.9,.7],size:[2.3,.05,3.2],rot:[-0.005,-0.35,0],stallAngle:[.55,.3,.2],liftCurve:e.WINGS.wing,stallLiftCoeff:[i,0,0],formDragCoeff:t},mainRight:{controls:{wing_sweep:[.1,1.1,0]},pos:[4.4,.6,-0.9],size:[7.5,.1,3.8],rot:[-0.1,.35,0],stallAngle:[.55,.3,.2],liftCurve:e.WINGS.wing,stallLiftCoeff:[i,0,0],formDragCoeff:t},mainLeft:{controls:{wing_sweep:[.1,-1.1,0]},pos:[-4.4,.6,-0.9],size:[7.5,.1,3.8],rot:[-0.1,-0.35,0],stallAngle:[.55,.3,.2],liftCurve:e.WINGS.wing,stallLiftCoeff:[i,0,0],formDragCoeff:t},flapRight:{controls:{flaps:[-0.5,0,0]},pos:[2.5,.9,-1.2],size:[3.8,.05,2.8],rot:[0,.1,0],stallAngle:[1.2,.7,.2],liftCurve:e.WINGS.rudder,stallLiftCoeff:[s,0,0],formDragCoeff:t},flapLeft:{controls:{flaps:[-0.5,0,0]},pos:[-2.5,.9,-1.2],size:[3.8,.05,2.8],rot:[0,-0.1,0],stallAngle:[1.2,.7,.2],liftCurve:e.WINGS.rudder,stallLiftCoeff:[s,0,0],formDragCoeff:t},aeilronRight:{controls:{aeilrons:[.5,0,0],elevator:[.5,0,0]},pos:[4,.15,-7.2],size:[3,.1,2.8],rot:[0,.4,0],stallAngle:[.9,.4,.2],liftCurve:e.WINGS.wing,stallLiftCoeff:[r,0,0],formDragCoeff:t},aeilronLeft:{controls:{aeilrons:[-0.5,0,0],elevator:[.5,0,0]},pos:[-4,.15,-7.2],size:[3,.1,2.8],rot:[0,-0.4,0],stallAngle:[.9,.4,.2],liftCurve:e.WINGS.wing,stallLiftCoeff:[r,0,0],formDragCoeff:t},break_up:{controls:{breaks:[.8,0,0]},pos:[0,.6,-6.1],size:[2,.15,2],rot:[0,0,0],stallAngle:[1.9,1,1],liftCurve:e.WINGS.rudder,stallLiftCoeff:[i,0,0],formDragCoeff:t},break_down:{controls:{breaks:[-0.8,0,0]},pos:[0,-0.6,-6.1],size:[2,.15,2],rot:[0,0,0],stallAngle:[1.9,1,1],liftCurve:e.WINGS.rudder,stallLiftCoeff:[i,0,0],formDragCoeff:t},rudder_r:{controls:{rudder:[-0.4,0,0]},pos:[1.8,2.2,-7.9],size:[2.5,.14,.6],rot:[0,0,-Math.PI/2],stallAngle:[1.2,0,0],liftCurve:e.WINGS.rudder,stallLiftCoeff:[0,i,0],formDragCoeff:t},rudder_l:{controls:{rudder:[-0.4,0,0]},pos:[-1.8,2.2,-7.9],size:[2.5,.14,.6],rot:[0,0,-Math.PI/2],stallAngle:[1.2,0,0],liftCurve:e.WINGS.rudder,stallLiftCoeff:[0,i,0],formDragCoeff:t},vert_stab_R:{pos:[1.8,1.8,-6.7],size:[3.2,.1,2.1],rot:[0,0,-Math.PI/2],stallAngle:[1,0,0],liftCurve:e.WINGS.stab,stallLiftCoeff:[0,i,0],formDragCoeff:t},vert_stab_L:{pos:[-1.8,1.8,-6.7],size:[3.2,.1,2.1],rot:[0,0,-Math.PI/2],stallAngle:[1,0,0],liftCurve:e.WINGS.stab,stallLiftCoeff:[0,i,0],formDragCoeff:t},vert_skid_R:{pos:[1.5,-0.8,-0.01],size:[.1,.1,1.3],rot:[0,0,-Math.PI/2],stallAngle:[1,0,0],liftCurve:e.WINGS.stab,stallLiftCoeff:[0,n,0],formDragCoeff:t},vert_skid_L:{pos:[-1.5,-0.8,-0.01],size:[.1,.1,1.3],rot:[0,0,-Math.PI/2],stallAngle:[1,0,0],liftCurve:e.WINGS.stab,stallLiftCoeff:[0,n,0],formDragCoeff:t},vert_lift:{pos:[0,-0.1,-0.2],size:[1.4,.1,8],rot:[0,0,-Math.PI/2],stallAngle:[.7,0,0],liftCurve:e.WINGS.stab,stallLiftCoeff:[0,i,0],formDragCoeff:t}}}}),define("game/planes/tomcat/TomcatLights",[],function(){return{LIGHTS:{meshData:[{meshEntityName:"tomcat_skinned/entities/lights.entity"}],feedback:{off:[0,301,4,4]},systems:{formation:{formation:{meshData:0,txcoords:[44,286,39,12]},formation_r:{meshData:0,txcoords:[5,301,9,8]},formation_l:{meshData:0,txcoords:[5,310,9,8]}},position:{wing_r:{meshData:0,txcoords:[25,301,9,8]},wing_l:{meshData:0,txcoords:[25,310,9,8]},glove_r:{meshData:0,txcoords:[15,301,9,8]},glove_l:{meshData:0,txcoords:[15,310,9,8]},rear_l:{meshData:0,txcoords:[45,301,9,8]}},collision:{collision_l:{meshData:0,txcoords:[35,310,9,8]},rear_r:{meshData:0,txcoords:[65,301,9,8]}},taxi:{nose:{meshData:0,txcoords:[45,310,9,8]}},cockpit:{seam_lock:{meshData:0,txcoords:[0,0,82,15]},collision:{meshData:0,txcoords:[0,16,82,15]},hot_trig:{meshData:0,txcoords:[0,35,82,15]},r_fire:{meshData:0,txcoords:[0,53,65,17]},l_fire:{meshData:0,txcoords:[0,73,65,17]},adl_ac:{meshData:0,txcoords:[0,92,78,14]},landing_chk:{meshData:0,txcoords:[0,106,78,15]},acl_ready:{meshData:0,txcoords:[0,123,78,15]},ap_cflr:{meshData:0,txcoords:[0,138,78,16]},cmd_control:{meshData:0,txcoords:[0,155,78,16]},ten_seconds:{meshData:0,txcoords:[0,171,78,14]},tilt:{meshData:0,txcoords:[0,186,78,14]},voice:{meshData:0,txcoords:[0,202,78,14]},blank1:{meshData:0,txcoords:[0,217,78,14]},blank2:{meshData:0,txcoords:[0,232,78,14]},ap_hef:{meshData:0,txcoords:[0,247,78,15]},wave_off:{meshData:0,txcoords:[81,92,78,14]},wing_sweep:{meshData:0,txcoords:[81,106,78,15]},reduce_speed:{meshData:0,txcoords:[81,123,78,15]},blank3:{meshData:0,txcoords:[81,138,78,16]},alt_low:{meshData:0,txcoords:[81,155,78,16]},hig_rate:{meshData:0,txcoords:[160,60,78,14]},low_rate:{meshData:0,txcoords:[160,80,41,16]},cool_on:{meshData:0,txcoords:[160,100,41,16]},cool_off:{meshData:0,txcoords:[160,120,41,16]},msl_prep_on:{meshData:0,txcoords:[160,140,41,16]},msl_prep_off:{meshData:0,txcoords:[160,160,41,16]},norm:{meshData:0,txcoords:[160,211,42,16]},brsit:{meshData:0,txcoords:[160,231,42,16]},ecm_1:{meshData:0,txcoords:[204,59,20,11]},ecm_2:{meshData:0,txcoords:[204,72,20,11]},ecm_3:{meshData:0,txcoords:[204,84,20,11]},master_caution:{meshData:0,txcoords:[222,66,88,18]},wheels:{meshData:0,txcoords:[222,116,56,20]},brakes:{meshData:0,txcoords:[222,138,56,20]},acls_ap:{meshData:0,txcoords:[222,162,56,20]},nws_enga:{meshData:0,txcoords:[222,187,56,20]},auto_throt:{meshData:0,txcoords:[222,211,56,20]},aoa_ind_top:{meshData:0,txcoords:[281,113,20,22]},aoa_ind_mid:{meshData:0,txcoords:[281,136,20,22]},aoa_ind_low:{meshData:0,txcoords:[281,160,20,22]},pitch_1:{meshData:0,txcoords:[332,120,45,12]},roll_1:{meshData:0,txcoords:[377,120,45,12]},yaw_op:{meshData:0,txcoords:[422,120,45,12]},xx_1:{meshData:0,txcoords:[467,120,45,12]},pitch_2:{meshData:0,txcoords:[332,132,45,12]},roll_2:{meshData:0,txcoords:[377,132,45,12]},yaw_out:{meshData:0,txcoords:[422,132,45,12]},xx_2:{meshData:0,txcoords:[467,132,45,12]},x_2:{meshData:0,txcoords:[332,144,45,12]},y_2:{meshData:0,txcoords:[377,144,45,12]},z_2:{meshData:0,txcoords:[422,144,45,12]},yy_1:{meshData:0,txcoords:[467,144,45,12]},x_1:{meshData:0,txcoords:[332,156,45,12]},y_1:{meshData:0,txcoords:[377,156,45,12]},z_1:{meshData:0,txcoords:[422,156,45,12]},yy_2:{meshData:0,txcoords:[467,156,45,12]},xx_12:{meshData:0,txcoords:[332,167,45,11]},yy_12:{meshData:0,txcoords:[377,167,45,11]},zz_12:{meshData:0,txcoords:[422,167,45,11]},yx_12:{meshData:0,txcoords:[467,167,45,11]},xx_22:{meshData:0,txcoords:[332,178,45,12]},yy_22:{meshData:0,txcoords:[377,178,45,12]},zz_22:{meshData:0,txcoords:[422,178,45,12]},yx_22:{meshData:0,txcoords:[467,178,45,12]},xx_33:{meshData:0,txcoords:[332,190,45,12]},yy_33:{meshData:0,txcoords:[377,190,45,12]},zz_33:{meshData:0,txcoords:[422,190,45,12]},yx_33:{meshData:0,txcoords:[467,190,45,12]},xx_44:{meshData:0,txcoords:[332,202,45,12]},yy_44:{meshData:0,txcoords:[377,202,45,12]},zz_44:{meshData:0,txcoords:[422,202,45,12]},yx_44:{meshData:0,txcoords:[467,202,45,12]},xx_55:{meshData:0,txcoords:[332,214,45,12]},yy_55:{meshData:0,txcoords:[377,214,45,12]},zz_55:{meshData:0,txcoords:[422,214,45,12]},yx_55:{meshData:0,txcoords:[467,214,45,12]},xx_66:{meshData:0,txcoords:[218,0,45,12]},yy_66:{meshData:0,txcoords:[263,0,45,12]},zz_66:{meshData:0,txcoords:[308,0,45,12]},yx_66:{meshData:0,txcoords:[353,0,45,12]},xx_77:{meshData:0,txcoords:[218,12,45,12]},yy_77:{meshData:0,txcoords:[263,12,45,12]},zz_77:{meshData:0,txcoords:[308,12,45,12]},yx_77:{meshData:0,txcoords:[353,12,45,12]},xx_88:{meshData:0,txcoords:[218,24,45,12]},yy_88:{meshData:0,txcoords:[263,24,45,12]},zz_88:{meshData:0,txcoords:[308,24,45,12]},yx_88:{meshData:0,txcoords:[353,24,45,12]},xx_99:{meshData:0,txcoords:[218,36,45,12]},yy_99:{meshData:0,txcoords:[263,36,45,12]},zz_99:{meshData:0,txcoords:[308,36,45,12]},yx_99:{meshData:0,txcoords:[353,36,45,12]}},engines:{engine_l:{meshData:0,txcoords:[6,319,19,15]},engine_r:{meshData:0,txcoords:[16,319,19,15]}}}}}}),define("game/planes/tomcat/TomcatScreens",["game/GameConfiguration"],function(e){return{SCREENS:{meshData:[{meshEntityName:"tomcat_skinned/entities/lights.entity"}],displays:{vdi:{mapcoords:[414,418,230,226],instruments:{vdi_video:{script:"VideoPlayer",meshIndex:0,txcoords:[414,418,230,226],sources:{video:[0,0,256,128]},channel:e.VIDEOS.channels.vdi},vdi_horizon:{script:"VdiLadder",meshIndex:0,txcoords:[414,418,230,226],sources:{up:[428,30,60,6],down:[428,75,60,6],origin:[442,42,32,7],o_line:[315,418,20,1],flat:[345,417,140,3]}},vdi_compass:{script:"CompassTape",meshIndex:0,lines:7,txcoords:[411,350,197,187],sources:{dots:[480,0,32,6],0:[397,0,7,11],1:[405,0,7,11],2:[413,0,7,11],3:[421,0,7,11],4:[429,0,7,11],5:[437,0,7,11],6:[445,0,7,11],7:[453,0,7,11],8:[461,0,7,11],9:[469,0,7,11]}}}},hsi:{mapcoords:[137,416,162,198],instruments:{hsi_video:{script:"VideoPlayer",meshIndex:0,txcoords:[137,416,162,198],sources:{video:[0,0,256,128]},channel:e.VIDEOS.channels.hsi},hsi_rotation:{script:"HsiRotation",meshIndex:0,txcoords:[137,416,162,198],sources:{circles:[94,369,90,90]}},hsi_compass:{script:"CompassTape",meshIndex:0,lines:7,txcoords:[139,335,161,27],sources:{dots:[480,0,32,6],0:[397,0,7,11],1:[405,0,7,11],2:[413,0,7,11],3:[421,0,7,11],4:[429,0,7,11],5:[437,0,7,11],6:[445,0,7,11],7:[453,0,7,11],8:[461,0,7,11],9:[469,0,7,11]}}}},hud:{mapcoords:[452,59,121,119],instruments:{hud_video:{script:"VideoPlayer",meshIndex:0,txcoords:[452,59,121,119],sources:{video:[0,0,256,128]},channel:e.VIDEOS.channels.hud},hud_horizon:{script:"HudLadder",meshIndex:0,txcoords:[452,59,121,119],sources:{flat:[428,54,60,5],up:[428,31,60,5],down:[428,75,60,5],origin:[440,42,36,5]}},hud_compass:{script:"CompassTape",meshIndex:0,lines:5,txcoords:[452,17,121,110],sources:{dots:[480,0,32,6],0:[397,0,7,11],1:[405,0,7,11],2:[413,0,7,11],3:[421,0,7,11],4:[429,0,7,11],5:[437,0,7,11],6:[445,0,7,11],7:[453,0,7,11],8:[461,0,7,11],9:[469,0,7,11]}},hud_altimeter:{script:"ScreenDigits",sourceValue:"altimeter",meshIndex:0,txcoords:[412,105,114,110],sources:{0:[397,0,7,11],1:[405,0,7,11],2:[413,0,7,11],3:[421,0,7,11],4:[429,0,7,11],5:[437,0,7,11],6:[445,0,7,11],7:[453,0,7,11],8:[461,0,7,11],9:[469,0,7,11]}},hud_speed:{script:"ScreenDigits",sourceValue:"ground_speed",meshIndex:0,txcoords:[412,116,114,110],sources:{0:[397,0,7,11],1:[405,0,7,11],2:[413,0,7,11],3:[421,0,7,11],4:[429,0,7,11],5:[437,0,7,11],6:[445,0,7,11],7:[453,0,7,11],8:[461,0,7,11],9:[469,0,7,11]}},climb_rate:{script:"RulerGauge",sourceValue:"climb_indicator",meshIndex:0,scaleFactor:2,xOffset:10,txcoords:[408,54,15,50],sources:{ruler:[407,29,15,50],arrow:[422,51,4,7]}},aoa_z:{meshIndex:0,script:"RulerGauge",sourceValue:"aoa_indicator",scaleFactor:160,xOffset:-10,txcoords:[502,54,8,48],sources:{ruler:[496,34,8,44],arrow:[491,50,4,8]}}}}}}}}),define("game/planes/tomcat/TomcatData",["game/planes/tomcat/TomcatInstruments","game/planes/tomcat/TomcatSystems","game/planes/tomcat/TomcatSurfaces","game/planes/tomcat/TomcatOnScreenInput","game/planes/tomcat/TomcatWings","game/planes/tomcat/TomcatLights","game/planes/tomcat/TomcatScreens","game/GameConfiguration","game/ModelDefinitions"],function(e,t,n,r,i,s,o,u,a){return{TOMCAT:{modelPath:"tomcat_skinned",dimensions:{massEmpty:14845,massMax:28375,weightDistribution:[6,2,7],length:19,wingspan:18.23,pilotSeatPos:[0,.85,6.52],wingAngle:.2,height:5.75},hitPoints:300,physicalShapes:[{partId:"fuselage",posOffset:[0,0,0],radius:5},{partId:"fuselage",posOffset:[0,0,4],radius:5},{partId:"fuselage",posOffset:[0,0,-4],radius:5},{partId:"wing",posOffset:[4,0,-4],radius:5},{partId:"wing",posOffset:[-4,0,-4],radius:5}],physicalRadius:30,keyBindings:u.KEY_BINDINGS.plane,gooProjectUrl:u.GOO_PROJECTS.tomcat.projectPath,gooProject:u.GOO_PROJECTS.tomcat,piecePath:u.GOO_PROJECTS.tomcat.tomcat,contrail_effect:a.GOO_PARTICLES.wing_smoke,uiPages:["UI_TUNNAN","UI_AIR_PARAMS","UI_BOTTOM_BAR","UI_DRAG_FEEDBACK"],wing_smoke:[[-5.8,0,-2],[5.8,0,-2]],onScreenInput:r.ON_SCREEN_INPUT,instruments:e.INSTRUMENTS,lights:s.LIGHTS,screens:o.SCREENS,measurements:{throttle:1,speed:1,altitude:1,airflowx:1,airflowy:1,airflowz:1,gForce:1},wings:i.WINGS,surfaces:n.SURFACES,systems:t.SYSTEMS}}}),define("game/planes/PlaneData",["game/planes/tunnan/TunnanData","game/planes/tomcat/TomcatData","game/GameConfiguration","game/ModelDefinitions","game/weapons/WeaponData"],function(e,t,n,r,i){return{TOMCAT:t.TOMCAT,TUNNAN:e.TUNNAN,DRAKEN:{modelPath:"draken",dimensions:{massEmpty:7245,massMax:11875,weightDistribution:[2,2,3],length:15.3,wingspan:9.43,pilotSeatPos:[0,-0.1,4.52],wingAngle:.2,height:3.9},hitPoints:300,physicalShapes:[{partId:"fuselage",posOffset:[0,0,0],radius:5},{partId:"fuselage",posOffset:[0,0,4],radius:5},{partId:"fuselage",posOffset:[0,0,-4],radius:5},{partId:"wing",posOffset:[4,0,-4],radius:5},{partId:"wing",posOffset:[-4,0,-4],radius:5}],physicalRadius:30,keyBindings:n.KEY_BINDINGS.plane,gooProjectUrl:n.GOO_PROJECTS.draken.projectPath,piecePath:n.GOO_PROJECTS.draken.draken,contrail_effect:r.GOO_PARTICLES.wing_smoke,uiPages:["UI_TUNNAN","UI_AIR_PARAMS","UI_BOTTOM_BAR"],wing_smoke:[[-4.5,-0.2,-2],[4.5,-0.2,-2]],instruments:{},measurements:{throttle:1,speed:1,altitude:1,airflowx:1,airflowy:1,airflowz:1,gForce:1},wings:{fuselageFore:{pos:[0,-0.2,2],size:[1.2,1.2,1.2],rot:[.02,0,0],stallAngle:[.5,1,1],stallLiftCoeff:[4.5,0,0],formDragCoeff:.05},fuselageMid:{pos:[0,-0.2,0],size:[.7,.01,3],rot:[.05,0,0],stallAngle:[.5,1,1],stallLiftCoeff:[4.5,0,0],formDragCoeff:.1},fuselageCore:{pos:[0,-0.2,0],size:[1.4,1.4,1.4],rot:[0,0,0],stallAngle:[.5,1,1],stallLiftCoeff:[3.5,0,0],formDragCoeff:.05},fuselageAft:{pos:[0,-0.2,-1.5],size:[.6,.6,.6],rot:[.03,0,0],stallAngle:[.5,1,1],stallLiftCoeff:[2.5,0,0],formDragCoeff:.05},mainInnerFore:{pos:[0,.24,.41],size:[3.7,.1,8.6],rot:[.004,0,0],stallAngle:[.4,.5,.2],stallLiftCoeff:[35,0,0],formDragCoeff:.001},mainOuterRight:{pos:[4,.2,-2.8],size:[3.1,.05,1.8],rot:[.002,.72,0],stallAngle:[.45,.3,.2],stallLiftCoeff:[42,0,0],formDragCoeff:.001},mainOuterLeft:{pos:[-4,.2,-2.8],size:[3.1,.05,1.8],rot:[.002,-0.72,0],stallAngle:[.45,.3,.2],stallLiftCoeff:[42,0,0],formDragCoeff:.001},aeilronRight:{controls:{aeilrons:[.3,0,0]},pos:[3,.15,-4.2],size:[3,.05,.6],rot:[0,.1,0],stallAngle:[.4,.4,.2],stallLiftCoeff:[12,0,0],formDragCoeff:.002},aeilronLeft:{controls:{aeilrons:[-0.3,0,0]},pos:[-3,.15,-4.3],size:[3,.05,.6],rot:[0,-0.1,0],stallAngle:[.4,.4,.2],stallLiftCoeff:[12,0,0],formDragCoeff:.002},elevator:{controls:{elevator:[.8,0,0]},pos:[0,.2,-4.5],size:[3.6,.04,1],rot:[0,0,0],stallAngle:[1.5,.4,.3],stallLiftCoeff:[12,0,0],formDragCoeff:.001},rudder:{controls:{rudder:[-0.4,0,0]},pos:[0,1.9,-4.3],size:[1.6,.01,.8],rot:[0,0,-Math.PI/2],stallAngle:[1.45,.5,1],stallLiftCoeff:[8,0,0],formDragCoeff:.01}},surfaces:{elevator:{inputBehavior:{release:1,speed:.1},controls:{elevator:{flap_r:-0.5,flap_l:.5},aeilrons:{aeilron_r:-0.5,aeilron_l:.5}},speed:.03},aeilrons:{inputBehavior:{release:1,speed:.1},controls:{aeilrons:{aeilron_r:.5,aeilron_l:.5},elevator:{flap_r:.5,flap_l:.5}},speed:.03},rudder:{inputBehavior:{release:1,speed:.1},controls:{rudder:{rudder:-0.8}},speed:.02}},systems:{auto_trim:{inputBehavior:{type:"toggle",speed:1},speed:1},gears:{inputBehavior:{type:"toggle",speed:1},controls:{doors:{door_nose_r:[-2.7,0,0],door_nose_l:[2.7,0,0],door_l:[1.4,0,0],door_r:[-1.4,0,0],door_l_inner:[-1.4,0,0],door_r_inner:[1.4,0,0]},stands:{gear_nose:[1.4,0,0],gear_r:[1.3,0,0],gear_l:[-1.3,0,0]}},wheels:{wheel_nose:{control:"rudder",radius:.3,pos:[0,-1.28,3],breakMax:555.02,drag:5,suspension:{boneId:"susp_nose",range:.12,axis:[0,1,0],stiffness:22550}},wheel_r:{control:null,radius:-0.5,pos:[-1.9,-1.02,-0.5],breakMax:9525.05,drag:5,suspension:{boneId:"susp_r",range:.12,axis:[0,1,0],stiffness:75e3}},wheel_l:{control:null,radius:.5,pos:[1.9,-1.02,-0.5],breakMax:9525.05,drag:5,suspension:{boneId:"susp_l",range:.12,axis:[0,-1,0],stiffness:75e3}}},speed:.01},breaks:{inputBehavior:{type:"slide",speed:.1},controls:{},speed:.01},canopy:{inputBehavior:{type:"toggle",speed:1},controls:{xform:"rotate",doors:{canopy:[1.05,0,0]}},speed:.01},seat:{inputBehavior:{type:"button",speed:1},type:"ejection",controls:{seats:{}},speed:.4},engines:{inputBehavior:{type:"slide",speed:.1},controls:{throttle:{}},mounts:[{maxThrust:73e3,jet_flame:r.GOO_PARTICLES.basic_jet,jet_smoke:r.GOO_PARTICLES.jet_smoke,posOffset:[0,.2,-6]}],speed:.005},weapons:{inputBehavior:{type:"button",speed:1},controls:{cannons:{}},cannons:[{data:i.CANNONS.hispano_20,bulletData:i.BULLET_20,posOffset:[1.65,.27,1.8]},{data:i.CANNONS.hispano_20,bulletData:i.BULLET_20,posOffset:[-1.65,.27,1.8]}],speed:2}}},COUGAR:{modelPath:"cougar_f9f",dimensions:{massEmpty:7845,massMax:11375,weightDistribution:[2,2,3],length:12,wingspan:11.23,pilotSeatPos:[0,.1,2.22],wingAngle:.2,height:3.75},hitPoints:300,physicalShapes:[{partId:"fuselage",posOffset:[0,0,0],radius:5},{partId:"fuselage",posOffset:[0,0,4],radius:5},{partId:"fuselage",posOffset:[0,0,-4],radius:5},{partId:"wing",posOffset:[4,0,-4],radius:5},{partId:"wing",posOffset:[-4,0,-4],radius:5}],physicalRadius:30,keyBindings:n.KEY_BINDINGS.plane,gooProjectUrl:n.GOO_PROJECTS.cougar_f9f.projectPath,piecePath:n.GOO_PROJECTS.cougar_f9f.cougar_f9f,contrail_effect:r.GOO_PARTICLES.wing_smoke,uiPages:["UI_TUNNAN","UI_AIR_PARAMS","UI_BOTTOM_BAR"],wing_smoke:[[-5.8,-0.5,-3],[5.8,-0.5,-3]],instruments:{},measurements:{throttle:1,speed:1,altitude:1,airflowx:1,airflowy:1,airflowz:1,gForce:1},wings:{fuselageFore:{pos:[0,-0.2,2],size:[1.2,1.2,1.2],rot:[.02,0,0],stallAngle:[.5,1,1],stallLiftCoeff:[4.5,0,0],formDragCoeff:.05},fuselageMid:{pos:[0,-0.2,0],size:[.7,.01,3],rot:[.05,0,0],stallAngle:[.5,1,1],stallLiftCoeff:[4.5,0,0],formDragCoeff:.1},fuselageCore:{pos:[0,-0.2,0],size:[1.4,1.4,1.4],rot:[0,0,0],stallAngle:[.5,1,1],stallLiftCoeff:[3.5,0,0],formDragCoeff:.05},fuselageAft:{pos:[0,-0.2,-1.5],size:[.6,.6,.6],rot:[.03,0,0],stallAngle:[.5,1,1],stallLiftCoeff:[2.5,0,0],formDragCoeff:.05},mainInnerRight:{pos:[1.3,.24,.41],size:[2.7,.1,2.6],rot:[.004,.65,0],stallAngle:[.5,.5,.2],stallLiftCoeff:[75,0,0],formDragCoeff:.001},mainInnerLeft:{pos:[-1.3,.24,.41],size:[2.7,.05,2.6],rot:[.004,-0.65,0],stallAngle:[.5,.5,.2],stallLiftCoeff:[75,0,0],formDragCoeff:.001},mainOuterRight:{pos:[4,.2,-0.8],size:[3.8,.05,1.8],rot:[.002,.62,0],stallAngle:[.45,.3,.2],stallLiftCoeff:[52,0,0],formDragCoeff:.001},mainOuterLeft:{pos:[-4,.2,-0.8],size:[3.8,.05,1.8],rot:[.002,-0.62,0],stallAngle:[.45,.3,.2],stallLiftCoeff:[52,0,0],formDragCoeff:.001},flapRight:{controls:{flaps:[-1.1,0,0]},pos:[1.6,.265,-0.05],size:[1.8,.1,1.4],rot:[0,.5,0],stallAngle:[1.2,.7,.2],stallLiftCoeff:[27,0,0],formDragCoeff:.002},flapLeft:{controls:{flaps:[-1.1,0,0]},pos:[-1.6,.265,-0.05],size:[1.8,.05,1.4],rot:[0,-0.5,0],stallAngle:[1.2,.7,.2],stallLiftCoeff:[27,0,0],formDragCoeff:.002},aeilronRight:{controls:{aeilrons:[.3,0,0]},pos:[3,.15,-1.8],size:[3,.05,.5],rot:[0,.5,0],stallAngle:[.4,.4,.2],stallLiftCoeff:[32,0,0],formDragCoeff:.002},aeilronLeft:{controls:{aeilrons:[-0.3,0,0]},pos:[-3,.15,-1.8],size:[3,.05,.5],rot:[0,-0.5,0],stallAngle:[.4,.4,.2],stallLiftCoeff:[32,0,0],formDragCoeff:.002},elevator:{controls:{elevator:[.8,0,0]},pos:[0,1.1,-5.8],size:[4,.04,1.2],rot:[0,0,0],stallAngle:[1.5,.4,.3],stallLiftCoeff:[28,0,0],formDragCoeff:.001},rudder:{controls:{rudder:[-0.4,0,0]},pos:[0,1.9,-6.3],size:[1.6,.01,.8],rot:[0,0,-Math.PI/2],stallAngle:[1.45,.5,1],stallLiftCoeff:[45,0,0],formDragCoeff:.01},stabiliser:{pos:[0,1.3,-5.3],size:[2.2,.1,1.1],rot:[0,0,-Math.PI/2],stallAngle:[.7,.4,1],stallLiftCoeff:[6,0,0],formDragCoeff:.01}},surfaces:{elevator:{inputBehavior:{release:1,speed:.1},controls:{elevator:{elevator:.6}},speed:.03},aeilrons:{inputBehavior:{release:1,speed:.1},controls:{aeilrons:{aeilron_r:.5,aeilron_l:.5}},speed:.03},rudder:{inputBehavior:{release:1,speed:.1},controls:{rudder:{rudder:-0.8}},speed:.02},flaps:{inputBehavior:{release:0,speed:.1},controls:{flaps:{flap_r:1.1,flap_l:-1.1}},speed:.005}},systems:{auto_trim:{inputBehavior:{type:"toggle",speed:1},speed:1},gears:{inputBehavior:{type:"toggle",speed:1},controls:{doors:{door_nose_r:[-1.4,0,0],door_nose_l:[1.4,0,0],door_l:[-1.1,0,0],door_r:[1.1,0,0]},stands:{gear_nose:[-1.5,0,0],gear_right:[-1,0,0],gear_left:[1,0,0]}},wheels:{wheel_nose:{control:"rudder",radius:.3,pos:[0,-1.4,3.4],breakMax:1555.02,drag:5,suspension:{boneId:"susp_nose",range:.11,axis:[0,-1,0],stiffness:14550}},wheel_r:{control:null,radius:-0.5,pos:[-1.4,-1.33,-0.17],breakMax:3025.05,drag:5,suspension:{boneId:"susp_right",range:.11,axis:[0,-1,0],stiffness:85e3}},wheel_l:{control:null,radius:.5,pos:[1.4,-1.33,-0.17],breakMax:3025.05,drag:5,suspension:{boneId:"susp_left",range:.11,axis:[0,1,0],stiffness:85e3}}},speed:.01},breaks:{inputBehavior:{type:"slide",speed:.1},controls:{},speed:.01},canopy:{inputBehavior:{type:"toggle",speed:1},controls:{xform:"slide",doors:{canopy:[-0.05,.85,0]}},speed:.01},seat:{inputBehavior:{type:"button",speed:1},type:"ejection",controls:{seats:{seat:[-2.15,0,-0.5]}},speed:.4},engines:{inputBehavior:{type:"slide",speed:.1},controls:{throttle:{throttle:.8}},mounts:[{maxThrust:57e3,jet_flame:r.GOO_PARTICLES.basic_jet,jet_smoke:r.GOO_PARTICLES.jet_smoke,posOffset:[0,-0.1,-4]}],speed:.005},weapons:{inputBehavior:{type:"button",speed:1},controls:{cannons:{}},cannons:[{data:i.CANNONS.hispano_20,bulletData:i.BULLET_20,posOffset:[.44,-0.54,3.6]},{data:i.CANNONS.hispano_20,bulletData:i.BULLET_20,posOffset:[.32,-0.75,3.35]},{data:i.CANNONS.hispano_20,bulletData:i.BULLET_20,posOffset:[-0.32,-0.75,3.35]},{data:i.CANNONS.hispano_20,bulletData:i.BULLET_20,posOffset:[-0.44,-0.54,3.6]}],speed:2}}},B52:{modelPath:"b_52",dimensions:{massEmpty:115845,massMax:231375,weightDistribution:[21,21,21],length:47,wingspan:56.23,pilotSeatPos:[0,.9,18.72],wingAngle:.2,height:3.75},hitPoints:300,physicalShapes:[{partId:"fuselage",posOffset:[0,0,15],radius:5},{partId:"fuselage",posOffset:[0,0,7],radius:5},{partId:"fuselage",posOffset:[0,0,0],radius:5},{partId:"fuselage",posOffset:[0,0,-7],radius:5},{partId:"fuselage",posOffset:[0,0,-15],radius:5},{partId:"fuselage",posOffset:[0,0,-22],radius:5},{partId:"fuselage",posOffset:[0,0,-29],radius:5},{partId:"engine",posOffset:[19,-1.5,-2.5],radius:5},{partId:"engine",posOffset:[-19,-1.5,-2.5],radius:5},{partId:"engine",posOffset:[11,-1.5,4.5],radius:5},{partId:"engine",posOffset:[-11,-1.5,4.5],radius:5},{partId:"wing",posOffset:[12,.5,-2],radius:5},{partId:"wing",posOffset:[-12,.5,-2],radius:5},{partId:"wing",posOffset:[25,-1,-10.5],radius:5},{partId:"wing",posOffset:[-25,-1,-10.5],radius:5}],physicalRadius:50,keyBindings:n.KEY_BINDINGS.plane,gooProjectUrl:n.GOO_PROJECTS.stratofortress.projectPath,piecePath:n.GOO_PROJECTS.stratofortress.b_52,uiPages:["UI_TUNNAN","UI_AIR_PARAMS","UI_BOTTOM_BAR"],wing_smoke:[[-19,-2,-5],[19,-2,-5],[-10.5,-1.4,1.5],[10.5,-1.4,1.5]],instruments:{},measurements:{throttle:1,speed:1,altitude:1,airflowx:1,airflowy:1,airflowz:1,gForce:1},wings:{fuselageMid:{pos:[0,-0.9,2],size:[9,9,45],rot:[0,0,0],stallAngle:[.5,1,1],stallLiftCoeff:[5.5,0,0],formDragCoeff:.3},mainInnerRight:{pos:[12.3,.24,-0.41],size:[26,1,8],rot:[.02,.6,0],stallAngle:[.5,0,.2],stallLiftCoeff:[42,0,0],formDragCoeff:.4},mainInnerLeft:{pos:[-12.3,.24,-0.41],size:[26,1,8],rot:[.02,-0.6,0],stallAngle:[.5,0,.2],stallLiftCoeff:[42,0,0],formDragCoeff:.4},mainOuterRight:{pos:[27,.2,-11.8],size:[5.8,1.7,7],rot:[0,0,0],stallAngle:[.45,.3,.2],stallLiftCoeff:[42,0,0],formDragCoeff:.6},mainOuterLeft:{pos:[-27,.2,-11.8],size:[5.8,1.7,7],rot:[0,0,0],stallAngle:[.45,.3,.2],stallLiftCoeff:[42,0,0],formDragCoeff:.6},flapRight:{controls:{flaps:[-1.1,0,0]},pos:[15.6,.5,.05],size:[12.8,.1,4.4],rot:[0,0,0],stallAngle:[1.2,.7,.2],stallLiftCoeff:[42,0,0],formDragCoeff:.2},flapLeft:{controls:{flaps:[-1.1,0,0]},pos:[-15.6,.5,.05],size:[12.8,.1,4.4],rot:[0,0,0],stallAngle:[1.2,.7,.2],stallLiftCoeff:[42,0,0],formDragCoeff:.2},aeilronRight:{controls:{aeilrons:[.3,0,0]},pos:[18,.15,-8.8],size:[8,.05,1.5],rot:[0,0,0],stallAngle:[.4,.4,.2],stallLiftCoeff:[5,0,0],formDragCoeff:.002},aeilronLeft:{controls:{aeilrons:[-0.3,0,0]},pos:[-18,.15,-8.8],size:[8,.05,1.5],rot:[0,0,0],stallAngle:[.4,.4,.2],stallLiftCoeff:[5,0,0],formDragCoeff:.002},tailplane:{pos:[0,1.1,-20.8],size:[14,.4,4.2],rot:[-0.04,0,0],stallAngle:[1.5,.4,.3],stallLiftCoeff:[42,0,0],formDragCoeff:.001},elevator:{controls:{elevator:[.8,0,0]},pos:[0,1.1,-22.8],size:[14,.04,1.2],rot:[0,0,0],stallAngle:[1.5,.4,.3],stallLiftCoeff:[32,0,0],formDragCoeff:.001},rudder:{controls:{rudder:[-0.4,0,0]},pos:[0,3.9,-23.3],size:[5,.01,1],rot:[0,0,-Math.PI/2],stallAngle:[1.45,.5,1],stallLiftCoeff:[22,0,0],formDragCoeff:.01},stabiliser:{pos:[0,1.3,-15.3],size:[5.2,.1,4.1],rot:[0,0,-Math.PI/2],stallAngle:[.7,.4,1],stallLiftCoeff:[22,0,0],formDragCoeff:.01}},surfaces:{elevator:{inputBehavior:{release:1,speed:.1},controls:{elevator:{elevator_r:-0.6,elevator_l:.6}},speed:.03},aeilrons:{inputBehavior:{release:1,speed:.1},controls:{aeilrons:{aeilron_r:.5,aeilron_l:.5}},speed:.03},rudder:{inputBehavior:{release:1,speed:.1},controls:{rudder:{rudder:-0.8}},speed:.02},flaps:{inputBehavior:{release:0,speed:.1},controls:{flaps:{flap_r_in:1.1,flap_l_in:-1.1,flap_r_out:1.1,flap_l_out:-1.1}},speed:.005}},systems:{auto_trim:{inputBehavior:{type:"toggle",speed:1},speed:1},engines:{inputBehavior:{type:"slide",speed:.1},controls:{throttle:{throttle:.8}},mounts:[{maxThrust:15e4,jet_flame:r.GOO_PARTICLES.basic_jet,jet_smoke:r.GOO_PARTICLES.jet_smoke,posOffset:[-19,-1.4,-5]},{maxThrust:15e4,jet_flame:r.GOO_PARTICLES.basic_jet,jet_smoke:r.GOO_PARTICLES.jet_smoke,posOffset:[19,-1.4,-5]},{maxThrust:15e4,jet_flame:r.GOO_PARTICLES.basic_jet,jet_smoke:r.GOO_PARTICLES.jet_smoke,posOffset:[-10.5,-1,1.5]},{maxThrust:15e4,jet_flame:r.GOO_PARTICLES.basic_jet,jet_smoke:r.GOO_PARTICLES.jet_smoke,posOffset:[10.5,-1,1.5]}],speed:.005}}},BLACKBIRD:{modelPath:"blackbird",dimensions:{massEmpty:30845,massMax:58375,weightDistribution:[2,2,2],length:11,wingspan:10.23,wingAngle:.2,height:3.75},forcePoints:{weight:[0,0,0],thrust:[0,-0.5,-5],wingLiftLeft:[3,1,-2],wingLiftRight:[-3,2,-2],elevatorLift:[0,2,-7.5],rudderYaw:[0,3,-7]},wings:{fuselage:{pos:[0,-0.04,5.1],size:[1.7,1.5,29],rot:[0,0,0],stallAngle:[.6,1,1],stallLiftCoeff:[.01,0,0],formDragCoeff:2e-4},fuselageWing:{pos:[0,-0.04,6.1],size:[3.2,.02,29],rot:[.0031,0,0],stallAngle:[.6,1,1],stallLiftCoeff:[4,0,0],formDragCoeff:.001},mainInnerRight:{pos:[3.1,-0.24,-1.41],size:[13.5,.02,4.6],rot:[.004,1.02,0],stallAngle:[.3,.5,.2],stallLiftCoeff:[12,0,0],formDragCoeff:.001},mainInnerLeft:{pos:[-3.1,-0.24,-1.41],size:[13.5,.02,4.6],rot:[.004,-1.02,0],stallAngle:[.3,.5,.2],stallLiftCoeff:[12,0,0],formDragCoeff:.001},mainEngineRight:{pos:[4.4,.2,-2],size:[1.9,1.9,11.4],rot:[.002,0,0],stallAngle:[.15,.3,.2],stallLiftCoeff:[1,0,0],formDragCoeff:.001},mainEngineLeft:{pos:[-4.4,.2,-2],size:[1.9,1.9,11.4],rot:[.002,0,0],stallAngle:[.15,.3,.2],stallLiftCoeff:[1,0,0],formDragCoeff:.001},flapRight:{controls:{elevator:[.08,0,0]},pos:[2.3,-0.15,-8.3],size:[2.4,.05,1.5],rot:[.005,-0.4,0],stallAngle:[.6,.7,.2],stallLiftCoeff:[8,0,0],formDragCoeff:.001},flapLeft:{controls:{elevator:[.08,0,0]},pos:[-2.3,-0.15,-8.3],size:[2.4,.05,1.5],rot:[.005,.4,0],stallAngle:[.6,.7,.2],stallLiftCoeff:[8,0,0],formDragCoeff:.001},aeilronRight:{controls:{aeilrons:[.1,0,0]},pos:[7,-0.15,-7.2],size:[3.3,.05,1],rot:[0,-0.4,0],stallAngle:[.6,.4,.2],stallLiftCoeff:[6,0,0],formDragCoeff:.001},aeilronLeft:{controls:{aeilrons:[-0.1,0,0]},pos:[-7,-0.15,-7.2],size:[3.3,.05,1],rot:[0,.4,0],stallAngle:[.6,.4,.2],stallLiftCoeff:[6,0,0],formDragCoeff:.001},rudderR:{controls:{rudder:[.1,0,0]},pos:[3.8,2.7,-6.8],size:[2.4,.1,3.8],rot:[0,0,0-Math.PI/2],stallAngle:[.4,.5,1],stallLiftCoeff:[12,0,0],formDragCoeff:.001},rudderL:{controls:{rudder:[.1,0,0]},pos:[-3.8,2.7,-6.8],size:[2.4,.1,3.8],rot:[0,0,0+Math.PI/2],stallAngle:[.4,.4,1],stallLiftCoeff:[4,0,0],formDragCoeff:.001}},modelDefinition:r.GOO_MODELS.tunnan,uiPage:"UI_TUNNAN",elevator:{inputBehavior:{type:"slide",speed:.1},controls:{elevator:{elevator:.6}},speed:.1},aeilrons:{inputBehavior:{type:"slide",speed:.1},controls:{aeilrons:{rightAeilron:.8,leftAeilron:.8}},speed:.07},rudder:{inputBehavior:{type:"slide",speed:.1},controls:{rudder:{rudder:-0.7}},speed:.06},flaps:{inputBehavior:{type:"toggle",speed:1},controls:{flaps:{rightFlap:1.1,leftFlap:-1.1}},speed:.01},gears:{inputBehavior:{type:"toggle",speed:1},controls:{doors:{noseGearDoorRight:-1.4,noseGearDoorLeft:1.4,leftGearDoor:1.2,rightGearDoor:-1.2},stands:{noseGear:-1.4,rightGear:-2,leftGear:2}},wheels:{noseWheel:-0.8,rightWheel:1,leftWheel:-1},speed:.01},canopy:{inputBehavior:{type:"button",speed:1},type:"slide",controls:{doors:{canopy:[-0.15,0,-0.8]}},speed:.01},seat:{inputBehavior:{type:"button",speed:1},type:"ejection",controls:{seats:{seat:[-2.15,0,-0.5]}},speed:.4},engines:{inputBehavior:{type:"slide",speed:.1},modelDefinition:r.GOO_PARTICLES.wing_smoke,controls:{jet:{flame:1}},mounts:[{maxThrust:6e5}],speed:.01},boneMap:{canopy:"bone4",noseGearRoot:"bone14",noseGear:"bone15",noseWheel:"bone16",noseGearDoorRight:"bone17",noseGearDoorLeft:"bone18",rightAeilron:"bone19",rightFlap:"bone20",leftFlap:"bone21",leftAeilron:"bone22",seat:"bone23",elevator:"bone30",rudder:"bone29",rightGearRoot:"bone6",rightGear:"bone7",rightWheel:"bone8",rightGearDoor:"bone9",leftGearRoot:"bone10",leftGearDoor:"bone11",leftGear:"bone12",leftWheel:"bone13"}}}}),define("game/characters/CharacterData",["game/GameConfiguration","game/ModelDefinitions","game/weapons/WeaponData"],function(e,t,n){var r={movement:{idle:"idle",turnLeft:"turnLeft",turnRight:"turnRight",strafeRight:"strafeRight",strafeLeft:"strafeLeft",forward:"forward",back:"back",halfStrafeRight:"halfStrafeRight",halfStrafeLeft:"halfStrafeLeft",backRight:"backRight",backLeft:"backLeft",jumpState:"jumpState"},seated:{pilotSit:"pilotSit",sit:"sit"}};return{ANIM_STATES:r,PILOT:{modelPath:"pilot",dimensions:{massEmpty:2,height:1.75,mobRadius:.7,weightDistribution:[1,1,1]},hitPoints:300,physicalShapes:[{partId:"body",posOffset:[0,1,0],radius:1}],physicalRadius:5,keyBindings:e.KEY_BINDINGS.move,uiPages:["UI_PILOT","UI_BOTTOM_BAR"],wings:{body:{pos:[0,2,0],size:[.6,1.9,.6],rot:[0,0,0],stallAngle:[1,1,1],stallLiftCoeff:[1,1,1],formDragCoeff:.21}},gooProject:e.GOO_PROJECTS.human,piecePath:e.GOO_PROJECTS.human.pilot,instruments:{},measurements:{},animations:{moveStates:{idle:"idle",forward:"run",back:"backwards",backLeft:"back_left",backRight:"back_right",turnLeft:"turn_left",turnRight:"turn_right",strafeLeft:"strafe_left",strafeRight:"strafe_right",halfStrafeLeft:"half_strafe_left",halfStrafeRight:"half_strafe_right",jumpState:"jumpstate"},seated:{pilotSit:"pilot_sit",sit:"sit"}}}}}),define("load/ClientLoader",["application/EventManager","sound/SoundManager","template/TemplateLoader","load/TrackProgress","game/GameConfiguration","game/ships/BoatData","game/cars/CarData","game/piece/TargetData","game/planes/PlaneData","game/characters/CharacterData","game/world/ZoneData"],function(e,t,n,r,i,s,o,u,a,f,l){function N(e){p.push(e)}function C(e){for(var t in e)N(e[t])}function L(e){r.loadingProgress(1,0,0,e.gooProject.refFile);var t=function(){r.loadingProgress(0,1,0,e.gooProject.refFile)};w(e.gooProject.projectPath,e.gooProject.refFile,t)}function A(e){L(a[e])}function O(){N(i.GOO_PROJECTS.bullet_20),N(i.GOO_PROJECTS.environment)}function M(e){for(var t=0;t<e.length;t++)for(var n=0;n<e[t].length;n++){var r=e[t][n];if(r.boats)for(var i in r.boats)L(s[i]);if(r.targets)for(var i in r.targets)L(u[i]);if(r.planes)for(var i in r.planes)L(a[i])}}function _(e){for(var t=0;t<e.length;t++);}function D(e){for(var t=0;t<e.length;t++);}function P(e,t){console.log("Load Scenario: ",e),r.showLoadingScreen(e.IDENTITY),O(),e.loadLevels&&D(e.loadLevels),e.playerVehicle&&A(e.playerVehicle),e.playerCharacter&&L(f[e.playerCharacter]),e.loadVehicles&&M(e.loadVehicles),C(e.loadProjects),S(t)}var c=function(){};c.prototype.loadScenarioData=function(){},c.prototype.getLoadedImageByUrl=function(){},c.prototype.preloadClientData=function(e){return g(e)},c.prototype.loadData=function(){},c.prototype.clientLoaded=function(){return m()},c.prototype.getLoadedCount=function(){},c.prototype.getCachedImage=function(){};var h={},p=[],d=function(e){return h[e]},v=function(e){return h[e]},m=function(){console.log("Remove Loading Screen"),r.removeLoadingScreen(),t.initFx()},g=function(e){r.showLoadingScreen(e),n.fetchTemplates(),y(),t.initSounds(),t.loadSounds()},y=function(){console.log("Load Images");for(var e in i.PRELOAD_GOO_TEXTURES){var t=new Image;t.src=i.PRELOAD_GOO_TEXTURES[e],h[i.PRELOAD_GOO_TEXTURES[e]]=t,r.loadingProgress(1,0,0,t.src),t.onload=function(){r.loadingProgress(0,1,0,t.src)}}for(var n=0;n<i.PRELOAD_IMAGES.length;n++){var t=new Image;t.src=i.PRELOAD_IMAGES[n],h[i.PRELOAD_IMAGES[n]]=t,r.loadingProgress(1,0,0,t.src),t.onload=function(){r.loadingProgress(0,1,0,t.src)}}},b=0,w=function(t,n,r){e.fireEvent(e.list().LOAD_GOO_PROJECT,{projectPath:t,refFile:n,callback:r})},E=function(t){var n=0,s=function(e){r.loadingProgress(0,1,0,"load_mesh_data")},o=function(e,n,i){if(!a.length)var o=function(e){r.loadingProgress(0,1,0,"load_ref_"+n),s(e),b==0&&t(e),b-=1};else var o=function(){r.loadingProgress(0,1,0,"load_ref_"+n),b-=1,u()};setTimeout(function(){r.loadingProgress(1,0,0,"load_ref_"+n),w(e,n,o)},i)},u=function(){var e=a.shift();console.log("next",b,e,a),o(p[e].projectPath,p[e].refFile,20)},a=[];r.loadingProgress(1,0,0,"load_sequence");for(var f in p)b+=1,a.push(f),console.log("Load Goo Project: ",f);setTimeout(function(){u()},30);for(var l in i.PRELOAD_GOO_TEXTURES){var c=function(e){console.log("Loaded: ",e),r.loadingProgress(0,1,0,"preload_tx_"+l)};r.loadingProgress(1,0,0,"preload_tx_"+l),e.fireEvent(e.list().LOAD_GOO_TEXTURE,{textureUrl:i.PRELOAD_GOO_TEXTURES[l],callback:c})}},S=function(t){E(t),e.fireEvent(e.list().LOAD_3D,{}),r.loadingProgress(1,0,0,"load_mesh_data")},x=function(){r.loadingProgress(0,1,0,"load_sequence")},T=function(){return r.getLoadedCount()},k=function(e,t){for(var n in t)for(var r=0;r<t[n].length;r++)var i=a[n]};return e.registerListener(e.list().ENINGE_READY,x),{ClientLoader:c,loadScenarioData:P,getLoadedImageByUrl:v,preloadClientData:g,loadData:S,clientLoaded:m,getLoadedCount:T,getCachedImage:d}}),function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},q={}.hasOwnProperty,R=function(e,t){function r(){this.constructor=e}for(var n in t)q.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};w=function(e){return function(t){return function(){return e.apply(this,arguments),t.apply(this,arguments)}}},b=function(e){return function(t){return function(){return t.apply(this,arguments),e.apply(this,arguments)}}},E=b(function(){return this}),B=function(e){if(typeof jQuery!="undefined"&&jQuery!==null||typeof Zepto!="undefined"&&Zepto!==null)return function(t){return e(arguments)}(jQuery||Zepto)},C=function(e){var t,n;n=[],t=e.firstChild;while(t)n.push(t),t=t.nextSibling;return n},k=function(e){var t;return t=[],F(e,t),t},F=function(e,t){var n,r;n=e.firstChild,r=[];while(n)n.nodeType===o&&(t.push(new a.createElement(n)),F(n,t)),r.push(n=n.nextSibling);return r},o=1,d=3,L=function(){return document.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>"},S=typeof document=="undefined"||document===null||L()?function(e){return e.cloneNode(!0)}:function(e){var t,n,r,i,s;t=g.clone(e);if(t.nodeType===o){t.removeAttribute(N),s=t.getElementsByTagName("*");for(r=0,i=s.length;r<i;r++)n=s[r],n.removeAttribute(N)}return t},N="transparency",T=function(e){return e[N]||(e[N]={})},H=function(){},x=function(){return console.log(arguments)},P=H,j=Object.prototype.toString,A=Array.isArray||function(e){return j.call(e)==="[object Array]"},M=function(e){return j.call(e)==="[object Date]"},_=function(e){return e.nodeType===o},D=function(e){var t;return t=typeof e,t!=="object"&&t!=="function"||M(e)},O=function(e){return e===!0||e===!1},g=this.Transparency={},g.render=function(e,t,n,r){var i;t==null&&(t=[]),n==null&&(n={}),r==null&&(r={}),P=r.debug&&console?x:H,P("Transparency.render:",e,t,n,r);if(!e)return;return A(t)||(t=[t]),e=(i=T(e)).context||(i.context=new s(e)),e.render(t,n,r).el},g.jQueryPlugin=E(function(e,t,n){var r,i,s,o;o=[];for(i=0,s=this.length;i<s;i++)r=this[i],o.push(g.render(r,e,t,n));return o}),g.matcher=function(e,t){return e.el.id===t||I.call(e.classNames,t)>=0||e.el.name===t||e.el.getAttribute("data-bind")===t},g.clone=B(function(){return function(e){return $(e).clone()[0]}}),B(function(){return $.fn.render=g.jQueryPlugin}),(typeof define!="undefined"&&define!==null?define.amd:void 0)&&define("lib/transparency",[],function(){return g}),s=function(){function n(e){this.el=e,this.template=S(this.el),this.instances=[new c(this.el)],this.instanceCache=[]}var e,t;return t=E(function(){this.parent=this.el.parentNode;if(this.parent)return this.nextSibling=this.el.nextSibling,this.parent.removeChild(this.el)}),e=E(function(){if(this.parent)return this.nextSibling?this.parent.insertBefore(this.el,this.nextSibling):this.parent.appendChild(this.el)}),n.prototype.render=w(t)(b(e)(E(function(e,t,n){var r,i,s,o,u,a,f;while(e.length<this.instances.length)this.instanceCache.push(this.instances.pop().remove());while(e.length>this.instances.length)s=this.instanceCache.pop()||new c(S(this.template)),this.instances.push(s.appendTo(this.el));f=[];for(i=u=0,a=e.length;u<a;i=++u)o=e[i],s=this.instances[i],r=[],f.push(s.prepare(o,r).renderValues(o,r).renderDirectives(o,i,t).renderChildren(o,r,t,n));return f}))),n}(),c=function(){function e(e){this.queryCache={},this.childNodes=C(e),this.elements=k(e)}return e.prototype.remove=E(function(){var e,t,n,r,i;r=this.childNodes,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.parentNode.removeChild(e));return i}),e.prototype.appendTo=E(function(e){var t,n,r,i,s;i=this.childNodes,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],s.push(e.appendChild(t));return s}),e.prototype.prepare=E(function(e){var t,n,r,i,s;i=this.elements,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],t.reset(),s.push(T(t.el).model=e);return s}),e.prototype.renderValues=E(function(e,t){var n,r,i,s;if(_(e)&&(n=this.elements[0]))return n.empty().el.appendChild(e);if(typeof e=="object"){s=[];for(r in e){if(!q.call(e,r))continue;i=e[r],i!=null&&(D(i)?s.push(function(){var e,t,s,o;s=this.matchingElements(r),o=[];for(e=0,t=s.length;e<t;e++)n=s[e],o.push(n.render(i));return o}.call(this)):typeof i=="object"?s.push(t.push(r)):s.push(void 0))}return s}}),e.prototype.renderDirectives=E(function(e,t,n){var r,i,s,o;o=[];for(s in n){if(!q.call(n,s))continue;r=n[s];if(typeof r!="object")continue;typeof e!="object"&&(e={value:e}),o.push(function(){var n,o,u,a;u=this.matchingElements(s),a=[];for(n=0,o=u.length;n<o;n++)i=u[n],a.push(i.renderDirectives(e,t,r));return a}.call(this))}return o}),e.prototype.renderChildren=E(function(e,t,n,r){var i,s,o,u,a;a=[];for(o=0,u=t.length;o<u;o++)s=t[o],a.push(function(){var t,o,u,a;u=this.matchingElements(s),a=[];for(t=0,o=u.length;t<o;t++)i=u[t],a.push(g.render(i.el,e[s],n[s],r));return a}.call(this));return a}),e.prototype.matchingElements=function(e){var t,n,r;return n=(r=this.queryCache)[e]||(r[e]=function(){var n,r,i,s;i=this.elements,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],g.matcher(t,e)&&s.push(t);return s}.call(this)),P("Matching elements for '"+e+"':",n),n},e}(),t={Attributes:{},createAttribute:function(n,r){var i;return i=t.Attributes[r]||e,new i(n,r)}},e=function(){function e(e,t){this.el=e,this.name=t,this.templateValue=this.el.getAttribute(this.name)||""}return e.prototype.set=function(e){return this.el[this.name]=e,this.el.setAttribute(this.name,e.toString())},e}(),n=function(e){function o(e,t){this.el=e,this.name=t,this.templateValue=this.el.getAttribute(this.name)||!1}var n,r,i,s;R(o,e),n=["hidden","async","defer","autofocus","formnovalidate","disabled","autofocus","formnovalidate","multiple","readonly","required","checked","scoped","reversed","selected","loop","muted","autoplay","controls","seamless","default","ismap","novalidate","open","typemustmatch","truespeed"];for(i=0,s=n.length;i<s;i++)r=n[i],t.Attributes[r]=o;return o.prototype.set=function(e){return this.el[this.name]=e,e?this.el.setAttribute(this.name,this.name):this.el.removeAttribute(this.name)},o}(e),v=function(e){function n(e,t){var n;this.el=e,this.name=t,this.templateValue=function(){var e,t,r,i;r=C(this.el),i=[];for(e=0,t=r.length;e<t;e++)n=r[e],n.nodeType===d&&i.push(n.nodeValue);return i}.call(this).join(""),(this.textNode=this.el.firstChild)?this.textNode.nodeType!==d&&(this.textNode=this.el.insertBefore(this.el.ownerDocument.createTextNode(""),this.textNode)):this.el.appendChild(this.textNode=this.el.ownerDocument.createTextNode(""))}return R(n,e),t.Attributes.text=n,n.prototype.set=function(e){return this.textNode.nodeValue=e},n}(e),f=function(e){function n(e){n.__super__.constructor.call(this,e,"innerHTML"),this.children=Array.prototype.slice.call(this.el.children)}return R(n,e),t.Attributes.html=n,n.prototype.set=function(e){var t,n,r,i,s;this.el.innerHTML=e,i=this.children,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],s.push(this.el.appendChild(t));return s},n}(e),i=function(e){function n(e){n.__super__.constructor.call(this,e,"class")}return R(n,e),t.Attributes["class"]=n,n}(e),a={Elements:{input:{}},createElement:function(e){var t,n;return"input"===(n=e.nodeName.toLowerCase())?t=a.Elements[n][e.type.toLowerCase()]||l:t=a.Elements[n]||u,new t(e)}},u=function(){function e(e){this.el=e,this.attributes={},this.childNodes=C(this.el),this.nodeName=this.el.nodeName.toLowerCase(),this.classNames=this.el.className.split(" "),this.originalAttributes={}}return e.prototype.empty=E(function(){var e,t;t=[];while(e=this.el.firstChild)t.push(this.el.removeChild(e));return t}),e.prototype.reset=function(){var e,t,n,r;n=this.attributes,r=[];for(t in n)e=n[t],r.push(e.set(e.templateValue));return r},e.prototype.render=function(e){return this.attr("text",e)},e.prototype.attr=function(e,n){var r,i;return r=(i=this.attributes)[e]||(i[e]=t.createAttribute(this.el,e,n)),n!=null&&r.set(n),r},e.prototype.renderDirectives=function(e,t,n){var r,i,s,o;o=[];for(i in n){if(!q.call(n,i))continue;r=n[i];if(typeof r!="function")continue;s=r.call(e,{element:this.el,index:t,value:this.attr(i).templateValue}),s!=null?o.push(this.attr(i,s)):o.push(void 0)}return o},e}(),p=function(e){function t(e){t.__super__.constructor.call(this,e),this.elements=k(e)}return R(t,e),a.Elements.select=t,t.prototype.render=function(e){var t,n,r,i,s;e=e.toString(),i=this.elements,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],t.nodeName==="option"&&s.push(t.attr("selected",t.el.value===e));return s},t}(u),y=function(e){function s(){return s.__super__.constructor.apply(this,arguments)}var t,n,r,i;R(s,e),t=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"];for(r=0,i=t.length;r<i;r++)n=t[r],a.Elements[n]=s;return s.prototype.attr=function(e,t){if(e!=="text"&&e!=="html")return s.__super__.attr.call(this,e,t)},s}(u),l=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return R(t,e),t.prototype.render=function(e){return this.attr("value",e)},t}(y),m=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return R(t,e),a.Elements.textarea=t,t}(l),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return R(t,e),a.Elements.input.checkbox=t,t.prototype.render=function(e){return this.attr("checked",Boolean(e))},t}(l),h=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return R(t,e),a.Elements.input.radio=t,t}(r)}.call(this),define("template/TemplateRenderer",["lib/transparency"],function(e){var t=function(t,n,r){setTimeout(function(){e.render(t,n,r)},0)},n=function(e,n,r,i){e.innerHTML=n.html,t(e,r,i)};return{renderTemplate:n}}),(window._gsQueue||(window._gsQueue=[])).push(function(){window._gsDefine("TweenMax",["core.Animation","core.SimpleTimeline","TweenLite"],function(e,t,n){var r=function(e,t,r){n.call(this,e,t,r),this._cycle=0,this._yoyo=this.vars.yoyo===!0,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._dirty=!0},i=function(e){return e.jquery||"function"==typeof e.each&&e[0]&&e[0].nodeType&&e[0].style},s=function(e){var t=[];return e.each(function(){t.push(this)}),t},o=r.prototype=n.to({},.1,{}),u=[];r.version="1.9.0",o.constructor=r,o.kill()._gc=!1,r.killTweensOf=r.killDelayedCallsTo=n.killTweensOf,r.getTweensOf=n.getTweensOf,r.ticker=n.ticker,o.invalidate=function(){return this._yoyo=this.vars.yoyo===!0,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._uncache(!0),n.prototype.invalidate.call(this)},o.updateTo=function(e,t){var r,i=this.ratio;t&&null!=this.timeline&&this._startTime<this._timeline._time&&(this._startTime=this._timeline._time,this._uncache(!1),this._gc?this._enabled(!0,!1):this._timeline.insert(this,this._startTime-this._delay));for(r in e)this.vars[r]=e[r];if(this._initted)if(t)this._initted=!1;else if(this._notifyPluginsOfEnabled&&this._firstPT&&n._onPluginEvent("_onDisable",this),this._time/this._duration>.998){var s=this._time;this.render(0,!0,!1),this._initted=!1,this.render(s,!0,!1)}else if(this._time>0){this._initted=!1,this._init();for(var o,u=1/(1-i),a=this._firstPT;a;)o=a.s+a.c,a.c*=u,a.s=o-a.c,a=a._next}return this},o.render=function(e,t,n){var r,i,s,o=this._dirty?this.totalDuration():this._totalDuration,a=this._time,f=this._totalTime,l=this._cycle;if(e>=o)this._totalTime=o,this._cycle=this._repeat,this._yoyo&&0!==(1&this._cycle)?(this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0):(this._time=this._duration,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1),this._reversed||(r=!0,i="onComplete"),0===this._duration&&((0===e||0>this._rawPrevTime)&&this._rawPrevTime!==e&&(n=!0),this._rawPrevTime=e);else if(0>=e)this._totalTime=this._time=this._cycle=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==f||0===this._duration&&this._rawPrevTime>0)&&(i="onReverseComplete",r=this._reversed),0>e?(this._active=!1,0===this._duration&&(this._rawPrevTime>=0&&(n=!0),this._rawPrevTime=e)):this._initted||(n=!0);else{if(this._totalTime=this._time=e,0!==this._repeat){var c=this._duration+this._repeatDelay;this._cycle=this._totalTime/c>>0,0!==this._cycle&&this._cycle===this._totalTime/c&&this._cycle--,this._time=this._totalTime-this._cycle*c,this._yoyo&&0!==(1&this._cycle)&&(this._time=this._duration-this._time),this._time>this._duration?this._time=this._duration:0>this._time&&(this._time=0)}if(this._easeType){var p=this._time/this._duration,d=this._easeType,v=this._easePower;(1===d||3===d&&p>=.5)&&(p=1-p),3===d&&(p*=2),1===v?p*=p:2===v?p*=p*p:3===v?p*=p*p*p:4===v&&(p*=p*p*p*p),this.ratio=1===d?1-p:2===d?p:.5>this._time/this._duration?p/2:1-p/2}else this.ratio=this._ease.getRatio(this._time/this._duration)}if(a===this._time&&!n)return f!==this._totalTime&&this._onUpdate&&(t||this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||u)),void 0;for(this._initted||(this._init(),!r&&this._time&&(this.ratio=this._ease.getRatio(this._time/this._duration))),this._active||this._paused||(this._active=!0),0===f&&(this._startAt&&this._startAt.render(e,t,n),this.vars.onStart&&(0!==this._totalTime||0===this._duration)&&(t||this.vars.onStart.apply(this.vars.onStartScope||this,this.vars.onStartParams||u))),s=this._firstPT;s;)s.f?s.t[s.p](s.c*this.ratio+s.s):s.t[s.p]=s.c*this.ratio+s.s,s=s._next;this._onUpdate&&(0>e&&this._startAt&&this._startAt.render(e,t,n),t||this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||u)),this._cycle!==l&&(t||this._gc||this.vars.onRepeat&&this.vars.onRepeat.apply(this.vars.onRepeatScope||this,this.vars.onRepeatParams||u)),i&&(this._gc||(0>e&&this._startAt&&(this._onUpdate||this._startAt.render(e,t,n)),r&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),t||this.vars[i]&&this.vars[i].apply(this.vars[i+"Scope"]||this,this.vars[i+"Params"]||u)))},r.to=function(e,t,n){return new r(e,t,n)},r.from=function(e,t,n){return n.runBackwards=!0,n.immediateRender!==!1&&(n.immediateRender=!0),new r(e,t,n)},r.fromTo=function(e,t,n,i){return i.startAt=n,i.immediateRender=0!=i.immediateRender&&0!=n.immediateRender,new r(e,t,i)},r.staggerTo=r.allTo=function(e,t,o,u,a,f,l){u=u||0;var h,p,v,m,g=o.delay||0,y=[];for(e instanceof Array||("string"==typeof e&&(e=n.selector(e)||e),i(e)&&(e=s(e))),h=e.length,v=0;h>v;v++){p={};for(m in o)p[m]=o[m];p.delay=g,v===h-1&&a&&(p.onComplete=function(){o.onComplete&&o.onComplete.apply(o.onCompleteScope,o.onCompleteParams),a.apply(l,f)}),y[v]=new r(e[v],t,p),g+=u}return y},r.staggerFrom=r.allFrom=function(e,t,n,i,s,o,u){return n.runBackwards=!0,0!=n.immediateRender&&(n.immediateRender=!0),r.staggerTo(e,t,n,i,s,o,u)},r.staggerFromTo=r.allFromTo=function(e,t,n,i,s,o,u,a){return i.startAt=n,i.immediateRender=0!=i.immediateRender&&0!=n.immediateRender,r.staggerTo(e,t,i,s,o,u,a)},r.delayedCall=function(e,t,n,i,s){return new r(t,0,{delay:e,onComplete:t,onCompleteParams:n,onCompleteScope:i,onReverseComplete:t,onReverseCompleteParams:n,onReverseCompleteScope:i,immediateRender:!1,useFrames:s,overwrite:0})},r.set=function(e,t){return new r(e,0,t)},r.isTweening=function(e){for(var t,r=n.getTweensOf(e),i=r.length;--i>-1;)if((t=r[i])._active||t._startTime===t.timeline._time&&t.timeline._active)return!0;return!1};var a=function(e,t){for(var r=[],i=0,s=e._first;s;)s instanceof n?r[i++]=s:(t&&(r[i++]=s),r=r.concat(a(s,t)),i=r.length),s=s._next;return r},f=r.getAllTweens=function(t){var n=a(e._rootTimeline,t);return n.concat(a(e._rootFramesTimeline,t))};r.killAll=function(e,n,r,i){null==n&&(n=!0),null==r&&(r=!0);var s,o,u,a=f(0!=i),l=a.length,c=n&&r&&i;for(u=0;l>u;u++)o=a[u],(c||o instanceof t||(s=o.target===o.vars.onComplete)&&r||n&&!s)&&(e?o.totalTime(o.totalDuration()):o._enabled(!1,!1))},r.killChildTweensOf=function(e,t){if(null!=e){var o,u,a,f,l,h=n._tweenLookup;if("string"==typeof e&&(e=n.selector(e)||e),i(e)&&(e=s(e)),e instanceof Array)for(f=e.length;--f>-1;)r.killChildTweensOf(e[f],t);else{o=[];for(a in h)for(u=h[a].target.parentNode;u;)u===e&&(o=o.concat(h[a].tweens)),u=u.parentNode;for(l=o.length,f=0;l>f;f++)t&&o[f].totalTime(o[f].totalDuration()),o[f]._enabled(!1,!1)}}};var l=function(e,n,r,i){void 0===n&&(n=!0),void 0===r&&(r=!0);for(var s,o,u=f(i),a=n&&r&&i,l=u.length;--l>-1;)o=u[l],(a||o instanceof t||(s=o.target===o.vars.onComplete)&&r||n&&!s)&&o.paused(e)};return r.pauseAll=function(e,t,n){l(!0,e,t,n)},r.resumeAll=function(e,t,n){l(!1,e,t,n)},o.progress=function(e){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&0!==(1&this._cycle)?1-e:e)+this._cycle*(this._duration+this._repeatDelay),!1):this._time/this.duration()},o.totalProgress=function(e){return arguments.length?this.totalTime(this.totalDuration()*e,!1):this._totalTime/this.totalDuration()},o.time=function(e,t){return arguments.length?(this._dirty&&this.totalDuration(),e>this._duration&&(e=this._duration),this._yoyo&&0!==(1&this._cycle)?e=this._duration-e+this._cycle*(this._duration+this._repeatDelay):0!==this._repeat&&(e+=this._cycle*(this._duration+this._repeatDelay)),this.totalTime(e,t)):this._time},o.duration=function(t){return arguments.length?e.prototype.duration.call(this,t):this._duration},o.totalDuration=function(e){return arguments.length?-1===this._repeat?this:this.duration((e-this._repeat*this._repeatDelay)/(this._repeat+1)):(this._dirty&&(this._totalDuration=-1===this._repeat?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat,this._dirty=!1),this._totalDuration)},o.repeat=function(e){return arguments.length?(this._repeat=e,this._uncache(!0)):this._repeat},o.repeatDelay=function(e){return arguments.length?(this._repeatDelay=e,this._uncache(!0)):this._repeatDelay},o.yoyo=function(e){return arguments.length?(this._yoyo=e,this):this._yoyo},r},!0),window._gsDefine("TimelineLite",["core.Animation","core.SimpleTimeline","TweenLite"],function(e,t,n){var r=function(e){t.call(this,e),this._labels={},this.autoRemoveChildren=this.vars.autoRemoveChildren===!0,this.smoothChildTiming=this.vars.smoothChildTiming===!0,this._sortChildren=!0,this._onUpdate=this.vars.onUpdate;for(var n,r,s=i.length;--s>-1;)if(r=this.vars[i[s]])for(n=r.length;--n>-1;)"{self}"===r[n]&&(r=this.vars[i[s]]=r.concat(),r[n]=this);this.vars.tweens instanceof Array&&this.add(this.vars.tweens,0,this.vars.align,this.vars.stagger)},i=["onStartParams","onUpdateParams","onCompleteParams","onReverseCompleteParams","onRepeatParams"],s=[],o=function(e){var t,n={};for(t in e)n[t]=e[t];return n},u=r.prototype=new t;return r.version="1.9.0",u.constructor=r,u.kill()._gc=!1,u.to=function(e,t,r,i){return this.add(new n(e,t,r),i)},u.from=function(e,t,r,i){return this.add(n.from(e,t,r),i)},u.fromTo=function(e,t,r,i,s){return this.add(n.fromTo(e,t,r,i),s)},u.staggerTo=function(e,t,i,s,u,a,f,l){var h,p,v=new r({onComplete:a,onCompleteParams:f,onCompleteScope:l});for("string"==typeof e&&(e=n.selector(e)||e),!(e instanceof Array)&&"function"==typeof e.each&&e[0]&&e[0].nodeType&&e[0].style&&(p=[],e.each(function(){p.push(this)}),e=p),s=s||0,h=0;e.length>h;h++)null!=i.startAt&&(i.startAt=o(i.startAt)),v.add(new n(e[h],t,o(i)),h*s);return this.add(v,u)},u.staggerFrom=function(e,t,n,r,i,s,o,u){return null==n.immediateRender&&(n.immediateRender=!0),n.runBackwards=!0,this.staggerTo(e,t,n,r,i,s,o,u)},u.staggerFromTo=function(e,t,n,r,i,s,o,u,a){return r.startAt=n,r.immediateRender=0!=r.immediateRender&&0!=n.immediateRender,this.staggerTo(e,t,r,i,s,o,u,a)},u.call=function(e,t,r,i){return this.add(n.delayedCall(0,e,t,r),i)},u.set=function(e,t,r){return r=this._parseTimeOrLabel(r,0,!0),null==t.immediateRender&&(t.immediateRender=r===this._time&&!this._paused),this.add(new n(e,0,t),r)},r.exportRoot=function(e,t){e=e||{},null==e.smoothChildTiming&&(e.smoothChildTiming=!0);var i,s,o=new r(e),u=o._timeline;for(null==t&&(t=!0),u._remove(o,!0),o._startTime=0,o._rawPrevTime=o._time=o._totalTime=u._time,i=u._first;i;)s=i._next,t&&i instanceof n&&i.target===i.vars.onComplete||o.add(i,i._startTime-i._delay),i=s;return u.add(o,0),o},u.add=function(i,s,o,u){var f,l,h,p,v;if("number"!=typeof s&&(s=this._parseTimeOrLabel(s,0,!0,i)),!(i instanceof e)){if(i instanceof Array){for(o=o||"normal",u=u||0,f=s,l=i.length,h=0;l>h;h++)(p=i[h])instanceof Array&&(p=new r({tweens:p})),this.add(p,f),"string"!=typeof p&&"function"!=typeof p&&("sequence"===o?f=p._startTime+p.totalDuration()/p._timeScale:"start"===o&&(p._startTime-=p.delay())),f+=u;return this._uncache(!0)}if("string"==typeof i)return this.addLabel(i,s);if("function"!=typeof i)throw"Cannot add "+i+" into the TimelineLite/Max: it is neither a tween, timeline, function, nor a String.";i=n.delayedCall(0,i)}if(t.prototype.add.call(this,i,s),this._gc&&!this._paused&&this._time===this._duration&&this._time<this.duration())for(v=this;v._gc&&v._timeline;)v._timeline.smoothChildTiming?v.totalTime(v._totalTime,!0):v._enabled(!0,!1),v=v._timeline;return this},u.remove=function(t){if(t instanceof e)return this._remove(t,!1);if(t instanceof Array){for(var n=t.length;--n>-1;)this.remove(t[n]);return this}return"string"==typeof t?this.removeLabel(t):this.kill(null,t)},u.append=function(e,t){return this.add(e,this._parseTimeOrLabel(null,t,!0,e))},u.insert=u.insertMultiple=function(e,t,n,r){return this.add(e,t||0,n,r)},u.appendMultiple=function(e,t,n,r){return this.add(e,this._parseTimeOrLabel(null,t,!0,e),n,r)},u.addLabel=function(e,t){return this._labels[e]=this._parseTimeOrLabel(t),this},u.removeLabel=function(e){return delete this._labels[e],this},u.getLabelTime=function(e){return null!=this._labels[e]?this._labels[e]:-1},u._parseTimeOrLabel=function(t,n,r,i){var s;if(i instanceof e&&i.timeline===this)this.remove(i);else if(i instanceof Array)for(s=i.length;--s>-1;)i[s]instanceof e&&i[s].timeline===this&&this.remove(i[s]);if("string"==typeof n)return this._parseTimeOrLabel(n,r&&"number"==typeof t&&null==this._labels[n]?t-this.duration():0,r);if(n=n||0,"string"!=typeof t||!isNaN(t)&&null==this._labels[t])null==t&&(t=this.duration());else{if(s=t.indexOf("="),-1===s)return null==this._labels[t]?r?this._labels[t]=this.duration()+n:n:this._labels[t]+n;n=parseInt(t.charAt(s-1)+"1",10)*Number(t.substr(s+1)),t=s>1?this._parseTimeOrLabel(t.substr(0,s-1),0,r):this.duration()}return Number(t)+n},u.seek=function(e,t){return this.totalTime("number"==typeof e?e:this._parseTimeOrLabel(e),t!==!1)},u.stop=function(){return this.paused(!0)},u.gotoAndPlay=function(e,n){return t.prototype.play.call(this,e,n)},u.gotoAndStop=function(e,t){return this.pause(e,t)},u.render=function(e,t,n){this._gc&&this._enabled(!0,!1),this._active=!this._paused;var r,i,o,u,a=this._dirty?this.totalDuration():this._totalDuration,l=this._time,c=this._startTime,h=this._timeScale,p=this._paused;if(e>=a?(this._totalTime=this._time=a,this._reversed||this._hasPausedChild()||(i=!0,u="onComplete",0===this._duration&&(0===e||0>this._rawPrevTime)&&this._rawPrevTime!==e&&(n=!0)),this._rawPrevTime=e,e=a+1e-6):0>=e?(this._totalTime=this._time=0,(0!==l||0===this._duration&&this._rawPrevTime>0)&&(u="onReverseComplete",i=this._reversed),0>e?(this._active=!1,0===this._duration&&this._rawPrevTime>=0&&(n=!0)):this._initted||(n=!0),this._rawPrevTime=e,e=-0.000001):this._totalTime=this._time=this._rawPrevTime=e,this._time!==l||n){if(this._initted||(this._initted=!0),0===l&&this.vars.onStart&&0!==this._time&&(t||this.vars.onStart.apply(this.vars.onStartScope||this,this.vars.onStartParams||s)),this._time>l)for(r=this._first;r&&(o=r._next,!this._paused||p);)(r._active||r._startTime<=this._time&&!r._paused&&!r._gc)&&(r._reversed?r.render((r._dirty?r.totalDuration():r._totalDuration)-(e-r._startTime)*r._timeScale,t,n):r.render((e-r._startTime)*r._timeScale,t,n)),r=o;else for(r=this._last;r&&(o=r._prev,!this._paused||p);)(r._active||l>=r._startTime&&!r._paused&&!r._gc)&&(r._reversed?r.render((r._dirty?r.totalDuration():r._totalDuration)-(e-r._startTime)*r._timeScale,t,n):r.render((e-r._startTime)*r._timeScale,t,n)),r=o;this._onUpdate&&(t||this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||s)),u&&(this._gc||(c===this._startTime||h!==this._timeScale)&&(0===this._time||a>=this.totalDuration())&&(i&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),t||this.vars[u]&&this.vars[u].apply(this.vars[u+"Scope"]||this,this.vars[u+"Params"]||s)))}},u._hasPausedChild=function(){for(var e=this._first;e;){if(e._paused||e instanceof r&&e._hasPausedChild())return!0;e=e._next}return!1},u.getChildren=function(e,t,r,i){i=i||-9999999999;for(var s=[],o=this._first,u=0;o;)i>o._startTime||(o instanceof n?t!==!1&&(s[u++]=o):(r!==!1&&(s[u++]=o),e!==!1&&(s=s.concat(o.getChildren(!0,t,r)),u=s.length))),o=o._next;return s},u.getTweensOf=function(e,t){for(var r=n.getTweensOf(e),i=r.length,s=[],o=0;--i>-1;)(r[i].timeline===this||t&&this._contains(r[i]))&&(s[o++]=r[i]);return s},u._contains=function(e){for(var t=e.timeline;t;){if(t===this)return!0;t=t.timeline}return!1},u.shiftChildren=function(e,t,n){n=n||0;for(var r,i=this._first;i;)i._startTime>=n&&(i._startTime+=e),i=i._next;if(t)for(r in this._labels)this._labels[r]>=n&&(this._labels[r]+=e);return this._uncache(!0)},u._kill=function(e,t){if(null==e&&null==t)return this._enabled(!1,!1);for(var n=null==t?this.getChildren(!0,!0,!1):this.getTweensOf(t),r=n.length,i=!1;--r>-1;)n[r]._kill(e,t)&&(i=!0);return i},u.clear=function(e){var t=this.getChildren(!1,!0,!0),n=t.length;for(this._time=this._totalTime=0;--n>-1;)t[n]._enabled(!1,!1);return e!==!1&&(this._labels={}),this._uncache(!0)},u.invalidate=function(){for(var e=this._first;e;)e.invalidate(),e=e._next;return this},u._enabled=function(e,n){if(e===this._gc)for(var r=this._first;r;)r._enabled(e,!0),r=r._next;return t.prototype._enabled.call(this,e,n)},u.progress=function(e){return arguments.length?this.totalTime(this.duration()*e,!1):this._time/this.duration()},u.duration=function(e){return arguments.length?(0!==this.duration()&&0!==e&&this.timeScale(this._duration/e),this):(this._dirty&&this.totalDuration(),this._duration)},u.totalDuration=function(e){if(!arguments.length){if(this._dirty){for(var t,n,r=0,i=this._last,s=999999999999;i;)t=i._prev,i._dirty&&i.totalDuration(),i._startTime>s&&this._sortChildren&&!i._paused?this.add(i,i._startTime-i._delay):s=i._startTime,0>i._startTime&&!i._paused&&(r-=i._startTime,this._timeline.smoothChildTiming&&(this._startTime+=i._startTime/this._timeScale),this.shiftChildren(-i._startTime,!1,-9999999999),s=0),n=i._startTime+i._totalDuration/i._timeScale,n>r&&(r=n),i=t;this._duration=this._totalDuration=r,this._dirty=!1}return this._totalDuration}return 0!==this.totalDuration()&&0!==e&&this.timeScale(this._totalDuration/e),this},u.usesFrames=function(){for(var t=this._timeline;t._timeline;)t=t._timeline;return t===e._rootFramesTimeline},u.rawTime=function(){return this._paused||0!==this._totalTime&&this._totalTime!==this._totalDuration?this._totalTime:(this._timeline.rawTime()-this._startTime)*this._timeScale},r},!0),window._gsDefine("TimelineMax",["TimelineLite","TweenLite","easing.Ease"],function(e,t,n){var r=function(t){e.call(this,t),this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._cycle=0,this._yoyo=this.vars.yoyo===!0,this._dirty=!0},i=[],s=new n(null,null,1,0),o=function(e){for(;e;){if(e._paused)return!0;e=e._timeline}return!1},u=r.prototype=new e;return u.constructor=r,u.kill()._gc=!1,r.version="1.9.0",u.invalidate=function(){return this._yoyo=this.vars.yoyo===!0,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._uncache(!0),e.prototype.invalidate.call(this)},u.addCallback=function(e,n,r,i){return this.add(t.delayedCall(0,e,r,i),n)},u.removeCallback=function(e,t){if(null==t)this._kill(null,e);else for(var n=this.getTweensOf(e,!1),r=n.length,i=this._parseTimeOrLabel(t);--r>-1;)n[r]._startTime===i&&n[r]._enabled(!1,!1);return this},u.tweenTo=function(e,n){n=n||{};var r,o,u={ease:s,overwrite:2,useFrames:this.usesFrames(),immediateRender:!1};for(r in n)u[r]=n[r];return u.time=this._parseTimeOrLabel(e),o=new t(this,Math.abs(Number(u.time)-this._time)/this._timeScale||.001,u),u.onStart=function(){o.target.paused(!0),o.vars.time!==o.target.time()&&o.duration(Math.abs(o.vars.time-o.target.time())/o.target._timeScale),n.onStart&&n.onStart.apply(n.onStartScope||o,n.onStartParams||i)},o},u.tweenFromTo=function(e,t,n){n=n||{},n.startAt={time:this._parseTimeOrLabel(e)};var r=this.tweenTo(t,n);return r.duration(Math.abs(r.vars.time-r.vars.startAt.time)/this._timeScale||.001)},u.render=function(e,t,n){this._gc&&this._enabled(!0,!1),this._active=!this._paused;var r,s,o,u,a=this._dirty?this.totalDuration():this._totalDuration,f=this._time,l=this._totalTime,c=this._startTime,h=this._timeScale,p=this._rawPrevTime,d=this._paused,v=this._cycle;if(e>=a)this._locked||(this._totalTime=a,this._cycle=this._repeat),this._reversed||this._hasPausedChild()||(s=!0,u="onComplete",0===this._duration&&(0===e||0>this._rawPrevTime)&&this._rawPrevTime!==e&&(n=!0)),this._rawPrevTime=e,this._yoyo&&0!==(1&this._cycle)?(this._time=0,e=-0.000001):(this._time=this._duration,e=this._duration+1e-6);else if(0>=e)this._locked||(this._totalTime=this._cycle=0),this._time=0,(0!==f||0===this._duration&&this._rawPrevTime>0&&!this._locked)&&(u="onReverseComplete",s=this._reversed),0>e?(this._active=!1,0===this._duration&&this._rawPrevTime>=0&&(n=!0)):this._initted||(n=!0),this._rawPrevTime=e,e=0===this._duration?0:-0.000001;else if(this._time=this._rawPrevTime=e,!this._locked&&(this._totalTime=e,0!==this._repeat)){var m=this._duration+this._repeatDelay;this._cycle=this._totalTime/m>>0,0!==this._cycle&&this._cycle===this._totalTime/m&&this._cycle--,this._time=this._totalTime-this._cycle*m,this._yoyo&&0!==(1&this._cycle)&&(this._time=this._duration-this._time),this._time>this._duration?(this._time=this._duration,e=this._duration+1e-6):0>this._time?this._time=e=0:e=this._time}if(this._cycle!==v&&!this._locked){var g=this._yoyo&&0!==(1&v),y=g===(this._yoyo&&0!==(1&this._cycle)),b=this._totalTime,w=this._cycle,E=this._rawPrevTime,S=this._time;this._totalTime=v*this._duration,v>this._cycle?g=!g:this._totalTime+=this._duration,this._time=f,this._rawPrevTime=0===this._duration?p-1e-5:p,this._cycle=v,this._locked=!0,f=g?0:this._duration,this.render(f,t,0===this._duration),t||this._gc||this.vars.onRepeat&&this.vars.onRepeat.apply(this.vars.onRepeatScope||this,this.vars.onRepeatParams||i),y&&(f=g?this._duration+1e-6:-0.000001,this.render(f,!0,!1)),this._time=S,this._totalTime=b,this._cycle=w,this._rawPrevTime=E,this._locked=!1}if(this._time===f&&!n)return l!==this._totalTime&&this._onUpdate&&(t||this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||i)),void 0;if(this._initted||(this._initted=!0),0===l&&this.vars.onStart&&0!==this._totalTime&&(t||this.vars.onStart.apply(this.vars.onStartScope||this,this.vars.onStartParams||i)),this._time>f)for(r=this._first;r&&(o=r._next,!this._paused||d);)(r._active||r._startTime<=this._time&&!r._paused&&!r._gc)&&(r._reversed?r.render((r._dirty?r.totalDuration():r._totalDuration)-(e-r._startTime)*r._timeScale,t,n):r.render((e-r._startTime)*r._timeScale,t,n)),r=o;else for(r=this._last;r&&(o=r._prev,!this._paused||d);)(r._active||f>=r._startTime&&!r._paused&&!r._gc)&&(r._reversed?r.render((r._dirty?r.totalDuration():r._totalDuration)-(e-r._startTime)*r._timeScale,t,n):r.render((e-r._startTime)*r._timeScale,t,n)),r=o;this._onUpdate&&(t||this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||i)),u&&(this._locked||this._gc||(c===this._startTime||h!==this._timeScale)&&(0===this._time||a>=this.totalDuration())&&(s&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),t||this.vars[u]&&this.vars[u].apply(this.vars[u+"Scope"]||this,this.vars[u+"Params"]||i)))},u.getActive=function(e,t,n){null==e&&(e=!0),null==t&&(t=!0),null==n&&(n=!1);var r,i,s=[],u=this.getChildren(e,t,n),a=0,f=u.length;for(r=0;f>r;r++)i=u[r],i._paused||i._timeline._time>=i._startTime&&i._timeline._time<i._startTime+i._totalDuration/i._timeScale&&(o(i._timeline)||(s[a++]=i));return s},u.getLabelAfter=function(e){e||0!==e&&(e=this._time);var t,n=this.getLabelsArray(),r=n.length;for(t=0;r>t;t++)if(n[t].time>e)return n[t].name;return null},u.getLabelBefore=function(e){null==e&&(e=this._time);for(var t=this.getLabelsArray(),n=t.length;--n>-1;)if(e>t[n].time)return t[n].name;return null},u.getLabelsArray=function(){var e,t=[],n=0;for(e in this._labels)t[n++]={time:this._labels[e],name:e};return t.sort(function(e,t){return e.time-t.time}),t},u.progress=function(e){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&0!==(1&this._cycle)?1-e:e)+this._cycle*(this._duration+this._repeatDelay),!1):this._time/this.duration()},u.totalProgress=function(e){return arguments.length?this.totalTime(this.totalDuration()*e,!1):this._totalTime/this.totalDuration()},u.totalDuration=function(t){return arguments.length?-1===this._repeat?this:this.duration((t-this._repeat*this._repeatDelay)/(this._repeat+1)):(this._dirty&&(e.prototype.totalDuration.call(this),this._totalDuration=-1===this._repeat?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat),this._totalDuration)},u.time=function(e,t){return arguments.length?(this._dirty&&this.totalDuration(),e>this._duration&&(e=this._duration),this._yoyo&&0!==(1&this._cycle)?e=this._duration-e+this._cycle*(this._duration+this._repeatDelay):0!==this._repeat&&(e+=this._cycle*(this._duration+this._repeatDelay)),this.totalTime(e,t)):this._time},u.repeat=function(e){return arguments.length?(this._repeat=e,this._uncache(!0)):this._repeat},u.repeatDelay=function(e){return arguments.length?(this._repeatDelay=e,this._uncache(!0)):this._repeatDelay},u.yoyo=function(e){return arguments.length?(this._yoyo=e,this):this._yoyo},u.currentLabel=function(e){return arguments.length?this.seek(e,!0):this.getLabelBefore(this._time+1e-8)},r},!0),function(){var e=180/Math.PI,t=Math.PI/180,n=[],r=[],i=[],s={},o=function(e,t,n,r){this.a=e,this.b=t,this.c=n,this.d=r,this.da=r-e,this.ca=n-e,this.ba=t-e},u=",x,y,z,left,top,right,bottom,marginTop,marginLeft,marginRight,marginBottom,paddingLeft,paddingTop,paddingRight,paddingBottom,backgroundPosition,backgroundPosition_y,",a=function(e,t,n,r){var i={a:e},s={},o={},u={c:r},a=(e+t)/2,f=(t+n)/2,l=(n+r)/2,c=(a+f)/2,h=(f+l)/2,p=(h-c)/8;return i.b=a+(e-a)/4,s.b=c+p,i.c=s.a=(i.b+s.b)/2,s.c=o.a=(c+h)/2,o.b=h-p,u.b=l+(r-l)/4,o.c=u.a=(o.b+u.b)/2,[i,s,o,u]},f=function(e,t,s,o,u){var f,l,c,h,p,d,v,m,g,y,b,w,E,S=e.length-1,x=0,T=e[0].a;for(f=0;S>f;f++)p=e[x],l=p.a,c=p.d,h=e[x+1].d,u?(b=n[f],w=r[f],E=.25*(w+b)*t/(o?.5:i[f]||.5),d=c-(c-l)*(o?.5*t:E/b),v=c+(h-c)*(o?.5*t:E/w),m=c-(d+(v-d)*(3*b/(b+w)+.5)/4)):(d=c-.5*(c-l)*t,v=c+.5*(h-c)*t,m=c-(d+v)/2),d+=m,v+=m,p.c=g=d,p.b=0!==f?T:T=p.a+.6*(p.c-p.a),p.da=c-l,p.ca=g-l,p.ba=T-l,s?(y=a(l,T,g,c),e.splice(x,1,y[0],y[1],y[2],y[3]),x+=4):x++,T=v;p=e[x],p.b=T,p.c=T+.4*(p.d-T),p.da=p.d-p.a,p.ca=p.c-p.a,p.ba=T-p.a,s&&(y=a(p.a,T,p.c,p.d),e.splice(x,1,y[0],y[1],y[2],y[3]))},l=function(e,t,i,s){var u,a,f,l,c,h,p=[];if(s)for(e=[s].concat(e),a=e.length;--a>-1;)"string"==typeof (h=e[a][t])&&"="===h.charAt(1)&&(e[a][t]=s[t]+Number(h.charAt(0)+h.substr(2)));if(u=e.length-2,0>u)return p[0]=new o(e[0][t],0,0,e[-1>u?0:1][t]),p;for(a=0;u>a;a++)f=e[a][t],l=e[a+1][t],p[a]=new o(f,0,0,l),i&&(c=e[a+2][t],n[a]=(n[a]||0)+(l-f)*(l-f),r[a]=(r[a]||0)+(c-l)*(c-l));return p[a]=new o(e[a][t],0,0,e[a+1][t]),p},c=function(e,t,o,a,c,h){var p,d,v,m,g,y,b,w,E={},S=[],x=h||e[0];c="string"==typeof c?","+c+",":u,null==t&&(t=1);for(d in e[0])S.push(d);if(e.length>1){for(w=e[e.length-1],b=!0,p=S.length;--p>-1;)if(d=S[p],Math.abs(x[d]-w[d])>.05){b=!1;break}b&&(e=e.concat(),h&&e.unshift(h),e.push(e[1]),h=e[e.length-3])}for(n.length=r.length=i.length=0,p=S.length;--p>-1;)d=S[p],s[d]=-1!==c.indexOf(","+d+","),E[d]=l(e,d,s[d],h);for(p=n.length;--p>-1;)n[p]=Math.sqrt(n[p]),r[p]=Math.sqrt(r[p]);if(!a){for(p=S.length;--p>-1;)if(s[d])for(v=E[S[p]],y=v.length-1,m=0;y>m;m++)g=v[m+1].da/r[m]+v[m].da/n[m],i[m]=(i[m]||0)+g*g;for(p=i.length;--p>-1;)i[p]=Math.sqrt(i[p])}for(p=S.length,m=o?4:1;--p>-1;)d=S[p],v=E[d],f(v,t,o,a,s[d]),b&&(v.splice(0,m),v.splice(v.length-m,m));return E},h=function(e,t,n){t=t||"soft";var r,i,s,u,a,f,l,c,h,p,d,v={},m="cubic"===t?3:2,y="soft"===t,b=[];if(y&&n&&(e=[n].concat(e)),null==e||m+1>e.length)throw"invalid Bezier data";for(h in e[0])b.push(h);for(f=b.length;--f>-1;){for(h=b[f],v[h]=a=[],p=0,c=e.length,l=0;c>l;l++)r=null==n?e[l][h]:"string"==typeof (d=e[l][h])&&"="===d.charAt(1)?n[h]+Number(d.charAt(0)+d.substr(2)):Number(d),y&&l>1&&c-1>l&&(a[p++]=(r+a[p-2])/2),a[p++]=r;for(c=p-m+1,p=0,l=0;c>l;l+=m)r=a[l],i=a[l+1],s=a[l+2],u=2===m?0:a[l+3],a[p++]=d=3===m?new o(r,i,s,u):new o(r,(2*i+r)/3,(2*i+s)/3,s);a.length=p}return v},p=function(e,t,n){for(var r,i,s,o,u,a,f,l,c,h,p,d=1/n,v=e.length;--v>-1;)for(h=e[v],s=h.a,o=h.d-s,u=h.c-s,a=h.b-s,r=i=0,l=1;n>=l;l++)f=d*l,c=1-f,r=i-(i=(f*f*o+3*c*(f*u+c*a))*f),p=v*n+l-1,t[p]=(t[p]||0)+r*r},d=function(e,t){t=t>>0||6;var n,r,i,s,o=[],u=[],a=0,f=0,l=t-1,c=[],h=[];for(n in e)p(e[n],o,t);for(i=o.length,r=0;i>r;r++)a+=Math.sqrt(o[r]),s=r%t,h[s]=a,s===l&&(f+=a,s=r/t>>0,c[s]=h,u[s]=f,a=0,h=[]);return{length:f,lengths:u,segments:c}},v=window._gsDefine.plugin({propName:"bezier",priority:-1,API:2,init:function(e,t,n){this._target=e,t instanceof Array&&(t={values:t}),this._func={},this._round={},this._props=[],this._timeRes=null==t.timeResolution?6:parseInt(t.timeResolution,10);var r,i,s,o,u,a=t.values||[],f={},l=a[0],p=t.autoRotate||n.vars.orientToBezier;this._autoRotate=p?p instanceof Array?p:[["x","y","rotation",p===!0?0:Number(p)||0]]:null;for(r in l)this._props.push(r);for(s=this._props.length;--s>-1;)r=this._props[s],this._overwriteProps.push(r),i=this._func[r]="function"==typeof e[r],f[r]=i?e[r.indexOf("set")||"function"!=typeof e["get"+r.substr(3)]?r:"get"+r.substr(3)]():parseFloat(e[r]),u||f[r]!==a[0][r]&&(u=f);if(this._beziers="cubic"!==t.type&&"quadratic"!==t.type&&"soft"!==t.type?c(a,isNaN(t.curviness)?1:t.curviness,!1,"thruBasic"===t.type,t.correlate,u):h(a,t.type,f),this._segCount=this._beziers[r].length,this._timeRes){var v=d(this._beziers,this._timeRes);this._length=v.length,this._lengths=v.lengths,this._segments=v.segments,this._l1=this._li=this._s1=this._si=0,this._l2=this._lengths[0],this._curSeg=this._segments[0],this._s2=this._curSeg[0],this._prec=1/this._curSeg.length}if(p=this._autoRotate)for(p[0]instanceof Array||(this._autoRotate=p=[p]),s=p.length;--s>-1;)for(o=0;3>o;o++)r=p[s][o],this._func[r]="function"==typeof e[r]?e[r.indexOf("set")||"function"!=typeof e["get"+r.substr(3)]?r:"get"+r.substr(3)]:!1;return!0},set:function(t){var n,r,i,s,o,u,a,f,l,c,h=this._segCount,p=this._func,d=this._target;if(this._timeRes){if(l=this._lengths,c=this._curSeg,t*=this._length,i=this._li,t>this._l2&&h-1>i){for(f=h-1;f>i&&t>=(this._l2=l[++i]););this._l1=l[i-1],this._li=i,this._curSeg=c=this._segments[i],this._s2=c[this._s1=this._si=0]}else if(this._l1>t&&i>0){for(;i>0&&(this._l1=l[--i])>=t;);0===i&&this._l1>t?this._l1=0:i++,this._l2=l[i],this._li=i,this._curSeg=c=this._segments[i],this._s1=c[(this._si=c.length-1)-1]||0,this._s2=c[this._si]}if(n=i,t-=this._l1,i=this._si,t>this._s2&&c.length-1>i){for(f=c.length-1;f>i&&t>=(this._s2=c[++i]););this._s1=c[i-1],this._si=i}else if(this._s1>t&&i>0){for(;i>0&&(this._s1=c[--i])>=t;);0===i&&this._s1>t?this._s1=0:i++,this._s2=c[i],this._si=i}u=(i+(t-this._s1)/(this._s2-this._s1))*this._prec}else n=0>t?0:t>=1?h-1:h*t>>0,u=(t-n*(1/h))*h;for(r=1-u,i=this._props.length;--i>-1;)s=this._props[i],o=this._beziers[s][n],a=(u*u*o.da+3*r*(u*o.ca+r*o.ba))*u+o.a,this._round[s]&&(a=a+(a>0?.5:-0.5)>>0),p[s]?d[s](a):d[s]=a;if(this._autoRotate){var v,m,g,y,b,w,E,S=this._autoRotate;for(i=S.length;--i>-1;)s=S[i][2],w=S[i][3]||0,E=S[i][4]===!0?1:e,o=this._beziers[S[i][0]][n],v=this._beziers[S[i][1]][n],m=o.a+(o.b-o.a)*u,y=o.b+(o.c-o.b)*u,m+=(y-m)*u,y+=(o.c+(o.d-o.c)*u-y)*u,g=v.a+(v.b-v.a)*u,b=v.b+(v.c-v.b)*u,g+=(b-g)*u,b+=(v.c+(v.d-v.c)*u-b)*u,a=Math.atan2(b-g,y-m)*E+w,p[s]?p[s].call(d,a):d[s]=a}}}),m=v.prototype;v.bezierThrough=c,v.cubicToQuadratic=a,v._autoCSS=!0,v.quadraticToCubic=function(e,t,n){return new o(e,(2*t+e)/3,(2*t+n)/3,n)},v._cssRegister=function(){var e=window._gsDefine.globals.CSSPlugin;if(e){var n=e._internals,r=n._parseToProxy,i=n._setPluginRatio,s=n.CSSPropTween;n._registerComplexSpecialProp("bezier",null,function(e,n,o,u,a,f){n instanceof Array&&(n={values:n}),f=new v;var l,c,h,p=n.values,d=p.length-1,m=[],g={};if(0>d)return a;for(l=0;d>=l;l++)h=r(e,p[l],u,a,f,d!==l),m[l]=h.end;for(c in n)g[c]=n[c];return g.values=m,a=new s(e,"bezier",0,0,h.pt,2),a.data=h,a.plugin=f,a.setRatio=i,0===g.autoRotate&&(g.autoRotate=!0),!g.autoRotate||g.autoRotate instanceof Array||(l=g.autoRotate===!0?0:Number(g.autoRotate)*t,g.autoRotate=null!=h.end.left?[["left","top","rotation",l,!0]]:null!=h.end.x?[["x","y","rotation",l,!0]]:!1),g.autoRotate&&(u._transform||u._enableTransforms(!1),h.autoRotate=u._target._gsTransform),f._onInitTween(h.proxy,g,u._tween),a})}},m._roundProps=function(e,t){for(var n=this._overwriteProps,r=n.length;--r>-1;)(e[n[r]]||e.bezier||e.bezierThrough)&&(this._round[n[r]]=t)},m._kill=function(e){var t,n,r=this._props;for(t in this._beziers)if(t in e)for(delete this._beziers[t],delete this._func[t],n=r.length;--n>-1;)r[n]===t&&r.splice(n,1);return this._super._kill.call(this,e)}}(),window._gsDefine("plugins.CSSPlugin",["plugins.TweenPlugin","TweenLite"],function(e){var t,n,r,i,s=function(){e.call(this,"css"),this._overwriteProps.length=0},o={},u=s.prototype=new e("css");u.constructor=s,s.version="1.9.0",s.API=2,s.defaultTransformPerspective=0,u="px",s.suffixMap={top:u,right:u,bottom:u,left:u,width:u,height:u,fontSize:u,padding:u,margin:u,perspective:u};var a,f,l,c,h,p,d=/(?:\d|\-\d|\.\d|\-\.\d)+/g,v=/(?:\d|\-\d|\.\d|\-\.\d|\+=\d|\-=\d|\+=.\d|\-=\.\d)+/g,m=/(?:\+=|\-=|\-|\b)[\d\-\.]+[a-zA-Z0-9]*(?:%|\b)/gi,g=/[^\d\-\.]/g,y=/(?:\d|\-|\+|=|#|\.)*/g,b=/opacity *= *([^)]*)/,w=/opacity:([^;]*)/,E=/alpha\(opacity *=.+?\)/i,S=/([A-Z])/g,x=/-([a-z])/gi,T=/(^(?:url\(\"|url\())|(?:(\"\))$|\)$)/gi,N=function(e,t){return t.toUpperCase()},C=/(?:Left|Right|Width)/i,k=/(M11|M12|M21|M22)=[\d\-\.e]+/gi,L=/progid\:DXImageTransform\.Microsoft\.Matrix\(.+?\)/i,A=Math.PI/180,O=180/Math.PI,M={},_=document,D=_.createElement("div"),P=_.createElement("img"),H=s._internals={_specialProps:o},B=navigator.userAgent,j=function(){var e,t=B.indexOf("Android"),n=_.createElement("div");return l=-1!==B.indexOf("Safari")&&-1===B.indexOf("Chrome")&&(-1===t||Number(B.substr(t+8,1))>3),h=l&&6>Number(B.substr(B.indexOf("Version/")+8,1)),c=-1!==B.indexOf("Firefox"),/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(B),p=parseFloat(RegExp.$1),n.innerHTML="<a style='top:1px;opacity:.55;'>a</a>",e=n.getElementsByTagName("a")[0],e?/^0.55/.test(e.style.opacity):!1}(),F=function(e){return b.test("string"==typeof e?e:(e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?parseFloat(RegExp.$1)/100:1},I=function(e){window.console&&console.log(e)},q="",R="",U=function(e,t){t=t||D;var n,r,i=t.style;if(void 0!==i[e])return e;for(e=e.charAt(0).toUpperCase()+e.substr(1),n=["O","Moz","ms","Ms","Webkit"],r=5;--r>-1&&void 0===i[n[r]+e];);return r>=0?(R=3===r?"ms":n[r],q="-"+R.toLowerCase()+"-",R+e):null},z=_.defaultView?_.defaultView.getComputedStyle:function(){},W=s.getStyle=function(e,t,n,r,i){var s;return j||"opacity"!==t?(!r&&e.style[t]?s=e.style[t]:(n=n||z(e,null))?(e=n.getPropertyValue(t.replace(S,"-$1").toLowerCase()),s=e||n.length?e:n[t]):e.currentStyle&&(n=e.currentStyle,s=n[t]),null==i||s&&"none"!==s&&"auto"!==s&&"auto auto"!==s?s:i):F(e)},X=function(e,t,n){var r,i,s={},o=e._gsOverwrittenClassNamePT;if(o&&!n){for(;o;)o.setRatio(0),o=o._next;e._gsOverwrittenClassNamePT=null}if(t=t||z(e,null))if(r=t.length)for(;--r>-1;)s[t[r].replace(x,N)]=t.getPropertyValue(t[r]);else for(r in t)s[r]=t[r];else if(t=e.currentStyle||e.style)for(r in t)s[r.replace(x,N)]=t[r];return j||(s.opacity=F(e)),i=bt(e,t,!1),s.rotation=i.rotation*O,s.skewX=i.skewX*O,s.scaleX=i.scaleX,s.scaleY=i.scaleY,s.x=i.x,s.y=i.y,yt&&(s.z=i.z,s.rotationX=i.rotationX*O,s.rotationY=i.rotationY*O,s.scaleZ=i.scaleZ),s.filters&&delete s.filters,s},V=function(e,t,n,r){var i,s,o,u={},a=e.style;for(s in n)"cssText"!==s&&"length"!==s&&isNaN(s)&&t[s]!==(i=n[s])&&-1===s.indexOf("Origin")&&("number"==typeof i||"string"==typeof i)&&(u[s]=""!==i&&"auto"!==i&&"none"!==i||"string"!=typeof t[s]||""===t[s].replace(g,"")?i:0,void 0!==a[s]&&(o=new ut(a,s,a[s],o)));if(r)for(s in r)"className"!==s&&(u[s]=r[s]);return{difs:u,firstMPT:o}},$={width:["Left","Right"],height:["Top","Bottom"]},J=["marginLeft","marginRight","marginTop","marginBottom"],K=function(e,t,n){var r=parseFloat("width"===t?e.offsetWidth:e.offsetHeight),i=$[t],s=i.length;for(n=n||z(e,null);--s>-1;)r-=parseFloat(W(e,"padding"+i[s],n,!0))||0,r-=parseFloat(W(e,"border"+i[s]+"Width",n,!0))||0;return r},Q=function(e,t,n,r,i){if("px"===r||!r)return n;if("auto"===r||!n)return 0;var s,o=C.test(t),u=e,a=D.style,f=0>n;return f&&(n=-n),"%"===r&&-1!==t.indexOf("border")?s=n/100*(o?e.clientWidth:e.clientHeight):(a.cssText="border-style:solid; border-width:0; position:absolute; line-height:0;","%"!==r&&u.appendChild?a[o?"borderLeftWidth":"borderTopWidth"]=n+r:(u=e.parentNode||_.body,a[o?"width":"height"]=n+r),u.appendChild(D),s=parseFloat(D[o?"offsetWidth":"offsetHeight"]),u.removeChild(D),0!==s||i||(s=Q(e,t,n,r,!0))),f?-s:s},G=function(e,t){(null==e||""===e||"auto"===e||"auto auto"===e)&&(e="0 0");var n=e.split(" "),r=-1!==e.indexOf("left")?"0%":-1!==e.indexOf("right")?"100%":n[0],i=-1!==e.indexOf("top")?"0%":-1!==e.indexOf("bottom")?"100%":n[1];return null==i?i="0":"center"===i&&(i="50%"),("center"===r||isNaN(parseFloat(r)))&&(r="50%"),t&&(t.oxp=-1!==r.indexOf("%"),t.oyp=-1!==i.indexOf("%"),t.oxr="="===r.charAt(1),t.oyr="="===i.charAt(1),t.ox=parseFloat(r.replace(g,"")),t.oy=parseFloat(i.replace(g,""))),r+" "+i+(n.length>2?" "+n[2]:"")},Y=function(e,t){return"string"==typeof e&&"="===e.charAt(1)?parseInt(e.charAt(0)+"1",10)*parseFloat(e.substr(2)):parseFloat(e)-parseFloat(t)},Z=function(e,t){return null==e?t:"string"==typeof e&&"="===e.charAt(1)?parseInt(e.charAt(0)+"1",10)*Number(e.substr(2))+t:parseFloat(e)},et=function(e,t){var n,r,i,s,o,u=1e-6;return null==e?o=t:"number"==typeof e?o=e*A:(n=2*Math.PI,r=e.split("_"),i=Number(r[0].replace(g,""))*(-1===e.indexOf("rad")?A:1)-("="===e.charAt(1)?0:t),s=r[1],"short"===s?(i%=n,i!==i%(n/2)&&(i=0>i?i+n:i-n)):"cw"===s&&0>i?i=(i+9999999999*n)%n-(0|i/n)*n:"ccw"===s&&i>0&&(i=(i-9999999999*n)%n-(0|i/n)*n),o=t+i),u>o&&o>-u&&(o=0),o},tt={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},nt=function(e,t,n){return e=0>e?e+1:e>1?e-1:e,0|255*(1>6*e?t+6*(n-t)*e:.5>e?n:2>3*e?t+6*(n-t)*(2/3-e):t)+.5},rt=function(e){var t,n,r,i,s,o;return e&&""!==e?tt[e]?tt[e]:"number"==typeof e?[e>>16,255&e>>8,255&e]:"#"===e.charAt(0)?(4===e.length&&(t=e.charAt(1),n=e.charAt(2),r=e.charAt(3),e="#"+t+t+n+n+r+r),e=parseInt(e.substr(1),16),[e>>16,255&e>>8,255&e]):"hsl"===e.substr(0,3)?(e=e.match(d),i=Number(e[0])%360/360,s=Number(e[1])/100,o=Number(e[2])/100,n=.5>=o?o*(s+1):o+s-o*s,t=2*o-n,e.length>3&&(e[3]=Number(e[3])),e[0]=nt(i+1/3,t,n),e[1]=nt(i,t,n),e[2]=nt(i-1/3,t,n),e):(e=e.match(d)||tt.transparent,e[0]=Number(e[0]),e[1]=Number(e[1]),e[2]=Number(e[2]),e.length>3&&(e[3]=Number(e[3])),e):tt.black},it="(?:\\b(?:(?:rgb|rgba)\\(.+?\\))|\\B#.+?\\b";for(u in tt)it+="|"+u+"\\b";it=RegExp(it+")","gi");var st=function(e,t,n){if(null==e)return function(e){return e};var r=t?(e.match(it)||[""])[0]:"",i=e.split(r).join("").match(m)||[],s=e.substr(0,e.indexOf(i[0])),o=")"===e.charAt(e.length-1)?")":"",u=-1!==e.indexOf(" ")?" ":",",a=i.length,f=a>0?i[0].replace(d,""):"";return a?t?function(e){"number"==typeof e&&(e+=f);var t=(e.match(it)||[r])[0],l=e.split(t).join("").match(m)||[],c=l.length;if(a>c--)for(;a>++c;)l[c]=n?l[(c-1)/2>>0]:i[c];return s+l.join(u)+u+t+o}:function(e){"number"==typeof e&&(e+=f);var t=e.match(m)||[],r=t.length;if(a>r--)for(;a>++r;)t[r]=n?t[(r-1)/2>>0]:i[r];return s+t.join(u)+o}:function(e){return e}},ot=function(e){return e=e.split(","),function(t,n,r,i,s,o,u){var a,f=(n+"").split(" ");for(u={},a=0;4>a;a++)u[e[a]]=f[a]=f[a]||f[(a-1)/2>>0];return i.parse(t,u,s,o)}},ut=(H._setPluginRatio=function(e){this.plugin.setRatio(e);for(var t,n,r,i,s=this.data,o=s.proxy,u=s.firstMPT,a=1e-6;u;)t=o[u.v],u.r?t=t>0?t+.5>>0:t-.5>>0:a>t&&t>-a&&(t=0),u.t[u.p]=t,u=u._next;if(s.autoRotate&&(s.autoRotate.rotation=o.rotation),1===e)for(u=s.firstMPT;u;){if(n=u.t,n.type){if(1===n.type){for(i=n.xs0+n.s+n.xs1,r=1;n.l>r;r++)i+=n["xn"+r]+n["xs"+(r+1)];n.e=i}}else n.e=n.s+n.xs0;u=u._next}},function(e,t,n,r,i){this.t=e,this.p=t,this.v=n,this.r=i,r&&(r._prev=this,this._next=r)}),at=(H._parseToProxy=function(e,t,n,r,i,s){var o,u,a,f,l,c=r,h={},p={},d=n._transform,v=M;for(n._transform=null,M=t,r=l=n.parse(e,t,r,i),M=v,s&&(n._transform=d,c&&(c._prev=null,c._prev&&(c._prev._next=null)));r&&r!==c;){if(1>=r.type&&(u=r.p,p[u]=r.s+r.c,h[u]=r.s,s||(f=new ut(r,"s",u,f,r.r),r.c=0),1===r.type))for(o=r.l;--o>0;)a="xn"+o,u=r.p+"_"+a,p[u]=r.data[a],h[u]=r[a],s||(f=new ut(r,a,u,f,r.rxp[a]));r=r._next}return{proxy:h,end:p,firstMPT:f,pt:l}},H.CSSPropTween=function(e,n,r,s,o,u,a,f,l,c,h){this.t=e,this.p=n,this.s=r,this.c=s,this.n=a||"css_"+n,e instanceof at||i.push(this.n),this.r=f,this.type=u||0,l&&(this.pr=l,t=!0),this.b=void 0===c?r:c,this.e=void 0===h?r+s:h,o&&(this._next=o,o._prev=this)}),ft=s.parseComplex=function(e,t,n,r,i,s,o,u,f,l){o=new at(e,t,0,0,o,l?2:1,null,!1,u,n,r);var c,h,p,m,g,y,b,w,E,S,x,T,N=n.split(", ").join(",").split(" "),C=(r+"").split(", ").join(",").split(" "),k=N.length,L=a!==!1;for(k!==C.length&&(N=(s||"").split(" "),k=N.length),o.plugin=f,o.setRatio=l,c=0;k>c;c++)if(m=N[c],g=C[c],w=parseFloat(m),w||0===w)o.appendXtra("",w,Y(g,w),g.replace(v,""),L&&-1!==g.indexOf("px"),!0);else if(i&&("#"===m.charAt(0)||0===m.indexOf("rgb")||tt[m]))m=rt(m),g=rt(g),E=m.length+g.length>6,E&&!j&&0===g[3]?(o["xs"+o.l]+=o.l?" transparent":"transparent",o.e=o.e.split(C[c]).join("transparent")):(j||(E=!1),o.appendXtra(E?"rgba(":"rgb(",m[0],g[0]-m[0],",",!0,!0).appendXtra("",m[1],g[1]-m[1],",",!0).appendXtra("",m[2],g[2]-m[2],E?",":")",!0),E&&(m=4>m.length?1:m[3],o.appendXtra("",m,(4>g.length?1:g[3])-m,")",!1)));else if(y=m.match(d)){if(b=g.match(v),!b||b.length!==y.length)return o;for(p=0,h=0;y.length>h;h++)x=y[h],S=m.indexOf(x,p),o.appendXtra(m.substr(p,S-p),Number(x),Y(b[h],x),"",L&&"px"===m.substr(S+x.length,2),0===h),p=S+x.length;o["xs"+o.l]+=m.substr(p)}else o["xs"+o.l]+=o.l?" "+m:m;if(-1!==r.indexOf("=")&&o.data){for(T=o.xs0+o.data.s,c=1;o.l>c;c++)T+=o["xs"+c]+o.data["xn"+c];o.e=T+o["xs"+c]}return o.l||(o.type=-1,o.xs0=o.e),o.xfirst||o},lt=9;for(u=at.prototype,u.l=u.pr=0;--lt>0;)u["xn"+lt]=0,u["xs"+lt]="";u.xs0="",u._next=u._prev=u.xfirst=u.data=u.plugin=u.setRatio=u.rxp=null,u.appendXtra=function(e,t,n,r,i,s){var o=this,u=o.l;return o["xs"+u]+=s&&u?" "+e:e||"",n||0===u||o.plugin?(o.l++,o.type=o.setRatio?2:1,o["xs"+o.l]=r||"",u>0?(o.data["xn"+u]=t+n,o.rxp["xn"+u]=i,o["xn"+u]=t,o.plugin||(o.xfirst=new at(o,"xn"+u,t,n,o.xfirst||o,0,o.n,i,o.pr),o.xfirst.xs0=0),o):(o.data={s:t+n},o.rxp={},o.s=t,o.c=n,o.r=i,o)):(o["xs"+u]+=t+(r||""),o)};var ct=function(e,t,n,r,i,s,u){this.p=r?U(e)||e:e,o[e]=o[this.p]=this,this.format=s||st(t,i),n&&(this.parse=n),this.clrs=i,this.dflt=t,this.pr=u||0},ht=H._registerComplexSpecialProp=function(e,t,n,r,i,s,o){for(var u,a=e.split(","),f=t instanceof Array?t:[t],l=a.length;--l>-1;)u=new ct(a[l],f[l],n,r&&0===l,i,s,o)},pt=function(e){if(!o[e]){var t=e.charAt(0).toUpperCase()+e.substr(1)+"Plugin";ht(e,null,function(e,n,r,i,s,u,a){var f=(window.GreenSockGlobals||window).com.greensock.plugins[t];return f?(f._cssRegister(),o[r].parse(e,n,r,i,s,u,a)):(I("Error: "+t+" js file not loaded."),s)})}};u=ct.prototype,u.parseComplex=function(e,t,n,r,i,s){return ft(e,this.p,t,n,this.clrs,this.dflt,r,this.pr,i,s)},u.parse=function(e,t,n,i,s,o){return this.parseComplex(e.style,this.format(W(e,this.p,r,!1,this.dflt)),this.format(t),s,o)},s.registerSpecialProp=function(e,t,n){ht(e,null,function(e,r,i,s,o,u){var a=new at(e,i,0,0,o,2,i,!1,n);return a.plugin=u,a.setRatio=t(e,r,s._tween,i),a},!1,!1,null,n)};var dt=["scaleX","scaleY","scaleZ","x","y","z","skewX","rotation","rotationX","rotationY","perspective"],vt=U("transform"),mt=q+"transform",gt=U("transformOrigin"),yt=null!==U("perspective"),bt=function(e,t,n){var r,i,o,u,a,f,l,c,h,p,d,v,m,g=n?e._gsTransform||{skewY:0}:{skewY:0},y=0>g.scaleX,b=2e-5,w=1e5,E=-Math.PI+1e-4,S=Math.PI-1e-4,x=yt?parseFloat(W(e,gt,t,!1,"0 0 0").split(" ")[2])||g.zOrigin||0:0;for(vt?r=W(e,mt,t,!0):e.currentStyle&&(r=e.currentStyle.filter.match(k),r=r&&4===r.length?r[0].substr(4)+","+Number(r[2].substr(4))+","+Number(r[1].substr(4))+","+r[3].substr(4)+","+(g?g.x:0)+","+(g?g.y:0):null),i=(r||"").match(/(?:\-|\b)[\d\-\.e]+\b/gi)||[],o=i.length;--o>-1;)u=Number(i[o]),i[o]=(a=u-(u|=0))?(0|a*w+(0>a?-0.5:.5))/w+u:u;if(16===i.length){var T=i[8],N=i[9],C=i[10],L=i[12],A=i[13],O=i[14];if(g.zOrigin&&(O=-g.zOrigin,L=T*O-i[12],A=N*O-i[13],O=C*O+g.zOrigin-i[14]),!n||L!==g.x||A!==g.y||O!==g.z){var M,_,D,P,H,B,j,F,I=i[0],q=i[1],R=i[2],U=i[3],z=i[4],X=i[5],V=i[6],$=i[7],J=i[11],K=g.rotationX=Math.atan2(V,C),Q=E>K||K>S;K&&(H=Math.cos(-K),B=Math.sin(-K),M=z*H+T*B,_=X*H+N*B,D=V*H+C*B,P=$*H+J*B,T=z*-B+T*H,N=X*-B+N*H,C=V*-B+C*H,J=$*-B+J*H,z=M,X=_,V=D),K=g.rotationY=Math.atan2(T,I),K&&(j=E>K||K>S,H=Math.cos(-K),B=Math.sin(-K),M=I*H-T*B,_=q*H-N*B,D=R*H-C*B,P=U*H-J*B,N=q*B+N*H,C=R*B+C*H,J=U*B+J*H,I=M,q=_,R=D),K=g.rotation=Math.atan2(q,X),K&&(F=E>K||K>S,H=Math.cos(-K),B=Math.sin(-K),I=I*H+z*B,_=q*H+X*B,X=q*-B+X*H,V=R*-B+V*H,q=_),F&&Q?g.rotation=g.rotationX=0:F&&j?g.rotation=g.rotationY=0:j&&Q&&(g.rotationY=g.rotationX=0),g.scaleX=(Math.sqrt(I*I+q*q)*w+.5>>0)/w,g.scaleY=(Math.sqrt(X*X+N*N)*w+.5>>0)/w,g.scaleZ=(Math.sqrt(V*V+C*C)*w+.5>>0)/w,g.skewX=0,g.perspective=J?1/(0>J?-J:J):0,g.x=L,g.y=A,g.z=O}}else if(!yt||0===i.length||g.x!==i[4]||g.y!==i[5]||!g.rotationX&&!g.rotationY){var G=i.length>=6,Y=G?i[0]:1,Z=i[1]||0,et=i[2]||0,tt=G?i[3]:1;g.x=i[4]||0,g.y=i[5]||0,f=Math.sqrt(Y*Y+Z*Z),l=Math.sqrt(tt*tt+et*et),c=Y||Z?Math.atan2(Z,Y):g.rotation||0,h=et||tt?Math.atan2(et,tt)+c:g.skewX||0,p=f-Math.abs(g.scaleX||0),d=l-Math.abs(g.scaleY||0),Math.abs(h)>Math.PI/2&&Math.abs(h)<1.5*Math.PI&&(y?(f*=-1,h+=0>=c?Math.PI:-Math.PI,c+=0>=c?Math.PI:-Math.PI):(l*=-1,h+=0>=h?Math.PI:-Math.PI)),v=(c-g.rotation)%Math.PI,m=(h-g.skewX)%Math.PI,(void 0===g.skewX||p>b||-b>p||d>b||-b>d||v>E&&S>v&&0!==v*w>>0||m>E&&S>m&&0!==m*w>>0)&&(g.scaleX=f,g.scaleY=l,g.rotation=c,g.skewX=h),yt&&(g.rotationX=g.rotationY=g.z=0,g.perspective=parseFloat(s.defaultTransformPerspective)||0,g.scaleZ=1)}g.zOrigin=x;for(o in g)b>g[o]&&g[o]>-b&&(g[o]=0);return n&&(e._gsTransform=g),g},wt=function(e){var t,n,r=this.data,i=-r.rotation,s=i+r.skewX,o=1e5,u=(Math.cos(i)*r.scaleX*o>>0)/o,a=(Math.sin(i)*r.scaleX*o>>0)/o,f=(Math.sin(s)*-r.scaleY*o>>0)/o,l=(Math.cos(s)*r.scaleY*o>>0)/o,c=this.t.style,h=this.t.currentStyle;if(h){n=a,a=-f,f=-n,t=h.filter,c.filter="";var d,v,m=this.t.offsetWidth,g=this.t.offsetHeight,w="absolute"!==h.position,E="progid:DXImageTransform.Microsoft.Matrix(M11="+u+", M12="+a+", M21="+f+", M22="+l,S=r.x,x=r.y;if(null!=r.ox&&(d=(r.oxp?.01*m*r.ox:r.ox)-m/2,v=(r.oyp?.01*g*r.oy:r.oy)-g/2,S+=d-(d*u+v*a),x+=v-(d*f+v*l)),w)d=m/2,v=g/2,E+=", Dx="+(d-(d*u+v*a)+S)+", Dy="+(v-(d*f+v*l)+x)+")";else{var T,N,C,k=8>p?1:-1;for(d=r.ieOffsetX||0,v=r.ieOffsetY||0,r.ieOffsetX=Math.round((m-((0>u?-u:u)*m+(0>a?-a:a)*g))/2+S),r.ieOffsetY=Math.round((g-((0>l?-l:l)*g+(0>f?-f:f)*m))/2+x),lt=0;4>lt;lt++)N=J[lt],T=h[N],n=-1!==T.indexOf("px")?parseFloat(T):Q(this.t,N,parseFloat(T),T.replace(y,""))||0,C=n!==r[N]?2>lt?-r.ieOffsetX:-r.ieOffsetY:2>lt?d-r.ieOffsetX:v-r.ieOffsetY,c[N]=(r[N]=Math.round(n-C*(0===lt||2===lt?1:k)))+"px";E+=", sizingMethod='auto expand')"}c.filter=-1!==t.indexOf("DXImageTransform.Microsoft.Matrix(")?t.replace(L,E):E+" "+t,(0===e||1===e)&&1===u&&0===a&&0===f&&1===l&&(w&&-1===E.indexOf("Dx=0, Dy=0")||b.test(t)&&100!==parseFloat(RegExp.$1)||-1===t.indexOf("gradient(")&&c.removeAttribute("filter"))}},Et=function(){var e,t,n,r,i,s,o,u,a,f=this.data,l=this.t.style,h=f.perspective,p=f.scaleX,d=0,v=0,m=0,g=0,y=f.scaleY,b=0,w=0,E=0,S=0,x=f.scaleZ,T=0,N=0,C=0,k=h?-1/h:0,L=f.rotation,A=f.zOrigin,O=",",M=1e5;c&&(o=W(this.t,"top",null,!1,"0"),u=parseFloat(o)||0,a=o.substr((u+"").length),f._ffFix=!f._ffFix,l.top=(f._ffFix?u+.05:u-.05)+(""===a?"px":a)),(L||f.skewX)&&(n=p*Math.cos(L),r=y*Math.sin(L),L-=f.skewX,d=p*-Math.sin(L),y*=Math.cos(L),p=n,g=r),L=f.rotationY,L&&(e=Math.cos(L),t=Math.sin(L),n=p*e,r=g*e,i=x*-t,s=k*-t,v=p*t,b=g*t,x*=e,k*=e,p=n,g=r,E=i,N=s),L=f.rotationX,L&&(e=Math.cos(L),t=Math.sin(L),n=d*e+v*t,r=y*e+b*t,i=S*e+x*t,s=C*e+k*t,v=d*-t+v*e,b=y*-t+b*e,x=S*-t+x*e,k=C*-t+k*e,d=n,y=r,S=i,C=s),A&&(T-=A,m=v*T,w=b*T,T=x*T+A),m=(n=(m+=f.x)-(m|=0))?(0|n*M+(0>n?-0.5:.5))/M+m:m,w=(n=(w+=f.y)-(w|=0))?(0|n*M+(0>n?-0.5:.5))/M+w:w,T=(n=(T+=f.z)-(T|=0))?(0|n*M+(0>n?-0.5:.5))/M+T:T,l[vt]="matrix3d("+(p*M>>0)/M+O+(g*M>>0)/M+O+(E*M>>0)/M+O+(N*M>>0)/M+O+(d*M>>0)/M+O+(y*M>>0)/M+O+(S*M>>0)/M+O+(C*M>>0)/M+O+(v*M>>0)/M+O+(b*M>>0)/M+O+(x*M>>0)/M+O+(k*M>>0)/M+O+m+O+w+O+T+O+(h?1+ -T/h:1)+")"},St=function(){var e,t,n,r,i,s,o,u,a=this.data,f=this.t;c&&(e=W(f,"top",null,!1,"0"),t=parseFloat(e)||0,n=e.substr((t+"").length),a._ffFix=!a._ffFix,f.style.top=(a._ffFix?t+.05:t-.05)+(""===n?"px":n)),a.rotation||a.skewX?(r=a.rotation,i=r-a.skewX,s=1e5,o=a.scaleX*s,u=a.scaleY*s,f.style[vt]="matrix("+(Math.cos(r)*o>>0)/s+","+(Math.sin(r)*o>>0)/s+","+(Math.sin(i)*-u>>0)/s+","+(Math.cos(i)*u>>0)/s+","+a.x+","+a.y+")"):f.style[vt]="matrix("+a.scaleX+",0,0,"+a.scaleY+","+a.x+","+a.y+")"};ht("transform,scale,scaleX,scaleY,scaleZ,x,y,z,rotation,rotationX,rotationY,rotationZ,skewX,skewY,shortRotation,shortRotationX,shortRotationY,shortRotationZ,transformOrigin,transformPerspective,directionalRotation",null,function(e,t,n,i,s,o,u){if(i._transform)return s;var a,f,l,c,h,p,d,v=i._transform=bt(e,r,!0),m=e.style,g=1e-6,y=dt.length,b=u;if("string"==typeof b.transform&&vt)l=m.cssText,m[vt]=b.transform,m.display="block",a=bt(e,null,!1),m.cssText=l;else if("object"==typeof b){if(a={scaleX:Z(null!=b.scaleX?b.scaleX:b.scale,v.scaleX),scaleY:Z(null!=b.scaleY?b.scaleY:b.scale,v.scaleY),scaleZ:Z(null!=b.scaleZ?b.scaleZ:b.scale,v.scaleZ),x:Z(b.x,v.x),y:Z(b.y,v.y),z:Z(b.z,v.z),perspective:Z(b.transformPerspective,v.perspective)},d=b.directionalRotation,null!=d)if("object"==typeof d)for(l in d)b[l]=d[l];else b.rotation=d;a.rotation=et("rotation"in b?b.rotation:"shortRotation"in b?b.shortRotation+"_short":"rotationZ"in b?b.rotationZ:v.rotation*O,v.rotation),yt&&(a.rotationX=et("rotationX"in b?b.rotationX:"shortRotationX"in b?b.shortRotationX+"_short":v.rotationX*O||0,v.rotationX),a.rotationY=et("rotationY"in b?b.rotationY:"shortRotationY"in b?b.shortRotationY+"_short":v.rotationY*O||0,v.rotationY)),a.skewX=null==b.skewX?v.skewX:et(b.skewX,v.skewX),a.skewY=null==b.skewY?v.skewY:et(b.skewY,v.skewY),(f=a.skewY-v.skewY)&&(a.skewX+=f,a.rotation+=f)}for(h=v.z||v.rotationX||v.rotationY||a.z||a.rotationX||a.rotationY||a.perspective,h||null==b.scale||(a.scaleZ=1);--y>-1;)n=dt[y],c=a[n]-v[n],(c>g||-g>c||null!=M[n])&&(p=!0,s=new at(v,n,v[n],c,s),s.xs0=0,s.plugin=o,i._overwriteProps.push(s.n));return c=b.transformOrigin,(c||yt&&h&&v.zOrigin)&&(vt?(p=!0,c=(c||W(e,n,r,!1,"50% 50%"))+"",n=gt,s=new at(m,n,0,0,s,-1,"css_transformOrigin"),s.b=m[n],s.plugin=o,yt?(l=v.zOrigin,c=c.split(" "),v.zOrigin=(c.length>2?parseFloat(c[2]):l)||0,s.xs0=s.e=m[n]=c[0]+" "+(c[1]||"50%")+" 0px",s=new at(v,"zOrigin",0,0,s,-1,s.n),s.b=l,s.xs0=s.e=v.zOrigin):s.xs0=s.e=m[n]=c):G(c+"",v)),p&&(i._transformType=h||3===this._transformType?3:2),s},!0),ht("boxShadow","0px 0px 0px 0px #999",function(e,t,n,i,s,o){var u=-1!==(t+"").indexOf("inset")?" inset":"";return this.parseComplex(e.style,this.format(W(e,this.p,r,!1,this.dflt))+u,this.format(t)+u,s,o)},!0,!0),ht("borderRadius","0px",function(e,t,i,s,o){t=this.format(t);var u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x=["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"],T=e.style;for(v=parseFloat(e.offsetWidth),m=parseFloat(e.offsetHeight),u=t.split(" "),a=0;x.length>a;a++)this.p.indexOf("border")&&(x[a]=U(x[a])),c=l=W(e,x[a],r,!1,"0px"),-1!==c.indexOf(" ")&&(l=c.split(" "),c=l[0],l=l[1]),h=f=u[a],p=parseFloat(c),y=c.substr((p+"").length),b="="===h.charAt(1),b?(d=parseInt(h.charAt(0)+"1",10),h=h.substr(2),d*=parseFloat(h),g=h.substr((d+"").length-(0>d?1:0))||""):(d=parseFloat(h),g=h.substr((d+"").length)),""===g&&(g=n[i]||y),g!==y&&(w=Q(e,"borderLeft",p,y),E=Q(e,"borderTop",p,y),"%"===g?(c=100*(w/v)+"%",l=100*(E/m)+"%"):"em"===g?(S=Q(e,"borderLeft",1,"em"),c=w/S+"em",l=E/S+"em"):(c=w+"px",l=E+"px"),b&&(h=parseFloat(c)+d+g,f=parseFloat(l)+d+g)),o=ft(T,x[a],c+" "+l,h+" "+f,!1,"0px",o);return o},!0,!1,st("0px 0px 0px 0px",!1,!0)),ht("backgroundPosition","0 0",function(e,t,n,i,s,o){var u,a,f,l,c,h,d="background-position",v=r||z(e,null),m=this.format((v?p?v.getPropertyValue(d+"-x")+" "+v.getPropertyValue(d+"-y"):v.getPropertyValue(d):e.currentStyle.backgroundPositionX+" "+e.currentStyle.backgroundPositionY)||"0 0"),g=this.format(t);if(-1!==m.indexOf("%")!=(-1!==g.indexOf("%"))&&(h=W(e,"backgroundImage").replace(T,""),h&&"none"!==h)){for(u=m.split(" "),a=g.split(" "),P.setAttribute("src",h),f=2;--f>-1;)m=u[f],l=-1!==m.indexOf("%"),l!==(-1!==a[f].indexOf("%"))&&(c=0===f?e.offsetWidth-P.width:e.offsetHeight-P.height,u[f]=l?parseFloat(m)/100*c+"px":100*(parseFloat(m)/c)+"%");m=u.join(" ")}return this.parseComplex(e.style,m,g,s,o)},!1,!1,G),ht("backgroundSize","0 0",null,!1,!1,G),ht("perspective","0px",null,!0),ht("perspectiveOrigin","50% 50%",null,!0),ht("transformStyle",null,null,!0),ht("backfaceVisibility",null,null,!0),ht("margin",null,ot("marginTop,marginRight,marginBottom,marginLeft")),ht("padding",null,ot("paddingTop,paddingRight,paddingBottom,paddingLeft")),ht("clip","rect(0px,0px,0px,0px)"),ht("textShadow","0px 0px 0px #999",null,!1,!0),ht("autoRound,strictUnits",null,function(e,t,n,r,i){return i}),ht("border","0px solid #000",function(e,t,n,i,s,o){return this.parseComplex(e.style,this.format(W(e,"borderTopWidth",r,!1,"0px")+" "+W(e,"borderTopStyle",r,!1,"solid")+" "+W(e,"borderTopColor",r,!1,"#000")),this.format(t),s,o)},!1,!0,function(e){var t=e.split(" ");return t[0]+" "+(t[1]||"solid")+" "+(e.match(it)||["#000"])[0]}),ht("float,cssFloat,styleFloat",null,function(e,t,n,r,i){var s=e.style,o="cssFloat"in s?"cssFloat":"styleFloat";return new at(s,o,0,0,i,-1,n,!1,0,s[o],t)});var xt=function(e){var t,n=this.t,r=n.filter,i=this.s+this.c*e>>0;100===i&&(-1===r.indexOf("atrix(")&&-1===r.indexOf("radient(")?(n.removeAttribute("filter"),t=!W(this.data,"filter")):(n.filter=r.replace(E,""),t=!0)),t||(this.xn1&&(n.filter=r=r||"alpha(opacity=100)"),-1===r.indexOf("opacity")?n.filter+=" alpha(opacity="+i+")":n.filter=r.replace(b,"opacity="+i))};ht("opacity,alpha,autoAlpha","1",function(e,t,n,i,s,o){var u,a=parseFloat(W(e,"opacity",r,!1,"1")),f=e.style;return t=parseFloat(t),"autoAlpha"===n&&(u=W(e,"visibility",r),1===a&&"hidden"===u&&0!==t&&(a=0),s=new at(f,"visibility",0,0,s,-1,null,!1,0,0!==a?"visible":"hidden",0===t?"hidden":"visible"),s.xs0="visible",i._overwriteProps.push(s.n)),j?s=new at(f,"opacity",a,t-a,s):(s=new at(f,"opacity",100*a,100*(t-a),s),s.xn1="autoAlpha"===n?1:0,f.zoom=1,s.type=2,s.b="alpha(opacity="+s.s+")",s.e="alpha(opacity="+(s.s+s.c)+")",s.data=e,s.plugin=o,s.setRatio=xt),s});var Tt=function(e){if(1===e||0===e){this.t.className=1===e?this.e:this.b;for(var t=this.data,n=this.t.style,r=n.removeProperty?"removeProperty":"removeAttribute";t;)t.v?n[t.p]=t.v:n[r](t.p.replace(S,"-$1").toLowerCase()),t=t._next}else this.t.className!==this.b&&(this.t.className=this.b)};ht("className",null,function(e,n,i,s,o,u,a){var f,l,c=e.className,h=e.style.cssText;return o=s._classNamePT=new at(e,i,0,0,o,2),o.setRatio=Tt,o.pr=-11,t=!0,o.b=c,o.e="="!==n.charAt(1)?n:"+"===n.charAt(0)?c+" "+n.substr(2):c.split(n.substr(2)).join(""),s._tween._duration&&(l=X(e,r,!0),e.className=o.e,f=V(e,l,X(e),a),e.className=c,o.data=f.firstMPT,e.style.cssText=h,o=o.xfirst=s.parse(e,f.difs,o,u)),o});var Nt=function(e){if((1===e||0===e)&&this.data._totalTime===this.data._totalDuration)for(var t,n="all"===this.e,r=this.t.style,i=n?r.cssText.split(";"):this.e.split(","),s=r.removeProperty?"removeProperty":"removeAttribute",u=i.length,a=o.transform.parse;--u>-1;)t=i[u],n&&(t=t.substr(0,t.indexOf(":")).split(" ").join("")),o[t]&&(t=o[t].parse===a?vt:o[t].p),t&&r[s](t.replace(S,"-$1").toLowerCase())};for(ht("clearProps",null,function(e,n,r,i,s){return s=new at(e,r,0,0,s,2),s.setRatio=Nt,s.e=n,s.pr=-10,s.data=i._tween,t=!0,s}),u="bezier,throwProps,physicsProps,physics2D".split(","),lt=u.length;lt--;)pt(u[lt]);return u=s.prototype,u._firstPT=null,u._onInitTween=function(e,o,u){if(!e.nodeType)return!1;this._target=e,this._tween=u,this._vars=o,a=o.autoRound,t=!1,n=o.suffixMap||s.suffixMap,r=z(e,""),i=this._overwriteProps;var c,p,d,v,m,g,y,b,E,S=e.style;if(f&&""===S.zIndex&&(c=W(e,"zIndex",r),("auto"===c||""===c)&&(S.zIndex=0)),"string"==typeof o&&(v=S.cssText,c=X(e,r),S.cssText=v+";"+o,c=V(e,c,X(e)).difs,!j&&w.test(o)&&(c.opacity=parseFloat(RegExp.$1)),o=c,S.cssText=v),this._firstPT=p=this.parse(e,o,null),this._transformType){for(E=3===this._transformType,vt?l&&(f=!0,""===S.zIndex&&(y=W(e,"zIndex",r),("auto"===y||""===y)&&(S.zIndex=0)),h&&(S.WebkitBackfaceVisibility=this._vars.WebkitBackfaceVisibility||(E?"visible":"hidden"))):S.zoom=1,d=p;d&&d._next;)d=d._next;b=new at(e,"transform",0,0,null,2),this._linkCSSP(b,null,d),b.setRatio=E&&yt?Et:vt?St:wt,b.data=this._transform||bt(e,r,!0),i.pop()}if(t){for(;p;){for(g=p._next,d=v;d&&d.pr>p.pr;)d=d._next;(p._prev=d?d._prev:m)?p._prev._next=p:v=p,(p._next=d)?d._prev=p:m=p,p=g}this._firstPT=v}return!0},u.parse=function(e,t,i,s){var u,f,l,c,h,p,d,v,m,g,b=e.style;for(u in t)p=t[u],f=o[u],f?i=f.parse(e,p,u,this,i,s,t):(h=W(e,u,r)+"",m="string"==typeof p,"color"===u||"fill"===u||"stroke"===u||-1!==u.indexOf("Color")||m&&!p.indexOf("rgb")?(m||(p=rt(p),p=(p.length>3?"rgba(":"rgb(")+p.join(",")+")"),i=ft(b,u,h,p,!0,"transparent",i,0,s)):!m||-1===p.indexOf(" ")&&-1===p.indexOf(",")?(l=parseFloat(h),d=l||0===l?h.substr((l+"").length):"",(""===h||"auto"===h)&&("width"===u||"height"===u?(l=K(e,u,r),d="px"):(l="opacity"!==u?0:1,d="")),g=m&&"="===p.charAt(1),g?(c=parseInt(p.charAt(0)+"1",10),p=p.substr(2),c*=parseFloat(p),v=p.replace(y,"")):(c=parseFloat(p),v=m?p.substr((c+"").length)||"":""),""===v&&(v=n[u]||d),p=c||0===c?(g?c+l:c)+v:t[u],d!==v&&""!==v&&(c||0===c)&&(l||0===l)&&(l=Q(e,u,l,d),"%"===v?(l/=Q(e,u,100,"%")/100,l>100&&(l=100),t.strictUnits!==!0&&(h=l+"%")):"em"===v?l/=Q(e,u,1,"em"):(c=Q(e,u,c,v),v="px"),g&&(c||0===c)&&(p=c+l+v)),g&&(c+=l),!l&&0!==l||!c&&0!==c?p||"NaN"!=p+""&&null!=p?(i=new at(b,u,c||l||0,0,i,-1,"css_"+u,!1,0,h,p),i.xs0="display"===u&&"none"===p?h:p):I("invalid "+u+" tween value. "):(i=new at(b,u,l,c-l,i,0,"css_"+u,a!==!1&&("px"===v||"zIndex"===u),0,h,p),i.xs0=v)):i=ft(b,u,h,p,!0,null,i,0,s)),s&&i&&!i.plugin&&(i.plugin=s);return i},u.setRatio=function(e){var t,n,r,i=this._firstPT,s=1e-6;if(1!==e||this._tween._time!==this._tween._duration&&0!==this._tween._time)if(e||this._tween._time!==this._tween._duration&&0!==this._tween._time||this._tween._rawPrevTime===-0.000001)for(;i;){if(t=i.c*e+i.s,i.r?t=t>0?t+.5>>0:t-.5>>0:s>t&&t>-s&&(t=0),i.type)if(1===i.type)if(r=i.l,2===r)i.t[i.p]=i.xs0+t+i.xs1+i.xn1+i.xs2;else if(3===r)i.t[i.p]=i.xs0+t+i.xs1+i.xn1+i.xs2+i.xn2+i.xs3;else if(4===r)i.t[i.p]=i.xs0+t+i.xs1+i.xn1+i.xs2+i.xn2+i.xs3+i.xn3+i.xs4;else if(5===r)i.t[i.p]=i.xs0+t+i.xs1+i.xn1+i.xs2+i.xn2+i.xs3+i.xn3+i.xs4+i.xn4+i.xs5;else{for(n=i.xs0+t+i.xs1,r=1;i.l>r;r++)n+=i["xn"+r]+i["xs"+(r+1)];i.t[i.p]=n}else-1===i.type?i.t[i.p]=i.xs0:i.setRatio&&i.setRatio(e);else i.t[i.p]=t+i.xs0;i=i._next}else for(;i;)2!==i.type?i.t[i.p]=i.b:i.setRatio(e),i=i._next;else for(;i;)2!==i.type?i.t[i.p]=i.e:i.setRatio(e),i=i._next},u._enableTransforms=function(e){this._transformType=e||3===this._transformType?3:2},u._linkCSSP=function(e,t,n,r){return e&&(t&&(t._prev=e),e._next&&(e._next._prev=e._prev),n?n._next=e:r||null!==this._firstPT||(this._firstPT=e),e._prev?e._prev._next=e._next:this._firstPT===e&&(this._firstPT=e._next),e._next=t,e._prev=n),e},u._kill=function(t){var n,r,i,s=t,o=!1;if(t.css_autoAlpha||t.css_alpha){s={};for(r in t)s[r]=t[r];s.css_opacity=1,s.css_autoAlpha&&(s.css_visibility=1)}return t.css_className&&(n=this._classNamePT)&&(i=n.xfirst,i&&i._prev?this._linkCSSP(i._prev,n._next,i._prev._prev):i===this._firstPT&&(this._firstPT=null),n._next&&this._linkCSSP(n._next,n._next._next,i._prev),this._target._gsOverwrittenClassNamePT=this._linkCSSP(n,this._target._gsOverwrittenClassNamePT),this._classNamePT=null,o=!0),e.prototype._kill.call(this,s)||o},e.activate([s]),s},!0),function(){var e=window._gsDefine.plugin({propName:"roundProps",priority:-1,API:2,init:function(e,t,n){return this._tween=n,!0}}),t=e.prototype;t._onInitAllProps=function(){for(var e,t,n,r=this._tween,i=r.vars.roundProps instanceof Array?r.vars.roundProps:r.vars.roundProps.split(","),s=i.length,o={},u=r._propLookup.roundProps;--s>-1;)o[i[s]]=1;for(s=i.length;--s>-1;)for(e=i[s],t=r._firstPT;t;)n=t._next,t.pg?t.t._roundProps(o,!0):t.n===e&&(this._add(t.t,e,t.s,t.c),n&&(n._prev=t._prev),t._prev?t._prev._next=n:r._firstPT===t&&(r._firstPT=n),t._next=t._prev=null,r._propLookup[e]=u),t=n;return!1},t._add=function(e,t,n,r){this._addTween(e,t,n,n+r,t,!0),this._overwriteProps.push(t)}}(),window._gsDefine.plugin({propName:"attr",API:2,init:function(e,t){var n;if("function"!=typeof e.setAttribute)return!1;this._target=e,this._proxy={};for(n in t)this._addTween(this._proxy,n,parseFloat(e.getAttribute(n)),t[n],n),this._overwriteProps.push(n);return!0},set:function(e){this._super.setRatio.call(this,e);for(var t,n=this._overwriteProps,r=n.length;--r>-1;)t=n[r],this._target.setAttribute(t,this._proxy[t]+"")}}),window._gsDefine.plugin({propName:"directionalRotation",API:2,init:function(e,t,n){"object"!=typeof t&&(t={rotation:t}),this.finals={},this._tween=n;var r,i,s,o,u,a,f,l=t.useRadians===!0?2*Math.PI:360;for(r in t)"useRadians"!==r&&(a=(t[r]+"").split("_"),i=a[0],f=a[1],s=parseFloat("function"!=typeof e[r]?e[r]:e[r.indexOf("set")||"function"!=typeof e["get"+r.substr(3)]?r:"get"+r.substr(3)]()),o=this.finals[r]="string"==typeof i&&"="===i.charAt(1)?s+parseInt(i.charAt(0)+"1",10)*Number(i.substr(2)):Number(i)||0,u=o-s,"short"===f?(u%=l,u!==u%(l/2)&&(u=0>u?u+l:u-l)):"cw"===f&&0>u?u=(u+9999999999*l)%l-(0|u/l)*l:"ccw"===f&&u>0&&(u=(u-9999999999*l)%l-(0|u/l)*l),this._addTween(e,r,s,s+u,r),this._overwriteProps.push(r));return!0},set:function(e){var t;if(1!==e)this._super.setRatio.call(this,e);else for(t=this._firstPT;t;)t.f?t.t[t.p](this.finals[t.p]):t.t[t.p]=this.finals[t.p],t=t._next}})._autoCSS=!0,window._gsDefine("easing.Back",["easing.Ease"],function(e){var t,n,r=window.GreenSockGlobals||window,i=r.com.greensock,s=2*Math.PI,o=Math.PI/2,u=i._class,a=function(t,n){var r=u("easing."+t,function(){},!0),i=r.prototype=new e;return i.constructor=r,i.getRatio=n,r},f=e.register||function(){},l=function(e,t,n,r){var i=u("easing."+e,{easeOut:new t,easeIn:new n,easeInOut:new r},!0);return f(i,e),i},c=function(t,n){var r=u("easing."+t,function(e){this._p1=e||0===e?e:1.70158,this._p2=1.525*this._p1},!0),i=r.prototype=new e;return i.constructor=r,i.getRatio=n,i.config=function(e){return new r(e)},r},h=l("Back",c("BackOut",function(e){return(e-=1)*e*((this._p1+1)*e+this._p1)+1}),c("BackIn",function(e){return e*e*((this._p1+1)*e-this._p1)}),c("BackInOut",function(e){return 1>(e*=2)?.5*e*e*((this._p2+1)*e-this._p2):.5*((e-=2)*e*((this._p2+1)*e+this._p2)+2)})),p=u("easing.SlowMo",function(e,t,n){t=t||0===t?t:.7,null==e?e=.7:e>1&&(e=1),this._p=1!==e?t:0,this._p1=(1-e)/2,this._p2=e,this._p3=this._p1+this._p2,this._calcEnd=n===!0},!0),d=p.prototype=new e;return d.constructor=p,d.getRatio=function(e){var t=e+(.5-e)*this._p;return this._p1>e?this._calcEnd?1-(e=1-e/this._p1)*e:t-(e=1-e/this._p1)*e*e*e*t:e>this._p3?this._calcEnd?1-(e=(e-this._p3)/this._p1)*e:t+(e-t)*(e=(e-this._p3)/this._p1)*e*e*e:this._calcEnd?1:t},p.ease=new p(.7,.7),d.config=p.config=function(e,t,n){return new p(e,t,n)},t=u("easing.SteppedEase",function(e){e=e||1,this._p1=1/e,this._p2=e+1},!0),d=t.prototype=new e,d.constructor=t,d.getRatio=function(e){return 0>e?e=0:e>=1&&(e=.999999999),(this._p2*e>>0)*this._p1},d.config=t.config=function(e){return new t(e)},l("Bounce",a("BounceOut",function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}),a("BounceIn",function(e){return 1/2.75>(e=1-e)?1-7.5625*e*e:2/2.75>e?1-(7.5625*(e-=1.5/2.75)*e+.75):2.5/2.75>e?1-(7.5625*(e-=2.25/2.75)*e+.9375):1-(7.5625*(e-=2.625/2.75)*e+.984375)}),a("BounceInOut",function(e){var t=.5>e;return e=t?1-2*e:2*e-1,e=1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,t?.5*(1-e):.5*e+.5})),l("Circ",a("CircOut",function(e){return Math.sqrt(1-(e-=1)*e)}),a("CircIn",function(e){return-(Math.sqrt(1-e*e)-1)}),a("CircInOut",function(e){return 1>(e*=2)?-0.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)})),n=function(t,n,r){var i=u("easing."+t,function(e,t){this._p1=e||1,this._p2=t||r,this._p3=this._p2/s*(Math.asin(1/this._p1)||0)},!0),o=i.prototype=new e;return o.constructor=i,o.getRatio=n,o.config=function(e,t){return new i(e,t)},i},l("Elastic",n("ElasticOut",function(e){return this._p1*Math.pow(2,-10*e)*Math.sin((e-this._p3)*s/this._p2)+1},.3),n("ElasticIn",function(e){return-(this._p1*Math.pow(2,10*(e-=1))*Math.sin((e-this._p3)*s/this._p2))},.3),n("ElasticInOut",function(e){return 1>(e*=2)?-0.5*this._p1*Math.pow(2,10*(e-=1))*Math.sin((e-this._p3)*s/this._p2):.5*this._p1*Math.pow(2,-10*(e-=1))*Math.sin((e-this._p3)*s/this._p2)+1},.45)),l("Expo",a("ExpoOut",function(e){return 1-Math.pow(2,-10*e)}),a("ExpoIn",function(e){return Math.pow(2,10*(e-1))-.001}),a("ExpoInOut",function(e){return 1>(e*=2)?.5*Math.pow(2,10*(e-1)):.5*(2-Math.pow(2,-10*(e-1)))})),l("Sine",a("SineOut",function(e){return Math.sin(e*o)}),a("SineIn",function(e){return-Math.cos(e*o)+1}),a("SineInOut",function(e){return-0.5*(Math.cos(Math.PI*e)-1)})),u("easing.EaseLookup",{find:function(t){return e.map[t]}},!0),f(r.SlowMo,"SlowMo","ease,"),f(t,"SteppedEase","ease,"),h},!0)}),function(e){var t,n,r,i,s=e.GreenSockGlobals||e,o=function(e){var t,n=e.split("."),r=s;for(t=0;n.length>t;t++)r[n[t]]=r=r[n[t]]||{};return r},u=o("com.greensock"),a={},f=function(t,n,r,i){this.sc=a[t]?a[t].sc:[],a[t]=this,this.gsClass=null,this.func=r;var u=[];this.check=function(l){for(var c,h,p,d,v=n.length,m=v;--v>-1;)(c=a[n[v]]||new f(n[v],[])).gsClass?(u[v]=c.gsClass,m--):l&&c.sc.push(this);if(0===m&&r)for(h=("com.greensock."+t).split("."),p=h.pop(),d=o(h.join("."))[p]=this.gsClass=r.apply(r,u),i&&(s[p]=d,"function"==typeof define&&define.amd?define((e.GreenSockAMDPath?e.GreenSockAMDPath+"/":"")+t.split(".").join("/"),[],function(){return d}):"undefined"!=typeof module&&module.exports&&(module.exports=d)),v=0;this.sc.length>v;v++)this.sc[v].check()},this.check(!0)},l=e._gsDefine=function(e,t,n,r){return new f(e,t,n,r)},c=u._class=function(e,t,n){return t=t||function(){},l(e,[],function(){return t},n),t};l.globals=s;var h=[0,0,1,1],p=[],d=c("easing.Ease",function(e,t,n,r){this._func=e,this._type=n||0,this._power=r||0,this._params=t?h.concat(t):h},!0),v=d.map={},m=d.register=function(e,t,n,r){for(var i,s,o,a,f=t.split(","),l=f.length,h=(n||"easeIn,easeOut,easeInOut").split(",");--l>-1;)for(s=f[l],i=r?c("easing."+s,null,!0):u.easing[s]||{},o=h.length;--o>-1;)a=h[o],v[s+"."+a]=v[a+s]=i[a]=e.getRatio?e:e[a]||new e};for(r=d.prototype,r._calcEnd=!1,r.getRatio=function(e){if(this._func)return this._params[0]=e,this._func.apply(null,this._params);var t=this._type,n=this._power,r=1===t?1-e:2===t?e:.5>e?2*e:2*(1-e);return 1===n?r*=r:2===n?r*=r*r:3===n?r*=r*r*r:4===n&&(r*=r*r*r*r),1===t?1-r:2===t?r:.5>e?r/2:1-r/2},t=["Linear","Quad","Cubic","Quart","Quint,Strong"],n=t.length;--n>-1;)r=t[n]+",Power"+n,m(new d(null,null,1,n),r,"easeOut",!0),m(new d(null,null,2,n),r,"easeIn"+(0===n?",easeNone":"")),m(new d(null,null,3,n),r,"easeInOut");v.linear=u.easing.Linear.easeIn,v.swing=u.easing.Quad.easeInOut;var g=c("events.EventDispatcher",function(e){this._listeners={},this._eventTarget=e||this});r=g.prototype,r.addEventListener=function(e,t,n,r,i){i=i||0;var s,o,u=this._listeners[e],a=0;for(null==u&&(this._listeners[e]=u=[]),o=u.length;--o>-1;)s=u[o],s.c===t?u.splice(o,1):0===a&&i>s.pr&&(a=o+1);u.splice(a,0,{c:t,s:n,up:r,pr:i})},r.removeEventListener=function(e,t){var n,r=this._listeners[e];if(r)for(n=r.length;--n>-1;)if(r[n].c===t)return r.splice(n,1),void 0},r.dispatchEvent=function(e){var t=this._listeners[e];if(t)for(var n,r=t.length,i=this._eventTarget;--r>-1;)n=t[r],n.up?n.c.call(n.s||i,{type:e,target:i}):n.c.call(n.s||i)};var y=e.requestAnimationFrame,b=e.cancelAnimationFrame,w=Date.now||function(){return(new Date).getTime()};for(t=["ms","moz","webkit","o"],n=t.length;--n>-1&&!y;)y=e[t[n]+"RequestAnimationFrame"],b=e[t[n]+"CancelAnimationFrame"]||e[t[n]+"CancelRequestAnimationFrame"];c("Ticker",function(t,n){var r,i,s,o,u,a=this,f=w(),l=n!==!1&&y,c=function(){null!=s&&(l&&b?b(s):e.clearTimeout(s),s=null)},h=function(e){a.time=(w()-f)/1e3,(!r||a.time>=u||e===!0)&&(a.frame++,u=a.time>u?a.time+o-(a.time-u):a.time+o-.001,a.time+.001>u&&(u=a.time+.001),a.dispatchEvent("tick")),e!==!0&&(s=i(h))};g.call(a),this.time=this.frame=0,this.tick=function(){h(!0)},this.fps=function(e){return arguments.length?(r=e,o=1/(r||60),u=this.time+o,i=0===r?function(){}:l&&y?y:function(e){return setTimeout(e,1e3*(u-a.time)+1>>0||1)},c(),s=i(h),void 0):r},this.useRAF=function(e){return arguments.length?(c(),l=e,a.fps(r),void 0):l},a.fps(t),setTimeout(function(){l&&!s&&a.useRAF(!1)},1e3)}),r=u.Ticker.prototype=new u.events.EventDispatcher,r.constructor=u.Ticker;var E=c("core.Animation",function(e,t){if(this.vars=t||{},this._duration=this._totalDuration=e||0,this._delay=Number(this.vars.delay)||0,this._timeScale=1,this._active=this.vars.immediateRender===!0,this.data=this.vars.data,this._reversed=this.vars.reversed===!0,P){i||(S.tick(),i=!0);var n=this.vars.useFrames?D:P;n.add(this,n._time),this.vars.paused&&this.paused(!0)}}),S=E.ticker=new u.Ticker;r=E.prototype,r._dirty=r._gc=r._initted=r._paused=!1,r._totalTime=r._time=0,r._rawPrevTime=-1,r._next=r._last=r._onUpdate=r._timeline=r.timeline=null,r._paused=!1,r.play=function(e,t){return arguments.length&&this.seek(e,t),this.reversed(!1),this.paused(!1)},r.pause=function(e,t){return arguments.length&&this.seek(e,t),this.paused(!0)},r.resume=function(e,t){return arguments.length&&this.seek(e,t),this.paused(!1)},r.seek=function(e,t){return this.totalTime(Number(e),t!==!1)},r.restart=function(e,t){return this.reversed(!1),this.paused(!1),this.totalTime(e?-this._delay:0,t!==!1)},r.reverse=function(e,t){return arguments.length&&this.seek(e||this.totalDuration(),t),this.reversed(!0),this.paused(!1)},r.render=function(){},r.invalidate=function(){return this},r._enabled=function(e,t){return this._gc=!e,this._active=e&&!this._paused&&this._totalTime>0&&this._totalTime<this._totalDuration,t!==!0&&(e&&null==this.timeline?this._timeline.add(this,this._startTime-this._delay):e||null==this.timeline||this._timeline._remove(this,!0)),!1},r._kill=function(){return this._enabled(!1,!1)},r.kill=function(e,t){return this._kill(e,t),this},r._uncache=function(e){for(var t=e?this:this.timeline;t;)t._dirty=!0,t=t.timeline;return this},r.eventCallback=function(e,t,n,r){if(null==e)return null;if("on"===e.substr(0,2)){if(1===arguments.length)return this.vars[e];if(null==t)delete this.vars[e];else if(this.vars[e]=t,this.vars[e+"Params"]=n,this.vars[e+"Scope"]=r,n)for(var i=n.length;--i>-1;)"{self}"===n[i]&&(n=this.vars[e+"Params"]=n.concat(),n[i]=this);"onUpdate"===e&&(this._onUpdate=t)}return this},r.delay=function(e){return arguments.length?(this._timeline.smoothChildTiming&&this.startTime(this._startTime+e-this._delay),this._delay=e,this):this._delay},r.duration=function(e){return arguments.length?(this._duration=this._totalDuration=e,this._uncache(!0),this._timeline.smoothChildTiming&&this._time>0&&this._time<this._duration&&0!==e&&this.totalTime(this._totalTime*(e/this._duration),!0),this):(this._dirty=!1,this._duration)},r.totalDuration=function(e){return this._dirty=!1,arguments.length?this.duration(e):this._totalDuration},r.time=function(e,t){return arguments.length?(this._dirty&&this.totalDuration(),e>this._duration&&(e=this._duration),this.totalTime(e,t)):this._time},r.totalTime=function(e,t){if(!arguments.length)return this._totalTime;if(this._timeline){if(0>e&&(e+=this.totalDuration()),this._timeline.smoothChildTiming&&(this._dirty&&this.totalDuration(),e>this._totalDuration&&(e=this._totalDuration),this._startTime=(this._paused?this._pauseTime:this._timeline._time)-(this._reversed?this._totalDuration-e:e)/this._timeScale,this._timeline._dirty||this._uncache(!1),!this._timeline._active))for(var n=this._timeline;n._timeline;)n.totalTime(n._totalTime,!0),n=n._timeline;this._gc&&this._enabled(!0,!1),this._totalTime!==e&&this.render(e,t,!1)}return this},r.startTime=function(e){return arguments.length?(e!==this._startTime&&(this._startTime=e,this.timeline&&this.timeline._sortChildren&&this.timeline.add(this,e-this._delay)),this):this._startTime},r.timeScale=function(e){if(!arguments.length)return this._timeScale;if(e=e||1e-6,this._timeline&&this._timeline.smoothChildTiming){var t=this._pauseTime||0===this._pauseTime?this._pauseTime:this._timeline._totalTime;this._startTime=t-(t-this._startTime)*this._timeScale/e}return this._timeScale=e,this._uncache(!1)},r.reversed=function(e){return arguments.length?(e!=this._reversed&&(this._reversed=e,this.totalTime(this._totalTime,!0)),this):this._reversed},r.paused=function(e){return arguments.length?(e!=this._paused&&this._timeline&&(!e&&this._timeline.smoothChildTiming&&(this._startTime+=this._timeline.rawTime()-this._pauseTime,this._uncache(!1)),this._pauseTime=e?this._timeline.rawTime():null,this._paused=e,this._active=!this._paused&&this._totalTime>0&&this._totalTime<this._totalDuration),this._gc&&(e||this._enabled(!0,!1)),this):this._paused};var x=c("core.SimpleTimeline",function(e){E.call(this,0,e),this.autoRemoveChildren=this.smoothChildTiming=!0});r=x.prototype=new E,r.constructor=x,r.kill()._gc=!1,r._first=r._last=null,r._sortChildren=!1,r.add=function(e,t){var n,r;if(e._startTime=Number(t||0)+e._delay,e._paused&&this!==e._timeline&&(e._pauseTime=e._startTime+(this.rawTime()-e._startTime)/e._timeScale),e.timeline&&e.timeline._remove(e,!0),e.timeline=e._timeline=this,e._gc&&e._enabled(!0,!0),n=this._last,this._sortChildren)for(r=e._startTime;n&&n._startTime>r;)n=n._prev;return n?(e._next=n._next,n._next=e):(e._next=this._first,this._first=e),e._next?e._next._prev=e:this._last=e,e._prev=n,this._timeline&&this._uncache(!0),this},r.insert=r.add,r._remove=function(e,t){return e.timeline===this&&(t||e._enabled(!1,!0),e.timeline=null,e._prev?e._prev._next=e._next:this._first===e&&(this._first=e._next),e._next?e._next._prev=e._prev:this._last===e&&(this._last=e._prev),this._timeline&&this._uncache(!0)),this},r.render=function(e,t,n){var r,i=this._first;for(this._totalTime=this._time=this._rawPrevTime=e;i;)r=i._next,(i._active||e>=i._startTime&&!i._paused)&&(i._reversed?i.render((i._dirty?i.totalDuration():i._totalDuration)-(e-i._startTime)*i._timeScale,t,n):i.render((e-i._startTime)*i._timeScale,t,n)),i=r},r.rawTime=function(){return this._totalTime};var T=c("TweenLite",function(e,t,n){if(E.call(this,t,n),null==e)throw"Cannot tween an undefined reference.";this.target=e="string"!=typeof e?e:T.selector(e)||e,this._overwrite=null==this.vars.overwrite?_[T.defaultOverwrite]:"number"==typeof this.vars.overwrite?this.vars.overwrite>>0:_[this.vars.overwrite];var r,i,s=e.jquery||"function"==typeof e.each&&e[0]&&e[0].nodeType&&e[0].style;if((s||e instanceof Array)&&"number"!=typeof e[0])for(this._targets=s&&!e.slice?C(e):e.slice(0),this._propLookup=[],this._siblings=[],r=0;this._targets.length>r;r++)i=this._targets[r],i?"string"!=typeof i?"function"==typeof i.each&&i[0]&&i[0].nodeType&&i[0].style?(this._targets.splice(r--,1),this._targets=this._targets.concat(C(i))):(this._siblings[r]=H(i,this,!1),1===this._overwrite&&this._siblings[r].length>1&&B(i,this,null,1,this._siblings[r])):(i=this._targets[r--]=T.selector(i),"string"==typeof i&&this._targets.splice(r+1,1)):this._targets.splice(r--,1);else this._propLookup={},this._siblings=H(e,this,!1),1===this._overwrite&&this._siblings.length>1&&B(e,this,null,1,this._siblings);(this.vars.immediateRender||0===t&&0===this._delay&&this.vars.immediateRender!==!1)&&this.render(-this._delay,!1,!0)},!0),N=function(e){return"function"==typeof e.each&&e[0]&&e[0].nodeType&&e[0].style},C=function(e){var t=[];return e.each(function(){t.push(this)}),t},k=function(e,t){var n,r={};for(n in e)M[n]||n in t&&"x"!==n&&"y"!==n&&"width"!==n&&"height"!==n&&"className"!==n||!(!L[n]||L[n]&&L[n]._autoCSS)||(r[n]=e[n],delete e[n]);e.css=r};r=T.prototype=new E,r.constructor=T,r.kill()._gc=!1,r.ratio=0,r._firstPT=r._targets=r._overwrittenProps=r._startAt=null,r._notifyPluginsOfEnabled=!1,T.version="1.9.0",T.defaultEase=r._ease=new d(null,null,1,1),T.defaultOverwrite="auto",T.ticker=S,T.selector=e.$||e.jQuery||function(t){return e.$?(T.selector=e.$,e.$(t)):e.document?e.document.getElementById("#"===t.charAt(0)?t.substr(1):t):t};var L=T._plugins={},A=T._tweenLookup={},O=0,M={ease:1,delay:1,overwrite:1,onComplete:1,onCompleteParams:1,onCompleteScope:1,useFrames:1,runBackwards:1,startAt:1,onUpdate:1,onUpdateParams:1,onUpdateScope:1,onStart:1,onStartParams:1,onStartScope:1,onReverseComplete:1,onReverseCompleteParams:1,onReverseCompleteScope:1,onRepeat:1,onRepeatParams:1,onRepeatScope:1,easeParams:1,yoyo:1,orientToBezier:1,immediateRender:1,repeat:1,repeatDelay:1,data:1,paused:1,reversed:1,autoCSS:1},_={none:0,all:1,auto:2,concurrent:3,allOnStart:4,preexisting:5,"true":1,"false":0},D=E._rootFramesTimeline=new x,P=E._rootTimeline=new x;P._startTime=S.time,D._startTime=S.frame,P._active=D._active=!0,E._updateRoot=function(){if(P.render((S.time-P._startTime)*P._timeScale,!1,!1),D.render((S.frame-D._startTime)*D._timeScale,!1,!1),!(S.frame%120)){var e,t,n;for(n in A){for(t=A[n].tweens,e=t.length;--e>-1;)t[e]._gc&&t.splice(e,1);0===t.length&&delete A[n]}}},S.addEventListener("tick",E._updateRoot);var H=function(e,t,n){var r,i,s=e._gsTweenID;if(A[s||(e._gsTweenID=s="t"+O++)]||(A[s]={target:e,tweens:[]}),t&&(r=A[s].tweens,r[i=r.length]=t,n))for(;--i>-1;)r[i]===t&&r.splice(i,1);return A[s].tweens},B=function(e,t,n,r,i){var s,o,u,a;if(1===r||r>=4){for(a=i.length,s=0;a>s;s++)if((u=i[s])!==t)u._gc||u._enabled(!1,!1)&&(o=!0);else if(5===r)break;return o}var f,l=t._startTime+1e-10,c=[],h=0,p=0===t._duration;for(s=i.length;--s>-1;)(u=i[s])===t||u._gc||u._paused||(u._timeline!==t._timeline?(f=f||j(t,0,p),0===j(u,f,p)&&(c[h++]=u)):l>=u._startTime&&u._startTime+u.totalDuration()/u._timeScale+1e-10>l&&((p||!u._initted)&&2e-10>=l-u._startTime||(c[h++]=u)));for(s=h;--s>-1;)u=c[s],2===r&&u._kill(n,e)&&(o=!0),(2!==r||!u._firstPT&&u._initted)&&u._enabled(!1,!1)&&(o=!0);return o},j=function(e,t,n){for(var r=e._timeline,i=r._timeScale,s=e._startTime;r._timeline;){if(s+=r._startTime,i*=r._timeScale,r._paused)return-100;r=r._timeline}return s/=i,s>t?s-t:n&&s===t||!e._initted&&2e-10>s-t?1e-10:(s+=e.totalDuration()/e._timeScale/i)>t?0:s-t-1e-10};r._init=function(){var e,t,n,r=this.vars,i=r.ease;if(r.startAt&&(r.startAt.overwrite=0,r.startAt.immediateRender=!0,this._startAt=new T(this.target,0,r.startAt),r.immediateRender&&(this._startAt=null)),this._ease=i?i instanceof d?r.easeParams instanceof Array?i.config.apply(i,r.easeParams):i:"function"==typeof i?new d(i,r.easeParams):v[i]||T.defaultEase:T.defaultEase,this._easeType=this._ease._type,this._easePower=this._ease._power,this._firstPT=null,this._targets)for(e=this._targets.length;--e>-1;)this._initProps(this._targets[e],this._propLookup[e]={},this._siblings[e],this._overwrittenProps?this._overwrittenProps[e]:null)&&(t=!0);else t=this._initProps(this.target,this._propLookup,this._siblings,this._overwrittenProps);if(t&&T._onPluginEvent("_onInitAllProps",this),this._overwrittenProps&&null==this._firstPT&&"function"!=typeof this.target&&this._enabled(!1,!1),r.runBackwards)for(n=this._firstPT;n;)n.s+=n.c,n.c=-n.c,n=n._next;this._onUpdate=r.onUpdate,this._initted=!0},r._initProps=function(e,t,n,r){var i,s,o,u,a,f,l;if(null==e)return!1;this.vars.css||e.style&&e.nodeType&&L.css&&this.vars.autoCSS!==!1&&k(this.vars,e);for(i in this.vars){if(M[i]){if(("onStartParams"===i||"onUpdateParams"===i||"onCompleteParams"===i||"onReverseCompleteParams"===i||"onRepeatParams"===i)&&(a=this.vars[i]))for(s=a.length;--s>-1;)"{self}"===a[s]&&(a=this.vars[i]=a.concat(),a[s]=this)}else if(L[i]&&(u=new L[i])._onInitTween(e,this.vars[i],this)){for(this._firstPT=f={_next:this._firstPT,t:u,p:"setRatio",s:0,c:1,f:!0,n:i,pg:!0,pr:u._priority},s=u._overwriteProps.length;--s>-1;)t[u._overwriteProps[s]]=this._firstPT;(u._priority||u._onInitAllProps)&&(o=!0),(u._onDisable||u._onEnable)&&(this._notifyPluginsOfEnabled=!0)}else this._firstPT=t[i]=f={_next:this._firstPT,t:e,p:i,f:"function"==typeof e[i],n:i,pg:!1,pr:0},f.s=f.f?e[i.indexOf("set")||"function"!=typeof e["get"+i.substr(3)]?i:"get"+i.substr(3)]():parseFloat(e[i]),l=this.vars[i],f.c="string"==typeof l&&"="===l.charAt(1)?parseInt(l.charAt(0)+"1",10)*Number(l.substr(2)):Number(l)-f.s||0;f&&f._next&&(f._next._prev=f)}return r&&this._kill(r,e)?this._initProps(e,t,n,r):this._overwrite>1&&this._firstPT&&n.length>1&&B(e,this,t,this._overwrite,n)?(this._kill(t,e),this._initProps(e,t,n,r)):o},r.render=function(e,t,n){var r,i,s,o=this._time;if(e>=this._duration)this._totalTime=this._time=this._duration,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1,this._reversed||(r=!0,i="onComplete"),0===this._duration&&((0===e||0>this._rawPrevTime)&&this._rawPrevTime!==e&&(n=!0),this._rawPrevTime=e);else if(0>=e)this._totalTime=this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==o||0===this._duration&&this._rawPrevTime>0)&&(i="onReverseComplete",r=this._reversed),0>e?(this._active=!1,0===this._duration&&(this._rawPrevTime>=0&&(n=!0),this._rawPrevTime=e)):this._initted||(n=!0);else if(this._totalTime=this._time=e,this._easeType){var u=e/this._duration,a=this._easeType,f=this._easePower;(1===a||3===a&&u>=.5)&&(u=1-u),3===a&&(u*=2),1===f?u*=u:2===f?u*=u*u:3===f?u*=u*u*u:4===f&&(u*=u*u*u*u),this.ratio=1===a?1-u:2===a?u:.5>e/this._duration?u/2:1-u/2}else this.ratio=this._ease.getRatio(e/this._duration);if(this._time!==o||n){for(this._initted||(this._init(),!r&&this._time&&(this.ratio=this._ease.getRatio(this._time/this._duration))),this._active||this._paused||(this._active=!0),0===o&&(this._startAt&&this._startAt.render(e,t,n),this.vars.onStart&&(0!==this._time||0===this._duration)&&(t||this.vars.onStart.apply(this.vars.onStartScope||this,this.vars.onStartParams||p))),s=this._firstPT;s;)s.f?s.t[s.p](s.c*this.ratio+s.s):s.t[s.p]=s.c*this.ratio+s.s,s=s._next;this._onUpdate&&(0>e&&this._startAt&&this._startAt.render(e,t,n),t||this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||p)),i&&(this._gc||(0>e&&this._startAt&&(this._onUpdate||this._startAt.render(e,t,n)),r&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),t||this.vars[i]&&this.vars[i].apply(this.vars[i+"Scope"]||this,this.vars[i+"Params"]||p)))}},r._kill=function(e,t){if("all"===e&&(e=null),null!=e||null!=t&&t!==this.target){t="string"!=typeof t?t||this._targets||this.target:T.selector(t)||t;var n,r,i,s,o,u,a,f;if((t instanceof Array||N(t))&&"number"!=typeof t[0])for(n=t.length;--n>-1;)this._kill(e,t[n])&&(u=!0);else{if(this._targets){for(n=this._targets.length;--n>-1;)if(t===this._targets[n]){o=this._propLookup[n]||{},this._overwrittenProps=this._overwrittenProps||[],r=this._overwrittenProps[n]=e?this._overwrittenProps[n]||{}:"all";break}}else{if(t!==this.target)return!1;o=this._propLookup,r=this._overwrittenProps=e?this._overwrittenProps||{}:"all"}if(o){a=e||o,f=e!==r&&"all"!==r&&e!==o&&(null==e||e._tempKill!==!0);for(i in a)(s=o[i])&&(s.pg&&s.t._kill(a)&&(u=!0),s.pg&&0!==s.t._overwriteProps.length||(s._prev?s._prev._next=s._next:s===this._firstPT&&(this._firstPT=s._next),s._next&&(s._next._prev=s._prev),s._next=s._prev=null),delete o[i]),f&&(r[i]=1)}}return u}return this._enabled(!1,!1)},r.invalidate=function(){return this._notifyPluginsOfEnabled&&T._onPluginEvent("_onDisable",this),this._firstPT=null,this._overwrittenProps=null,this._onUpdate=null,this._startAt=null,this._initted=this._active=this._notifyPluginsOfEnabled=!1,this._propLookup=this._targets?{}:[],this},r._enabled=function(e,t){if(e&&this._gc)if(this._targets)for(var n=this._targets.length;--n>-1;)this._siblings[n]=H(this._targets[n],this,!0);else this._siblings=H(this.target,this,!0);return E.prototype._enabled.call(this,e,t),this._notifyPluginsOfEnabled&&this._firstPT?T._onPluginEvent(e?"_onEnable":"_onDisable",this):!1},T.to=function(e,t,n){return new T(e,t,n)},T.from=function(e,t,n){return n.runBackwards=!0,0!=n.immediateRender&&(n.immediateRender=!0),new T(e,t,n)},T.fromTo=function(e,t,n,r){return r.startAt=n,r.immediateRender=0!=r.immediateRender&&0!=n.immediateRender,new T(e,t,r)},T.delayedCall=function(e,t,n,r,i){return new T(t,0,{delay:e,onComplete:t,onCompleteParams:n,onCompleteScope:r,onReverseComplete:t,onReverseCompleteParams:n,onReverseCompleteScope:r,immediateRender:!1,useFrames:i,overwrite:0})},T.set=function(e,t){return new T(e,0,t)},T.killTweensOf=T.killDelayedCallsTo=function(e,t){for(var n=T.getTweensOf(e),r=n.length;--r>-1;)n[r]._kill(t,e)},T.getTweensOf=function(e){if(null!=e){e="string"!=typeof e?e:T.selector(e)||e;var t,n,r,i;if((e instanceof Array||N(e))&&"number"!=typeof e[0]){for(t=e.length,n=[];--t>-1;)n=n.concat(T.getTweensOf(e[t]));for(t=n.length;--t>-1;)for(i=n[t],r=t;--r>-1;)i===n[r]&&n.splice(t,1)}else for(n=H(e).concat(),t=n.length;--t>-1;)n[t]._gc&&n.splice(t,1);return n}};var F=c("plugins.TweenPlugin",function(e,t){this._overwriteProps=(e||"").split(","),this._propName=this._overwriteProps[0],this._priority=t||0,this._super=F.prototype},!0);if(r=F.prototype,F.version=12,F.API=2,r._firstPT=null,r._addTween=function(e,t,n,r,i,s){var o,u;null!=r&&(o="number"==typeof r||"="!==r.charAt(1)?Number(r)-n:parseInt(r.charAt(0)+"1",10)*Number(r.substr(2)))&&(this._firstPT=u={_next:this._firstPT,t:e,p:t,s:n,c:o,f:"function"==typeof e[t],n:i||t,r:s},u._next&&(u._next._prev=u))},r.setRatio=function(e){for(var t,n=this._firstPT,r=1e-6;n;)t=n.c*e+n.s,n.r?t=t+(t>0?.5:-0.5)>>0:r>t&&t>-r&&(t=0),n.f?n.t[n.p](t):n.t[n.p]=t,n=n._next},r._kill=function(e){var t,n=this._overwriteProps,r=this._firstPT;if(null!=e[this._propName])this._overwriteProps=[];else for(t=n.length;--t>-1;)null!=e[n[t]]&&n.splice(t,1);for(;r;)null!=e[r.n]&&(r._next&&(r._next._prev=r._prev),r._prev?(r._prev._next=r._next,r._prev=null):this._firstPT===r&&(this._firstPT=r._next)),r=r._next;return!1},r._roundProps=function(e,t){for(var n=this._firstPT;n;)(e[this._propName]||null!=n.n&&e[n.n.split(this._propName+"_").join("")])&&(n.r=t),n=n._next},T._onPluginEvent=function(e,t){var n,r,i,s,o,u=t._firstPT;if("_onInitAllProps"===e){for(;u;){for(o=u._next,r=i;r&&r.pr>u.pr;)r=r._next;(u._prev=r?r._prev:s)?u._prev._next=u:i=u,(u._next=r)?r._prev=u:s=u,u=o}u=t._firstPT=i}for(;u;)u.pg&&"function"==typeof u.t[e]&&u.t[e]()&&(n=!0),u=u._next;return n},F.activate=function(e){for(var t=e.length;--t>-1;)e[t].API===F.API&&(T._plugins[(new e[t])._propName]=e[t]);return!0},l.plugin=function(e){if(!(e&&e.propName&&e.init&&e.API))throw"illegal plugin definition.";var t,n=e.propName,r=e.priority||0,i=e.overwriteProps,s={init:"_onInitTween",set:"setRatio",kill:"_kill",round:"_roundProps",initAll:"_onInitAllProps"},o=c("plugins."+n.charAt(0).toUpperCase()+n.substr(1)+"Plugin",function(){F.call(this,n,r),this._overwriteProps=i||[]},e.global===!0),u=o.prototype=new F(n);u.constructor=o,o.API=e.API;for(t in s)"function"==typeof e[t]&&(u[s[t]]=e[t]);return o.version=e.version,F.activate([o]),o},t=e._gsQueue){for(n=0;t.length>n;n++)t[n]();for(r in a)a[r].func||e.console.log("GSAP encountered missing dependency: com.greensock."+r)}i=!1}(window),define("TweenMax",function(){}),define("sound/MasterTrack",["application/EventManager"],function(e){var t,n=function(e){t=e},r=function(e){e.connect(t.destination)},i=function(n){var r=e.eventArgs(n).node;r.connect(t.destination)},s=function(n){var r=e.eventArgs(n).node;r.connect(t.destination)},o=function(n){var r=e.eventArgs(n).node;r.connect(t.destination)},u=function(n){var r=e.eventArgs(n).pos,i=e.eventArgs(n).vel,s=e.eventArgs(n).rot;t.listener.setPosition(r[0],r[1],r[2]),t.listener.setOrientation(s[0],s[1],s[2],0,1,0),t.listener.setVelocity(i[0],i[1],i[2])};return e.registerListener(e.list().SEND_SOUND_TO_LISTENER,i),e.registerListener(e.list().SEND_SOUND_TO_MASTER,s),e.registerListener(e.list().SEND_SOUND_TO_DESTINATION,o),e.registerListener(e.list().MOVE_AUDIO_LISTENER,u),{setContext:n,connectTrack:r}}),define("sound/MixTrack",["application/EventManager","sound/MasterTrack","sound/EffectTrack"],function(e,t,n){var r=function(e,t,n,r){this.channelId=e,this.is3dSource=t,this.context=r,this.fxSend=n,this.channelGain=1,this.tuneLevel=1,this.wireTrack(),this.defaultMix()};return r.prototype.wireTrack=function(){this.gainNode=this.context.createGain(),this.filterNode=this.context.createBiquadFilter(),this.filterNode.connect(this.gainNode),t.connectTrack(this.gainNode);if(this.fxSend){var e=this.context.createGain();this.gainNode.connect(e),e.gain.value=this.fxSend,n.connectTrackToFx(e)}},r.prototype.defaultMix=function(){this.setTrackGain(1,0),this.setFilterQValue(1e-8,0),this.setFilterFreqValue(2e4,0)},r.prototype.addSourceNode=function(e){e.connect(this.filterNode)},r.prototype.setTrackGain=function(e,t){t||(t=.5),this.gainNode.gain.linearRampToValueAtTime(e,this.context.currentTime+t)},r.prototype.setFilterQValue=function(e,t){t||(t=.5),this.filterNode.Q.linearRampToValueAtTime(e,t+this.context.currentTime)},r.prototype.getFilterQValue=function(){return this.filterNode.Q.value},r.prototype.setFilterFreqValue=function(e,t){t||(t=.5),this.filterNode.frequency.linearRampToValueAtTime(e,t+this.context.currentTime)},r.prototype.getFilterFreqValue=function(){return this.filterNode.frequency.value},r.prototype.tuneFilterQ=function(e){this.setFilterQValue(1*e,.01)},r.prototype.tuneFilterFreq=function(e){this.setFilterFreqValue(2e4*e,.01)},r.prototype.tuneGain=function(e){this.tuneLevel=e,this.setTrackGain(this.channelGain*this.tuneLevel,.01)},r.prototype.setChannelGain=function(e){this.channelGain=e,this.setTrackGain(this.channelGain*this.tuneLevel,.01)},r.prototype.getChannelGain=function(){return this.channelGain},r}),define("sound/ChannelMixer",["game/GameConfiguration","application/EventManager","sound/MasterTrack","sound/EffectTrack","sound/MixTrack"],function(e,t,n,r,i){var s={},o=e.MIX_TRACKS,u=function(){return o},a=function(e){return s[e].mixTrack},f=function(){return s},l=function(e,t,n,r){var o=new i(e,t,n,r);s[e]=o},c=function(e){for(var t in o)l(o[t].id,o[t].spatial,o[t].fxSend,e)},h=function(e){r.setContext(e),n.setContext(e),c(e)},p=function(e,t){s[e.track.id].addSourceNode(t.gainNode)},d=function(e){var n=t.eventArgs(e).channelId,r=t.eventArgs(e).valueId,i=t.eventArgs(e).amount;s[n][r](i)},v=function(e,t){s[t].addSourceNode(e)};return t.registerListener(t.list().MIX_CHANNEL_VALUE,d),{getTracks:u,connectNodeToChannel:v,addSoundToChannel:p,setupMixChannels:h,getChannels:f}}),define("sound/SoundPlayer",["application/EventManager","application/DeviceHandler","sound/ChannelMixer"],function(e,t,n){var r={},i={},s={},o=[0,0,0],u,a=[],f=90,l=0,c=t.hasPowerSound(),h="HRTF",p=function(e,t){var n=u.createPanner();return n.rolloffFactor=t,n.panningModel=h,n.coneInnerAngle=360,n.coneOuterAngle=360,n.refDistance=e,n},d=function(){for(var e=0;e<f;e++)a[e]=p(10,.5);console.log("PANNER POOL:",a)},v=function(e,t,i,o){e.source.setGain(e.gain);var u=e.source.getSource(),a=e.source.wire(u),f={playId:t,source:e.source,sourceNode:u,gainNode:a};o?r[t]=f:t&&(s[t]=f),n.addSoundToChannel(e,f),e.source.play(u,o),typeof i=="function"&&i(f)},m=function(e,t){if(typeof e.source.getSource!="function")return;var n=e.source.getSource(),r={source:e.source,sourceNode:n,data:e};t(r)},g=function(e,t){if(typeof e.source.getSource!="function")return;var n=e.source.getSource().buffer;t(n)},y=function(e){var t=r[e].source;t.pause(r[e].sourceNode),delete r[e]},b=function(e){var t=s[e].source;t.pause(s[e].sourceNode),delete s[e]},w=function(t){var n=e.eventArgs(t).soundData,r=e.eventArgs(t).playId,i=e.eventArgs(t).callback;v(n,r,i,!1)},E=function(t){var n=e.eventArgs(t).soundData,r=e.eventArgs(t).loopId,i=e.eventArgs(t).callback;v(n,r,i,!0)},S=function(t){var n=e.eventArgs(t).loopId;y(n)},x=function(t){var n=e.eventArgs(t).playId;b(n)},T=function(t){var n=e.eventArgs(t).soundData,r=e.eventArgs(t).callback;m(n,r)},N=function(t){u=e.eventArgs(t).context,c||d(),n.setupMixChannels(u)},C=function(t){var n=e.eventArgs(t).soundData,r=e.eventArgs(t).callback;g(n,r)},k=function(e){var t=Math.abs(Math.abs(e[0])-Math.abs(o[0]))+Math.abs(Math.abs(e[1])-Math.abs(o[1]))+Math.abs(Math.abs(e[2])-Math.abs(o[2]));return t},L=function(e,t){if(c)return p(e,t);var n=l+1;n>=f&&(n=0);var r=a[n];return r.disconnect(),r},A=function(t){var r=e.eventArgs(t).soundData,i=e.eventArgs(t).pos,s=e.eventArgs(t).vel,o=e.eventArgs(t).dir,a=k(i);if(a>1e4)return;var f=L(r.options.refDist,r.options.rolloff),l=u.createGain();f.setPosition(i[0],i[1],i[2]),s||(s=[0,0,0]),f.setVelocity(s[0],s[1],s[2]),f.setOrientation(o[0],o[1],o[2]);var c=function(e){l.gain.value=1,e.sourceNode.connect(l),l.connect(f),n.connectNodeToChannel(f,n.getTracks().game.id),e.sourceNode.start(0)};m(r,c)},O=function(t){var i=e.eventArgs(t).soundData,s=e.eventArgs(t).playId,o=e.eventArgs(t).callback,a=p(i.options.refDist,i.options.rolloff),f=u.createGain(),l=function(e){f.gain.value=1,e.sourceNode.connect(f),e.sourceNode.loop=!0,f.connect(a),n.connectNodeToChannel(a,n.getTracks().game.id),e.panner=a,e.gainNode=f,e.playId=s,o(e),e.sourceNode.start(0),r[s]=e};m(i,l)},M=function(t){var n=e.eventArgs(t).pos,r=e.eventArgs(t).vel;o=n};e.registerListener(e.list().REGISTER_AUDIO_CONTEXT,N),e.registerListener(e.list().FETCH_SOUND,T),e.registerListener(e.list().FETCH_BUFFER,C),e.registerListener(e.list().STOP_SOUND,x),e.registerListener(e.list().ONESHOT_SOUND,w),e.registerListener(e.list().ONESHOT_AMBIENT_SOUND,A),e.registerListener(e.list().LOOP_AMBIENT_SOUND,O),e.registerListener(e.list().START_SOUND_LOOP,E),e.registerListener(e.list().STOP_SOUND_LOOP,S),e.registerListener(e.list().MOVE_AUDIO_LISTENER,M)}),define("view/Animate",["TweenMax","application/EventManager","sound/SoundPlayer"],function(e,t,n){var r=function(t,n){e[n.mode](t,n.time,n.values)},i=function(e,t){for(var n in t.toPercent)switch(n){case"y":var r=e.parentNode.offsetHeight;r||alert("Not Ready"),t.values.y=Math.round(r*t.toPercent[n]*.01)+"px";break;case"x":var i=e.parentNode.offsetWidth;t.values.x=Math.round(i*t.toPercent[n]*.01)+"px"}},s=function(e){var n=t.eventArgs(e),s=document.getElementById(n.elementId),o=n.animData;o.toPercent&&i(s,o),r(s,o)},o=function(e){var s=t.eventArgs(e),o=document.getElementById(s.elementId);s.feedback.animData&&(s.feedback.animData.toPercent&&i(o,s.feedback.animData),r(o,s.feedback.animData)),s.feedback.soundData&&n.playSound(s.feedback.soundData)},u=function(){},a=function(){console.log("Register ui anim listeners"),t.registerListener(t.list().TRIGGER_ANIMATION,s),t.registerListener(t.list().TRIGGER_FEEDBACK,o),t.registerListener(t.list().RENDER_TICK,u)};return{registerListeners:a}}),define("view/Renderer",["application/EventManager","template/TemplateRenderer","view/Animate"],function(e,t,n){console.log("Init Template Renderer"),n.registerListeners();var r,i=function(){clearTimeout(r);var t=document.body,n=document.getElementById("viewporter"),i=t.offsetWidth,s=t.offsetHeight,o=72,u=i;s<u;if(s/540<i/960){var a=Math.round(s*(960/540));n.style.width=a+"px",n.style.height=s+"px",n.style.left=Math.round(-0.5*(a-i))+"px",n.style.top="",u=s}else{var f=Math.round(i*.5625);n.style.width=i+"px",n.style.height=f+"px",n.style.top=Math.round(-0.5*(f-s))+"px",n.style.left="",o/=.5625}var l=u/o;t.style.fontSize=l+"pt",e.fireEvent(e.list().WINDOW_RESIZED,{})};window.addEventListener("resize",i,!1),i();var s=function(e){setTimeout(function(){t.renderTemplate(e.element,e.template,e.text,e.directives)},0)};return{renderTemplate:s}}),define("view/ActiveView",["view/Renderer","view/DomUtils"],function(e,t){var n=0,r={},i=function(){return n=1,"id_"+n},s=function(e){var t=i();return e.id=t,r[t]=e,t},o=function(t){e.renderTemplate(t)},u=function(e){t.removeElement(e.element),setTimeout(function(){delete r[e.id]},50)},a=function(){for(var t in r)e.renderTemplate(r[t])};return{add:o,remove:u,render:a}}),define("view/ButtonFactory",["view/DomUtils"],function(e){var t=function(t,n,r){var i=function(){n(r)};e.addElementClickFunction(t,i)},n=function(e){var n=e.hasClick,r=e.action;return{html:function(e){t(e.element,n,r)}}};return{createButton:n}}),define("view/RenderableFactory",["view/ButtonFactory","view/DomUtils","application/EventManager"],function(e,t,n){var r=0,i=function(i,s){r+=1;var o=t.createDivElement(i,"renderable_"+r,"","full_size"),u={},a=function(e){setTimeout(function(){e()},0)};for(var f in s.data.directives){var l=s.data.directives[f];for(var c in l)c=="hasClick"&&(u[f]=e.createButton(l)),c=="dynamicDirective"&&a(l[c])}if(s.data.spriteElementIds)for(var h=0;h<s.data.spriteElementIds.length;h++)n.fireEvent(n.list().REGISTER_SPRITE,{elementId:s.data.spriteElementIds[h]});return{element:o,template:s,text:s.data.text,directives:u}},s=function(e){var r=n.eventArgs(e).elementId,i=n.eventArgs(e).data,s=i[n.eventArgs(e).propertyId].text,o=t.getElementById(r);t.setElementHtml(o,s)};n.registerListener(n.list().SET_ELEMENT_TEXT,s);var o=function(e){var r=n.eventArgs(e).elementId,i=n.eventArgs(e).data.getServerConfig().lines,s=t.getElementById(r),o=function(e,n){var r=t.createDivElement(s.id,s.id+"_nr_"+e,"","payline_info_container"),i=t.createDivElement(r.id,r.id+"_label",e,"payline_info_nr"),o=t.createDivElement(r.id,r.id+"_matrix","","payline_info_matrix");for(var u=0;u<n.length;u++){var a=t.createDivElement(o.id,o.id+"_col_"+u,"","payline_info_column");for(var f=0;f<3;f++){var l=t.createDivElement(a.id,a.id+"_row_"+f,"","payline_info_symbol");n[u]==f&&t.addElementClass(l,"payline_participant")}}};for(var u=0;u<i.length;u++)o(u+1,i[u])};n.registerListener(n.list().LAYOUT_LINES,o);var u=function(e){var r=n.eventArgs(e).elementId,i=n.eventArgs(e).data.getServerConfig(),s=n.eventArgs(e).property,o=t.getElementById(r),u=n.eventArgs(e).onClick,a=function(e,n){t.addElementClickFunction(e,n)},f=function(e,r,i){var u=t.createDivElement(o.id,s+"_"+e,r,"menu_selection"),f=function(){n.fireEvent(n.list().SET_SETTING_INDEX,{elementId:u.id,settingId:s,properties:{value:r,index:e}})};a(u,f)};for(var l=0;l<i[s].length;l++)f(l,i[s][l],u)};return n.registerListener(n.list().LAYOUT_RADIO_BUTTONS,u),{buildRenderable:i}}),define("view/PageOpener",["view/ActiveView","view/RenderableFactory"],function(e,t){var n,r,i=function(e){n=e},s=function(){return n},o=function(e){r=e},u=function(){return r},a=function(n){var r=n.template,s=t.buildRenderable(n.parentId,r);return i(s),e.add(s),e.render(),s},f=function(n,r){var i=n.template,s=t.buildRenderable(r,i);return o(s),e.add(s),e.render(),s},l=function(){u()&&e.remove(u()),o(null)},c=function(t){e.remove(t)};return{overlay:f,open:a,removeRenderable:c,closeOverlay:l}}),define("game/characters/CharacterAnimator",["application/EventManager","game/characters/CharacterData"],function(e,t){function o(e){return e>0?n.turnRight:e<0?n.turnLeft:n.idle}function u(e){return e>0?n.strafeRight:e<0?n.strafeLeft:n.idle}function a(e){return e>0?n.forward:e<0?n.back:n.idle}function f(e,t){if(e>0){if(t>0)return n.halfStrafeRight;if(t<0)return n.halfStrafeLeft}if(e<0){if(t>0)return n.backRight;if(t<0)return n.backLeft}return n.idle}function l(e,t,n){return e==0&&t==0?o(n):t==0?a(e):e==0?u(t):f(e,t)}function c(e){var t=e.forward-e.back,n=e.strafe*(e.turnright-e.turnleft),r=(1-e.strafe)*(e.turnright-e.turnleft)+e.mouseturn;return l(t,n,r)}function h(e,t){var s=e.animStateMap[t];e.geometries[0].animationComponent.transitionTo(s),t==n.idle||t=="sit"||t=="jumpstate"?clearTimeout(r):(e.currentMovementAnimState=!t)&&i(e)}function p(e){var t=e.pieceData.animations.moveStates;h(e,t[e.currentMovementAnimState])}function d(e,t){var n=e.pieceData.animations[t],r=e.animationComponent.getCurrentState();if(r.name!=n)return r.name}function m(e,t){clearTimeout(v),v=setTimeout(function(){g(e,t)},100)}var n=t.ANIM_STATES.movement,r,i=function(e){clearTimeout(r),s(e)},s=function(t){r=setTimeout(function(){var n=Math.ceil(Math.random()*3),r=t.spatial.pos.data;e.fireEvent(e.list().ONESHOT_AMBIENT_SOUND,{soundData:e.sound()["STEP_ROAD_"+n],pos:[r[0],r[1]+1,r[2]],dir:[Math.random()-.5,Math.random(),Math.random()-.5]}),i(t)},300)},v,g=function(e,t){if(e.isPilot)return;e.geometries[0].animationComponent||(alert("No Animation"),console.log(e.geometries[0]));if(!e.geometries[0].animationComponent.getCurrentState()){m(e,t);return}var r=n.jumpState;e.moveSphere.spatialControl.sphereMovement.groundContact&&(r=c(t));if(e.geometries[0].animationComponent.getCurrentState()._name==undefined){m(e,t);return}if(e.currentMovementAnimState==r)return;e.currentMovementAnimState=r,p(e)};return{applyMovementAnimation:p,applyEntityAnimationState:h,updateCharacterMovementAnimation:g}}),define("game/player/PlayerUtils",["application/EventManager","game/characters/CharacterAnimator"],function(e,t){function r(){return n.getPlayerEntity()}var n;require(["game/player/PlayerController"],function(e){n=e});var i=function(e){var t=r();for(var n in t.wings)t.wings[n].visualize(t,t.wings[n],e)},s=function(t){var n=e.eventArgs(t).pos,i=" "+[r().spatial.pos.data[0],r().spatial.pos.data[1],r().spatial.pos.data[2]];e.fireEvent(e.list().ANALYTICS_EVENT,{category:"ui_action",action:"RESET",labels:"From:"+i,value:0}),r().spatial.pos.set(n)},o=function(e){e.systems.canopy&&(console.log("Lock: ",e.systems.canopy),e.systems.canopy.locked=!1)},u=function(n,r){n.isPilot!=1&&console.log("Pilot transition failed! ",n),n.moveSphere.deactivate(),r.pilot=n,n.spatial.velocity.set(0,0,0),t.applyEntityAnimationState(n,n.pieceData.animations.seated.pilotSit),setTimeout(function(){e.fireEvent(e.list().SET_CAMERA_TARGET,{spatial:n.spatial,geometry:n.geometries[0],controlScript:"pilotCam"}),o(r)},200)},a=function(t){for(var n=0;n<t.pieceData.uiPages.length;n++)e.fireEvent(e.list().UNLOAD_UI_TEMPLATE,{templateId:t.pieceData.uiPages[n]})},f=function(t,n){u(t,n),setTimeout(function(){e.fireEvent(e.list().SET_PLAYER_CONTROLLED_ENTITY,{entity:n})},200)},l=function(){var t=r().spatial.pos;console.log("USE NEAREST ENTITY");var n=r();a(n),n.isPilot=!0,setTimeout(function(){function r(e){f(n,e)}e.fireEvent(e.list().FETCH_LEVEL_ENTITY,{entityId:"NEAREST",pos:t,callback:r})},200)},c=function(){e.registerListener(e.list().PLAYER_MOVE_TO_POINT,s),e.registerListener(e.list().USE_NEAREST_ENTITY,l)},h=function(t){f(e.eventArgs(t).pilot,e.eventArgs(t).vehicle)};return e.registerListener(e.list().SCENARIO_LOADED,c),e.registerListener(e.list().PILOT_VEHICLE,h),{handleDebugState:i}}),define("goo/math/Matrix",["goo/math/MathUtils"],function(e){function t(e,t){this.rows=e||0,this.cols=t||0,this.data=new Float32Array(this.rows*this.cols)}return t.prototype.setupAliases=function(e){var t=this;for(var n=0;n<e.length;n++)(function(r){for(var s=0;s<e[r].length;s++)Object.defineProperty(t,e[r][s],{get:function(){return this.data[r]},set:function(e){this.data[r]=e}});Object.defineProperty(t,n,{get:function(){return this.data[r]},set:function(e){this.data[r]=e}})})(n)},t.add=function(e,n,r){var i=e.rows,s=e.cols;r||(r=new t(i,s));if(n instanceof t){if(n.rows!==i||n.cols!==s||r.rows!==i||r.cols!==s)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var o=0;o<e.data.length;o++)r.data[o]=e.data[o]+n.data[o]}else{if(r.rows!==i||r.cols!==s)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var o=0;o<e.data.length;o++)r.data[o]=e.data[o]+n}return r},t.prototype.add=function(e){return t.add(this,e,this)},t.sub=function(e,n,r){var i=e.rows,s=e.cols;r||(r=new t(i,s));if(n instanceof t){if(n.rows!==i||n.cols!==s||r.rows!==i||r.cols!==s)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var o=0;o<e.data.length;o++)r.data[o]=e.data[o]-n.data[o]}else{if(r.rows!==i||r.cols!==s)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var o=0;o<e.data.length;o++)r.data[o]=e.data[o]-n}return r},t.prototype.sub=function(e){return t.sub(this,e,this)},t.mul=function(e,n,r){var i=e.rows,s=e.cols;r||(r=new t(i,s));if(n instanceof t){if(n.rows!==i||n.cols!==s||r.rows!==i||r.cols!==s)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var o=0;o<e.data.length;o++)r.data[o]=e.data[o]*n.data[o]}else{if(r.rows!==i||r.cols!==s)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var o=0;o<e.data.length;o++)r.data[o]=e.data[o]*n}return r},t.prototype.mul=function(e){return t.mul(this,e,this)},t.div=function(e,n,r){var i=e.rows,s=e.cols;r||(r=new t(i,s));if(n instanceof t){if(n.rows!==i||n.cols!==s||r.rows!==i||r.cols!==s)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var o=0;o<e.data.length;o++)r.data[o]=e.data[o]/n.data[o]}else{if(r.rows!==i||r.cols!==s)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};n=1/n;for(var o=0;o<e.data.length;o++)r.data[o]=e.data[o]*n}return r},t.prototype.div=function(e){return t.div(this,e,this)},t.combine=function(e,n,r){var i=e.rows,s=n.cols,o=e.cols=n.rows;r||(r=new t(i,s));if(e.cols!==o||n.rows!==o||r.rows!==i||r.cols!==s)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};if(r===e||r===n)return t.copy(t.combine(e,n),r);for(var u=0;u<s;u++){var a=u*i;for(var f=0;f<i;f++){var l=0;for(var c=0;c<o;c++)l+=e.data[c*e.rows+f]*n.data[u*n.rows+c];r.data[a+f]=l}}return r},t.prototype.combine=function(e){return t.combine(this,e,this)},t.transpose=function(e,n){var r=e.cols,i=e.rows;n||(n=new t(r,i));if(n.rows!==r||n.cols!==i)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};if(n===e)return t.copy(t.transpose(e),n);for(var s=0;s<i;s++){var o=s*r;for(var u=0;u<r;u++)n.data[o+u]=e.data[u*i+s]}return n},t.prototype.transpose=function(){return t.transpose(this,this)},t.copy=function(e,n){var r=e.rows,i=e.cols;n||(n=new t(r,i));if(n.rows!==r||n.cols!==i)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return n.data.set(e.data),n},t.prototype.copy=function(e){return t.copy(e,this)},t.equals=function(t,n){if(t.rows!==n.rows||t.cols!==n.cols)return!1;for(var r=0;r<t.data.length;r++)if(Math.abs(t.data[r]-n.data[r])>e.EPSILON)return!1;return!0},t.prototype.equals=function(e){return t.equals(this,e)},t.prototype.isOrthogonal=function(){for(var t=0;t<this.cols;t++)for(var n=t+1;n<this.cols;n++){var r=t*this.rows,i=n*this.rows,s=0;for(var o=0;o<this.rows;o++)s+=this.data[r+o]*this.data[i+o];if(Math.abs(s)>e.EPSILON)return!1}return!0},t.prototype.isNormal=function(){for(var t=0;t<this.cols;t++){var n=t*this.rows,r=0;for(var i=0;i<this.rows;i++)r+=this.data[n+i]*this.data[n+i];if(Math.abs(r-1)>e.EPSILON)return!1}return!0},t.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()},t.prototype.clone=function(){return t.copy(this)},t.prototype.set=function(){if(arguments.length===1&&typeof arguments[0]=="object")if(arguments[0]instanceof t)this.copy(arguments[0]);else for(var e=0;e<arguments[0].length;e++)this.data[e]=arguments[0][e];else for(var e=0;e<arguments.length;e++)this.data[e]=arguments[e];return this},t.prototype.toString=function(){var e="";for(var t=0;t<this.cols;t++){var n=t*this.rows;e+="[";for(var r=0;r<this.rows;r++)e+=this.data[n+r],e+=r!==this.rows-1?", ":"";e+=t!==this.cols-1?"], ":"]"}return e},t}),define("goo/math/Matrix3x3",["goo/math/MathUtils","goo/math/Matrix","goo/math/Vector3"],function(e,t,n){function r(){t.call(this,3,3),arguments.length===0?this.setIdentity():this.set(arguments),this._tempX=new n,this._tempY=new n,this._tempZ=new n}return r.prototype=Object.create(t.prototype),r.prototype.setupAliases([["e00"],["e10"],["e20"],["e01"],["e11"],["e21"],["e02"],["e12"],["e22"]]),r.IDENTITY=new r(1,0,0,0,1,0,0,0,1),r.add=function(e,t,n){n||(n=new r);var i=n.data,s=e.data;if(t instanceof r){var o=t.data;i[0]=s[0]+o[0],i[1]=s[1]+o[1],i[2]=s[2]+o[2],i[3]=s[3]+o[3],i[4]=s[4]+o[4],i[5]=s[5]+o[5],i[6]=s[6]+o[6],i[7]=s[7]+o[7],i[8]=s[8]+o[8]}else i[0]=s[0]+t,i[1]=s[1]+t,i[2]=s[2]+t,i[3]=s[3]+t,i[4]=s[4]+t,i[5]=s[5]+t,i[6]=s[6]+t,i[7]=s[7]+t,i[8]=s[8]+t;return n},r.prototype.add=function(e){return r.add(this,e,this)},r.sub=function(e,t,n){n||(n=new r);var i=n.data,s=e.data;if(t instanceof r){var o=t.data;i[0]=s[0]-o[0],i[1]=s[1]-o[1],i[2]=s[2]-o[2],i[3]=s[3]-o[3],i[4]=s[4]-o[4],i[5]=s[5]-o[5],i[6]=s[6]-o[6],i[7]=s[7]-o[7],i[8]=s[8]-o[8]}else i[0]=s[0]-t,i[1]=s[1]-t,i[2]=s[2]-t,i[3]=s[3]-t,i[4]=s[4]-t,i[5]=s[5]-t,i[6]=s[6]-t,i[7]=s[7]-t,i[8]=s[8]-t;return n},r.prototype.sub=function(e){return r.sub(this,e,this)},r.mul=function(e,t,n){n||(n=new r);var i=n.data,s=e.data;if(t instanceof r){var o=t.data;i[0]=s[0]*o[0],i[1]=s[1]*o[1],i[2]=s[2]*o[2],i[3]=s[3]*o[3],i[4]=s[4]*o[4],i[5]=s[5]*o[5],i[6]=s[6]*o[6],i[7]=s[7]*o[7],i[8]=s[8]*o[8]}else i[0]=s[0]*t,i[1]=s[1]*t,i[2]=s[2]*t,i[3]=s[3]*t,i[4]=s[4]*t,i[5]=s[5]*t,i[6]=s[6]*t,i[7]=s[7]*t,i[8]=s[8]*t;return n},r.prototype.mul=function(e){return r.mul(this,e,this)},r.div=function(e,t,n){n||(n=new r);var i=n.data,s=e.data;if(t instanceof r){var o=t.data;i[0]=s[0]/o[0],i[1]=s[1]/o[1],i[2]=s[2]/o[2],i[3]=s[3]/o[3],i[4]=s[4]/o[4],i[5]=s[5]/o[5],i[6]=s[6]/o[6],i[7]=s[7]/o[7],i[8]=s[8]/o[8]}else i[0]=s[0]/t,i[1]=s[1]/t,i[2]=s[2]/t,i[3]=s[3]/t,i[4]=s[4]/t,i[5]=s[5]/t,i[6]=s[6]/t,i[7]=s[7]/t,i[8]=s[8]/t;return n},r.prototype.div=function(e){return r.div(this,e,this)},r.combine=function(e,t,n){n||(n=new r);var i=e.data,s=i[0],o=i[3],u=i[6],a=i[1],f=i[4],l=i[7],c=i[2],h=i[5],p=i[8],d=t.data,v=d[0],m=d[3],g=d[6],y=d[1],b=d[4],w=d[7],E=d[2],S=d[5],x=d[8],T=n.data;return T[0]=s*v+o*y+u*E,T[3]=s*m+o*b+u*S,T[6]=s*g+o*w+u*x,T[1]=a*v+f*y+l*E,T[4]=a*m+f*b+l*S,T[7]=a*g+f*w+l*x,T[2]=c*v+h*y+p*E,T[5]=c*m+h*b+p*S,T[8]=c*g+h*w+p*x,n},r.prototype.combine=function(e){return r.combine(this,e,this)},r.transpose=function(e,t){t||(t=new r);var n=e.data,i=t.data;if(t===e){var s=n[3],o=n[6],u=n[7];return i[3]=n[1],i[6]=n[2],i[7]=n[5],i[1]=s,i[2]=o,i[5]=u,t}return i[0]=n[0],i[1]=n[3],i[2]=n[6],i[3]=n[1],i[4]=n[4],i[5]=n[7],i[6]=n[2],i[7]=n[5],i[8]=n[8],t},r.prototype.transpose=function(){return r.transpose(this,this)},r.invert=function(n,i){i||(i=new r);if(i===n)return t.copy(r.invert(n),i);var s=n.determinant();if(Math.abs(s)<e.EPSILON)return i;s=1/s;var o=i.data,u=n.data;return o[0]=(u[4]*u[8]-u[7]*u[5])*s,o[1]=(u[7]*u[2]-u[1]*u[8])*s,o[2]=(u[1]*u[5]-u[4]*u[2])*s,o[3]=(u[6]*u[5]-u[3]*u[8])*s,o[4]=(u[0]*u[8]-u[6]*u[2])*s,o[5]=(u[3]*u[2]-u[0]*u[5])*s,o[6]=(u[3]*u[7]-u[6]*u[4])*s,o[7]=(u[6]*u[1]-u[0]*u[7])*s,o[8]=(u[0]*u[4]-u[3]*u[1])*s,i},r.prototype.invert=function(){return r.invert(this,this)},r.prototype.isOrthogonal=function(){var t=this.data,n=t[0]*t[3]+t[1]*t[4]+t[2]*t[5];return Math.abs(n)>e.EPSILON?!1:(n=t[0]*t[6]+t[1]*t[7]+t[2]*t[8],Math.abs(n)>e.EPSILON?!1:(n=t[3]*t[6]+t[4]*t[7]+t[5]*t[8],Math.abs(n)>e.EPSILON?!1:!0))},r.prototype.isNormal=function(){var t=this.data,n=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];return Math.abs(n-1)>e.EPSILON?!1:(n=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],Math.abs(n-1)>e.EPSILON?!1:(n=t[6]*t[6]+t[7]*t[7]+t[8]*t[8],Math.abs(n-1)>e.EPSILON?!1:!0))},r.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()},r.prototype.determinant=function(){var e=this.data;return e[0]*(e[4]*e[8]-e[7]*e[5])-e[3]*(e[1]*e[8]-e[7]*e[2])+e[6]*(e[1]*e[5]-e[4]*e[2])},r.prototype.setIdentity=function(){var e=this.data;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,this},r.prototype.applyPost=function(e){var t=e.data,n=this.data,r=t[0],i=t[1],s=t[2];return t[0]=n[0]*r+n[3]*i+n[6]*s,t[1]=n[1]*r+n[4]*i+n[7]*s,t[2]=n[2]*r+n[5]*i+n[8]*s,e},r.prototype.applyPre=function(e){var t=e.data,n=this.data,r=t[0],i=t[1],s=t[2];return t[0]=n[0]*r+n[1]*i+n[2]*s,t[1]=n[3]*r+n[4]*i+n[5]*s,t[2]=n[6]*r+n[7]*i+n[8]*s,e},r.prototype.multiplyDiagonalPost=function(e,t){var n=e.data[0],r=e.data[1],i=e.data[2],s=this.data,o=t.data;return o[0]=n*s[0],o[1]=n*s[1],o[2]=n*s[2],o[3]=r*s[3],o[4]=r*s[4],o[5]=r*s[5],o[6]=i*s[6],o[7]=i*s[7],o[8]=i*s[8],t},r.prototype.fromAngles=function(e,t,n){var r=Math.cos(e),i=Math.sin(e),s=Math.cos(t),o=Math.sin(t),u=Math.cos(n),a=Math.sin(n),f=this.data;return f[0]=s*u,f[3]=o*i-s*a*r,f[6]=s*a*i+o*r,f[1]=a,f[4]=u*r,f[7]=-u*i,f[2]=-o*u,f[5]=o*a*r+s*i,f[8]=-o*a*i+s*r,this},r.prototype.rotateX=function(e,t){t=t||this;var n=this.data,r=t.data,i=Math.sin(e),s=Math.cos(e),o=n[3],u=n[4],a=n[5],f=n[6],l=n[7],c=n[8];return n!==r&&(r[0]=n[0],r[1]=n[1],r[2]=n[2]),r[3]=o*s+f*i,r[4]=u*s+l*i,r[5]=a*s+c*i,r[6]=f*s-o*i,r[7]=l*s-u*i,r[8]=c*s-a*i,r},r.prototype.rotateY=function(e,t){t=t||this;var n=this.data,r=t.data,i=Math.sin(e),s=Math.cos(e),o=n[0],u=n[1],a=n[2],f=n[6],l=n[7],c=n[8];return n!==r&&(r[3]=n[3],r[4]=n[4],r[5]=n[5]),r[0]=o*s-f*i,r[1]=u*s-l*i,r[2]=a*s-c*i,r[6]=o*i+f*s,r[7]=u*i+l*s,r[8]=a*i+c*s,r},r.prototype.rotateZ=function(e,t){t=t||this;var n=this.data,r=t.data,i=Math.sin(e),s=Math.cos(e),o=n[0],u=n[1],a=n[2],f=n[3],l=n[4],c=n[5];return n!==r&&(r[6]=n[6],r[7]=n[7],r[8]=n[8]),r[0]=o*s+f*i,r[1]=u*s+l*i,r[2]=a*s+c*i,r[3]=f*s-o*i,r[4]=l*s-u*i,r[5]=c*s-a*i,r},r.prototype.toAngles=function(t){var r=t;r||(r=new n);var i=this.data,s=r.data;return i[3]>1-e.EPSILON?(s[1]=Math.atan2(i[2],i[8]),s[2]=Math.PI/2,s[0]=0):i[3]<-1+e.EPSILON?(s[1]=Math.atan2(i[2],i[8]),s[2]=-Math.PI/2,s[0]=0):(s[1]=Math.atan2(-i[2],i[0]),s[0]=Math.atan2(-i[7],i[4]),s[2]=Math.asin(i[1])),r},r.prototype.fromAngleNormalAxis=function(e,t,n,r){var i=Math.cos(e),s=Math.sin(e),o=1-i,u=t*t,a=n*n,f=r*r,l=t*n*o,c=t*r*o,h=n*r*o,p=t*s,d=n*s,v=r*s,m=this.data;return m[0]=u*o+i,m[3]=l-v,m[6]=c+d,m[1]=l+v,m[4]=a*o+i,m[7]=h-p,m[2]=c-d,m[5]=h+p,m[8]=f*o+i,this},r.prototype.lookAt=function(e,t){var r=this._tempX,i=this._tempY,s=this._tempZ;s.setv(e).normalize(),r.setv(t).cross(s).normalize(),r.equals(n.ZERO)&&(s.data[0]!==0?r.setd(s.data[1],-s.data[0],0):r.setd(0,s.data[2],-s.data[1])),i.setv(s).cross(r);var o=this.data;return o[0]=r.data[0],o[1]=r.data[1],o[2]=r.data[2],o[3]=i.data[0],o[4]=i.data[1],o[5]=i.data[2],o[6]=s.data[0],o[7]=s.data[1],o[8]=s.data[2],this},r.prototype.copyQuaternion=function(e){return e.toRotationMatrix(this)},r.prototype.copy=function(e){var t=this.data,n=e.data;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this},r.prototype.clone=function(){var e=this.data;return new r(e[0],e[1],e[2],e[3],e[4],e[5],e[4],e[5],e[6])},r}),define("goo/math/Quaternion",["goo/math/Vector","goo/math/Vector3","goo/math/Matrix3x3","goo/math/MathUtils"],function(e,t,n,r){function i(){e.call(this,4),arguments.length!==0?this.set(arguments):this.setd(0,0,0,1)}return i.prototype=Object.create(e.prototype),i.prototype.setupAliases([["x"],["y"],["z"],["w"]]),i.IDENTITY=new i(0,0,0,1),i.ALLOWED_DEVIANCE=1e-8,i.add=function(e,t,n){return n||(n=new i),n.data[0]=e.data[0]+t.data[0],n.data[1]=e.data[1]+t.data[1],n.data[2]=e.data[2]+t.data[2],n.data[3]=e.data[3]+t.data[3],n},i.sub=function(e,t,n){return n||(n=new i),n.data[0]=e.data[0]-t.data[0],n.data[1]=e.data[1]-t.data[1],n.data[2]=e.data[2]-t.data[2],n.data[3]=e.data[3]-t.data[3],n},i.mul=function(e,t,n){return n||(n=new i),n.data[0]=e.data[0]*t.data[0],n.data[1]=e.data[1]*t.data[1],n.data[2]=e.data[2]*t.data[2],n.data[3]=e.data[3]*t.data[3],n},i.mul2=function(e,t,n){var r=e.data[0],i=e.data[1],s=e.data[2],o=e.data[3],u=t.data[0],a=t.data[1],f=t.data[2],l=t.data[3];return n.data[0]=r*l+o*u+i*f-s*a,n.data[1]=i*l+o*a+s*u-r*f,n.data[2]=s*l+o*f+r*a-i*u,n.data[3]=o*l-r*u-i*a-s*f,n},i.div=function(e,t,n){n||(n=new i);var r=!0;return n.data[0]=(r&=t.data[0]<0||t.data[0]>0)?e.data[0]/t.data[0]:0,n.data[1]=(r&=t.data[1]<0||t.data[1]>0)?e.data[1]/t.data[1]:0,n.data[2]=(r&=t.data[2]<0||t.data[2]>0)?e.data[2]/t.data[2]:0,n.data[3]=(r&=t.data[3]<0||t.data[3]>0)?e.data[3]/t.data[3]:0,r===!1&&console.warn("[Quaternion.div] Attempted to divide by zero!"),n},i.scalarAdd=function(e,t,n){return n||(n=new i),n.data[0]=e.data[0]+t,n.data[1]=e.data[1]+t,n.data[2]=e.data[2]+t,n.data[3]=e.data[3]+t,n},i.scalarSub=function(e,t,n){return n||(n=new i),n.data[0]=e.data[0]-t,n.data[1]=e.data[1]-t,n.data[2]=e.data[2]-t,n.data[3]=e.data[3]-t,n},i.scalarMul=function(e,t,n){return n||(n=new i),n.data[0]=e.data[0]*t,n.data[1]=e.data[1]*t,n.data[2]=e.data[2]*t,n.data[3]=e.data[3]*t,n},i.scalarDiv=function(e,t,n){n||(n=new i);var r=!0;return t=(r&=t<0||t>0)?1/t:0,n.data[0]=e.data[0]*t,n.data[1]=e.data[1]*t,n.data[2]=e.data[2]*t,n.data[3]=e.data[3]*t,r===!1&&console.warn("[Quaternion.scalarDiv] Attempted to divide by zero!"),n},i.slerp=function(e,t,n,r){if(n===0)return r.setv(e);if(n===1)return r.setv(t);if(e.equals(t))return r.setv(e);var i=e.dot(t);r.setv(t),i<0&&(r.negate(),i=-i);var s=1-n,o=n;if(1-i>.1){var u=Math.acos(i),a=1/Math.sin(u);s=Math.sin((1-n)*u)*a,o=Math.sin(n*u)*a}var f=s*e.data[0]+o*r.data[0],l=s*e.data[1]+o*r.data[1],c=s*e.data[2]+o*r.data[2],h=s*e.data[3]+o*r.data[3];return r.setd(f,l,c,h),r},i.prototype.negate=function(){return this.data[0]*=-1,this.data[1]*=-1,this.data[2]*=-1,this.data[3]*=-1,this},i.prototype.dot=function(e){var t=this.data,n=e.data||e,r=0;return r+=t[0]*n[0],r+=t[1]*n[1],r+=t[2]*n[2],r+=t[3]*n[3],r},i.prototype.add=function(e){return i.add(this,e,this)},i.prototype.sub=function(e){return i.sub(this,e,this)},i.prototype.mul=function(e){return i.mul(this,e,this)},i.prototype.div=function(e){return i.div(this,e,this)},i.prototype.scalarAdd=function(e){return i.scalarAdd(this,e,this)},i.prototype.scalarSub=function(e){return i.scalarSub(this,e,this)},i.prototype.scalarMul=function(e){return i.scalarMul(this,e,this)},i.prototype.scalarDiv=function(e){return i.scalarDiv(this,e,this)},i.prototype.slerp=function(e,t){var n=(new i).copy(e);return i.slerp(this,e,t,n),this.copy(n),this},i.prototype.fromRotationMatrix=function(e){var t=e.e00+e.e11+e.e22,n,r,i,s;if(t>=0){var o=Math.sqrt(t+1);s=.5*o,o=.5/o,n=(e.e21-e.e12)*o,r=(e.e02-e.e20)*o,i=(e.e10-e.e01)*o}else if(e.e00>e.e11&&e.e00>e.e22){var o=Math.sqrt(1+e.e00-e.e11-e.e22);n=o*.5,o=.5/o,r=(e.e10+e.e01)*o,i=(e.e02+e.e20)*o,s=(e.e21-e.e12)*o}else if(e.e11>e.e22){var o=Math.sqrt(1+e.e11-e.e00-e.e22);r=o*.5,o=.5/o,n=(e.e10+e.e01)*o,i=(e.e21+e.e12)*o,s=(e.e02-e.e20)*o}else{var o=Math.sqrt(1+e.e22-e.e00-e.e11);i=o*.5,o=.5/o,n=(e.e02+e.e20)*o,r=(e.e21+e.e12)*o,s=(e.e10-e.e01)*o}return this.set(n,r,i,s)},i.prototype.toRotationMatrix=function(e){var t=e;t||(t=new n);var r=this.magnitudeSquared(),i=r>0?2/r:0,s=this.data,o=s[0]*i,u=s[1]*i,a=s[2]*i,f=s[0]*o,l=s[0]*u,c=s[0]*a,h=s[3]*o,p=s[1]*u,d=s[1]*a,v=s[3]*u,m=s[2]*a,g=s[3]*a,y=t.data;return y[0]=1-(p+m),y[1]=l+g,y[2]=c-v,y[3]=l-g,y[4]=1-(f+m),y[5]=d+h,y[6]=c+v,y[7]=d-h,y[8]=1-(f+p),t},i.prototype.fromVectorToVector=function(e,n){var s=e,o=n,u=s.length()*o.length();if(Math.abs(u)>r.EPSILON){var a=new t,f=s.dot(o)/u,l=Math.acos(Math.max(-1,Math.min(f,1)));s.cross(o,a);if(f<0&&a.length()<r.EPSILON){var c;Math.abs(s.x)>Math.abs(s.y)?Math.abs(s.x)>Math.abs(s.z)?c=0:c=2:Math.abs(s.y)>Math.abs(s.z)?c=1:c=2,a.setValue(c,-s[(c+1)%3]),a.setValue((c+1)%3,s[c]),a.setValue((c+2)%3,0)}return this.fromAngleAxis(l,a)}return this.set(i.IDENTITY)},i.prototype.normalize=function(){var e=1/this.magnitude(),t=this.x*e,n=this.y*e,r=this.z*e,i=this.w*e;return this.set(t,n,r,i)},i.prototype.magnitude=function(){var e=this.data[0]*this.data[0]+this.data[1]*this.data[1]+this.data[2]*this.data[2]+this.data[3]*this.data[3];return e===1?1:Math.sqrt(e)},i.prototype.magnitudeSquared=function(){return this.data[0]*this.data[0]+this.data[1]*this.data[1]+this.data[2]*this.data[2]+this.data[3]*this.data[3]},i.prototype.fromAngleAxis=function(e,n){var r=(new t(n)).normalize();return this.fromAngleNormalAxis(e,r)},i.prototype.fromAngleNormalAxis=function(e,n){if(n.equals(t.ZERO))return this.set(i.IDENTITY);var s=.5*e,o=r.sin(s),u=r.cos(s),a=o*n.getX(),f=o*n.getY(),l=o*n.getZ();return this.set(a,f,l,u)},i.prototype.toAngleAxis=function(e){var t=this.x*this.x+this.y*this.y+this.z*this.z,n;if(Math.abs(t)<=i.ALLOWED_DEVIANCE)n=0,e!==null&&(e.x=1,e.y=0,e.z=0);else{n=2*Math.acos(this.w);if(e!==null){var r=1/Math.sqrt(t);e.x=this.x*r,e.y=this.y*r,e.z=this.z*r}}return n},i.prototype.equals=function(e){return this===e?!0:!e instanceof i?!1:Math.abs(this.data[0]-e.data[0])<i.ALLOWED_DEVIANCE&&Math.abs(this.data[1]-e.data[1])<i.ALLOWED_DEVIANCE&&Math.abs(this.data[2]-e.data[2])<i.ALLOWED_DEVIANCE&&Math.abs(this.data[3]-e.data[3])<i.ALLOWED_DEVIANCE},i.prototype.setd=function(e,t,n,r){return this.data[0]=e,this.data[1]=t,this.data[2]=n,this.data[3]=r,this},i.prototype.seta=function(e){return this.data[0]=e[0],this.data[1]=e[1],this.data[2]=e[2],this.data[3]=e[3],this},i.prototype.setv=function(e){return this.data[0]=e.data[0],this.data[1]=e.data[1],this.data[2]=e.data[2],this.data[3]=e.data[3],this},i}),define("goo/math/Matrix4x4",["goo/math/MathUtils","goo/math/Matrix"],function(e,t){function n(){t.call(this,4,4),arguments.length===0?this.setIdentity():this.set(arguments)}return n.prototype=Object.create(t.prototype),n.prototype.setupAliases([["e00"],["e10"],["e20"],["e30"],["e01"],["e11"],["e21"],["e31"],["e02"],["e12"],["e22"],["e32"],["e03"],["e13"],["e23"],["e33"]]),n.IDENTITY=new n(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),n.add=function(e,t,r){return r||(r=new n),t instanceof n?(r.e00=e.e00+t.e00,r.e10=e.e10+t.e10,r.e20=e.e20+t.e20,r.e30=e.e30+t.e30,r.e01=e.e01+t.e01,r.e11=e.e11+t.e11,r.e21=e.e21+t.e21,r.e31=e.e31+t.e31,r.e02=e.e02+t.e02,r.e12=e.e12+t.e12,r.e22=e.e22+t.e22,r.e32=e.e32+t.e32,r.e03=e.e03+t.e03,r.e13=e.e13+t.e13,r.e23=e.e23+t.e23,r.e33=e.e33+t.e33):(r.e00=e.e00+t,r.e10=e.e10+t,r.e20=e.e20+t,r.e30=e.e30+t,r.e01=e.e01+t,r.e11=e.e11+t,r.e21=e.e21+t,r.e31=e.e31+t,r.e02=e.e02+t,r.e12=e.e12+t,r.e22=e.e22+t,r.e32=e.e32+t,r.e03=e.e03+t,r.e13=e.e13+t,r.e23=e.e23+t,r.e33=e.e33+t),r},n.prototype.add=function(e){return n.add(this,e,this)},n.sub=function(e,t,r){return r||(r=new n),t instanceof n?(r.e00=e.e00-t.e00,r.e10=e.e10-t.e10,r.e20=e.e20-t.e20,r.e30=e.e30-t.e30,r.e01=e.e01-t.e01,r.e11=e.e11-t.e11,r.e21=e.e21-t.e21,r.e31=e.e31-t.e31,r.e02=e.e02-t.e02,r.e12=e.e12-t.e12,r.e22=e.e22-t.e22,r.e32=e.e32-t.e32,r.e03=e.e03-t.e03,r.e13=e.e13-t.e13,r.e23=e.e23-t.e23,r.e33=e.e33-t.e33):(r.e00=e.e00-t,r.e10=e.e10-t,r.e20=e.e20-t,r.e30=e.e30-t,r.e01=e.e01-t,r.e11=e.e11-t,r.e21=e.e21-t,r.e31=e.e31-t,r.e02=e.e02-t,r.e12=e.e12-t,r.e22=e.e22-t,r.e32=e.e32-t,r.e03=e.e03-t,r.e13=e.e13-t,r.e23=e.e23-t,r.e33=e.e33-t),r},n.prototype.sub=function(e){return n.sub(this,e,this)},n.mul=function(e,t,r){return r||(r=new n),t instanceof n?(r.e00=e.e00*t.e00,r.e10=e.e10*t.e10,r.e20=e.e20*t.e20,r.e30=e.e30*t.e30,r.e01=e.e01*t.e01,r.e11=e.e11*t.e11,r.e21=e.e21*t.e21,r.e31=e.e31*t.e31,r.e02=e.e02*t.e02,r.e12=e.e12*t.e12,r.e22=e.e22*t.e22,r.e32=e.e32*t.e32,r.e03=e.e03*t.e03,r.e13=e.e13*t.e13,r.e23=e.e23*t.e23,r.e33=e.e33*t.e33):(r.e00=e.e00*t,r.e10=e.e10*t,r.e20=e.e20*t,r.e30=e.e30*t,r.e01=e.e01*t,r.e11=e.e11*t,r.e21=e.e21*t,r.e31=e.e31*t,r.e02=e.e02*t,r.e12=e.e12*t,r.e22=e.e22*t,r.e32=e.e32*t,r.e03=e.e03*t,r.e13=e.e13*t,r.e23=e.e23*t,r.e33=e.e33*t),r},n.prototype.mul=function(e){return n.mul(this,e,this)},n.div=function(e,t,r){return r||(r=new n),t instanceof n?(r.e00=e.e00/t.e00,r.e10=e.e10/t.e10,r.e20=e.e20/t.e20,r.e30=e.e30/t.e30,r.e01=e.e01/t.e01,r.e11=e.e11/t.e11,r.e21=e.e21/t.e21,r.e31=e.e31/t.e31,r.e02=e.e02/t.e02,r.e12=e.e12/t.e12,r.e22=e.e22/t.e22,r.e32=e.e32/t.e32,r.e03=e.e03/t.e03,r.e13=e.e13/t.e13,r.e23=e.e23/t.e23,r.e33=e.e33/t.e33):(t=1/t,r.e00=e.e00*t,r.e10=e.e10*t,r.e20=e.e20*t,r.e30=e.e30*t,r.e01=e.e01*t,r.e11=e.e11*t,r.e21=e.e21*t,r.e31=e.e31*t,r.e02=e.e02*t,r.e12=e.e12*t,r.e22=e.e22*t,r.e32=e.e32*t,r.e03=e.e03*t,r.e13=e.e13*t,r.e23=e.e23*t,r.e33=e.e33*t),r},n.prototype.div=function(e){return n.div(this,e,this)},n.combine=function(e,t,r){r||(r=new n);var i=e.data,s=i[0],o=i[4],u=i[8],a=i[12],f=i[1],l=i[5],c=i[9],h=i[13],p=i[2],d=i[6],v=i[10],m=i[14],g=i[3],y=i[7],b=i[11],w=i[15],E=t.data,S=E[0],x=E[4],T=E[8],N=E[12],C=E[1],k=E[5],L=E[9],A=E[13],O=E[2],M=E[6],_=E[10],D=E[14],P=E[3],H=E[7],B=E[11],j=E[15],F=r.data;return F[0]=s*S+o*C+u*O+a*P,F[4]=s*x+o*k+u*M+a*H,F[8]=s*T+o*L+u*_+a*B,F[12]=s*N+o*A+u*D+a*j,F[1]=f*S+l*C+c*O+h*P,F[5]=f*x+l*k+c*M+h*H,F[9]=f*T+l*L+c*_+h*B,F[13]=f*N+l*A+c*D+h*j,F[2]=p*S+d*C+v*O+m*P,F[6]=p*x+d*k+v*M+m*H,F[10]=p*T+d*L+v*_+m*B,F[14]=p*N+d*A+v*D+m*j,F[3]=g*S+y*C+b*O+w*P,F[7]=g*x+y*k+b*M+w*H,F[11]=g*T+y*L+b*_+w*B,F[15]=g*N+y*A+b*D+w*j,r},n.prototype.combine=function(e){return n.combine(this,e,this)},n.transpose=function(e,t){t||(t=new n);var r=e.data,i=t.data;if(t===e){var s=r[4],o=r[8],u=r[12],a=r[9],f=r[13],l=r[14];return i[4]=r[1],i[8]=r[2],i[12]=r[3],i[9]=r[6],i[13]=r[7],i[14]=r[11],i[1]=s,i[2]=o,i[3]=u,i[6]=a,i[7]=f,i[11]=l,t}return i[0]=r[0],i[1]=r[4],i[2]=r[8],i[3]=r[12],i[4]=r[1],i[5]=r[5],i[6]=r[9],i[7]=r[13],i[8]=r[2],i[9]=r[6],i[10]=r[10],i[11]=r[14],i[12]=r[3],i[13]=r[7],i[14]=r[11],i[15]=r[15],t},n.prototype.transpose=function(){return n.transpose(this,this)},n.invert=function(r,i){i||(i=new n);if(i===r)return t.copy(n.invert(r),i);var s=r.determinant();if(Math.abs(s)<e.EPSILON)return i;var o=r.data,u=i.data;return s=1/s,u[0]=(o[5]*(o[10]*o[15]-o[14]*o[11])-o[9]*(o[6]*o[15]-o[14]*o[7])+o[13]*(o[6]*o[11]-o[10]*o[7]))*s,u[1]=(o[1]*(o[14]*o[11]-o[10]*o[15])-o[9]*(o[14]*o[3]-o[2]*o[15])+o[13]*(o[10]*o[3]-o[2]*o[11]))*s,u[2]=(o[1]*(o[6]*o[15]-o[14]*o[7])-o[5]*(o[2]*o[15]-o[14]*o[3])+o[13]*(o[2]*o[7]-o[6]*o[3]))*s,u[3]=(o[1]*(o[10]*o[7]-o[6]*o[11])-o[5]*(o[10]*o[3]-o[2]*o[11])+o[9]*(o[6]*o[3]-o[2]*o[7]))*s,u[4]=(o[4]*(o[14]*o[11]-o[10]*o[15])-o[8]*(o[14]*o[7]-o[6]*o[15])+o[12]*(o[10]*o[7]-o[6]*o[11]))*s,u[5]=(o[0]*(o[10]*o[15]-o[14]*o[11])-o[8]*(o[2]*o[15]-o[14]*o[3])+o[12]*(o[2]*o[11]-o[10]*o[3]))*s,u[6]=(o[0]*(o[14]*o[7]-o[6]*o[15])-o[4]*(o[14]*o[3]-o[2]*o[15])+o[12]*(o[6]*o[3]-o[2]*o[7]))*s,u[7]=(o[0]*(o[6]*o[11]-o[10]*o[7])-o[4]*(o[2]*o[11]-o[10]*o[3])+o[8]*(o[2]*o[7]-o[6]*o[3]))*s,u[8]=(o[4]*(o[9]*o[15]-o[13]*o[11])-o[8]*(o[5]*o[15]-o[13]*o[7])+o[12]*(o[5]*o[11]-o[9]*o[7]))*s,u[9]=(o[0]*(o[13]*o[11]-o[9]*o[15])-o[8]*(o[13]*o[3]-o[1]*o[15])+o[12]*(o[9]*o[3]-o[1]*o[11]))*s,u[10]=(o[0]*(o[5]*o[15]-o[13]*o[7])-o[4]*(o[1]*o[15]-o[13]*o[3])+o[12]*(o[1]*o[7]-o[5]*o[3]))*s,u[11]=(o[0]*(o[9]*o[7]-o[5]*o[11])-o[4]*(o[9]*o[3]-o[1]*o[11])+o[8]*(o[5]*o[3]-o[1]*o[7]))*s,u[12]=(o[4]*(o[13]*o[10]-o[9]*o[14])-o[8]*(o[13]*o[6]-o[5]*o[14])+o[12]*(o[9]*o[6]-o[5]*o[10]))*s,u[13]=(o[0]*(o[9]*o[14]-o[13]*o[10])-o[8]*(o[1]*o[14]-o[13]*o[2])+o[12]*(o[1]*o[10]-o[9]*o[2]))*s,u[14]=(o[0]*(o[13]*o[6]-o[5]*o[14])-o[4]*(o[13]*o[2]-o[1]*o[14])+o[12]*(o[5]*o[2]-o[1]*o[6]))*s,u[15]=(o[0]*(o[5]*o[10]-o[9]*o[6])-o[4]*(o[1]*o[10]-o[9]*o[2])+o[8]*(o[1]*o[6]-o[5]*o[2]))*s,i},n.prototype.invert=function(){return n.invert(this,this)},n.prototype.isOrthogonal=function(){var t;return t=this.e00*this.e01+this.e10*this.e11+this.e20*this.e21+this.e30*this.e31,Math.abs(t)>e.EPSILON?!1:(t=this.e00*this.e02+this.e10*this.e12+this.e20*this.e22+this.e30*this.e32,Math.abs(t)>e.EPSILON?!1:(t=this.e00*this.e03+this.e10*this.e13+this.e20*this.e23+this.e30*this.e33,Math.abs(t)>e.EPSILON?!1:(t=this.e01*this.e02+this.e11*this.e12+this.e21*this.e22+this.e31*this.e32,Math.abs(t)>e.EPSILON?!1:(t=this.e01*this.e03+this.e11*this.e13+this.e21*this.e23+this.e31*this.e33,Math.abs(t)>e.EPSILON?!1:(t=this.e02*this.e03+this.e12*this.e13+this.e22*this.e23+this.e32*this.e33,Math.abs(t)>e.EPSILON?!1:!0)))))},n.prototype.isNormal=function(){var t;return t=this.e00*this.e00+this.e10*this.e10+this.e20*this.e20+this.e30*this.e30,Math.abs(t-1)>e.EPSILON?!1:(t=this.e01*this.e01+this.e11*this.e11+this.e21*this.e21+this.e31*this.e31,Math.abs(t-1)>e.EPSILON?!1:(t=this.e02*this.e02+this.e12*this.e12+this.e22*this.e22+this.e32*this.e32,Math.abs(t-1)>e.EPSILON?!1:(t=this.e03*this.e03+this.e13*this.e13+this.e23*this.e23+this.e33*this.e33,Math.abs(t-1)>e.EPSILON?!1:!0)))},n.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()},n.prototype.determinant=function(){var e=this.data,t=e[5]*e[10]*e[15]+e[9]*e[14]*e[7]+e[13]*e[6]*e[11]-e[13]*e[10]*e[7]-e[9]*e[6]*e[15]-e[5]*e[14]*e[11],n=e[1]*e[10]*e[15]+e[9]*e[14]*e[3]+e[13]*e[2]*e[11]-e[13]*e[10]*e[3]-e[9]*e[2]*e[15]-e[1]*e[14]*e[11],r=e[1]*e[6]*e[15]+e[5]*e[14]*e[3]+e[13]*e[2]*e[7]-e[13]*e[6]*e[3]-e[5]*e[2]*e[15]-e[1]*e[14]*e[7],i=e[1]*e[6]*e[11]+e[5]*e[10]*e[3]+e[9]*e[2]*e[7]-e[9]*e[6]*e[3]-e[5]*e[2]*e[11]-e[1]*e[10]*e[7];return e[0]*t-e[4]*n+e[8]*r-e[12]*i},n.prototype.setIdentity=function(){var e=this.data;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},n.prototype.setRotationFromVector=function(e){var t=Math.sin(e.x),n=Math.cos(e.x),r=Math.sin(e.y),i=Math.cos(e.y),s=Math.sin(e.z),o=Math.cos(e.z);return this.e00=o*i,this.e10=s*i,this.e20=0-r,this.e01=o*r*t-s*n,this.e11=s*r*t+o*n,this.e21=i*t,this.e02=o*r*n+s*t,this.e12=s*r*n-o*t,this.e22=i*n,this},n.prototype.setRotationFromQuaternion=function(e){var t=e.lengthSquared();t=t>0?2/t:0;var n=e.x*t,r=e.y*t,i=e.z*t,s=e.w*n,o=e.w*r,u=e.w*i,a=e.x*n,f=e.x*r,l=e.x*i,c=e.y*r,h=e.y*i,p=e.z*i;return this.e00=1-c-p,this.e10=f+u,this.e20=l-o,this.e01=f-u,this.e11=1-a-p,this.e21=h+s,this.e02=l+o,this.e12=h-s,this.e22=1-a-c,this},n.prototype.setTranslation=function(e){return this.e03=e.x,this.e13=e.y,this.e23=e.z,this},n.prototype.getTranslation=function(e){return e.x=this.data[12],e.y=this.data[13],e.z=this.data[14],this},n.prototype.getScale=function(e){var t=Math.sqrt(e.setd(this.data[0],this.data[4],this.data[8]).lengthSquared()),n=Math.sqrt(e.setd(this.data[1],this.data[5],this.data[9]).lengthSquared()),r=Math.sqrt(e.setd(this.data[2],this.data[6],this.data[10]).lengthSquared());return e.x=t,e.y=n,e.z=r,this},n.prototype.setScale=function(e){return this.e00*=e.x,this.e10*=e.y,this.e20*=e.z,this.e01*=e.x,this.e11*=e.y,this.e21*=e.z,this.e02*=e.x,this.e12*=e.y,this.e22*=e.z,this},n.prototype.applyPre=function(e){var t=e.data[0],n=e.data[1],r=e.data[2],i=e.data[3],s=this.data;return e.data[0]=s[0]*t+s[1]*n+s[2]*r+s[3]*i,e.data[1]=s[4]*t+s[5]*n+s[6]*r+s[7]*i,e.data[2]=s[8]*t+s[9]*n+s[10]*r+s[11]*i,e.data[3]=s[12]*t+s[13]*n+s[14]*r+s[15]*i,e},n.prototype.applyPost=function(e){var t=e.data[0],n=e.data[1],r=e.data[2],i=e.data[3],s=this.data;return e.data[0]=s[0]*t+s[4]*n+s[8]*r+s[12]*i,e.data[1]=s[1]*t+s[5]*n+s[9]*r+s[13]*i,e.data[2]=s[2]*t+s[6]*n+s[10]*r+s[14]*i,e.data[3]=s[3]*t+s[7]*n+s[11]*r+s[15]*i,e},n.prototype.applyPostPoint=function(e){var t=e.data[0],n=e.data[1],r=e.data[2],i=this.data;return e.data[0]=i[0]*t+i[4]*n+i[8]*r+i[12],e.data[1]=i[1]*t+i[5]*n+i[9]*r+i[13],e.data[2]=i[2]*t+i[6]*n+i[10]*r+i[14],e},n.prototype.applyPostVector=function(e){var t=e.x,n=e.y,r=e.z,i=this.data;return e.x=i[0]*t+i[4]*n+i[8]*r,e.y=i[1]*t+i[5]*n+i[9]*r,e.z=i[2]*t+i[6]*n+i[10]*r,e},n.prototype.copy=function(e){var t=this.data,n=e.data;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this},n.prototype.clone=function(){var e=this.data;return new n(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},n}),define("3d/GooJointAnimator",["goo/math/Quaternion","goo/math/Matrix4x4","goo/math/Matrix3x3","goo/math/Vector3"],function(e,t,n,r){var i=new e,s=new n,o=new t,u=new r,a=function(e,t,n,r){s.copy(e.sourceMatrix),t&&s.rotateX(t),n&&s.rotateY(n),r&&s.rotateZ(r),i.fromRotationMatrix(s),e._rotations[0]=i.data[0],e._rotations[1]=i.data[1],e._rotations[2]=i.data[2],e._rotations[3]=i.data[3]},f=function(e,t){e._scales[0]=t,e._scales[1]=t,e._scales[2]=t},l=function(e,t,n,r){s.copy(e.sourceMatrix),s.rotateX(t),s.rotateY(n),s.rotateZ(r),i.fromRotationMatrix(s),e._rotations[0]+=i.data[0],e._rotations[1]+=i.data[1],e._rotations[2]+=i.data[2],e._rotations[3]+=i.data[3]},c=function(e,t){e._translations[0]=t[0]+e.sourceTranslation[0],e._translations[1]=t[1]+e.sourceTranslation[1],e._translations[2]=t[2]+e.sourceTranslation[2]},h=function(e){e.geometries[0].animationComponent.layers[0]._currentState||(alert("No Source Tree loaded yet?"),console.log(e.geometries[0].animationComponent)),e.pieceData.boneMap={};var t=e.geometries[0].animationComponent.layers[0]._steadyStates["Take 001"]._sourceTree._clip;for(var n=0;n<t._channels.length;n++)e.pieceData.boneMap[t._channels[n]._jointName]=n,t._channels[n].sourceTranslation=[t._channels[n]._translations[0],t._channels[n]._translations[1],t._channels[n]._translations[2]],i.seta(t._channels[n]._rotations),t._channels[n].sourceMatrix=i.toRotationMatrix();e.animationChannels=t._channels},p=function(e,t,n){var r=e.animationChannels[e.pieceData.boneMap[t]];r==undefined&&console.log("No Bone:",t,e.animationChannels),a(r,n)},d=function(e,t,n){var r=e.animationChannels[e.pieceData.boneMap[t]];r==undefined&&console.log("No Bone:",t,e.animationChannels),f(r,n)},v=function(e,t,n,r,i){var s=e.animationChannels[e.pieceData.boneMap[t]];s==undefined&&console.log("No Bone:",t,e.animationChannels),a(s,n,r,i)};return{rotateBone:a,addRotationToBone:l,translateBone:c,printClipInitialTransform:h,updateEntityBoneRotX:p,updateEntityBoneRotXYZ:v,setEntityBoneScale:d}}),define("game/piece/PieceInputHandler",[],function(){var e=function(e){e.pieceInput={};for(var t in e.controls)e.pieceInput[t]={value:0,update:!1}},t=function(e,t,n){if(!e.pieceInput[t])return;e.pieceInput[t].value=n,e.pieceInput[t].update=!0},n=function(e,t){e.pieceInput[t].update=!0};return{buildPieceInput:e,setPieceInputState:t,resamplePieceInputState:n}}),define("game/gameConfiguration",[],function(){return{GAME_IDENTITY:{title:"Tunnan & Friends",tagLine:"Early test version for you to fly"},WORLD_PROPERTIES:{gravity:[0,-9.81,0],newton:9.81,speedOfSound:340.29},PLAYER_INIT:{startSpatial:{pos:[342,18.2,2880],vel:[0,1e-4,0],rot:[0,Math.PI*.5,0]},landingStrip:{pos:[2861,15,2388]},approach:{pos:[650,620,1e3]},stratosphere:{pos:[-1050,35690,3e3]},battle:{pos:[2750,820,2310]}},AERODYNAMICS:{airMassDensity:1.229,densityPerMeter:8e-5,kelvinsAtSeaLevel:288,kelvinDropByMeterUp:.0065,seaLevelPressure:1.01,gasConstant:8.3,airMolarMass:.0289644},RENDER_SETUP:{targetFPS:60,physicsFPS:100},GAME_SETTINGS:{soundDisable:{values:[0,1],loadIndex:1}},INTRO:{containerId:"intro",stages:[{id:"intro_1",time:2e3},{id:"intro_2",time:1e3},{id:"intro_3",time:1e3}]},MIX_TRACKS:{game:{id:"Game",gain:.5,spatial:!0,fxSend:.9},ambient:{id:"Ambient",gain:.5,spatial:!1,fxSend:1},ui:{id:"UI",gain:.5,spatial:!1,fxSend:.8},music:{id:"Music",gain:.5,spatial:!1}},PRELOAD_IMAGES:["resources/goo/bundles/images/r_back.jpg","resources/goo/bundles/images/r_bottom.jpg","resources/goo/bundles/images/r_front.jpg","resources/goo/bundles/images/r_left.jpg","resources/goo/bundles/images/r_right.jpg","resources/goo/bundles/images/r_top.jpg","resources/goo/bundles/images/PlaneAtlas.png","resources/goo/bundles/images/PlaneAtlasEmit.png","resources/goo/bundles/images/PlaneAtlasSpec.png","resources/goo/bundles/images/PlaneAtlas_Normal.png","resources/goo/bundles/images/nature1024.png"],PRELOAD_GOO_MATERIALS:{},PRELOAD_GOO_MESHES:{},GOO_PROJECTS:{environment:{refFile:"environment.bundle",projectPath:"bundles"},car_pv_9031:{refFile:"pv_9031.bundle",projectPath:"bundles",pv_9031:"pv_9031"},cougar_f9f:{refFile:"cougar_f9f.bundle",projectPath:"bundles",cougar_f9f:"cougar_f9f"},stratofortress:{refFile:"stratofortress.bundle",projectPath:"bundles",b_52:"b_52"},draken:{refFile:"draken.bundle",projectPath:"bundles",draken:"draken"},human:{refFile:"human.bundle",projectPath:"bundles",pilot:"pilot_bind_AO"},tunnan:{refFile:"tunnan.bundle",projectPath:"bundles",tunnan:"tunnan_f"},tre_kronor:{refFile:"tre_kronor.bundle",projectPath:"bundles",tre_kronor:"tre_kronor"},battleship:{refFile:"battleship.bundle",projectPath:"bundles",battleship:"battleship_skinned"},carrier:{refFile:"carrier.bundle",projectPath:"bundles",carrier:"carrier"},nature:{refFile:"trees_rocks.bundle",projectPath:"bundles",tree_leafy:"tree_leafy_30m",tree_40:"tree_leafy_40m",tree_leafy_small:"tree_leafy_small",rock_mossy:"rock_mossy",rock_plain:"rock_plain",rock_tiny:"rock_tiny"},houses:{refFile:"houses.bundle",projectPath:"bundles",hangar_building:"hangar_building",seventeen_big_floors:"17_big_floors",seventeen_floor:"17_floors",ten_floors:"10_floors",cube_22:"cube_22",air_tower:"air_tower",cottage:"cottage"},targets:{refFile:"targets.bundle",projectPath:"bundles",ground_flat:"ground_flat",house_box_3:"house_box_3"},house_t:{refFile:"house_T.bundle",projectPath:"bundles",house_t:"house_T"},air_base:{refFile:"air_base.bundle",projectPath:"bundles",base:"base",roof:"roof",lockers:"lockers",lamps:"lamps"},hilltop_base:{refFile:"hilltop_base.bundle",projectPath:"bundles",base:"hilltop_base",roof:"hilltop_roof",lamps:"hilltop_lights",lamps_inner:"hilltop_lights_inner"},harbor:{refFile:"harbor.bundle",projectPath:"bundles",base:"harbor_base"},tomcat:{refFile:"tomcat.bundle",projectPath:"bundles",tomcat:"tomcat_skinned"},elevator:{refFile:"elevator.bundle",projectPath:"bundles",base:"elevator_base",roof:"elevator_roof"},top_base:{refFile:"top_base.bundle",projectPath:"bundles",base:"top_base",roof:"top_base_roof"},tv_screen:{refFile:"tv_monitors.bundle",projectPath:"bundles",tv:"tv_crt",tv_2:"tv_2",tv_3:"tv_3"},monitor_console:{refFile:"monitor_console.bundle",projectPath:"bundles",monitor_console:"monitor_console"},armaments:{refFile:"armaments.bundle",projectPath:"bundles",bomb_200kg:"bomb_200kg",rocket_7cm:"rocket_7cm",rocket_18cm:"rocket_18cm"},bullet_20:{refFile:"project.project",projectPath:"bullet_project",piecePath:"bullet_red"}},PRELOAD_GOO_SKELETON:{},PRELOAD_GOO_ANIMATION:{},VIDEOS:{sources:{hsi:{funnyCat:"resources/video/funny_cat_352x240.mp4",cuteCat:"resources/video/cute_cat_320x240.mp4",angryCat:"resources/video/angry_cat_screams_at_enemy_cat_640x360.mp4"},vdi:{tunnanPromo:"resources/video/tunnan_short.mp4",marineAd:"resources/video/united_states_marine_corps_640x480.mp4",jetEngine:"resources/video/jet_engine_-_cinema_4d_animation_640x360.mp4"},hud:{memorial:"resources/video/the_collings_foundation_vietnam_memorial_flight.__f-4_phantom_a-4_skyhawk_uh-1_huey_480x240.mp4",dayTrap:"resources/video/day_trap_aboard_the_jfk_640x480.mp4",carrierOps:"resources/video/aircraft_carrier_operation_640x360.mp4"},cats:{funnyCat:"resources/video/funny_cat_352x240.mp4",cuteCat:"resources/video/cute_cat_320x240.mp4",angryCat:"resources/video/angry_cat_screams_at_enemy_cat_640x360.mp4"},promos:{tunnanPromo:"resources/video/tunnan_short.mp4",marineAd:"resources/video/united_states_marine_corps_640x480.mp4",jetEngine:"resources/video/jet_engine_-_cinema_4d_animation_640x360.mp4"},military:{memorial:"resources/video/the_collings_foundation_vietnam_memorial_flight.__f-4_phantom_a-4_skyhawk_uh-1_huey_480x240.mp4",dayTrap:"resources/video/day_trap_aboard_the_jfk_640x480.mp4",carrierOps:"resources/video/aircraft_carrier_operation_640x360.mp4"},history:{strangelove:"resources/video/dr._strangelove_-_ending_640x384.mp4",submarine:"resources/video/submarine_480x272.mp4",bomber:"bomber_480x270.mp4"},animals:{alaska:"resources/video/alaska_mammals_tour_640x350.mp4",frogYear:"resources/video/year_of_the_frog_campaign_568x320.mp4",unFrog:"resources/video/un_frog_640x272.mp4"},planes:{blackbird:"resources/video/sr-71_blackbird_-_the_worlds_fastest_and_highest_flying_aircraft_(jet)_-_youtube_640x480.mp4"},doge:{moonLaunch:"shopdoge.com-_dogecoin_moon_launch_hd__________much_trust_must_doge_640x358"}},channels:{vdi:"vdi",cats:"cats",animals:"animals",promos:"promos",military:"military",history:"history",planes:"planes"}},PRELOAD_GOO_TEXTURES:{jet_particle:"resources/images/particles/shockwave.png",splash_particle:"resources/images/particles/splash.png",shockwave_particle:"resources/images/particles/shockwave.png",fieldring_particle:"resources/images/particles/fieldring.png",spark_particle:"resources/images/particles/spark.png",dot_particle:"resources/images/particles/dot.png",foam_particle:"resources/images/particles/water_foam.png",smoke_particle:"resources/images/particles/smoke.png"},PRELOAD_GOO_SHADERS:{},KEY_BINDINGS:{plane:{cannons:["1",32],throttleUp:["R",107],throttleDown:["F",109],pitchUp:["S",40],pitchDown:["W",38],rollLeft:["A",37],rollRight:["D",39],yawLeft:["Q"],yawRight:["E"],canopy:["C"],gears:["G"],breaksOn:["B"],breaksOff:["V"],flapsDown:["X"],flapsUp:["Z"],eject:["P"],trimPitchUp:["K"],trimPitchDown:["I"],trimRollLeft:["J"],trimRollRight:["L"],trimYawLeft:["U"],trimYawRight:["O"]},car:{breaksOn:["B","X"],breaksOff:["V","Q"],throttleUp:["W",107],throttleDown:["S",109],yawLeft:["A",37],yawRight:["D",39]},move:{forward:["W",38],back:["S",40],turnleft:["A",37],turnright:["D",39],strafeModifier:["-"],jump:[" ","E"]},carrier:{}}}}),define("physics/ShapePhysics",[],function(){var e=function(e,t,n){var r=n.stallAngle[0],i=n.stallLiftCoeff[0],s=i/r,o=Math.PI*t*s;return t>r&&(o=i/2),t<-r&&(o=-i/2),o*.5},t=function(e,t){if(!t.controlId)return;var n=t.rot.toAngles(),r=0;e[t.controlId].trimState&&(r=e[t.controlId].trimState);var i=e[t.controlId].currentState*Math.abs(e[t.controlId].currentState)+r,s=t.controls[t.controlId];t.frameRot.fromAngles(i*s[0]+n.data[0],i*s[1]+n.data[1],i*s[2]+n.data[2])},n=function(e,t){var n=e.sourceData.size[0]*e.sourceData.size[2];return n*Math.abs(t)},r=function(e,t){var n=-Math.abs(e*.05*t);return n*.01},i=function(e,t){return t>e*2&&(t=e*2),1/3*Math.PI*t*t*(3*e-t)},s=function(e,t){return Math.cos(e-t)},o=function(e,t,n){return Math.sin(e+t)*Math.sin(n)},u=function(e,t){},a=function(e,t,n){},f=function(e,t,n,r){n*=1/e,n>e*1.3&&(n=e*1.3),n<-e*.6&&(n=-e*.6);var i=(.0077+14.7*n+8.6*n*n+ -20.35*n*n*n)/8;return i*=t,i},e=function(e,t,n){return f(n.stallAngle[0],n.stallLiftCoeff[0],t)},l=function(e){return 4/3*Math.PI*e*e*e},c=function(e){return Math.pow(e*.75/Math.PI,1/3)};return{calcSurfaceAxisAngleOfAttack:o,volumeToApproxRadius:c,calcSphereDisplacement:i,calcPlaneFaceExposureAtAngle:s,calcRadiusToVolume:l,applyStallCurve:f}}),define("goo/entities/components/Component",[],function(){function e(){this.enabled=!0,this.installedAPI={}}return e.prototype.applyAPI=function(e){this.installedAPI||(this.installedAPI={});var t=this.api;for(var n in t)typeof e[n]=="undefined"?(e[n]=t[n],this.installedAPI[n]=!0):console.warn("Could not install method "+n+" of "+this.type+" as it is already taken")},e.prototype.removeAPI=function(e){var t=this.installedAPI;for(var n in t)delete e[n]},e}),define("goo/entities/components/ScriptComponent",["goo/entities/components/Component"],function(e){function t(e){this.type="ScriptComponent",e instanceof Array?this.scripts=e:e?this.scripts=[e]:this.scripts=[]}return t.prototype=Object.create(e.prototype),t.prototype.run=function(e,t,n){var r;for(var i=0,s=this.scripts.length;i<s;i++)r=this.scripts[i],r&&r.run&&(r.enabled===undefined||r.enabled)&&r.run(e,t,n)},t.applyOnEntity=function(e,n){if(e instanceof Function||e.run instanceof Function){var r;return n.scriptComponent?r=n.scriptComponent:(r=new t,n.setComponent(r)),r.scripts.push(e.run instanceof Function?e:{run:e}),!0}},t}),define("game/planes/PlaneWing",["application/EventManager","game/gameConfiguration","physics/ShapePhysics","goo/entities/components/ScriptComponent","goo/math/Vector3","game/GameUtil","goo/math/Matrix3x3","goo/math/MathUtils"],function(e,t,n,r,i,s,o,u){function M(e,t,r){this.wingId=r,this.worldPos=null,this.entity=e,this.sourceData=t,this.controlIds=[],this.controls={};for(var s in t.controls)this.controls[s]=new i(t.controls[s]);this.pos=new i(t.pos),this.size=new i(t.size),this.volume=this.size.data[0]*this.size.data[1]*this.size.data[2],this.approxRadius=n.volumeToApproxRadius(this.volume),this.maxLoad=this.entity.pieceData.dimensions.massMax*this.volume/10,this.rot=new o,this.rot.fromAngles(t.rot[0],t.rot[1],t.rot[2]),this.frameRot=this.rot.clone(),this.force=new i(0,0,0),this.drag=new i(0,0,0),this.formDragCoeff=t.formDragCoeff,this.liftCurve=t.liftCurve,this.stallAngle=t.stallAngle,this.stallLiftCoeff=t.stallLiftCoeff,this.controlSurfaces={},this.waterForce=0,this.integrity=1,this.destroyed=!1,this.lastFrameForce=new i}var a,f,l,c,h,p,d=new i,v=new i,m=new i,g=new i,y=new o,b,w,E,S,x,T,N,C,k,L,A,O;M.prototype.visualize=function(t,n,s){if(n.debugGeometry){for(var u=0;u<n.debugGeometry.length;u++)n.debugGeometry[u].removeFromWorld();delete n.debugGeometry;return}var a=[.5+Math.sin(this.pos[0]*.5),.5+Math.sin(this.pos[1]*.5),.5+Math.sin(this.pos[2]*.5)];n.debugGeometry=[];var f=n.frameRot,l=n.force,n=n,c=new i;c.seta([1,1,1]);var h=function(s){n.debugGeometry.push(s);var u=function(e){console.log(e),n.debugGeometry.push(e),e.setComponent(new r({run:function(t){var n=l.clone();n.data[0]=.05+l.data[0]*.2,n.data[1]=.05,n.data[2]=.05;var r=new i;e.transformComponent.transform.scale.setv(n);var r=n.clone();r.data[0]=r.data[0]/2,t.transformComponent.transform.translation.setv(r),s.transformComponent.setUpdated(),t.transformComponent.setUpdated()}}))},f=function(e){console.log(e),n.debugGeometry.push(e),e.setComponent(new r({run:function(t){var n=l.clone();n.data[0]=.05,n.data[1]=.05+l.data[1]*.1,n.data[2]=.05;var r=new i;e.transformComponent.transform.scale.setv(n);var r=n.clone();r.data[1]=r.data[1]/2,t.transformComponent.transform.translation.setv(r),s.transformComponent.setUpdated(),t.transformComponent.setUpdated()}}))},h=function(e){n.debugGeometry.push(e);var s=t.spatial;e.setComponent(new r({run:function(t){var n=l.clone();n.data[0]=.05,n.data[1]=.05,n.data[2]=.05+l.data[2]*.5,e.transformComponent.transform.scale.setv(n);var r=n.clone();r.data[2]=r.data[2]/2,t.transformComponent.transform.translation.setv(r),t.transformComponent.transform.lookAt(n,i.UNIT_Y),t.transformComponent.setUpdated()}}))};e.fireEvent(e.list().BUILD_GOO_PRIMITIVE,{parentGooEntity:s,shape:"Box",pos:new i(0,0,0),rot:new o,size:c,color:a,callback:u}),e.fireEvent(e.list().BUILD_GOO_PRIMITIVE,{parentGooEntity:s,shape:"Box",pos:new i(0,0,0),rot:new o,size:c,color:a,callback:f}),e.fireEvent(e.list().BUILD_GOO_PRIMITIVE,{parentGooEntity:s,shape:"Box",pos:new i(0,0,0),rot:new o,size:c,color:a,callback:h})},p=function(e){var t=n.frameRot;e.wing=n,n.debugGeometry.push(e),e.setComponent(new r({run:function(e){n.destroyed&&(e.transformComponent.transform.scale.set(.5),e.transformComponent.setUpdated());if(!n.controlIds.length)return;e.transformComponent.transform.rotation=e.wing.frameRot,e.transformComponent.setUpdated()}})),e.transformComponent.setUpdated()};e.fireEvent(e.list().BUILD_GOO_PRIMITIVE,{parentGooEntity:t.geometries[0],shape:"Box",pos:this.pos,rot:this.rot,size:this.size,color:[a[0]*.6,a[1]*.6,a[2]*.6],callback:p}),e.fireEvent(e.list().BUILD_GOO_PRIMITIVE,{parentGooEntity:t.geometries[0],shape:"Sphere",pos:this.pos,rot:new o,size:new i(.2,.2,.2),color:[a[0]*.3,a[1]*.3,a[2]*.3],callback:h})},M.prototype.addControlSurface=function(e,t){this.controlSurfaces[e]=t},M.prototype.setAoAControl=function(e){this.controlIds.push(e)},M.prototype.attitudeAffectedLift=function(e,t){var n=e*s.fitValueInCurve(t,this.liftCurve);return Math.abs(n)>this.maxLoad&&(this.applyDamageToWing(.99),n=0),n},M.prototype.calcAxisLift=function(e){};var _=function(e,t){};return M.prototype.updateControlledRotation=function(){if(this.controlIds.length==0)return;l=this.rot.toAngles(),p=[0,0,0],h=0,c=0;for(var e=0;e<this.controlIds.length;e++)this.entity.surfaces[this.controlIds[e]].trimState&&(c+=this.entity.surfaces[this.controlIds[e]].trimState),h=c+this.entity.surfaces[this.controlIds[e]].currentState,p[0]+=h*this.controls[this.controlIds[e]][0],p[1]+=h*this.controls[this.controlIds[e]][1],p[2]+=h*this.controls[this.controlIds[e]][2];this.frameRot.fromAngles(p[0]+l.data[0],p[1]+l.data[1],p[2]+l.data[2])},M.prototype.applyDamageToWing=function(t){console.log("Wing Damaged: ",this),e.fireEvent(e.list().ONESHOT_AMBIENT_SOUND,{soundData:e.sound().MAIN_HIT_0,pos:this.worldPos.data,dir:[Math.random()-.5,Math.random()-.5,Math.random()-.5]}),e.fireEvent(e.list().PUFF_BLACK_SMOKE,{pos:this.worldPos.data,count:2,dir:[Math.random()-.5,1+Math.random(),Math.random()-.5]}),e.fireEvent(e.list().FLASH_MUZZLE_FIRE,{pos:this.worldPos.data,count:2,dir:[.2*(Math.random()-.5),.1+Math.random(),.2*(Math.random()-.5)]}),e.fireEvent(e.list().FLASH_SPARKS,{pos:this.worldPos.data,count:2,dir:[Math.random()-.5,.1+Math.random(),Math.random()-.5]}),this.integrity*=t},M.prototype.applyWaterInfluence=function(t,r){this.entity.spatial.angularVelocity.mul(.9);var i=n.calcSphereDisplacement(this.approxRadius,t);Math.random()<.3&&this.entity.spatial.speed>.1+5.5*Math.random()&&(Math.random()<.2&&e.fireEvent(e.list().SPLASH_RINGLET,{pos:[this.worldPos.data[0],.5,this.worldPos.data[2]],count:1,dir:[0,0,0]}),Math.random()<.15&&e.fireEvent(e.list().SPLASH_FOAM,{pos:[this.worldPos.data[0],.5,this.worldPos.data[2]],count:1,dir:[0,0,0]}),Math.random()<.5&&e.fireEvent(e.list().SPLASH_WATER,{pos:[this.worldPos.data[0],0,this.worldPos.data[2]],count:1,dir:[0,2,0]})),this.entity.spatial.velocity[1]>0&&(this.waterForce*=.75),this.waterForce=u.lerp(.1,this.waterForce,i*r*.1),v.set(0,this.waterForce,0),this.entity.spatial.velocity.mul(.9993),this.force.addv(v)},M.prototype.calcEffectSizeVector=function(e){return e.set((Math.random()-.5)*this.size.data[0]*.6,this.size.data[1]*.5,(Math.random()-.5)*this.size.data[2]*.6),y.set(this.entity.spatial.rot),y.rotateY(this.frameRot.toAngles().data[1]),y.applyPost(e),e},M.prototype.calcEffectPointVector=function(e){return e.set(this.worldPos.data),g=this.calcEffectSizeVector(g),e.add(g),e},M.prototype.applyTurbulence=function(){v=this.calcEffectPointVector(v),m.set(this.entity.spatial.velocity),e.fireEvent(e.list().PUFF_RAPID_WHITE,{pos:v.data,count:1,dir:m.data})},M.prototype.applySoundBarrierFx=function(){v=this.calcEffectPointVector(v),m.set(this.entity.spatial.velocity),e.fireEvent(e.list().PUFF_RAPID_WHITE,{pos:v.data,count:1,dir:m.data})},M.prototype.calcFormDrag=function(){L=this.size.data[1]*this.size.data[0],this.formDragForce=-this.airDensity*L*this.formDragCoeff*(this.airSpeed+this.entity.spatial.angularVelocity.data[1]*this.entity.spatial.angularVelocity.data[1]*this.pos.data[0]+this.entity.spatial.angularVelocity.data[2]*this.entity.spatial.angularVelocity.data[2]*this.pos.data[0]),-this.formDragForce>this.maxLoad&&(this.applyDamageToWing(.99),this.formDragForce=0)},M.prototype.calcInducedDrag=function(e,t){var n=Math.abs(e*.3*t);return n>this.maxLoad&&(this.applyDamageToWing(.99),n=0),-n},M.prototype.calcLiftForces=function(){l=this.frameRot.toAngles(),w=this.sourceData.rot[2],E=this.entity.spatial.axisAttitudes,O=this.entity.spatial.angularVelocity.data[2],d.set(E),S=Math.abs(Math.cos(d.data[2]-this.sourceData.rot[2])),x=Math.abs(Math.sin(d.data[1]-this.sourceData.rot[0])),T=Math.abs(Math.cos(d.data[0]-this.sourceData.rot[1])),N=n.calcSurfaceAxisAngleOfAttack(d.data[0],l.data[0],Math.sin(w)),C=n.calcSurfaceAxisAngleOfAttack(d.data[1],l.data[0],Math.cos(w)),N-=.25*this.entity.spatial.angularVelocity.data[1]*this.pos.data[2],C+=.2*O*this.pos.data[0],C-=.12*this.entity.spatial.angularVelocity.data[0]*this.pos.data[2],C+=.3*this.entity.spatial.angularVelocity.data[1]*this.pos.data[0]/(this.entity.spatial.speed+.1),k=Math.abs(T)*this.size.data[2]*this.size.data[0]*this.airSpeed,this.liftForcePitch=this.airDensity*k*this.attitudeAffectedLift(this.stallLiftCoeff[0],C,this),this.liftForceYaw=this.airDensity*k*this.attitudeAffectedLift(this.stallLiftCoeff[1],N,this),this.inducedLiftDragForce=this.calcInducedDrag(C,this.liftForcePitch),this.inducedYawDragForce=this.calcInducedDrag(N,this.liftForceYaw)},M.prototype.calcSurfaceForces=function(){b=this.worldPos.data[1],this.force.set(0,0,0),b<this.approxRadius;if(b<0){this.applyWaterInfluence(b,this.airDensity);return}this.waterForce=0,this.airSpeed=this.entity.spatial.velocity.lengthSquared(),this.calcLiftForces(),this.calcFormDrag(),A=this.formDragForce+this.inducedLiftDragForce+this.inducedYawDragForce,this.force.data[0]+=this.liftForceYaw,this.force.data[0]=this.force.data[0]*(1-Math.max(S*A,-1)),this.force.data[1]+=-this.liftForcePitch,this.force.data[1]=this.force.data[1]*(1-Math.max(x*A,-1)),this.force.data[2]+=A,this.force.data[2]=this.force.data[2]*(1-Math.max(T*A,-1)),this.lastFrameForce.lerp(this.force,.7),this.force.set(this.lastFrameForce),this.airSpeed>1&&(this.size.data[2]*this.size.data[0]*+Math.random()*this.size.data[2]*this.size.data[0]<-8550+this.force.lengthSquared()*Math.random()*.1*this.airDensity*this.airDensity&&this.applyTurbulence(),Math.abs(t.WORLD_PROPERTIES.speedOfSound*t.WORLD_PROPERTIES.speedOfSound-(this.entity.spatial.audioVel.lengthSquared()-3500))<1e3&&this.applySoundBarrierFx()),this.checkForceOverload()},M.prototype.checkForceOverload=function(){Math.random()>this.integrity&&(v=this.calcEffectPointVector(v),e.fireEvent(e.list().PUFF_BLACK_SMOKE,{pos:v.data,count:1,dir:[Math.random()-.5,1+Math.random(),Math.random()-.5]})),Math.sqrt(this.force.lengthSquared())>this.maxLoad&&this.force.mul(.5),this.destroyed&&this.force.mul(.9)},M.prototype.updateWingForces=function(e,t,n){this.groundProximity=n,this.airDensity=e,this.worldPos=t,this.updateControlledRotation(),this.calcSurfaceForces(),this.destroyed&&this.force.mul(.9)},M}),define("game/controls/SurfaceController",["application/EventManager","3d/GooJointAnimator","goo/math/MathUtils"],function(e,t,n){var r=function(e){var t={lastSpeed:0,currentState:0,targetState:0,trimState:0,speed:e.speed,release:e.inputBehavior.release,lights:e.lights,locked:!1};return t},i=function(e,t,n){var r=e.surfaces[n];return t==undefined&&(r.release?t=0:t=r.currentState),r.targetState=t,r.locked=!1,t},s=function(t,n,r){var i=t.surfaces[r];return n==undefined&&(n=0),i.trimState+=.02*n,i.trimState=Math.min(i.trimState,.95),i.trimState=Math.max(i.trimState,-0.95),i.locked=!1,t.isPlayer&&e.fireEvent(e.list().PLAYER_CONTROL_STATE_UPDATE,{control:"trim_"+r,currentState:i.trimState}),n},o=function(t,n){t.surfaces[n].trimState=0,u(t,n),t.isPlayer&&e.fireEvent(e.list().PLAYER_CONTROL_STATE_UPDATE,{control:"trim_"+n,currentState:0})},u=function(r,i){var s=r.surfaces[i],o=r.pieceData.surfaces[i];if(s.locked)return;var u=s.targetState-s.currentState,a=o.controls,f=o.speed,l=1/(1+r.spatial.speed*r.spatial.speed*.03);f=f*u*l,f=n.lerp(.5,s.lastSpeed,f),s.lastSpeed=f;var c=s.currentState+f;Math.abs(c-s.targetState)<=f&&(c=s.targetState,s.locked=!0),r.isPlayer&&e.fireEvent(e.list().PLAYER_CONTROL_STATE_UPDATE,{control:i,currentState:c});for(var h in a){var p=a[h],d=function(e,n,i,s){s=s||0;for(var o in e){var u=r.pieceData.boneMap[o],f=r.animationChannels[u],l=(i+s)*a[n][o];n=="spoiler"&&(r.surfaces.wing_sweep.currentState>.5&&(l=0),c>0?l=Math.sqrt(Math.max(0,-l)):l=-Math.sqrt(-Math.min(0,l))),s,t.rotateBone(f,l,0,0)}};d(p,h,c,s.trimState)}s.currentState=c},a=function(e){for(var t in e.surfaces)u(e,t)};return{applyControlStateToSurface:i,applyTrimStateToSurface:s,processControlState:a,zeroSurfaceTrimState:o,buildSurface:r}}),define("game/controls/FlapsController",["application/EventManager","3d/GooJointAnimator"],function(e,t){var n=function(e){var t={currentState:0,targetState:0,speed:e.speed,locked:!1};return t},r=function(e,t){console.log("Fire Flaps change",t);var n=e.surfaces.flaps;return t==undefined&&(t=n.currentState),n.targetState=t,n.locked=!1,t},i=function(n){var r=n.surfaces.flaps;if(r.locked)return;var i=r.targetState-r.currentState;if(i==0)return;var s=i>0?1:i==0?0:-1;r.currentState+=s*r.speed,r.currentState=Math.max(r.currentState,0),r.currentState=Math.min(r.currentState,1),n.isPlayer&&e.fireEvent(e.list().PLAYER_CONTROL_STATE_UPDATE,{control:"flaps",currentState:r.currentState});var o=n.pieceData.surfaces.flaps.controls,u=n.pieceData.surfaces.flaps.speed;r.targetState<r.currentState&&(u=-u);var a=r.currentState+u;Math.abs(a-r.targetState)<=u&&(a=r.targetState,r.locked=!0);var f=o.flaps,l=function(e,r,i){console.log(e,r,i);for(var s in e){var u=n.pieceData.boneMap[s],a=n.animationChannels[u],f=i*o[r][s];t.rotateBone(a,f,0,0)}};l(f,"flaps",a),r.currentState=a};return{applyControlStateToFlaps:r,processControlState:i,buildFlaps:n}}),define("game/controls/BreaksController",["application/EventManager","3d/GooJointAnimator"],function(e,t){var n=function(e,t,n){var r={targetState:n,currentState:0,lights:t.lights,type:t.type,breaks:t.breaks,speed:t.speed,locked:!1};return r},r,i=function(e,t){return r=e.systems.breaks,t==undefined&&(t=r.currentState),r.targetState=t,r.locked=!1,t},s=function(e,n,r){var i=e.pieceData.boneMap[n],n=e.animationChannels[i];t.rotateBone(n,r)},o,u,a,f,l,c=function(e){r=e.systems.breaks;if(r.locked)return;a=e.pieceData.systems.breaks.controls,f=r.targetState-r.currentState;if(f==0)return;l=f>0?1:f==0?0:-1,r.currentState+=l*r.speed,r.currentState=Math.max(r.currentState,0),r.currentState=Math.min(r.currentState,1),o=r.speed,r.targetState<r.currentState&&(o=-o);var t=r.currentState+o;Math.abs(t-r.targetState)<=o&&(t=r.targetState,r.locked=!0),e.isPlayer,u=a.breaks;if(r.lights)for(var n=0;n<r.lights.length;n++)e.lights[r.lights[n]].setIntensity(t);var i=function(t,n,r){for(var i in t)s(e,i,r*t[i],a[n][i])};i(u,"breaks",t),r.currentState=t};return{processControlState:c,applyControlStateToBreaks:i,buildSystem:n}}),define("goo/math/Vector2",["goo/math/Vector"],function(e){function t(){e.call(this,2),arguments.length!==0?this.set(arguments):this.setd(0,0)}return t.prototype=Object.create(e.prototype),t.prototype.setupAliases([["x","u","s"],["y","v","t"]]),t.ZERO=new t(0,0),t.ONE=new t(1,1),t.UNIT_X=new t(1,0),t.UNIT_Y=new t(0,1),t.add=function(e,n,r){typeof e=="number"&&(e=[e,e]),typeof n=="number"&&(n=[n,n]),r||(r=new t);var i=e.data||e,s=n.data||n;if(i.length!==2||s.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return r.data[0]=i[0]+s[0],r.data[1]=i[1]+s[1],r},t.prototype.add=function(e){return t.add(this,e,this)},t.sub=function(e,n,r){typeof e=="number"&&(e=[e,e]),typeof n=="number"&&(n=[n,n]),r||(r=new t);var i=e.data||e,s=n.data||n;if(i.length!==2||s.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return r.data[0]=i[0]-s[0],r.data[1]=i[1]-s[1],r},t.prototype.sub=function(e){return t.sub(this,e,this)},t.mul=function(e,n,r){typeof e=="number"&&(e=[e,e]),typeof n=="number"&&(n=[n,n]),r||(r=new t);var i=e.data||e,s=n.data||n;if(i.length!==2||s.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return r.data[0]=i[0]*s[0],r.data[1]=i[1]*s[1],r},t.prototype.mul=function(e){return t.mul(this,e,this)},t.div=function(e,n,r){typeof e=="number"&&(e=[e,e]),typeof n=="number"&&(n=[n,n]),r||(r=new t);var i=e.data||e,s=n.data||n;if(i.length!==2||s.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return r.data[0]=i[0]/s[0],r.data[1]=i[1]/s[1],r},t.prototype.div=function(e){return t.div(this,e,this)},t.dot=function(e,t){typeof e=="number"&&(e=[e,e]),typeof t=="number"&&(t=[t,t]);var n=e.data||e,r=t.data||t;if(n.length!==2||r.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var i=0;return i+=n[0]*r[0],i+=n[1]*r[1],i},t.prototype.dot=function(e){return t.dot(this,e)},t.prototype.setd=function(e,t){return this.data[0]=e,this.data[1]=t,this},t.prototype.seta=function(e){return this.data[0]=e[0],this.data[1]=e[1],this},t.prototype.setv=function(e){return this.data[0]=e.data[0],this.data[1]=e.data[1],this},t}),define("goo/renderer/Texture",["goo/math/Vector2"],function(e){function t(t,n,r,i){this.glTexture=null,n=n||{},this.wrapS=n.wrapS||"Repeat",this.wrapT=n.wrapT||"Repeat",this.magFilter=n.magFilter||"Bilinear",this.minFilter=n.minFilter||"Trilinear",this.anisotropy=n.anisotropy!==undefined?n.anisotropy:1,this.format=n.format||"RGBA",this.type=n.type||"UnsignedByte",this.variant="2D",this.offset=new e(n.offset||[0,0]),this.repeat=new e(n.repeat||[1,1]),this.generateMipmaps=n.generateMipmaps!==undefined?n.generateMipmaps:!0,this.premultiplyAlpha=n.premultiplyAlpha!==undefined?n.premultiplyAlpha:!1,this.unpackAlignment=n.unpackAlignment!==undefined?n.unpackAlignment:1,this.flipY=n.flipY!==undefined?n.flipY:!0,this.hasBorder=!1,this.needsUpdate=!1,this.updateCallback=null,this.readyCallback=null,t&&this.setImage(t,n,r,i)}return t.prototype.checkDataReady=function(){return this.image&&(this.image.dataReady||this.image instanceof HTMLImageElement)||this.readyCallback!==null&&this.readyCallback()},t.prototype.checkNeedsUpdate=function(){return this.needsUpdate||this.updateCallback!==null&&this.updateCallback()},t.prototype.setNeedsUpdate=function(){this.needsUpdate=!0},t.prototype.setImage=function(e,t,n,r){this.image=e;var i=e instanceof Array?e[0]:e;if(i instanceof Uint8Array||i instanceof Uint8ClampedArray||i instanceof Uint16Array||i instanceof Float32Array){n=n||e.width,r=r||e.height;if(n===undefined||r===undefined)throw"Data textures need width and height";this.image={data:e},this.image.width=n,this.image.height=r,this.image.isData=!0,this.image.dataReady=!0,i instanceof Uint8Array||i instanceof Uint8ClampedArray?this.type="UnsignedByte":i instanceof Uint16Array?(this.type="UnsignedShort565",this.format="RGB"):i instanceof Float32Array&&(this.type="Float",this.format="Alpha")}else i instanceof HTMLCanvasElement?this.image.dataReady=!0:e instanceof Array&&(this.image={data:e});this.setNeedsUpdate()},t.CUBE_FACES=["PositiveX","NegativeX","PositiveY","NegativeY","PositiveZ","NegativeZ"],t}),define("game/parts/CanvasLight",[],function(){var e="darker",t="source-over",n=function(e,t,n){this.meshData=e,this.txcoords=t,this.materialMap=n,this.intensity=0,this.attenuation=0,this.masterIntensity=1,this.ctx=this.materialMap.ctx,this.img=this.materialMap.emitImg};return n.prototype.adjustMasterIntensity=function(e){this.masterIntensity=e,this.renderLightState()},n.prototype.attenuatedFill=function(e){return"rgba(0, 0, 0, "+e+")"},n.prototype.setIntensity=function(e){this.intensity=e,this.renderLightState()},n.prototype.renderLightState=function(){this.ctx.globalCompositeOperation=t,this.ctx.drawImage(this.img,this.txcoords[0],this.txcoords[1],this.txcoords[2],this.txcoords[3],this.txcoords[0],this.txcoords[1],this.txcoords[2],this.txcoords[3]),this.attenuation=1-this.intensity*this.masterIntensity,this.ctx.fillStyle=this.attenuatedFill(this.attenuation),this.ctx.globalCompositeOperation=e,this.ctx.fillRect(this.txcoords[0],this.txcoords[1],this.txcoords[2],this.txcoords[3]),this.materialMap.emissiveMap.setNeedsUpdate()},n}),define("game/parts/LightSystem",[],function(){var e=function(e,t){this.id=t,this.entity=e,this.lights={},this.masterIntensity=1,this.masterColor=[1,1,1],this.testState={testing:!1,duration:0}};return e.prototype.addLight=function(e,t){this.lights[e]=t},e.prototype.setMasterIntensity=function(e,t){this.masterIntensity=e;for(var n in this.lights)this.lights[n].adjustMasterIntensity(this.masterIntensity);t&&(this.masterColor=t)},e.prototype.setSystemIntensity=function(e){for(var t in this.lights)this.lights[t].setIntensity(e)},e.prototype.lightOn=function(e,t){},e.prototype.lightOff=function(e){},e.prototype.setMode=function(e){e>.9?this.setSystemIntensity(1):e<-0.9&&this.setSystemIntensity(0)},e.prototype.runLightSystemTest=function(e){if(this.testState.testing)return;this.testState.testing=!0;var t=0,n=this,r=90,i=this,s=function(e,t,n,r){setTimeout(function(){e.setIntensity(i.masterIntensity*t)},n),setTimeout(function(){e.setIntensity(0)},n+r)};for(var o in this.lights){this.lights[o].setIntensity(0),t+=1;var u=this.lights[o],a=t*r;s(this.lights[o],1,a,60)}setTimeout(function(){n.testState.testing=!1},a+1e3)},e}),define("game/parts/Lights",["application/EventManager","goo/renderer/Texture","game/parts/CanvasLight","game/parts/LightSystem"],function(e,t,n,r){function i(e,t){var i={};e.lights=i,e.lightSystems={},e.lightsMaterialMap=s(e,t),console.log("Register entity lights: ",e,t);for(var o in t.systems){e.lightSystems[o]=new r(e,o);for(var u in t.systems[o])console.log("Create light; ",o,u),e.lights[u]=new n(t.systems[o][u].meshData,t.systems[o][u].txcoords,e.lightsMaterialMap),e.lightSystems[o].addLight(u,e.lights[u])}}function s(e,n){var r=e.geometries[0].transformComponent.children,i={};for(var s=0;s<r.length;s++){var o=r[s].entity;for(var u=0;u<n.meshData.length;u++)if(o.name==n.meshData[u].meshEntityName){console.log("Emissive material: ",o.name);var a=o.meshRendererComponent.materials;for(var f=0;f<a.length;f++)if(a[f]._textureMaps.EMISSIVE_MAP&&a[f]._textureMaps.EMISSIVE_MAP.image){console.log(a[f].name);var l=a[f]._textureMaps.EMISSIVE_MAP.image,c=document.createElement("canvas");c.id=o.name+"_canvas",c.width=l.naturalWidth,c.height=l.naturalHeight,c.dataReady=!0;var h=new t(c,null,c.width,c.height);return a[f].setTexture("EMISSIVE_MAP",h),i={meshRendComp:o.meshRendererComponent,meshEntity:o,material:a[f],emissiveMap:h,diffuseMap:a[f]._textureMaps.DIFFUSE_MAP,emitImg:l,canvas:c,ctx:c.getContext("2d")},i}}}}function o(e,t,n){e.lights[t].setIntensity(n)}function u(e){}return{setEntityLightIntensity:o,registerEntityLights:i,updateEntityLightState:u}}),define("game/planes/PlaneEngine",["application/EventManager","game/GameUtil","goo/math/Vector3","goo/math/Matrix3x3","game/parts/Lights","3d/GooJointAnimator"],function(e,t,n,r,i,s){var o=new n,u=new n,a,f=function(t){a=e.eventArgs(t).goo.world};e.registerListener(e.list().ENINGE_READY,f);var l=function(e,t,r){console.log("--------------->>>>  Add Engine"),this.planeEntity=e,this.engineId=e.id+JSON.stringify(r.posOffset),this.type=t,this.engineData=r,this.currentState=0,this.targetState=0,this.maxThrust=r.maxThrust,this.afterBurnerBoost=r.afterBurner,this.thrust=0,this.thrustVector=new n,this.pos=new n(r.posOffset),this.started=!1,this.flameEffect={},this.smokeEffect={},this.fireSounds={},this.rpm=0,this.exhaustTemp=0,this.engineGeometry=a.createEntity("engine_geometry_"+this.engineId),this.planeEntity.geometries[0].transformComponent.attachChild(this.engineGeometry.transformComponent),this.engineGeometry.transformComponent.transform.translation.set(this.pos),r.rot?this.engineGeometry.transformComponent.transform.setRotationXYZ(r.rot[0],r.rot[1],r.rot[2]):r.rot=[0,0,0],this.flameLight=r.flame_light},c,h=function(e,t){return e.transformComponent.transform.rotation.applyPost(t)};l.prototype.startEmission=function(){clearTimeout(this.endTimeout),this.particleComp.enabled=!0;for(var e=0;e<this.particleComp.emitters.length;e++)this.particleComp.emitters[e].enabled=!0};var p=2;l.prototype.determineNozzleState=function(e){var t=Math.max(e-.8,0);return t*p},l.prototype.updateNozzleState=function(e){s.setEntityBoneScale(this.planeEntity,this.engineData.nozzle,.6+e),s.updateEntityBoneRotXYZ(this.planeEntity,this.engineData.nozzle,0,e*this.engineData.rot[1],0)},l.prototype.updateEffects=function(n,r,i){var s=.4*(1-Math.cos(.5*Math.PI*n)),a=10*(r-n);if(n>.95){this.maxThrust=this.engineData.maxThrust+this.engineData.afterBurner,this.flameEffect.enabled=!0;for(var f=0;f<this.flameEffect.emitters.length;f++)this.flameEffect.emitters[f].enabled=!0}else{this.maxThrust=this.engineData.maxThrust,this.engineData.nozzle&&this.updateNozzleState(this.determineNozzleState(n));for(var f=0;f<this.flameEffect.emitters.length;f++)this.flameEffect.emitters[f].enabled=!1}var l=(new Date).getTime()*.001;this.fireSounds[d(this.engineId)].sourceNode.playbackRate.value=n*n*1.8+n*.3+.8+.05+s*.13+Math.sin(l*134)*.01,this.fireSounds[d(this.engineId)].gainNode.gain.value=Math.sin(n*1.4),this.fireSounds[v(this.engineId)].sourceNode.playbackRate.value=n*n*.5+.7+n*Math.sin(Math.PI*n*.5)*.4+Math.sin(n*l*40+l*120)*.001,this.fireSounds[v(this.engineId)].gainNode.gain.value=n+n*Math.sin(n*l*90+l*120)*.02,this.fireSounds[m(this.engineId)].gainNode.gain.value=n*n*n*Math.sin(Math.PI*n*.8)*.5*(1+Math.sin(l*80)*.01),this.fireSounds[m(this.engineId)].sourceNode.playbackRate.value=Math.sqrt(n+.2)*194*Math.sin(Math.PI*n*.4)+s*3.12+Math.sin(l*130)*.03;var c=this.planeEntity.spatial.pos;o.set(this.pos);var h=t.applyRotationToVelocity(this.planeEntity.geometries[0],o);h.addv(c),u.set(0,0,-Math.random()*n*12-14.4*n-6),t.applyRotationToVelocity(this.planeEntity.geometries[0],u),Math.random()<(s-i)*.02&&e.fireEvent(e.list().ACROBATIC_SMOKE,{pos:h.data,count:1,dir:u.data}),Math.random()<(a-i)*.06&&e.fireEvent(e.list().PUFF_SMALL_WHITE,{pos:h.data,count:1,dir:[u.data[0]*.15+.1*(Math.random()-.5),u.data[1]*.15+.1*(Math.random()-.5),u.data[2]*.15+.1*(Math.random()-.5)]}),Math.random()<(a-i)*.02&&e.fireEvent(e.list().PUFF_WHITE_SMOKE,{pos:h.data,count:1,dir:[u.data[0]*.5+.3*(Math.random()-.5),u.data[1]*.5+.3*(Math.random()-.5),u.data[2]*.5+.3*(Math.random()-.5)]});var p=this.planeEntity.spatial.audioVel.data,g=[-p[0],-p[1],-p[2]];this.fireSounds[d(this.engineId)].panner.setPosition(h[0],h[1],h[2]),this.fireSounds[d(this.engineId)].panner.setVelocity(p[0],p[1],p[2]),this.fireSounds[d(this.engineId)].panner.setOrientation(g[0],g[1],g[2]),this.fireSounds[v(this.engineId)].panner.setPosition(h[0],h[1],h[2]),this.fireSounds[v(this.engineId)].panner.setVelocity(p[0],p[1],p[2]),this.fireSounds[v(this.engineId)].panner.setOrientation(g[0],g[1],g[2]),this.fireSounds[m(this.engineId)].panner.setPosition(h[0],h[1],h[2]),this.fireSounds[m(this.engineId)].panner.setVelocity(p[0],p[1],p[2]),this.fireSounds[m(this.engineId)].panner.setOrientation(g[0],g[1],g[2])};var d=function(e){return e+"_engine_loop"},v=function(e){return e+"_turbine_loop"},m=function(e){return e+"_tone_loop"};l.prototype.addJetSounds=function(){var t=function(e){this.fireSounds[e.playId]=e,console.log(e)}.bind(this);e.fireEvent(e.list().LOOP_AMBIENT_SOUND,{soundData:e.sound().ENGINE_ON,playId:d(this.engineId),callback:t}),e.fireEvent(e.list().LOOP_AMBIENT_SOUND,{soundData:e.sound().ENGINE_GAS,playId:v(this.engineId),callback:t}),e.fireEvent(e.list().LOOP_AMBIENT_SOUND,{soundData:e.sound().ENGINE_TONE,playId:m(this.engineId),callback:t})},l.prototype.removeJetSounds=function(){console.log("Stop loop"),e.fireEvent(e.list().STOP_SOUND_LOOP,{loopId:d(this.engineId)}),e.fireEvent(e.list().STOP_SOUND_LOOP,{loopId:v(this.engineId)}),e.fireEvent(e.list().STOP_SOUND_LOOP,{loopId:m(this.engineId)})},l.prototype.addJetFlame=function(){var t=this.planeEntity.spatial,n=this.engineData.rot,r=function(e){return e.velocity.set(6*(Math.random()-.5-n[1]*15),6.7*(Math.random()-.5),t.speed-175*(Math.random()-.5)),t.rot.applyPost(e.velocity),e.velocity},i=function(e){return e.position.set(n[1]*5-n[1]*.9*t.speed,0,-2-Math.random()*5),e.position.data[2]+=t.speed-t.speed*Math.random(),e.position.data[1]+=t.angularVelocity.data[0]*60,e.position},s={velocity:r,position:i},o=function(e){this.engineGeometry.transformComponent.attachChild(e.transformComponent),this.flameEffect=e.particleComponent,this.flameEffect.parentEntity=this.planeEntity.geometries[0],console.log(e);var t=0;for(var n=0;n<this.flameEffect.emitters.length;n++)t+=this.flameEffect.emitters[n].releaseRatePerSecond;this.flameEffect.maxReleaseRate=t}.bind(this);e.fireEvent(e.list().BUILD_GOO_PARTICLES,{parentGooEntity:this.planeEntity.geometries[0],systemParams:this.engineData.jet_flame,emitFunctions:s,callback:o})},l.prototype.addJetSmoke=function(){var t=function(e){this.smokeEffect=e.particleComponent;var t=0;for(var n=0;n<this.smokeEffect.emitters.length;n++)t+=this.smokeEffect.emitters[n].releaseRatePerSecond;this.smokeEffect.maxReleaseRate=t}.bind(this);e.fireEvent(e.list().BUILD_GOO_PARTICLES,{parentGooEntity:this.planeEntity.geometries[0],systemParams:this.engineData.jet_smoke,emitFunctions:emitFunctions,callback:t})},l.prototype.start=function(){this.started||(e.fireEvent(e.list().ONESHOT_AMBIENT_SOUND,{soundData:e.sound().ENGINE_START,pos:this.planeEntity.spatial.pos.data,dir:[0,0,0]}),this.addJetFlame(),this.addJetSounds(),this.started=!0,console.log("Start Engine"))},l.prototype.pause=function(){this.removeJetSounds(),this.started=!1,console.log("Pause Engine")};var g=function(e,t,n){return t>2&&(t=.2),e*(Math.random()*t*.2+t*.9)*n};l.prototype.updateRpm=function(){var e=.98*this.currentState+.04*Math.random()-this.rpm;this.rpm+=e*.01},l.prototype.updateTemps=function(){var e=Math.sin(this.rpm*(2.6-this.rpm)),t=Math.max((e-this.exhaustTemp)*e*.004,0),n=this.exhaustTemp*this.exhaustTemp*.001;this.flameLight&&i.setEntityLightIntensity(this.planeEntity,this.flameLight,2*this.exhaustTemp*(.8*this.exhaustTemp+Math.random()*.2)-.5),this.exhaustTemp+=t-n},l.prototype.updateThrust=function(e){if(this.currentState==0&&this.targetState>0)this.start();else if(this.started&&this.rpm<=1e-5)this.pause();else if(!this.started)return;this.updateEffects(this.rpm,this.targetState,e);var t=this.targetState-this.currentState,n=t>0?1:t==0?0:-1;this.currentState+=n*.003,this.currentState=Math.max(this.currentState,0),this.currentState=Math.min(this.currentState,1),this.updateRpm(),this.updateTemps(),this.thrust=g(this.rpm,e,this.maxThrust),this.thrustVector.setd(0,0,this.thrust)};var y=function(t){c=e.eventArgs(t).context};return e.registerListener(e.list().REGISTER_AUDIO_CONTEXT,y),l}),define("game/controls/EngineController",["application/EventManager","game/planes/PlaneEngine"],function(e,t){var n=function(e,n,r){var i=new t(e,n,r);return i},r=function(e,t){var r=[];for(var i in t.controls)for(var s=0;s<t.mounts.length;s++)r.push(n(e,i,t.mounts[s]));return r},i=function(e,t){e.targetState=t},s=function(e,t){for(var n=0;n<e.systems.engines.length;n++){var r=e.systems.engines[n];t==undefined&&(t=r.currentState),i(r,t)}return t},o=function(t){var n=t.systems.engines;for(var r=0;r<n.length;r++){var i=n[r],s=i.currentState;i.updateThrust(t.air.density)}if(s==i.currentState)return;t.isPlayer&&e.fireEvent(e.list().PLAYER_CONTROL_STATE_UPDATE,{control:"engines",currentState:s})};return{applyControlStateToEngines:s,processControlState:o,buildSystem:r}}),define("goo/renderer/BufferData",[],function(){function e(e,t){this.data=e,this.target=t,this.glBuffer=null,this._dataUsage="StaticDraw",this._dataNeedsRefresh=!1}return e.prototype.setDataUsage=function(e){this._dataUsage=e},e.prototype.setDataNeedsRefresh=function(){this._dataNeedsRefresh=!0},e}),define("goo/renderer/Util",[],function(){function e(){}return e.getByteSize=function(e){switch(e){case"Byte":return 1;case"UnsignedByte":return 1;case"Short":return 2;case"UnsignedShort":return 2;case"Int":return 4;case"HalfFloat":return 2;case"Float":return 4;case"Double":return 8;default:throw"Unknown type: "+e}},e.checkGLError=function(e){var t=e.getError(),n=!1;while(t!==e.NO_ERROR){n=!0;if(t===e.INVALID_ENUM)console.error("An unacceptable value is specified for an enumerated argument. The offending command is ignored and has no other side effect than to set the error flag.");else if(t===e.INVALID_VALUE)console.error("A numeric argument is out of range. The offending command is ignored and has no other side effect than to set the error flag.");else if(t===e.INVALID_OPERATION)console.error("The specified operation is not allowed in the current state. The offending command is ignored and has no other side effect than to set the error flag.");else if(t===e.FRAMEBUFFER_COMPLETE)console.error("The command is trying to render to or read from the framebuffer while the currently bound framebuffer is not framebuffer complete (i.e. the return value from glCheckFramebufferStatus is not GL_FRAMEBUFFER_COMPLETE). The offending command is ignored and has no other side effect than to set the error flag.");else if(t===e.OUT_OF_MEMORY)throw"There is not enough memory left to execute the command. The state of the GL is undefined, except for the state of the error flags, after this error is recorded.";t=e.getError()}if(n)throw"Stopping due to error"},e.isPowerOfTwo=function(e){return(e&e-1)===0},e.nearestPowerOfTwo=function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.log(2)))},e.clone=function(t){if(t===null||typeof t!="object")return t;if(t instanceof Uint8Array)return t;if(t instanceof Date){var n=new Date;return n.setTime(t.getTime()),n}if(t instanceof Array){var n=[];for(var r=0,i=t.length;r<i;++r)n[r]=e.clone(t[r]);return n}if(t instanceof Object){var n={};for(var s in t)t.hasOwnProperty(s)&&(n[s]=e.clone(t[s]));return n}throw new Error("Unable to copy obj! Its type isn't supported.")},e}),define("goo/renderer/BufferUtils",[],function(){function e(){}function t(){var t=["Trident","MSIE","Firefox","Safari","Chrome","Opera"],n=navigator.userAgent,r=t.length-1;for(r;r>-1&&n.indexOf(t[r])===-1;r--);e.browserType=t[r]}return e.createIndexBuffer=function(t,n){var r;if(n<=256)e.browserType==="Trident"?r=new Uint16Array(t):r=new Uint8Array(t);else{if(!(n<=65536))throw new Error("Maximum number of vertices is 65536. Got: "+n);r=new Uint16Array(t)}return r},t(),e}),define("goo/math/Vector4",["goo/math/Vector"],function(e){function t(){e.call(this,4),arguments.length!==0?this.set(arguments):this.setd(0,0,0,0)}return t.prototype=Object.create(e.prototype),t.prototype.setupAliases([["x","r"],["y","g"],["z","b"],["w","a"]]),t.ZERO=new t(0,0,0,0),t.ONE=new t(1,1,1,1),t.UNIT_X=new t(1,0,0,0),t.UNIT_Y=new t(0,1,0,0),t.UNIT_Z=new t(0,0,1,0),t.UNIT_W=new t(0,0,0,1),t.add=function(e,n,r){typeof e=="number"&&(e=[e,e,e,e]),typeof n=="number"&&(n=[n,n,n,n]),r||(r=new t);var i=e.data||e,s=n.data||n;if(i.length!==4||s.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return r.data[0]=i[0]+s[0],r.data[1]=i[1]+s[1],r.data[2]=i[2]+s[2],r.data[3]=i[3]+s[3],r},t.prototype.add=function(e){return t.add(this,e,this)},t.sub=function(e,n,r){typeof e=="number"&&(e=[e,e,e,e]),typeof n=="number"&&(n=[n,n,n,n]),r||(r=new t);var i=e.data||e,s=n.data||n;if(i.length!==4||s.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return r.data[0]=i[0]-s[0],r.data[1]=i[1]-s[1],r.data[2]=i[2]-s[2],r.data[3]=i[3]-s[3],r},t.prototype.sub=function(e){return t.sub(this,e,this)},t.mul=function(e,n,r){typeof e=="number"&&(e=[e,e,e,e]),typeof n=="number"&&(n=[n,n,n,n]),r||(r=new t);var i=e.data||e,s=n.data||n;if(i.length!==4||s.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return r.data[0]=i[0]*s[0],r.data[1]=i[1]*s[1],r.data[2]=i[2]*s[2],r.data[3]=i[3]*s[3],r},t.prototype.mul=function(e){return t.mul(this,e,this)},t.div=function(e,n,r){typeof e=="number"&&(e=[e,e,e,e]),typeof n=="number"&&(n=[n,n,n,n]),r||(r=new t);var i=e.data||e,s=n.data||n;if(i.length!==4||s.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return r.data[0]=i[0]/s[0],r.data[1]=i[1]/s[1],r.data[2]=i[2]/s[2],r.data[3]=i[3]/s[3],r},t.prototype.div=function(e){return t.div(this,e,this)},t.dot=function(e,t){typeof e=="number"&&(e=[e,e,e,e]),typeof t=="number"&&(t=[t,t,t,t]);var n=e.data||e,r=t.data||t;if(n.length!==4||r.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var i=0;return i+=n[0]*r[0],i+=n[1]*r[1],i+=n[2]*r[2],i+=n[3]*r[3],i},t.prototype.dot=function(e){return t.dot(this,e)},t.prototype.lerp=function(e,t){return this.x=(1-t)*this.x+t*e.x,this.y=(1-t)*this.y+t*e.y,this.z=(1-t)*this.z+t*e.z,this.w=(1-t)*this.w+t*e.w,this},t.prototype.setd=function(e,t,n,r){return this.data[0]=e,this.data[1]=t,this.data[2]=n,this.data[3]=r,this},t.prototype.seta=function(e){return this.data[0]=e[0],this.data[1]=e[1],this.data[2]=e[2],this.data[3]=e[3],this},t.prototype.setv=function(e){return this.data[0]=e.data[0],this.data[1]=e.data[1],this.data[2]=e.data[2],this.data[3]=e.data[3],this},t}),define("goo/renderer/MeshData",["goo/renderer/BufferData","goo/renderer/Util","goo/renderer/BufferUtils","goo/math/Vector2","goo/math/Vector3","goo/math/Vector4"],function(e,t,n,r,i,s){function u(e,t,n){this.attributeMap=e,this.vertexCount=t!==undefined?t:0,this.indexCount=n!==undefined?n:0,this.primitiveCounts=[0],this.vertexData=null,this.indexData=null,this.dataViews={},this.indexLengths=null,this.indexModes=["Triangles"],this.type=u.MESH,this.rebuildData(this.vertexCount,this.indexCount)}function p(e){var n={};for(var r=0;r<e.length;r++){var i=e[r];if(h[i]===undefined)throw"No default attribute named: "+i;n[i]=t.clone(h[i])}return n}var o=window.Uint8ClampedArray;u.MESH=0,u.SKINMESH=1,u.prototype.rebuildData=function(e,t,n){var r={},i=null;if(n){for(var s in this.attributeMap){var o=this.dataViews[s];o&&(r[s]=o)}this.indexData&&(i=this.indexData.data)}this.rebuildVertexData(e),this.rebuildIndexData(t);if(n){for(var s in this.attributeMap){var u=r[s];if(u){var o=this.dataViews[s];o.set(u)}}r={},i&&this.indexData.data.set(i)}},u.prototype.rebuildVertexData=function(n){isNaN(n)||(this.vertexCount=n,this._vertexCountStore=this.vertexCount);if(this.vertexCount>0){var r=0;for(var i in this.attributeMap){var s=this.attributeMap[i];r+=t.getByteSize(s.type)*s.count}this.vertexData=new e(new ArrayBuffer(r*this.vertexCount),"ArrayBuffer"),this.generateAttributeData()}},u.prototype.rebuildIndexData=function(t){t!==undefined&&(this.indexCount=t);if(this.indexCount>0){var r=n.createIndexBuffer(this.indexCount,this.vertexCount);this.indexData=new e(r,"ElementArrayBuffer")}},u.prototype.setVertexDataUpdated=function(){this.vertexData._dataNeedsRefresh=!0},u.prototype.getSectionCount=function(){return this.indexLengths?this.indexLengths.length:1},u.prototype.getPrimitiveCount=function(e){return e>=0&&e<this.primitiveCounts.length?this.primitiveCounts[e]:0},u.prototype.getPrimitiveVertices=function(e,t,n){var r=this.getPrimitiveCount(t);if(e>=r||e<0)throw new Error("Invalid primitiveIndex '"+e+"'.  Count is "+r);var s=this.indexModes[t],o=u.getVertexCount(s),a=n;if(!a||a.length<o)a=[];var f=this.getAttributeBuffer(u.POSITION);for(var l=0;l<o;l++){a[l]||(a[l]=new i);if(this.getIndexBuffer()){var c=this.getIndexBuffer()[this.getVertexIndex(e,l,t)];a[l].x=f[c*3+0],a[l].y=f[c*3+1],a[l].z=f[c*3+2]}else{var c=this.getVertexIndex(e,l,t);a[l].x=f[c*3+0],a[l].y=f[c*3+1],a[l].z=f[c*3+2]}}return a},u.prototype.getVertexIndex=function(e,t,n){var r=0;for(var i=0;i<n;i++)r+=this.indexLengths[i];switch(this.indexModes[n]){case"Triangles":r+=e*3+t;break;case"TriangleStrip":r+=e+t;break;case"TriangleFan":t===0?r+=0:r+=e+t;break;case"Points":r+=e;break;case"Lines":r+=e*2+t;break;case"LineStrip":case"LineLoop":r+=e+t;break;default:return u.logger.warning("unimplemented index mode: "+this.indexModes[n]),-1}return r},u.prototype.getTotalPrimitiveCount=function(){var e=0;for(var t=0,n=this.primitiveCounts.length;t<n;t++)e+=this.primitiveCounts[t];return e},u.prototype.updatePrimitiveCounts=function(){var e=this.indexData?this.indexData.data.length:this.vertexCount,t=this.getSectionCount();this.primitiveCounts.length!==t&&(this.primitiveCounts=[]);for(var n=0;n<t;n++){var r=this.indexLengths?this.indexLengths[n]:e,i=u.getPrimitiveCount(this.indexModes[n],r);this.primitiveCounts[n]=i}},u.getPrimitiveCount=function(e,t){switch(e){case"Triangles":return t/3;case"TriangleFan":case"TriangleStrip":return t-2;case"Lines":return t/2;case"LineStrip":return t-1;case"LineLoop":return t;case"Points":return t}throw new Error("unimplemented index mode: "+e)},u.getVertexCount=function(e){switch(e){case"Triangles":case"TriangleFan":case"TriangleStrip":return 3;case"Lines":case"LineStrip":case"LineLoop":return 2;case"Points":return 1}throw new Error("unimplemented index mode: "+e)};var a={Byte:Int8Array,UnsignedByte:Uint8Array,UnsignedByteClamped:o,Short:Int16Array,UnsignedShort:Uint16Array,Int:Int32Array,UnsignedInt:Uint32Array,Float:Float32Array};u.prototype.generateAttributeData=function(){var e=this.vertexData.data,n,r=0;for(var i in this.attributeMap){var s=this.attributeMap[i];s.offset=r;var o=this.vertexCount*s.count;r+=o*t.getByteSize(s.type);var u=a[s.type];if(!u)throw"Unsupported DataType: "+s.type;n=new u(e,s.offset,o),this.dataViews[i]=n}},u.prototype.makeInterleavedData=function(){var n=0,r=0;for(var i in this.attributeMap){var s=this.attributeMap[i];s.offset=n,n+=s.count*t.getByteSize(s.type)}var o=new e(new ArrayBuffer(n*this.vertexCount),this.vertexData.target);o._dataUsage=this.vertexData._dataUsage,o._dataNeedsRefresh=!0;var u=new DataView(o.data);for(var i in this.attributeMap){var a=this.dataViews[i],s=this.attributeMap[i];s.stride=n;var r=s.offset,f=s.count,l=t.getByteSize(s.type),c=this.getDataMethod(s.type),h=u[c];for(var p=0;p<this.vertexCount;p++)for(var d=0;d<f;d++)h.apply(u,[r+n*p+d*l,a[p*f+d],!0])}this.vertexData=o},u.prototype.getDataMethod=function(e){switch(e){case"Byte":return"setInt8";case"UnsignedByte":return"setUInt8";case"Short":return"setInt16";case"UnsignedShort":return"setUInt16";case"Int":return"setInt32";case"HalfFloat":return"setInt16";case"Float":return"setFloat32"}},u.prototype.getAttributeBuffer=function(e){return this.dataViews[e]},u.prototype.getIndexData=function(){return this.indexData},u.prototype.getIndexBuffer=function(){return this.indexData!==null?this.indexData.data:null},u.prototype.getIndexLengths=function(){return this.indexLengths},u.prototype.getIndexModes=function(){return this.indexModes},u.prototype.resetVertexCount=function(){this.vertexCount=this.vertexCountStore},u.prototype.applyTransform=function(e,t){var n=new i,r=this.getAttributeBuffer(e),s=r.length;if(e===u.POSITION)for(var o=0;o<s;o+=3)n.setd(r[o+0],r[o+1],r[o+2]),t.matrix.applyPostPoint(n),r[o+0]=n[0],r[o+1]=n[1],r[o+2]=n[2];else if(e===u.NORMAL)for(var o=0;o<s;o+=3)n.setd(r[o+0],r[o+1],r[o+2]),t.rotation.applyPost(n),r[o+0]=n[0],r[o+1]=n[1],r[o+2]=n[2];else if(e===u.TANGENT)for(var o=0;o<s;o+=3)n.setd(r[o+0],r[o+1],r[o+2]),t.rotation.applyPost(n),r[o+0]=n[0],r[o+1]=n[1],r[o+2]=n[2];return this},u.prototype.applyFunction=function(e,t){var n,o,u=this.getAttributeBuffer(e),a=u.length,f=this.attributeMap[e].count;switch(f){case 1:for(var l=0;l<a;l++)u[l]=t(u[l]);break;case 2:n=new r;for(var l=0;l<a;l+=2)n.setd(u[l+0],u[l+1]),o=t(n),u[l+0]=o[0],u[l+1]=o[1];break;case 3:n=new i;for(var l=0;l<a;l+=3)n.setd(u[l+0],u[l+1],u[l+2]),o=t(n),u[l+0]=o[0],u[l+1]=o[1],u[l+2]=o[2];break;case 4:n=new s;for(var l=0;l<a;l+=4)n.setd(u[l+0],u[l+1],u[l+2],u[l+3]),o=t(n),u[l+0]=o[0],u[l+1]=o[1],u[l+2]=o[2],u[l+3]=o[3]}return this},u.prototype.getNormalsMeshData=function(e){if(this.getAttributeBuffer("POSITION")===undefined)return;if(this.getAttributeBuffer("NORMAL")===undefined)return;e=e!==undefined?e:1;var t=[],n=[],r=this.dataViews.POSITION.length/3;for(var i=0;i<r;i++)t.push(this.dataViews.POSITION[i*3+0],this.dataViews.POSITION[i*3+1],this.dataViews.POSITION[i*3+2],this.dataViews.POSITION[i*3+0]+this.dataViews.NORMAL[i*3+0]*e,this.dataViews.POSITION[i*3+1]+this.dataViews.NORMAL[i*3+1]*e,this.dataViews.POSITION[i*3+2]+this.dataViews.NORMAL[i*3+2]*e);for(var i=0;i<r*2;i+=2)n.push(i,i+1);var s=new u(u.defaultMap([u.POSITION]),t.length,n.length);return s.getAttributeBuffer(u.POSITION).set(t),s.getIndexBuffer().set(n),s.indexModes[0]="Lines",s},u.prototype.buildWireframeData=function(){var e=t.clone(this.attributeMap),n=new u(e,this.vertexCount,0);n.indexModes[0]="Lines";var r=this.getIndexBuffer(),i=[],s=0;this.updatePrimitiveCounts();for(var o=0;o<this.getSectionCount();o++){var a=this.indexModes[o],f=this.getPrimitiveCount(o);for(var l=0;l<f;l++)switch(a){case"Triangles":case"TriangleFan":case"TriangleStrip":var c=r[this.getVertexIndex(l,0,o)],h=r[this.getVertexIndex(l,1,o)],p=r[this.getVertexIndex(l,2,o)];i[s+0]=c,i[s+1]=h,i[s+2]=h,i[s+3]=p,i[s+4]=p,i[s+5]=c,s+=6;break;case"Lines":case"LineStrip":var c=r[this.getVertexIndex(l,0,o)],h=r[this.getVertexIndex(l,1,o)];i[s+0]=c,i[s+1]=h,s+=2;break;case"LineLoop":var c=r[this.getVertexIndex(l,0,o)],h=r[this.getVertexIndex(l,1,o)];l===f-1&&(h=r[this.getVertexIndex(0,0,o)]),i[s+0]=c,i[s+1]=h,s+=2;break;case"Points":}}if(s>0){n.rebuildIndexData(s);for(var d in e)n.getAttributeBuffer(d).set(this.getAttributeBuffer(d));n.getIndexBuffer().set(i)}return n.paletteMap=this.paletteMap,n.weightsPerVertex=this.weightsPerVertex,n};var f=new i,l=new i,c=new i;u.prototype.buildFlatMeshData=function(){var e=[],n=this.getIndexBuffer();if(n===null)return console.debug("No indices, probably a point mesh"),this;if(n.length>65535)return console.warn("Mesh too big, cannot build flat mesh data"),this;var r=t.clone(this.attributeMap),i={};for(var s in r)i[s]={oldBuffer:this.getAttributeBuffer(s),values:[]};var o=0;this.updatePrimitiveCounts();for(var a=0;a<this.getSectionCount();a++){var h=this.indexModes[a],p=this.getPrimitiveCount(a),d=!1;for(var v=0;v<p;v++)switch(h){case"TriangleStrip":d=v%2===1?!0:!1;case"Triangles":case"TriangleFan":var m=n[this.getVertexIndex(v,0,a)],g=n[this.getVertexIndex(v,1,a)],y=n[this.getVertexIndex(v,2,a)];if(d){var b=y;y=g,g=b}for(var s in i){if(s===u.NORMAL)continue;var w=r[s].count;for(var E=0;E<w;E++)i[s].values[o*w+E]=i[s].oldBuffer[m*w+E],i[s].values[(o+1)*w+E]=i[s].oldBuffer[g*w+E],i[s].values[(o+2)*w+E]=i[s].oldBuffer[y*w+E];s===u.POSITION&&(f.setd(i[s].values[o*3],i[s].values[o*3+1],i[s].values[o*3+2]),l.setd(i[s].values[(o+1)*3],i[s].values[(o+1)*3+1],i[s].values[(o+1)*3+2]),c.setd(i[s].values[(o+2)*3],i[s].values[(o+2)*3+1],i[s].values[(o+2)*3+2]),l.subv(f),c.subv(f),l.cross(c).normalize(),i[u.NORMAL]&&(i[u.NORMAL].values[o*3]=l.data[0],i[u.NORMAL].values[o*3+1]=l.data[1],i[u.NORMAL].values[o*3+2]=l.data[2],i[u.NORMAL].values[(o+1)*3]=l.data[0],i[u.NORMAL].values[(o+1)*3+1]=l.data[1],i[u.NORMAL].values[(o+1)*3+2]=l.data[2],i[u.NORMAL].values[(o+2)*3]=l.data[0],i[u.NORMAL].values[(o+2)*3+1]=l.data[1],i[u.NORMAL].values[(o+2)*3+2]=l.data[2]))}e.push(e.length),e.push(e.length),e.push(e.length),o+=3}}if(e.length===0)return console.warn("Could not build flat data"),this;var S=new u(r,e.length,e.length);for(var s in i)S.getAttributeBuffer(s).set(i[s].values);return S.getIndexBuffer().set(e),S.paletteMap=this.paletteMap,S.weightPerVertex=this.weightsPerVertex,S},u.POSITION="POSITION",u.NORMAL="NORMAL",u.COLOR="COLOR",u.TANGENT="TANGENT",u.TEXCOORD0="TEXCOORD0",u.TEXCOORD1="TEXCOORD1",u.TEXCOORD2="TEXCOORD2",u.TEXCOORD3="TEXCOORD3",u.WEIGHTS="WEIGHTS",u.JOINTIDS="JOINTIDS",u.createAttribute=function(e,t,n){return{count:e,type:t,stride:0,offset:0,normalized:n!==undefined?n:!1}};var h={POSITION:u.createAttribute(3,"Float"),NORMAL:u.createAttribute(3,"Float"),COLOR:u.createAttribute(4,"Float"),TANGENT:u.createAttribute(4,"Float"),TEXCOORD0:u.createAttribute(2,"Float"),TEXCOORD1:u.createAttribute(2,"Float"),TEXCOORD2:u.createAttribute(2,"Float"),TEXCOORD3:u.createAttribute(2,"Float"),WEIGHTS:u.createAttribute(4,"Float"),JOINTIDS:u.createAttribute(4,"Float")};return u.defaultMap=function(e){return e===undefined?p(Object.keys(h)):p(e)},u}),define("goo/shapes/TerrainSurface",["goo/renderer/MeshData","goo/math/MathUtils"],function(e,t){function n(t,n,r,i){var s=[];for(var o=0;o<t.length;o++)for(var u=0;u<t[o].length;u++)s.push(o*n/(t.length-1),t[o][u]*r,u*i/(t.length-1));this.verts=s,this.vertsPerLine=t[0].length;var a=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]),f=this.verts.length/3,l=f/this.vertsPerLine;e.call(this,a,f,(l-1)*(this.vertsPerLine-1)*6),this.rebuild()}return n.prototype=Object.create(e.prototype),n.prototype.rebuild=function(){this.getAttributeBuffer(e.POSITION).set(this.verts);var n=[],r=[],i=[],s=this.verts.length/3,o=s/this.vertsPerLine;for(var u=0;u<o-1;u++){for(var a=0;a<this.vertsPerLine-1;a++){var f=(u+0)*this.vertsPerLine+(a+0),l=(u+1)*this.vertsPerLine+(a+0),c=(u+1)*this.vertsPerLine+(a+1),h=(u+0)*this.vertsPerLine+(a+1);n.push(l,f,h,l,h,c),i=t.getTriangleNormal(this.verts[f*3+0],this.verts[f*3+1],this.verts[f*3+2],this.verts[h*3+0],this.verts[h*3+1],this.verts[h*3+2],this.verts[l*3+0],this.verts[l*3+1],this.verts[l*3+2]),r.push(i[0],i[1],i[2])}r.push(i[0],i[1],i[2])}u--;for(var a=0;a<this.vertsPerLine-1;a++){var f=(u+0)*this.vertsPerLine+(a+0),l=(u+1)*this.vertsPerLine+(a+0),h=(u+0)*this.vertsPerLine+(a+1);i=t.getTriangleNormal(this.verts[f*3+0],this.verts[f*3+1],this.verts[f*3+2],this.verts[h*3+0],this.verts[h*3+1],this.verts[h*3+2],this.verts[l*3+0],this.verts[l*3+1],this.verts[l*3+2]),r.push(i[0],i[1],i[2])}r.push(i[0],i[1],i[2]),this.getAttributeBuffer(e.NORMAL).set(r),this.getIndexBuffer().set(n);var p=[],d=this.verts[this.verts.length-3],v=this.verts[this.verts.length-1];for(var u=0;u<this.verts.length;u+=3){var m=this.verts[u+0]/d,g=this.verts[u+2]/v;p.push(m,g)}return this.getAttributeBuffer(e.TEXCOORD0).set(p),this},n}),define("goo/math/Transform",["goo/math/Vector3","goo/math/Matrix3x3","goo/math/Matrix4x4"],function(e,t,n){function r(){this.matrix=new n,this.translation=new e,this.rotation=new t,this.scale=new e(1,1,1),this.tmpVec=new e,this.tmpVec2=new e,this.tmpMat1=new t}return r.combine=function(e,n,i){if(e.scale.data[0]!==e.scale.data[1]||e.scale.data[0]!==e.scale.data[2])throw{name:"NonUniformScaleException",message:"Non-uniform scaling in left hand transform, cannot resolve combined transform"};i=i||new r;var s=i.tmpVec;s.setv(n.translation),e.rotation.applyPost(s),s.mulv(e.scale),s.addv(e.translation);var o=i.tmpVec2;o.setv(n.scale),o.mulv(e.scale);var u=i.tmpMat1;return t.combine(e.rotation,n.rotation,u),i.rotation.copy(u),i.scale.setv(o),i.translation.setv(s),i},r.prototype.combine=function(e){return r.combine(this,e,this)},r.prototype.multiply=function(e,r){n.combine(e.matrix,r.matrix,this.matrix),this.tmpMat1.data.set(e.rotation.data),this.rotation.data.set(r.rotation.data),t.combine(this.tmpMat1,this.rotation,this.rotation),this.translation.setv(r.translation),this.translation.mulv(e.scale),this.tmpMat1.applyPost(this.translation).addv(e.translation),this.scale.setv(e.scale).mulv(r.scale)},r.prototype.setIdentity=function(){this.matrix.setIdentity(),this.translation.setv(e.ZERO),this.rotation.setIdentity(),this.scale.setv(e.ONE)},r.prototype.applyForward=function(e,t){return t.setv(e),this.matrix.applyPostPoint(t),t},r.prototype.applyForwardVector=function(e,t){return t.copy(e),t.set(t.x*this.scale.x,t.y*this.scale.y,t.z*this.scale.z),this.rotation.applyPost(t),t},r.prototype.update=function(){var e=this.matrix.data,t=this.rotation.data,n=this.scale.data,r=this.translation.data;e[0]=n[0]*t[0],e[1]=n[0]*t[1],e[2]=n[0]*t[2],e[3]=0,e[4]=n[1]*t[3],e[5]=n[1]*t[4],e[6]=n[1]*t[5],e[7]=0,e[8]=n[2]*t[6],e[9]=n[2]*t[7],e[10]=n[2]*t[8],e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1},r.prototype.copy=function(e){this.matrix.copy(e.matrix),this.translation.setv(e.translation),this.rotation.copy(e.rotation),this.scale.setv(e.scale)},r.prototype.setRotationXYZ=function(e,t,n){this.rotation.fromAngles(e,t,n)},r.prototype.lookAt=function(t,n){n||(n=e.UNIT_Y),this.tmpVec.setv(this.translation).subv(t).normalize(),this.rotation.lookAt(this.tmpVec,n)},r.prototype.invert=function(e){var t=e;t||(t=new r),t.matrix.copy(this.matrix),t.matrix.invert();var n=t.rotation.copy(this.rotation);return n.multiplyDiagonalPost(this.scale,n).invert(),t.translation.copy(this.translation),t.rotation.applyPost(t.translation).invert(),t},r.prototype.toString=function(){return""+this.matrix},r}),define("goo/entities/components/TransformComponent",["goo/math/Transform","goo/math/Vector3","goo/entities/components/Component"],function(e,t,n){function r(){this.type="TransformComponent",this.entity=null,this.parent=null,this.children=[],this.transform=new e,this.worldTransform=new e,this._dirty=!0,this._updated=!1,this.api={setTranslation:function(){return r.prototype.setTranslation.apply(this,arguments),this.entity}.bind(this),setScale:function(){return r.prototype.setScale.apply(this,arguments),this.entity}.bind(this),addTranslation:function(){return r.prototype.addTranslation.apply(this,arguments),this.entity}.bind(this),setRotation:function(){return r.prototype.setRotation.apply(this,arguments),this.entity}.bind(this),lookAt:function(){return r.prototype.lookAt.apply(this,arguments),this.entity}.bind(this),attachChild:function(e){return this.attachChild(e.transformComponent),this.entity}.bind(this),detachChild:function(e){return this.detachChild(e.transformComponent),this.entity}.bind(this)}}return r.type="TransformComponent",r.prototype=Object.create(n.prototype),r.prototype.constructor=r,r.prototype.setTranslation=function(){return this.transform.translation.set(arguments),this._dirty=!0,this},r.prototype.setScale=function(){return this.transform.scale.set(arguments),this._dirty=!0,this},r.prototype.addTranslation=function(){return arguments.length===3?this.transform.translation.add(arguments):this.transform.translation.add(arguments[0]),this._dirty=!0,this},r.prototype.setRotation=function(){if(arguments.length===1&&typeof arguments[0]=="object"){var e=arguments[0];e instanceof t?this.transform.rotation.fromAngles(e.x,e.y,e.z):e.length===3&&this.transform.rotation.fromAngles(e[0],e[1],e[2])}else this.transform.rotation.fromAngles(arguments[0],arguments[1],arguments[2]);return this._dirty=!0,this},r.prototype.lookAt=function(e,t){return this.transform.lookAt(e,t),this._dirty=!0,this},r.prototype.setUpdated=function(){this._dirty=!0},r.prototype.attached=function(e){this.entity=e},r.prototype.detached=function(){this.entity=undefined},r.prototype.attachChild=function(e,t){var n=this;while(n){if(n===e){console.warn("attachChild: An object can't be added as a descendant of itself.");return}n=n.parent}e.parent&&e.parent.detachChild(e),t&&(e.updateTransform(),this.updateTransform(),this.updateWorldTransform(),e.transform.multiply(this.worldTransform.invert(),e.transform)),e.parent=this,this.children.push(e)},r.prototype.detachChild=function(e,t){if(e===this){console.warn("attachChild: An object can't be removed from itself.");return}t&&e.transform.copy(e.worldTransform);var n=this.children.indexOf(e);n!==-1&&(e.parent=null,this.children.splice(n,1))},r.prototype.updateTransform=function(){this.transform.update()},r.prototype.updateWorldTransform=function(){this.parent?this.worldTransform.multiply(this.parent.worldTransform,this.transform):this.worldTransform.copy(this.transform),this._dirty=!1,this._updated=!0},r.applyOnEntity=function(e,n){var i=n.transformComponent;i||(i=new r);var s=!1;Array.isArray(e)&&e.length===3?(i.transform.translation.setd(e[0],e[1],e[2]),s=!0):e instanceof t?(i.transform.translation.setd(e.data[0],e.data[1],e.data[2]),s=!0):typeof e=="object"&&typeof e.x!="undefined"&&typeof e.y!="undefined"&&typeof e.z!="undefined"&&(i.transform.translation.setd(e.x,e.y,e.z),s=!0);if(s)return n.setComponent(i),!0},r}),define("goo/renderer/bounds/BoundingVolume",["goo/math/Vector3"],function(e){function t(t){this.center=new e,t!==undefined&&this.center.setv(t),this.min=new e(Infinity,Infinity,Infinity),this.max=new e(-Infinity,-Infinity,-Infinity)}return t.Outside=0,t.Inside=1,t.Intersects=2,t}),define("goo/renderer/bounds/BoundingSphere",["goo/math/Vector3","goo/math/MathUtils","goo/renderer/bounds/BoundingVolume","goo/renderer/MeshData"],function(e,t,n,r){function i(t,r){n.call(this,t),this.radius=r!==undefined?r:1,this.vec=new e}return i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.computeFromPoints=function(e){var t=this.min,n=this.max,r=this.vec;t.setd(Infinity,Infinity,Infinity),n.setd(-Infinity,-Infinity,-Infinity);var i,s,o;for(var u=0;u<e.length;u+=3)i=e[u+0],s=e[u+1],o=e[u+2],t.x=i<t.x?i:t.x,t.y=s<t.y?s:t.y,t.z=o<t.z?o:t.z,n.x=i>n.x?i:n.x,n.y=s>n.y?s:n.y,n.z=o>n.z?o:n.z;var a=n.addv(t).div(2),f=0,l;for(var u=0;u<e.length;u+=3)r.setd(e[u],e[u+1],e[u+2]),l=r.subv(a).lengthSquared(),l>f&&(f=l);this.radius=Math.sqrt(f),this.center.setv(a)},i.prototype.computeFromPrimitives=function(t,n,i,s,o){if(o-s<=0)return;var u=[],a=[],f=r.getVertexCount(t.indexModes[n]),l=0;for(var c=s;c<o;c++){a=t.getPrimitiveVertices(i[c],n,a);for(var h=0;h<f;h++)u[l++]=(new e).set(a[h])}this.averagePoints(u)},i.prototype.averagePoints=function(t){this.center.set(t[0]);for(var n=1;n<t.length;n++)this.center.add(t[n]);var r=1/t.length;this.center.mul(r);var i=0;for(var n=0;n<t.length;n++){var s=e.sub(t[n],this.center,this.vec),o=s.lengthSquared();o>i&&(i=o)}this.radius=Math.sqrt(i)+1e-5},i.prototype.transform=function(e,t){t===null&&(t=new i),e.applyForward(this.center,t.center);var n=e.scale;return t.radius=Math.abs(this._maxAxis(n)*this.radius),t},i.prototype.whichSide=function(e){var t=e.normal.data,r=this.center.data,i=t[0]*r[0]+t[1]*r[1]+t[2]*r[2]-e.constant;return i<-this.radius?n.Inside:i>this.radius?n.Outside:n.Intersects},i.prototype._pseudoDistance=function(e,t){return e.normal.x*t.x+e.normal.y*t.y+e.normal.z*t.z-e.constant},i.prototype._maxAxis=function(e){return Math.max(Math.abs(e.x),Math.max(Math.abs(e.y),Math.abs(e.z)))},i.prototype.toString=function(){var e=Math.round(this.center.x*10)/10,t=Math.round(this.center.y*10)/10,n=Math.round(this.center.z*10)/10,r=Math.round(this.radius*10)/10;return"["+e+","+t+","+n+"]"+" - "+r},i.prototype.intersects=function(e){return e.intersectsSphere(this)},i.prototype.intersectsBoundingBox=function(e){e.min.x=e.center.x-e.xExtent,e.min.y=e.center.y-e.yExtent,e.min.z=e.center.z-e.zExtent,e.max.x=e.center.x+e.xExtent,e.max.y=e.center.y+e.yExtent,e.max.z=e.center.z+e.zExtent;var t=Math.pow(this.radius,2),n=0;return this.center.x<e.min.x?n+=Math.pow(this.center.x-e.min.x,2):this.center.x>e.max.x&&(n+=Math.pow(this.center.x-e.max.x,2)),this.center.y<e.min.y?n+=Math.pow(this.center.y-e.min.y,2):this.center.y>e.max.y&&(n+=Math.pow(this.center.y-e.max.y,2)),this.center.z<e.min.z?n+=Math.pow(this.center.z-e.min.z,2):this.center.z>e.max.z&&(n+=Math.pow(this.center.z-e.max.z,2)),n<=t},i.prototype.intersectsSphere=function(e){var t=this.vec.setv(this.center).subv(e.center),n=this.radius+e.radius;return t.dot(t)<=n*n},i.prototype.intersectsRay=function(t){if(!this.center)return!1;var n=(new e).copy(t.origin).sub(this.center),r=n.dot(n)-this.radius*this.radius;if(r<=0)return!0;var i=t.direction.dot(n);return i>=0?!1:i*i>=r},i.prototype.intersectsRayWhere=function(t){var n=(new e).copy(t.origin).sub(this.center),r=n.dot(n)-this.radius*this.radius,i,s,o;if(r<=0){i=t.direction.dot(n),s=i*i-r,o=Math.sqrt(s);var u=[o-i],a=[(new e).copy(t.direction).mul(u[0]).add(t.origin)];return{distances:u,points:a}}i=t.direction.dot(n);if(i>=0)return null;s=i*i-r;if(s<0)return null;if(s>=1e-5){o=Math.sqrt(s);var u=[-i-o,-i+o],a=[(new e).copy(t.direction).mul(u[0]).add(t.origin),(new e).copy(t.direction).mul(u[1]).add(t.origin)];return{distances:u,points:a}}var u=[-i],a=[(new e).copy(t.direction).mul(u[0]).add(t.origin)];return{distances:u,points:a}},i.prototype.merge=function(e){if(e instanceof i)return this.mergeSphere(e.center,e.radius,this);var t=this.vec.setd(e.xExtent,e.yExtent,e.zExtent).length();return this.mergeSphere(e.center,t,this)},i.prototype.mergeSphere=function(e,n,r){r||(r=new i);var s=this.vec.setv(e).subv(this.center),o=s.lengthSquared(),u=n-this.radius,a=u*u;if(a>=o)return u<=0?(r.center.setv(this.center),r.radius=this.radius,r):(r.center.setv(e),r.radius=n,r);var f=Math.sqrt(o),l=r.center;if(f>t.EPSILON){var c=(f+u)/(2*f);l.addv(s.mul(c))}return r.radius=.5*(f+this.radius+n),r},i.prototype.clone=function(e){return e&&e instanceof i?(e.center.setv(this.center),e.radius=this.radius,e):new i(this.center,this.radius)},i}),define("goo/renderer/bounds/BoundingBox",["goo/math/Vector3","goo/renderer/bounds/BoundingVolume","goo/renderer/bounds/BoundingSphere","goo/math/MathUtils"],function(e,t,n,r){function i(n,r,i,s){t.call(this,n),this.xExtent=r!==undefined?r:1,this.yExtent=i!==undefined?i:1,this.zExtent=s!==undefined?s:1,this._compVect1=new e,this._compVect2=new e,this.vec=new e,this.corners=[];for(var o=0;o<8;o++)this.corners.push(new e)}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype.computeFromPoints=function(e){var t=this.min,n=this.max,r=this.vec;t.setd(Infinity,Infinity,Infinity),n.setd(-Infinity,-Infinity,-Infinity);var i,s,o;for(var u=0;u<e.length;u+=3)i=e[u+0],s=e[u+1],o=e[u+2],t.x=i<t.x?i:t.x,t.y=s<t.y?s:t.y,t.z=o<t.z?o:t.z,n.x=i>n.x?i:n.x,n.y=s>n.y?s:n.y,n.z=o>n.z?o:n.z;r.setv(n).subv(t).div(2),this.xExtent=r.x,this.yExtent=r.y,this.zExtent=r.z,this.center.setv(n).addv(t).div(2)},i.prototype.computeFromPrimitives=function(e,t,n,r,s){if(s-r<=0)return;var o=this._compVect1.set(Infinity,Infinity,Infinity),u=this._compVect2.set(-Infinity,-Infinity,-Infinity),a=[];for(var f=r;f<s;f++){a=e.getPrimitiveVertices(n[f],t,a);for(var l=0;l<a.length;l++)i.checkMinMax(o,u,a[l])}this.center.copy(o.add(u)),this.center.mul(.5),this.xExtent=u.x-this.center.x,this.yExtent=u.y-this.center.y,this.zExtent=u.z-this.center.z},i.checkMinMax=function(e,t,n){n.x<e.x&&(e.x=n.x),n.x>t.x&&(t.x=n.x),n.y<e.y&&(e.y=n.y),n.y>t.y&&(t.y=n.y),n.z<e.z&&(e.z=n.z),n.z>t.z&&(t.z=n.z)},i.prototype.transform=function(e,t){t===null&&(t=new i);var n=this.corners;this.getCorners(n);for(var r=0;r<n.length;r++)e.matrix.applyPostPoint(n[r]);var s=n[0].data[0],o=n[0].data[1],u=n[0].data[2],a=s,f=o,l=u;for(var r=1;r<n.length;r++){var c=n[r].data[0],h=n[r].data[1],p=n[r].data[2];s=Math.min(s,c),o=Math.min(o,h),u=Math.min(u,p),a=Math.max(a,c),f=Math.max(f,h),l=Math.max(l,p)}var d=(a+s)*.5,v=(f+o)*.5,m=(l+u)*.5;return t.center.setd(d,v,m),t.xExtent=a-d,t.yExtent=f-v,t.zExtent=l-m,t},i.prototype.getCorners=function(t){if(!t||t.length!==8){t=[];for(var n=0;n<t.length;n++)t.push(new e)}return t[0].setd(this.center.data[0]+this.xExtent,this.center.data[1]+this.yExtent,this.center.data[2]+this.zExtent),t[1].setd(this.center.data[0]+this.xExtent,this.center.data[1]+this.yExtent,this.center.data[2]-this.zExtent),t[2].setd(this.center.data[0]+this.xExtent,this.center.data[1]-this.yExtent,this.center.data[2]+this.zExtent),t[3].setd(this.center.data[0]+this.xExtent,this.center.data[1]-this.yExtent,this.center.data[2]-this.zExtent),t[4].setd(this.center.data[0]-this.xExtent,this.center.data[1]+this.yExtent,this.center.data[2]+this.zExtent),t[5].setd(this.center.data[0]-this.xExtent,this.center.data[1]+this.yExtent,this.center.data[2]-this.zExtent),t[6].setd(this.center.data[0]-this.xExtent,this.center.data[1]-this.yExtent,this.center.data[2]+this.zExtent),t[7].setd(this.center.data[0]-this.xExtent,this.center.data[1]-this.yExtent,this.center.data[2]-this.zExtent),t},i.prototype.whichSide=function(e){var n=e.normal.data,r=this.center.data,i=Math.abs(this.xExtent*n[0])+Math.abs(this.yExtent*n[1])+Math.abs(this.zExtent*n[2]),s=n[0]*r[0]+n[1]*r[1]+n[2]*r[2]-e.constant;return s<-i?t.Inside:s>i?t.Outside:t.Intersects},i.prototype._pseudoDistance=function(e,t){var n=e.normal.data,r=t.data;return n[0]*r[0]+n[1]*r[1]+n[2]*r[2]-e.constant},i.prototype._maxAxis=function(e){return Math.max(Math.abs(e.x),Math.max(Math.abs(e.y),Math.abs(e.z)))},i.prototype.toString=function(){var e=Math.round(this.center.x*10)/10,t=Math.round(this.center.y*10)/10,n=Math.round(this.center.z*10)/10;return"["+e+","+t+","+n+"]"+" - "+"["+this.xExtent+","+this.yExtent+","+this.zExtent+"]"},i.prototype.intersects=function(e){return e.intersectsBoundingBox(this)},i.prototype.intersectsBoundingBox=function(e){return this.center.x+this.xExtent<e.center.x-e.xExtent||this.center.x-this.xExtent>e.center.x+e.xExtent?!1:this.center.y+this.yExtent<e.center.y-e.yExtent||this.center.y-this.yExtent>e.center.y+e.yExtent?!1:this.center.z+this.zExtent<e.center.z-e.zExtent||this.center.z-this.zExtent>e.center.z+e.zExtent?!1:!0},i.prototype.intersectsSphere=function(e){this.min.x=this.center.x-this.xExtent,this.min.y=this.center.y-this.yExtent,this.min.z=this.center.z-this.zExtent,this.max.x=this.center.x+this.xExtent,this.max.y=this.center.y+this.yExtent,this.max.z=this.center.z+this.zExtent;var t=Math.pow(e.radius,2),n=0;return e.center.x<this.min.x?n+=Math.pow(e.center.x-this.min.x,2):e.center.x>this.max.x&&(n+=Math.pow(e.center.x-this.max.x,2)),e.center.y<this.min.y?n+=Math.pow(e.center.y-this.min.y,2):e.center.y>this.max.y&&(n+=Math.pow(e.center.y-this.max.y,2)),e.center.z<this.min.z?n+=Math.pow(e.center.z-this.min.z,2):e.center.z>this.max.z&&(n+=Math.pow(e.center.z-this.max.z,2)),n<=t},i.prototype.testStaticAABBAABB=function(t,n){var r=this,i=t,s={mtvDistance:1e10,mtvAxis:new e};return this.testAxisStatic(e.UNIT_X,r.center.x-r.xExtent,r.center.x+r.xExtent,i.center.x-i.xExtent,i.center.x+i.xExtent,s)?this.testAxisStatic(e.UNIT_Y,r.center.y-r.yExtent,r.center.y+r.yExtent,i.center.y-i.yExtent,i.center.y+i.yExtent,s)?this.testAxisStatic(e.UNIT_Z,r.center.z-r.zExtent,r.center.z+r.zExtent,i.center.z-i.zExtent,i.center.z+i.zExtent,s)?(n&&(n.isIntersecting=!0,n.normal=s.mtvAxis,n.penetration=Math.sqrt(s.mtvDistance)*1.001),!0):!1:!1:!1},i.prototype.testAxisStatic=function(t,n,r,i,s,o){var u=e.dot(t,t);if(u<1e-6)return!0;var a=s-n,f=r-i;if(a<=0||f<=0)return!1;var l=a<f?a:-f,c=(new e).copy(t).mul(l/u),h=e.dot(c,c);return h<o.mtvDistance&&(o.mtvDistance=h,o.mtvAxis=t),!0},i.prototype.intersectsRay=function(e){if(isNaN(this.center.x)||isNaN(this.center.y)||isNaN(this.center.z))return!1;var t=this._compVect1.setv(e.origin).subv(this.center),n=e.direction,s=[0,Infinity],o=this.xExtent;o<r.ZERO_TOLERANCE&&o>=0&&(o=r.ZERO_TOLERANCE);var u=this.yExtent;u<r.ZERO_TOLERANCE&&u>=0&&(u=r.ZERO_TOLERANCE);var a=this.zExtent;a<r.ZERO_TOLERANCE&&a>=0&&(a=r.ZERO_TOLERANCE);var f=i.clip(n.data[0],-t.data[0]-o,s)&&i.clip(-n.data[0],t.data[0]-o,s)&&i.clip(n.data[1],-t.data[1]-u,s)&&i.clip(-n.data[1],t.data[1]-u,s)&&i.clip(n.data[2],-t.data[2]-a,s)&&i.clip(-n.data[2],t.data[2]-a,s);return!f||s[0]===0&&s[1]===Infinity?!1:!0},i.prototype.intersectsRayWhere=function(t){if(isNaN(this.center.x)||isNaN(this.center.y)||isNaN(this.center.z))return null;var n=e.sub(t.origin,this.center,this._compVect1),s=t.direction,o=[0,Infinity],u=this.xExtent;u<r.ZERO_TOLERANCE&&u>=0&&(u=r.ZERO_TOLERANCE);var a=this.yExtent;a<r.ZERO_TOLERANCE&&a>=0&&(a=r.ZERO_TOLERANCE);var f=this.zExtent;f<r.ZERO_TOLERANCE&&f>=0&&(f=r.ZERO_TOLERANCE);var l=i.clip(s.x,-n.x-u,o)&&i.clip(-s.x,n.x-u,o)&&i.clip(s.y,-n.y-a,o)&&i.clip(-s.y,n.y-a,o)&&i.clip(s.z,-n.z-f,o)&&i.clip(-s.z,n.z-f,o);if(l&&(o[0]!==0||o[1]!==Infinity)){if(o[1]>o[0]){var c=o,h=[(new e(t.direction)).mul(c[0]).add(t.origin),(new e(t.direction)).mul(c[1]).add(t.origin)];return{distances:c,points:h}}var c=[o[0]],h=[(new e(t.direction)).mul(c[0]).add(t.origin)];return{distances:c,points:h}}return null},i.clip=function(e,t,n){return e>0?t>e*n[1]?!1:(t>e*n[0]&&(n[0]=t/e),!0):e<0?t>e*n[0]?!1:(t>e*n[1]&&(n[1]=t/e),!0):t<=0},i.prototype.merge=function(e){return e instanceof i?this.mergeBox(e.center,e.xExtent,e.yExtent,e.zExtent,this):e instanceof n?this.mergeBox(e.center,e.radius,e.radius,e.radius,this):this},i.prototype.mergeBox=function(e,t,n,r,s){s||(s=new i);var o=this._compVect1,u=this._compVect2;return o.x=this.center.x-this.xExtent,o.x>e.x-t&&(o.x=e.x-t),o.y=this.center.y-this.yExtent,o.y>e.y-n&&(o.y=e.y-n),o.z=this.center.z-this.zExtent,o.z>e.z-r&&(o.z=e.z-r),u.x=this.center.x+this.xExtent,u.x<e.x+t&&(u.x=e.x+t),u.y=this.center.y+this.yExtent,u.y<e.y+n&&(u.y=e.y+n),u.z=this.center.z+this.zExtent,u.z<e.z+r&&(u.z=e.z+r),s.center.set(u).addv(o).muld(.5,.5,.5),s.xExtent=u.x-s.center.x,s.yExtent=u.y-s.center.y,s.zExtent=u.z-s.center.z,s},i.prototype.clone=function(e){return e&&e instanceof i?(e.center.setv(this.center),e.xExtent=this.xExtent,e.yExtent=this.yExtent,e.zExtent=this.zExtent,e):new i(this.center,this.xExtent,this.yExtent,this.zExtent)},i}),define("goo/entities/components/MeshDataComponent",["goo/renderer/bounds/BoundingBox","goo/entities/components/Component","goo/renderer/MeshData"],function(e,t,n){function r(t){this.type="MeshDataComponent",this.meshData=t,this.modelBound=new e,this.autoCompute=!0,this.currentPose=null}return r.type="MeshDataComponent",r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype.setModelBound=function(e,t){this.modelBound=e,this.autoCompute=t},r.prototype.computeBoundFromPoints=function(){if(this.autoCompute&&this.modelBound!==null){var e=this.meshData.getAttributeBuffer("POSITION");e!==undefined&&(this.modelBound.computeFromPoints(e),this.autoCompute=!1)}},r.applyOnEntity=function(e,t){if(e instanceof n){var i=new r(e);return t.setComponent(i),!0}},r}),define("goo/renderer/ShaderCall",[],function(){function e(e,t,n){this.context=e,this.location=t,this.location.value=undefined;if(n)switch(n){case"float":this.call=this.uniform1f;break;case"bool":case"int":case"integer":case"sampler2D":case"sampler3D":case"samplerCube":this.call=this.uniform1i;break;case"floatarray":this.call=this.uniform1fv;break;case"intarray":case"samplerArray":this.call=this.uniform1iv;break;case"vec2":this.call=this.uniform2fv;break;case"vec3":this.call=this.uniform3fv;break;case"vec4":this.call=this.uniform4fv;break;case"mat2":this.call=this.uniformMatrix2fv;break;case"mat3":this.call=this.uniformMatrix3fv;break;case"mat4":this.call=this.uniformMatrix4fv;break;default:throw"Uniform type not handled: "+n}}function t(e,t,n){if(n<0)return!1;while(n--)if(e[n]!==t[n])return!1;return!0}function n(e,t){var n=e.length;while(n--)if(e[n]!==t[n])return!1;return!0}return e.prototype.uniform1f=function(e){var t=this.location.value;if(t===e)return;this.context.uniform1f(this.location,e),this.location.value=e},e.prototype.uniform1fv=function(e){var t=this.location.value;if(t!==undefined&&n(e,t))return;this.context.uniform1fv(this.location,e),this.location.value=e.slice()},e.prototype.uniform1i=function(e){var t=this.location.value;if(t===e)return;this.context.uniform1i(this.location,e),this.location.value=e},e.prototype.uniform1iv=function(e){var t=this.location.value;if(t!==undefined&&n(e,t))return;this.context.uniform1iv(this.location,e),this.location.value=e.slice()},e.prototype.uniform2f=function(e,t){var n=this.location.value;if(n!==undefined&&n.length===2&&n[0]===e&&n[1]===t)return;this.context.uniform2f(this.location,e,t),this.location.value=[e,t]},e.prototype.uniform2fv=function(e){var t=this.location.value;if(t!==undefined){if(n(e,t))return}else t=this.location.value=new Float64Array(e.length);this.context.uniform2fv(this.location,e);var r=e.length;while(r--)t[r]=e[r]},e.prototype.uniform2i=function(e,t){var n=this.location.value;if(n!==undefined&&n.length===2&&n[0]===e&&n[1]===t)return;this.context.uniform2i(this.location,e,t),this.location.value=[e,t]},e.prototype.uniform2iv=function(e){var t=this.location.value;if(t!==undefined&&n(e,t))return;this.context.uniform2iv(this.location,e),this.location.value=e.slice()},e.prototype.uniform3f=function(e,t,n){var r=this.location.value;if(r!==undefined&&r.length===3&&r[0]===e&&r[1]===t&&r[2]===n)return;this.context.uniform3f(this.location,e,t,n),this.location.value=[e,t,n]},e.prototype.uniform3fv=function(e){var t=this.location.value;if(t!==undefined){if(n(e,t))return}else t=this.location.value=new Float64Array(e.length);this.context.uniform3fv(this.location,e);var r=e.length;while(r--)t[r]=e[r]},e.prototype.uniform3i=function(e,t,n){var r=this.location.value;if(r!==undefined&&r.length===3&&r[0]===e&&r[1]===t&&r[2]===n)return;this.context.uniform3i(this.location,e,t,n),this.location.value=[e,t,n]},e.prototype.uniform3iv=function(e){var t=this.location.value;if(t!==undefined&&n(e,t))return;this.context.uniform3iv(this.location,e),this.location.value=e.slice()},e.prototype.uniform4f=function(e,t,n,r){var i=this.location.value;if(i!==undefined&&i.length===4&&i[0]===e&&i[1]===t&&i[2]===n&&i[3]===r)return;this.context.uniform4f(this.location,e,t,n,r),this.location.value=[e,t,n,r]},e.prototype.uniform4fv=function(e){var t=this.location.value;if(t!==undefined){if(n(e,t))return}else t=this.location.value=new Float64Array(e.length);this.context.uniform4fv(this.location,e);var r=e.length;while(r--)t[r]=e[r]},e.prototype.uniform4i=function(e,t,n,r){var i=this.location.value;if(i!==undefined&&i.length===4&&i[0]===e&&i[1]===t&&i[2]===n&&i[3]===r)return;this.context.uniform4i(this.location,e,t,n,r),this.location.value=[e,t,n,r]},e.prototype.uniform4iv=function(e){var t=this.location.value;if(t!==undefined&&n(e,t))return;this.context.uniform4iv(this.location,e),this.location.value=e.slice()},e.prototype.uniformMatrix2fv=function(e,n){n=n===!0;if(!e.data){this.context.uniformMatrix2fv(this.location,n,e);return}var r=this.location.value;if(r!==undefined){var i=t(r.data,e.data,4);if(i)return;r.copy(e)}else this.location.value=e.clone();this.context.uniformMatrix2fv(this.location,n,e.data)},e.prototype.uniformMatrix3fv=function(e,n){n=n===!0;if(!e.data){this.context.uniformMatrix3fv(this.location,n,e);return}var r=this.location.value;if(r!==undefined){var i=t(r.data,e.data,9);if(i)return;r.copy(e)}else this.location.value=e.clone();this.context.uniformMatrix3fv(this.location,n,e.data)},e.prototype.uniformMatrix4fv=function(e,r){r=r===!0;if(!e.data){var i=e,s=this.location.value;if(s!==undefined){if(n(i,s))return}else s=this.location.value=new Float64Array(i.length);this.context.uniformMatrix4fv(this.location,r,i);var o=i.length;while(o--)s[o]=i[o];return}var s=this.location.value;if(s!==undefined){var u=t(s.data,e.data,16);if(u)return;s.copy(e)}else this.location.value=e.clone();this.context.uniformMatrix4fv(this.location,r,e.data)},e}),define("goo/entities/Entity",["goo/entities/components/Component"],function(e){function t(e,n){this._world=e,this._components=[],Object.defineProperty(this,"id",{value:t.entityCount++,writable:!1}),this.name=n!==undefined?n:"Entity_"+this.id,this.skip=!1,this.hidden=!1}function n(e){return e.charAt(0).toLowerCase()+e.substr(1)}return t.prototype.set=function(){for(var t=0;t<arguments.length;t++){var n=arguments[t];if(n instanceof e)this.setComponent(n);else{var r=this._world._components;for(var i=0;i<r.length;i++){var s=r[i],o=s.applyOnEntity(n,this);if(o)break}}}return this},t.prototype.addToWorld=function(e){return this._world.addEntity(this,e),this},t.prototype.removeFromWorld=function(e){return this._world.removeEntity(this,e),this},t.prototype.setComponent=function(e){if(this.hasComponent(e.type))return;return this._components.push(e),this[n(e.type)]=e,e.attached&&e.attached(this),e.applyAPI(this),this._world.entityManager.containsEntity(this)&&this._world.changedEntity(this,e,"addedComponent"),this},t.prototype.hasComponent=function(e){var t=n(e),r=this[t];return!!r&&this._components.indexOf(r)>-1},t.prototype.getComponent=function(e){var t=n(e);if(this.hasComponent(e))return this[t]},t.prototype.clearComponent=function(e){var t=n(e),r=this[t];if(!!r&&this._components.indexOf(r)>-1){r.detached&&r.detached(this),r.removeAPI(this);var i=this._components.indexOf(r);this._components.splice(i,1),delete this[t],this._world.entityManager.containsEntity(this)&&this._world.changedEntity(this,r,"removedComponent")}return this},t.prototype.toString=function(){return this.name},t.entityCount=0,t}),define("goo/entities/managers/Manager",[],function(){function e(){}return e.prototype.applyAPI=function(e){this.installedAPI||(this.installedAPI={});var t=this.api;for(var n in t)typeof e[n]=="undefined"?(e[n]=t[n],this.installedAPI[n]=!0):console.warn("Could not install method "+n+" of "+this.type+" as it is already taken")},e}),define("goo/entities/managers/EntityManager",["goo/entities/managers/Manager"],function(e){function t(){this.type="EntityManager",this._entitiesById=[],this._entityCount=0,this.api={id:function(){var e=t.prototype.getEntityById.apply(this,arguments);return e}.bind(this),name:function(){var e=t.prototype.getEntityByName.apply(this,arguments);return e}.bind(this)}}return t.prototype=Object.create(e.prototype),t.prototype.added=function(e){this.containsEntity(e)||(this._entitiesById[e.id]=e,this._entityCount++)},t.prototype.removed=function(e){this.containsEntity(e)&&(delete this._entitiesById[e.id],this._entityCount--)},t.prototype.containsEntity=function(e){return this._entitiesById[e.id]!==undefined},t.prototype.getEntityById=function(e){return this._entitiesById[e]},t.prototype.getEntityByName=function(e){for(var t in this._entitiesById){var n=this._entitiesById[t];if(n.name===e)return n}},t.prototype.size=function(){return this._entityCount},t.prototype.getEntities=function(){var e=[];for(var t in this._entitiesById)e.push(this._entitiesById[t]);return e},t.prototype.getTopEntities=function(){var e=[];for(var t in this._entitiesById){var n=this._entitiesById[t];n.transformComponent?n.transformComponent.parent||e.push(n):e.push(n)}return e},t}),define("goo/entities/systems/System",[],function(){function e(e,t){this.type=e,this.interests=t,this._activeEntities=[],this.passive=!1,this.priority=0}function t(e){return e.charAt(0).toLowerCase()+e.substr(1)}return e.prototype.added=function(e){this._check(e)},e.prototype.changed=function(e){this._check(e)},e.prototype.removed=function(e){var t=this._activeEntities.indexOf(e);t!==-1&&(this._activeEntities.splice(t,1),this.deleted&&this.deleted(e))},e.prototype._check=function(e){if(this.interests&&this.interests.length===0)return;var n=this.interests===null;if(!n&&this.interests.length<=e._components.length){n=!0;for(var r=0;r<this.interests.length;r++){var i=t(this.interests[r]);if(!e[i]){n=!1;break}}}var s=this._activeEntities.indexOf(e);n&&s===-1?(this._activeEntities.push(e),this.inserted&&this.inserted(e)):!n&&s!==-1&&(this._activeEntities.splice(s,1),this.deleted&&this.deleted(e))},e.prototype._process=function(e){this.process&&this.process(this._activeEntities,e)},e}),define("goo/entities/World",["goo/entities/Entity","goo/entities/managers/EntityManager","goo/entities/components/TransformComponent","goo/entities/managers/Manager","goo/entities/systems/System","goo/entities/components/Component"],function(e,t,n,r,i,s){function o(e){this.gooRunner=e,this._managers=[],this._systems=[],this._addedEntities=[],this._changedEntities=[],this._removedEntities=[],this.by={},this.entityManager=new t,this.setManager(this.entityManager),this.time=0,this.tpf=1,this._components=[]}return o.time=0,o.tpf=1,o.prototype.add=function(){for(var t=0;t<arguments.length;t++){var n=arguments[t];n instanceof e?this.addEntity(n):n instanceof r?this.setManager(n):n instanceof i?this.setSystem(n):n instanceof s&&this.registerComponent(n)}return this},o.prototype.registerComponent=function(e){return this._components.indexOf(e)===-1&&this._components.push(e),this},o.prototype.setManager=function(e){return this._managers.push(e),e.applyAPI(this.by),this},o.prototype.getManager=function(e){for(var t=0;t<this._managers.length;t++){var n=this._managers[t];if(n.type===e)return n}},o.prototype.setSystem=function(e){var t=e.priority;for(var n=0;n<this._systems.length;n++)if(this._systems[n].priority>t)break;return this._systems.splice(n,0,e),this},o.prototype.getSystem=function(e){for(var t=0;t<this._systems.length;t++){var n=this._systems[t];if(n.type===e)return n}},o.prototype.createEntity=function(){var t=new e(this);for(var r=0;r<arguments.length;r++)typeof arguments[r]=="string"?t.name=arguments[r]:t.set(arguments[r]);return t.transformComponent||t.setComponent(new n),t},o.prototype.getEntities=function(){return this.entityManager.getEntities()},o.prototype.addEntity=function(e,t){this._addedEntities.indexOf(e)===-1&&this._addedEntities.push(e);if(e.transformComponent&&(t===undefined||t===!0)){var n=e.transformComponent.children;for(var r=0;r<n.length;r++)this.addEntity(n[r].entity,t)}return this},o.prototype.removeEntity=function(e,t){this._removedEntities.indexOf(e)===-1&&this._removedEntities.push(e);var n=e.transformComponent;n.parent&&(n.parent.detachChild(n),n.parent=null);if(t===!1){var r=n.children;for(var i=0;i<r.length;i++)r[i].parent=null;n.children=[]}else{var r=n.children;for(var i=0;i<r.length;i++)this._recursiveRemoval(r[i].entity,t)}return this},o.prototype._recursiveRemoval=function(e,t){this._removedEntities.indexOf(e)===-1&&this._removedEntities.push(e);if(e.transformComponent&&(t===undefined||t===!0)){var n=e.transformComponent.children;for(var r=0;r<n.length;r++)this._recursiveRemoval(n[r].entity,t)}},o.prototype.changedEntity=function(e,t,n){var r={entity:e};t!==undefined&&(r.component=t),n!==undefined&&(r.eventType=n),this._changedEntities.push(r)},o.prototype.process=function(){this._check(this._addedEntities,function(e,t){e.added&&e.added(t);if(e.addedComponent)for(var n=0;n<t._components.length;n++)e.addedComponent(t,t._components[n])}),this._check(this._changedEntities,function(e,t){e.changed&&e.changed(t.entity),t.eventType!==undefined&&e[t.eventType]&&e[t.eventType](t.entity,t.component)}),this._check(this._removedEntities,function(e,t){e.removed&&e.removed(t);if(e.removedComponent)for(var n=0;n<t._components.length;n++)e.removedComponent(t,t._components[n])});for(var e=0;e<this._systems.length;e++){var t=this._systems[e];t.passive||t._process(this.tpf)}},o.prototype._check=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];for(var i=0;i<this._managers.length;i++){var s=this._managers[i];t(s,r)}for(var o=0;o<this._systems.length;o++){var u=this._systems[o];t(u,r)}}e.length=0},o}),define("goo/renderer/RenderQueue",["goo/math/Vector3"],function(e){function t(){var t=this,n=new e;this.opaqueSorter=function(e,r){var i=e.meshRendererComponent.materials[0],s=r.meshRendererComponent.materials[0];if(i===null||s===null)return 0;if(i===s){var o=e.meshRendererComponent.worldBound,u=r.meshRendererComponent.worldBound;if(o===null||u===null)return 0;var a=n.setv(t.camera.translation).subv(o.center).lengthSquared(),f=n.setv(t.camera.translation).subv(u.center).lengthSquared();return a-f}var l=i.shader,c=s.shader;if(l===null||c===null)return 0;if(l._id===c._id){var o=e.meshRendererComponent.worldBound,u=r.meshRendererComponent.worldBound;if(o===null||u===null)return 0;var a=n.setv(t.camera.translation).subv(o.center).lengthSquared(),f=n.setv(t.camera.translation).subv(u.center).lengthSquared();return a-f}return l._id-c._id},this.transparentSorter=function(e,r){var i=e.meshRendererComponent.worldBound,s=r.meshRendererComponent.worldBound,o=n.setv(t.camera.translation).subv(i.center).lengthSquared(),u=n.setv(t.camera.translation).subv(s.center).lengthSquared();return u-o},this.bucketSorter=function(e,t){return e-t}}return t.prototype.sort=function(e,n){var r=0;this.camera=n;var i={},s=[];for(var o=0;o<e.length;o++){var u=e[o],a=u.meshRendererComponent;if(!a||a.materials.length===0){e[r]=u,r++;continue}var f=a.materials[0].getRenderQueue(),l=i[f];l||(l=[],i[f]=l,s.push(f)),l.push(u)}s.length>1&&s.sort(this.bucketSorter);for(var c=0;c<s.length;c++){var h=s[c],l=i[h];h<t.TRANSPARENT?l.sort(this.opaqueSorter):l.sort(this.transparentSorter);for(var o=0;o<l.length;o++)e[r]=l[o],r++}},t.BACKGROUND=0,t.OPAQUE=1e3,t.TRANSPARENT=2e3,t.OVERLAY=3e3,t}),define("goo/renderer/Shader",["goo/renderer/ShaderCall","goo/math/Matrix4x4","goo/entities/World","goo/renderer/RenderQueue","goo/renderer/Util"],function(e,t,n,r,i){function o(e,t){if(!t.vshader||!t.fshader)throw new Error("Missing shader sources for shader: "+e);this.originalShaderDefinition=t,this.shaderDefinition=t,this.name=e,this.origVertexSource=t.vshader,this.origFragmentSource=t.fshader,this.vertexSource=typeof this.origVertexSource=="function"?this.origVertexSource():this.origVertexSource,this.fragmentSource=typeof this.origFragmentSource=="function"?this.origFragmentSource():this.origFragmentSource,this.shaderProgram=null,this.attributeMapping={},this.attributeIndexMapping={},this.uniformMapping={},this.uniformCallMapping={},this.textureSlots=[],this.textureSlotsNaming={},this.currentCallbacks={},this.overridePrecision=t.precision||null,this.processors=t.processors,this.builder=t.builder,this.defines=t.defines,this.attributes=t.attributes||{},this.uniforms=t.uniforms||{},this.renderQueue=r.OPAQUE,this._id=o.id++,this.errorOnce=!1}function c(e){var r=new t,i=new t;e[o.PROJECTION_MATRIX]=function(e,t){var n=t.camera.getProjectionMatrix();e.uniformMatrix4fv(n)},e[o.VIEW_MATRIX]=function(e,t){var n=t.camera.getViewMatrix().clone();n.e03=0,n.e13=0,n.e23=0,e.uniformMatrix4fv(n)},e[o.WORLD_MATRIX]=function(e,t){var n=t.transform!==undefined?t.transform.matrix:r,i=n.clone();i.e03-=t.camera.translation.x,i.e13-=t.camera.translation.y,i.e23-=t.camera.translation.z,e.uniformMatrix4fv(i)},e[o.NORMAL_MATRIX]=function(e,n){var s=n.transform!==undefined?n.transform.matrix:r;t.invert(s,i),t.transpose(i,i),e.uniformMatrix4fv(i)},e[o.VIEW_INVERSE_MATRIX]=function(e,t){var n=t.camera.getViewInverseMatrix().clone();n.e03=0,n.e13=0,n.e23=0,e.uniformMatrix4fv(n)},e[o.VIEW_PROJECTION_MATRIX]=function(e,t){var n=t.camera.getViewMatrix().clone();n.e03=0,n.e13=0,n.e23=0,i.copy(t.camera.getProjectionMatrix()).combine(n),e.uniformMatrix4fv(i)},e[o.VIEW_PROJECTION_INVERSE_MATRIX]=function(e,t){var n=t.camera.getViewProjectionInverseMatrix().clone();e.uniformMatrix4fv(n)};for(var s=0;s<16;s++)e[o["TEXTURE"+s]]=function(e){return function(t){t.uniform1i(e)}}(s);for(var s=0;s<8;s++)e[o["LIGHT"+s]]=function(e){return function(t,n){var r=n.lights[e];r!==undefined?t.uniform3f(r.translation.data[0],r.translation.data[1],r.translation.data[2]):t.uniform3f(-20,20,20)}}(s);e[o.LIGHTCOUNT]=function(e,t){e.uniform1i(t.lights.length)},e[o.CAMERA]=function(e,t){e.uniform3f(0,0,0)},e[o.CAMERA_TRANSLATION]=function(e,t){var n=t.camera.translation;e.uniform3f(n.data[0],n.data[1],n.data[2])},e[o.NEAR_PLANE]=function(e,t){e.uniform1f(t.camera.near)},e[o.FAR_PLANE]=function(e,t){e.uniform1f(t.camera.far)},e[o.MAIN_NEAR_PLANE]=function(e,t){e.uniform1f(t.mainCamera.near)},e[o.MAIN_FAR_PLANE]=function(e,t){e.uniform1f(t.mainCamera.far)},e[o.MAIN_DEPTH_SCALE]=function(e,t){e.uniform1f(1/(t.mainCamera.far-t.mainCamera.near))},e[o.AMBIENT]=function(e,t){var n=t.material.materialState!==undefined?t.material.materialState.ambient:o.DEFAULT_AMBIENT;e.uniform4fv(n)},e[o.EMISSIVE]=function(e,t){var n=t.material.materialState!==undefined?t.material.materialState.emissive:o.DEFAULT_EMISSIVE;e.uniform4fv(n)},e[o.DIFFUSE]=function(e,t){var n=t.material.materialState!==undefined?t.material.materialState.diffuse:o.DEFAULT_DIFFUSE;e.uniform4fv(n)},e[o.SPECULAR]=function(e,t){var n=t.material.materialState!==undefined?t.material.materialState.specular:o.DEFAULT_SPECULAR;e.uniform4fv(n)},e[o.SPECULAR_POWER]=function(e,t){var n=t.material.materialState!==undefined?t.material.materialState.shininess:o.DEFAULT_SHININESS;n=Math.max(n,1),e.uniform1f(n)},e[o.TIME]=function(e){e.uniform1f(n.time)},e[o.TPF]=function(e){e.uniform1f(n.tpf)},e[o.RESOLUTION]=function(e,t){e.uniform2f(t.renderer.viewportWidth,t.renderer.viewportHeight)}}var s=window.WebGLRenderingContext;o.id=0,o.prototype.clone=function(){return new o(this.name,i.clone({precision:this.precision,processors:this.processors,builder:this.builder,defines:this.defines,attributes:this.attributes,uniforms:this.uniforms,vshader:this.origVertexSource,fshader:this.origFragmentSource}))},o.prototype.cloneOriginal=function(){return new o(this.name,this.originalShaderDefinition)};var u=/\b(attribute|uniform)\s+(float|int|bool|vec2|vec3|vec4|mat3|mat4|sampler2D|sampler3D|samplerCube)\s+(\w+)(\s*\[\s*\w+\s*\])*;/g;o.prototype.apply=function(e,t){var n=t.context,r=t.rendererRecord;this.shaderProgram===null&&(this._investigateShaders(),this.addDefines(this.defines),this.addPrecision(this.overridePrecision||t.shaderPrecision),this.compile(t));var i=!1;r.usedProgram!==this.shaderProgram&&(n.useProgram(this.shaderProgram),r.usedProgram=this.shaderProgram,i=!0);if(this.attributes){var s=e.meshData.attributeMap,o=this.attributes,u=Object.keys(o);for(var a=0,f=u.length;a<f;a++){var l=u[a],c=s[o[l]];if(!c)continue;var h=this.attributeIndexMapping[l];if(h===undefined)continue;i&&t.context.enableVertexAttribArray(h),t.bindVertexAttribute(h,c)}}this._bindUniforms(e)},o.prototype._bindUniforms=function(e){if(this.uniforms)try{this.textureIndex=0;var t=Object.keys(this.uniforms);for(var n=0,r=t.length;n<r;n++)this._bindUniform(t[n],e);this.errorOnce=!1}catch(i){this.errorOnce===!1&&(console.error(i.stack),this.errorOnce=!0)}},o.prototype._bindUniform=function(e,t){var n=this.uniformCallMapping[e];if(n===undefined)return;var r=t.material.uniforms[e]!==undefined?t.material.uniforms[e]:this.uniforms[e];if(typeof r=="string"){var i=this.currentCallbacks[e];if(i)i(n,t);else{var s=this.textureSlotsNaming[e];if(s!==undefined){var o=t.material.getTexture(s.mapping);if(o instanceof Array){var u=[];s.index=[];for(var a=0;a<o.length;a++)s.index.push(this.textureIndex),u.push(this.textureIndex++);n.call(u)}else s.index=this.textureIndex,n.call(this.textureIndex++)}}}else{var f=typeof r=="function"?r(t):r;n.call(f)}},o.prototype.rebuild=function(){this.shaderProgram=null,this.attributeMapping={},this.attributeIndexMapping={},this.uniformMapping={},this.uniformCallMapping={},this.currentCallbacks={},this.vertexSource=typeof this.origVertexSource=="function"?this.origVertexSource():this.origVertexSource,this.fragmentSource=typeof this.origFragmentSource=="function"?this.origFragmentSource():this.origFragmentSource},o.prototype._investigateShaders=function(){this.textureSlots=[],this.textureSlotsNaming={},o.investigateShader(this.vertexSource,this),o.investigateShader(this.fragmentSource,this)},o.investigateShader=function(e,t){u.lastIndex=0;var n=u.exec(e);while(n!==null){var r={format:n[2]},i=n[1],s=n[3],o=n[4];o&&(r.format==="float"?r.format="floatarray":r.format==="int"?r.format="intarray":r.format.indexOf("sampler")===0&&(r.format="samplerArray"));if("attribute"===i)t.attributeMapping[s]=r;else{if(r.format.indexOf("sampler")===0){var a={format:r.format,name:s,mapping:t.uniforms[s],index:t.textureSlots.length};t.textureSlots.push(a),t.textureSlotsNaming[a.name]=a}t.uniformMapping[s]=r}n=u.exec(e)}},o.prototype.compile=function(t){var n=t.context,r=this._getShader(n,s.VERTEX_SHADER,this.vertexSource),i=this._getShader(n,s.FRAGMENT_SHADER,this.fragmentSource);(r===null||i===null)&&console.error("Shader error - no shaders"),this.shaderProgram=n.createProgram();var o=n.getError();(this.shaderProgram===null||o!==s.NO_ERROR)&&console.error("Shader error: "+o+" [shader: "+this.name+"]"),n.attachShader(this.shaderProgram,r),n.attachShader(this.shaderProgram,i),n.linkProgram(this.shaderProgram),n.getProgramParameter(this.shaderProgram,s.LINK_STATUS)||console.error("Could not initialise shaders: "+n.getProgramInfoLog(this.shaderProgram));for(var u in this.attributeMapping){var a=n.getAttribLocation(this.shaderProgram,u);if(a===-1)continue;this.attributeIndexMapping[u]=a}for(var u in this.uniformMapping){var f=n.getUniformLocation(this.shaderProgram,u);if(f===null){var l=this.textureSlots.length;for(var c=0;c<l;c++){var h=this.textureSlots[c];if(h.name===u){this.textureSlots.splice(c,1),delete this.textureSlotsNaming[h.name];for(;c<l-1;c++)this.textureSlots[c].index--;break}}continue}this.uniformCallMapping[u]=new e(n,f,this.uniformMapping[u].format)}if(this.uniforms){if(this.uniforms.$link){var p=this.uniforms.$link instanceof Array?this.uniforms.$link:[this.uniforms.$link];for(var c=0;c<p.length;c++){var d=p[c];for(var u in d)this.uniforms[u]=d[u]}delete this.uniforms.$link}for(var v in this.uniforms){var m=this.uniforms[v];this.defaultCallbacks[m]&&(this.currentCallbacks[v]=this.defaultCallbacks[m])}}};var a=/\b\d+:(\d+):\s(.+)\b/g,f=/\((\d+),\s*\d+\):\s(.+)/g;o.prototype._getShader=function(e,t,n){var r=e.createShader(t);e.shaderSource(r,n),e.compileShader(r);if(!e.getShaderParameter(r,s.COMPILE_STATUS)){var i=e.getShaderInfoLog(r),o=t===s.VERTEX_SHADER?"VertexShader":"FragmentShader";a.lastIndex=0;var u=a.exec(i);u===null&&(u=f.exec(i));if(u!==null)while(u!==null){var l=n.split("\n"),c=u[1],h=u[2];console.error("Error in "+o+" - ["+this.name+"]["+this._id+"] at line "+c+":"),console.error("	Error: "+h),console.error("	Source: "+l[c-1]),u=a.exec(i)}else console.error("Error in "+o+" - ["+this.name+"]["+this._id+"] "+i);return null}return r};var l=/\bprecision\s+(lowp|mediump|highp)\s+(float|int);/g;o.prototype.addPrecision=function(e){l.lastIndex=0;var t=l.exec(this.vertexSource);t===null&&(this.vertexSource="precision "+e+" float;"+"\n"+this.vertexSource),l.lastIndex=0;var n=l.exec(this.fragmentSource);n===null&&(this.fragmentSource="precision "+e+" float;"+"\n"+this.fragmentSource)},o.prototype.addDefines=function(e){if(!e)return;var t=this.generateDefines(e);this.vertexSource=t+"\n"+this.vertexSource,this.fragmentSource=t+"\n"+this.fragmentSource},o.prototype.generateDefines=function(e){var t=[];for(var n in e){var r=e[n];if(r===!1)continue;var i="#define "+n+" "+r;t.push(i)}return t.join("\n")},o.prototype.getShaderDefinition=function(){return{vshader:this.vertexSource,fshader:this.fragmentSource,defines:this.defines,attributes:this.attributes,uniforms:this.uniforms}},o.prototype.toString=function(){return this.name},o.PROJECTION_MATRIX="PROJECTION_MATRIX",o.VIEW_MATRIX="VIEW_MATRIX",o.VIEW_INVERSE_MATRIX="VIEW_INVERSE_MATRIX",o.VIEW_PROJECTION_MATRIX="VIEW_PROJECTION_MATRIX",o.VIEW_PROJECTION_INVERSE_MATRIX="VIEW_PROJECTION_INVERSE_MATRIX",o.WORLD_MATRIX="WORLD_MATRIX",o.NORMAL_MATRIX="NORMAL_MATRIX";for(var h=0;h<8;h++)o["LIGHT"+h]="LIGHT"+h;return o.CAMERA="CAMERA",o.CAMERA_TRANSLATION="CAMERA_TRANSLATION",o.AMBIENT="AMBIENT",o.EMISSIVE="EMISSIVE",o.DIFFUSE="DIFFUSE",o.SPECULAR="SPECULAR",o.SPECULAR_POWER="SPECULAR_POWER",o.NEAR_PLANE="NEAR_PLANE",o.FAR_PLANE="FAR_PLANE",o.MAIN_NEAR_PLANE="NEAR_PLANE",o.MAIN_FAR_PLANE="FAR_PLANE",o.MAIN_DEPTH_SCALE="DEPTH_SCALE",o.TIME="TIME",o.TPF="TPF",o.RESOLUTION="RESOLUTION",o.DIFFUSE_MAP="DIFFUSE_MAP",o.NORMAL_MAP="NORMAL_MAP",o.SPECULAR_MAP="SPECULAR_MAP",o.LIGHT_MAP="LIGHT_MAP",o.SHADOW_MAP="SHADOW_MAP",o.AO_MAP="AO_MAP",o.EMISSIVE_MAP="EMISSIVE_MAP",o.DEPTH_MAP="DEPTH_MAP",o.DEFAULT_AMBIENT=[.1,.1,.1,1],o.DEFAULT_EMISSIVE=[0,0,0,0],o.DEFAULT_DIFFUSE=[.8,.8,.8,1],o.DEFAULT_SPECULAR=[.6,.6,.6,1],o.DEFAULT_SHININESS=64,o.prototype.defaultCallbacks={},c(o.prototype.defaultCallbacks),o}),define("goo/renderer/Material",["goo/renderer/Shader"],function(e){function t(t){this.name=t,this.shader=null,this.uniforms={},this._textureMaps={},this.materialState={ambient:e.DEFAULT_AMBIENT,diffuse:e.DEFAULT_DIFFUSE,emissive:e.DEFAULT_EMISSIVE,specular:e.DEFAULT_SPECULAR,shininess:e.DEFAULT_SHININESS},this.cullState={enabled:!0,cullFace:"Back",frontFace:"CCW"},this.blendState={blending:"NoBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"},this.depthState={enabled:!0,write:!0},this.offsetState={enabled:!1,factor:1,units:1},this.dualTransparency=!1,this.wireframe=!1,this.flat=!1,this.renderQueue=null}return t.prototype.setTexture=function(e,t){this._textureMaps[e]=t},t.prototype.getTexture=function(e){return this._textureMaps[e]},t.prototype.removeTexture=function(e){delete this._textureMaps[e]},t.prototype.getTextures=function(){var e=[];for(var t in this._textureMaps)e.push(this._textureMaps[t]);return e},t.prototype.getTextureEntries=function(){return this._textureMaps},t.prototype.getRenderQueue=function(){return this.renderQueue!==null?this.renderQueue:this.shader!==null?this.shader.renderQueue:1e3},t.prototype.setRenderQueue=function(e){this.renderQueue=e},t.store=[],t.hash=[],t.createShader=function(n,r){var i=t.store.indexOf(n);if(i!==-1)return t.hash[i];var s=new e(r||null,n);return s.name===null&&(s.name="DefaultShader"+s._id),t.store.push(n),t.hash.push(s),s},t.clearShaderCache=function(){t.store.length=0,t.hash.length=0},t.createMaterial=function(e,n){var r=new t(n||"DefaultMaterial");return r.shader=t.createShader(e),r},t.createEmptyMaterial=function(e,n){var r=new t(n||"Empty Material");return r.empty(),e?r.shader=t.createShader(e):r.shader=undefined,r},t.prototype.empty=function(){this.cullState={},this.blendState={},this.depthState={},this.offsetState={},this.wireframe=undefined,this.renderQueue=undefined,this.flat=undefined,this._textureMaps={},this.shader=undefined,this.uniforms={}},t}),define("goo/entities/components/MeshRendererComponent",["goo/entities/components/Component","goo/renderer/Material"],function(e,t){function n(){this.type="MeshRendererComponent",this.materials=[],this.worldBound=null,this.cullMode="Dynamic",this.castShadows=!0,this.receiveShadows=!0,this.isPickable=!0,this.isReflectable=!0,this.hidden=!1}return n.prototype=Object.create(e.prototype),n.prototype.updateBounds=function(e,t){this.worldBound=e.transform(t,this.worldBound)},n.applyOnEntity=function(e,r){var i=r.meshRendererComponent;i||(i=new n);var s=!1;e instanceof t&&(i.materials.push(e),s=!0);if(s)return r.setComponent(i),!0},n}),define("goo/util/Handy",[],function(){function e(){}return e.deepFreeze=function(t){var n,r;Object.freeze(t);for(r in t){n=t[r];if(!t.hasOwnProperty(r)||typeof n!="object"||Object.isFrozen(n))continue;e.deepFreeze(n)}},e.defineProperty=function(e,t,n,r){var i=n;Object.defineProperty(e,t,{get:function(){return i},set:function(e){i=e,r(i)},configurable:!0,enumerable:!0})},e.addListener=function(e,t,n,r){var i=e[t];Object.defineProperty(e,t,{get:function(){return n&&n(),i},set:function(e){i=e,r&&r(i)},configurable:!0,enumerable:!0})},e}),define("goo/math/Plane",["goo/math/Vector3"],function(e){function t(t,n){this.normal=t!==undefined?new e(t):new e(e.UNIT_Y),this.constant=isNaN(n)?0:n}t.XZ=new t(e.UNIT_Y,0),t.XY=new t(e.UNIT_Z,0),t.YZ=new t(e.UNIT_X,0),t.prototype.pseudoDistance=function(e){return this.normal.dot(e)-this.constant},t.prototype.setPlanePoints=function(e,t,n){return this.normal.set(t).sub(e),this.normal.cross([n.x-e.x,n.y-e.y,n.z-e.z]).normalize(),this.constant=this.normal.dot(e),this},t.prototype.reflectVector=function(t,n){var r=n;r===null&&(r=new e);var i=this.normal.dot(t)*2;return r.set(t).sub([this.normal.x*i,this.normal.y*i,this.normal.z*i]),r};var n=new e;return t.prototype.rayIntersect=function(t,r){r=r||new e;var i=t.direction.dot(this.normal);if(Math.abs(i)<1e-8)return console.warn("Ray parallell with plane"),null;var s=this.constant,o=n.set(this.normal).muld(s,s,s).subv(t.origin).dot(this.normal),u=o/i;return r.setv(t.direction).muld(u,u,u).addv(t.origin)},t}),define("goo/math/Ray",["goo/math/Vector3","goo/math/MathUtils"],function(e,t){function n(t,n){this.origin=t||new e,this.direction=n||(new e).copy(e.UNIT_Z),this.calcVec1=new e,this.calcVec2=new e,this.calcVec3=new e,this.calcVec4=new e}return n.prototype.intersects=function(e,t,n){return e.length===3?this.intersectsTriangle(e[0],e[1],e[2],t,n):e.length===4?this.intersectsTriangle(e[0],e[1],e[2],t,n)||this.intersectsTriangle(e[0],e[2],e[3],t,n):!1},n.prototype.intersectsTriangle=function(n,r,i,s,o){var u=this.calcVec1.set(this.origin).sub(n),a=this.calcVec2.set(r).sub(n),f=this.calcVec3.set(i).sub(n),l=this.calcVec4.set(a).cross(f),c=this.direction.dot(l),h;if(c>t.EPSILON)h=1;else{if(!(c<-t.EPSILON))return!1;h=-1,c=-c}var p=h*this.direction.dot(e.cross(u,f,f)),d=!1;if(p>=0){var v=h*this.direction.dot(a.cross(u));if(v>=0&&p+v<=c){var m=-h*u.dot(l);if(m>=0){if(!o)return!0;var g=1/c,y=m*g;if(!s)o.setv(this.origin).add_d(this.direction.x*y,this.direction.y*y,this.direction.z*y);else{var b=p*g,w=v*g;o.setd(y,b,w)}d=!0}}}return d},n.prototype.getDistanceToPrimitive=function(e){var t=this.calcVec1;return this.intersects(e,!1,t)?this.origin.distance(t.x,t.y,t.z):Infinity},n.prototype.intersectsPlane=function(e,t){var n=e.normal,r=n.dot(this.direction);if(Math.abs(r)<1e-5)return!1;var i=-n.dot(this.origin)+e.constant,s=i/r;return s<1e-5?!1:(t!==null&&t.set(this.direction).multiplyLocal(s).addLocal(this.origin),!0)},n.prototype.distanceSquared=function(e,t){var n=this.calcVec1;n.set(e).subtractLocal(this.origin);var r=this.direction.dot(n);return r>0?(n.set(this.direction).multiplyLocal(r),n.addLocal(this.origin)):n.set(this.origin),t!==null&&t.set(n),e.subtract(n,n),n.lengthSquared()},n}),define("goo/renderer/Camera",["goo/util/Handy","goo/math/Vector3","goo/math/Vector4","goo/math/Matrix4x4","goo/math/Plane","goo/math/MathUtils","goo/math/Ray","goo/renderer/bounds/BoundingBox","goo/renderer/bounds/BoundingSphere","goo/renderer/bounds/BoundingVolume"],function(e,t,n,r,i,s,o,u,a,f){function l(s,o,u,a){s=typeof s!="undefined"?s:45,o=typeof o!="undefined"?o:1,u=typeof u!="undefined"?u:1,a=typeof a!="undefined"?a:1e3,this.translation=new t(0,0,0),this._left=new t(-1,0,0),this._up=new t(0,1,0),this._direction=new t(0,0,-1),e.defineProperty(this,"this._depthRangeNear",0,function(){this._depthRangeDirty=!0}),e.defineProperty(this,"this._depthRangeFar",1,function(){this._depthRangeDirty=!0}),this._depthRangeDirty=!0,this._frustumNear=1,this._frustumFar=2,this._frustumLeft=-0.5,this._frustumRight=.5,this._frustumTop=.5,this._frustumBottom=-0.5,this._coeffLeft=[],this._coeffRight=[],this._coeffBottom=[],this._coeffTop=[],this._viewPortLeft=0,this._viewPortRight=1,this._viewPortTop=1,this._viewPortBottom=0,this._planeQuantity=6,this._worldPlane=[];for(var f=0;f<l.FRUSTUM_PLANES;f++)this._worldPlane[f]=new i;this._newDirection=new t,this.projectionMode=l.Perspective,this.lockedRatio=!1,this.aspect=o,this._updateMVMatrix=!0,this._updateInverseMVMatrix=!0,this._updatePMatrix=!0,this._updateMVPMatrix=!0,this._updateInverseMVPMatrix=!0,this.modelView=new r,this.modelViewInverse=new r,this.projection=new r,this.modelViewProjection=new r,this.modelViewProjectionInverse=new r,this._depthRangeDirty=!0,this._viewPortDirty=!0,this._planeState=0,this._clipPlane=new n,this._qCalc=new n,this._corners=[];for(var f=0;f<8;f++)this._corners.push(new t);this._extents=new t,this.vNearPlaneCenter=new t,this.vFarPlaneCenter=new t,this.direction=new t,this.left=new t,this.up=new t,this.planeNormal=new t,this.changedProperties=!0,this.setFrustumPerspective(s,o,u,a),this.onFrameChange()}l.LEFT_PLANE=0,l.RIGHT_PLANE=1,l.BOTTOM_PLANE=2,l.TOP_PLANE=3,l.FAR_PLANE=4,l.NEAR_PLANE=5,l.FRUSTUM_PLANES=6,l.Perspective=0,l.Parallel=1,l.Custom=2,l.Outside=0,l.Inside=1,l.Intersects=2,l.prototype.normalize=function(){this._left.normalize(),this._up.normalize(),this._direction.normalize(),this.onFrameChange()},l.prototype.setProjectionMode=function(e){this.projectionMode=e,this.update()},l.prototype.setFrustumPerspective=function(e,t,n,r){e!==undefined&&e!==null&&(this.fov=e),t!==undefined&&t!==null&&(this.aspect=t),n!==undefined&&n!==null&&(this.near=n),r!==undefined&&r!==null&&(this.far=r);if(this.fov!==undefined){var i=Math.tan(this.fov*s.DEG_TO_RAD*.5)*this.near,o=i*this.aspect;this._frustumLeft=-o,this._frustumRight=o,this._frustumBottom=-i,this._frustumTop=i,this._frustumNear=this.near,this._frustumFar=this.far,this.onFrustumChange()}},l.prototype.setFrustum=function(e,t,n,r,i,s,o){e!==undefined&&e!==null&&(this.near=e),t!==undefined&&t!==null&&(this.far=t),n!==undefined&&n!==null&&(this.left=n),r!==undefined&&r!==null&&(this.right=r),i!==undefined&&i!==null&&(this.top=i),s!==undefined&&s!==null&&(this.bottom=s),o!==undefined&&o!==null&&(this.aspect=o),this._frustumNear=this.near,this._frustumFar=this.far,this._frustumLeft=this.left*this.aspect,this._frustumRight=this.right*this.aspect,this._frustumTop=this.top,this._frustumBottom=this.bottom,this.onFrustumChange()},l.prototype.copy=function(e){this.translation.setv(e.translation),this._left.setv(e._left),this._up.setv(e._up),this._direction.setv(e._direction),this.fov=e.fov,this.aspect=e.aspect,this.near=e.near,this.far=e.far,this._frustumLeft=e._frustumLeft,this._frustumRight=e._frustumRight,this._frustumBottom=e._frustumBottom,this._frustumTop=e._frustumTop,this._frustumNear=e._frustumNear,this._frustumFar=e._frustumFar,this.projectionMode=e.projectionMode,this._depthRangeDirty=!0,this.onFrustumChange(),this.onFrameChange()},l.prototype.setFrame=function(e,t,n,r){this._left.copy(t),this._up.copy(n),this._direction.copy(r),this.translation.copy(e),this.onFrameChange()},l.prototype.lookAt=function(e,n){this._newDirection.copy(e).sub(this.translation).normalize();if(this._newDirection.equals(this._direction))return;this._direction.copy(this._newDirection),this._up.copy(n).normalize(),this._up.equals(t.ZERO)&&this._up.copy(t.UNIT_Y),this._left.copy(this._up).cross(this._direction).normalize(),this._left.equals(t.ZERO)&&(this._direction.x!==0?this._left.set(this._direction.y,-this._direction.x,0):this._left.set(0,this._direction.z,-this._direction.y)),this._up.copy(this._direction).cross(this._left).normalize(),this.onFrameChange()},l.prototype.makeDirty=function(){this._depthRangeDirty=!0,this._viewPortDirty=!0},l.prototype.update=function(){this._depthRangeDirty=!0,this.onFrustumChange(),this.onFrameChange()},l.prototype.setViewPort=function(){console.warn("Camera.setViewPort() not implemented.")},l.prototype.contains=function(e){if(!e)return l.Inside;var t=l.Inside;for(var n=l.FRUSTUM_PLANES-1;n>=0;n--)switch(e.whichSide(this._worldPlane[n])){case f.Inside:return l.Outside;case f.Outside:break;case f.Intersects:t=l.Intersects}return t},l.prototype.onFrustumChange=function(){if(this.projectionMode===l.Perspective){var e=this._frustumNear*this._frustumNear,t=this._frustumLeft*this._frustumLeft,n=this._frustumRight*this._frustumRight,r=this._frustumBottom*this._frustumBottom,i=this._frustumTop*this._frustumTop,s=1/Math.sqrt(e+t);this._coeffLeft[0]=this._frustumNear*s,this._coeffLeft[1]=-this._frustumLeft*s,s=1/Math.sqrt(e+n),this._coeffRight[0]=-this._frustumNear*s,this._coeffRight[1]=this._frustumRight*s,s=1/Math.sqrt(e+r),this._coeffBottom[0]=this._frustumNear*s,this._coeffBottom[1]=-this._frustumBottom*s,s=1/Math.sqrt(e+i),this._coeffTop[0]=-this._frustumNear*s,this._coeffTop[1]=this._frustumTop*s}else this.projectionMode===l.Parallel&&(this._frustumRight>this._frustumLeft?(this._coeffLeft[0]=-1,this._coeffLeft[1]=0,this._coeffRight[0]=1,this._coeffRight[1]=0):(this._coeffLeft[0]=1,this._coeffLeft[1]=0,this._coeffRight[0]=-1,this._coeffRight[1]=0),this._frustumTop>this._frustumBottom?(this._coeffBottom[0]=-1,this._coeffBottom[1]=0,this._coeffTop[0]=1,this._coeffTop[1]=0):(this._coeffBottom[0]=1,this._coeffBottom[1]=0,this._coeffTop[0]=-1,this._coeffTop[1]=0));this._updatePMatrix=!0,this._updateMVPMatrix=!0,this._updateInverseMVMatrix=!0,this._updateInverseMVPMatrix=!0,this.changedProperties=!0},l.prototype.onFrameChange=function(){var e=this._direction.dot(this.translation),t=this.planeNormal;t.x=this._left.x*this._coeffLeft[0],t.y=this._left.y*this._coeffLeft[0],t.z=this._left.z*this._coeffLeft[0],t.add([this._direction.x*this._coeffLeft[1],this._direction.y*this._coeffLeft[1],this._direction.z*this._coeffLeft[1]]),this._worldPlane[l.LEFT_PLANE].normal.copy(t),this._worldPlane[l.LEFT_PLANE].constant=this.translation.dot(t),t.x=this._left.x*this._coeffRight[0],t.y=this._left.y*this._coeffRight[0],t.z=this._left.z*this._coeffRight[0],t.add([this._direction.x*this._coeffRight[1],this._direction.y*this._coeffRight[1],this._direction.z*this._coeffRight[1]]),this._worldPlane[l.RIGHT_PLANE].normal.copy(t),this._worldPlane[l.RIGHT_PLANE].constant=this.translation.dot(t),t.x=this._up.x*this._coeffBottom[0],t.y=this._up.y*this._coeffBottom[0],t.z=this._up.z*this._coeffBottom[0],t.add([this._direction.x*this._coeffBottom[1],this._direction.y*this._coeffBottom[1],this._direction.z*this._coeffBottom[1]]),this._worldPlane[l.BOTTOM_PLANE].normal.copy(t),this._worldPlane[l.BOTTOM_PLANE].constant=this.translation.dot(t),t.x=this._up.x*this._coeffTop[0],t.y=this._up.y*this._coeffTop[0],t.z=this._up.z*this._coeffTop[0],t.add([this._direction.x*this._coeffTop[1],this._direction.y*this._coeffTop[1],this._direction.z*this._coeffTop[1]]),this._worldPlane[l.TOP_PLANE].normal.copy(t),this._worldPlane[l.TOP_PLANE].constant=this.translation.dot(t),this.projectionMode===l.Parallel&&(this._frustumRight>this._frustumLeft?(this._worldPlane[l.LEFT_PLANE].constant=this._worldPlane[l.LEFT_PLANE].contant+this._frustumLeft,this._worldPlane[l.RIGHT_PLANE].constant=this._worldPlane[l.RIGHT_PLANE].contant-this._frustumRight):(this._worldPlane[l.LEFT_PLANE].constant=this._worldPlane[l.LEFT_PLANE].contant-this._frustumLeft,this._worldPlane[l.RIGHT_PLANE].constant=this._worldPlane[l.RIGHT_PLANE].contant+this._frustumRight),this._frustumBottom>this._frustumTop?(this._worldPlane[l.TOP_PLANE].constant=this._worldPlane[l.TOP_PLANE].contant+this._frustumTop,this._worldPlane[l.BOTTOM_PLANE].constant=this._worldPlane[l.BOTTOM_PLANE].contant-this._frustumBottom):(this._worldPlane[l.TOP_PLANE].constant=this._worldPlane[l.TOP_PLANE].contant-this._frustumTop,this._worldPlane[l.BOTTOM_PLANE].constant=this._worldPlane[l.BOTTOM_PLANE].contant+this._frustumBottom)),t.copy(this._direction).invert(),this._worldPlane[l.FAR_PLANE].normal.copy(t),this._worldPlane[l.FAR_PLANE].constant=-(e+this._frustumFar),this._worldPlane[l.NEAR_PLANE].normal.copy(this._direction),this._worldPlane[l.NEAR_PLANE].constant=e+this._frustumNear,this._updateMVMatrix=!0,this._updateMVPMatrix=!0,this._updateInverseMVMatrix=!0,this._updateInverseMVPMatrix=!0},l.prototype.updateProjectionMatrix=function(){if(this.projectionMode===l.Parallel){this.projection.setIdentity();var e=this.projection.data;e[0]=2/(this._frustumRight-this._frustumLeft),e[5]=2/(this._frustumTop-this._frustumBottom),e[10]=-2/(this._frustumFar-this._frustumNear),e[12]=-(this._frustumRight+this._frustumLeft)/(this._frustumRight-this._frustumLeft),e[13]=-(this._frustumTop+this._frustumBottom)/(this._frustumTop-this._frustumBottom),e[14]=-(this._frustumFar+this._frustumNear)/(this._frustumFar-this._frustumNear)}else if(this.projectionMode===l.Perspective){this.projection.setIdentity();var e=this.projection.data;e[0]=2*this._frustumNear/(this._frustumRight-this._frustumLeft),e[5]=2*this._frustumNear/(this._frustumTop-this._frustumBottom),e[8]=(this._frustumRight+this._frustumLeft)/(this._frustumRight-this._frustumLeft),e[9]=(this._frustumTop+this._frustumBottom)/(this._frustumTop-this._frustumBottom),e[10]=-(this._frustumFar+this._frustumNear)/(this._frustumFar-this._frustumNear),e[11]=-1,e[14]=-(2*this._frustumFar*this._frustumNear)/(this._frustumFar-this._frustumNear),e[15]=0}},l.prototype.updateModelViewMatrix=function(){this.modelView.setIdentity();var e=this.modelView.data;e[0]=-this._left.x,e[4]=-this._left.y,e[8]=-this._left.z,e[1]=this._up.x,e[5]=this._up.y,e[9]=this._up.z,e[2]=-this._direction.x,e[6]=-this._direction.y,e[10]=-this._direction.z,e[12]=this._left.dot(this.translation),e[13]=-this._up.dot(this.translation),e[14]=this._direction.dot(this.translation)},l.prototype.getPickRay=function(e,n,r,i,s){s||(s=new o);var u=new t,a=new t;return this.getWorldCoordinates(e,i-n,r,i,0,u),this.getWorldCoordinates(e,i-n,r,i,.3,a).sub(u).normalize(),s.origin.copy(u),s.direction.copy(a),s},l.prototype.getWorldCoordinates=function(e,r,i,s,o,u){u||(u=new t),this.checkInverseModelViewProjection();var a=new n;return a.set((e/i-this._viewPortLeft)/(this._viewPortRight-this._viewPortLeft)*2-1,(r/s-this._viewPortBottom)/(this._viewPortTop-this._viewPortBottom)*2-1,o*2-1,1),this.modelViewProjectionInverse.applyPost(a),a.mul(1/a.w),u.x=a.x,u.y=a.y,u.z=a.z,u},l.prototype.getScreenCoordinates=function(e,t,n,r){return r=this.getNormalizedDeviceCoordinates(e,r),r.x=(r.x+1)*(this._viewPortRight-this._viewPortLeft)/2*t,r.y=(r.y+1)*(this._viewPortTop-this._viewPortBottom)/2*n,r.z=(r.z+1)/2,r},l.prototype.getFrustumCoordinates=function(e,t){return t=this.getNormalizedDeviceCoordinates(e,t),t.x=(t.x+1)*(this._frustumRight-this._frustumLeft)/2+this._frustumLeft,t.y=(t.y+1)*(this._frustumTop-this._frustumBottom)/2+this._frustumBottom,t.z=(t.z+1)*(this._frustumFar-this._frustumNear)/2+this._frustumNear,t},l.prototype.getNormalizedDeviceCoordinates=function(e,r){r||(r=new t),this.checkModelViewProjection();var i=new n;return i.set(e.x,e.y,e.z,1),this.modelViewProjection.applyPost(i),i.mul(1/i.w),r.x=i.x,r.y=i.y,r.z=i.z,r},l.prototype.checkModelView=function(){this._updateMVMatrix&&(this.updateModelViewMatrix(),this._updateMVMatrix=!1)},l.prototype.checkProjection=function(){this._updatePMatrix&&(this.updateProjectionMatrix(),this._updatePMatrix=!1)},l.prototype.checkModelViewProjection=function(){this._updateMVPMatrix&&(this.checkModelView(),this.checkProjection(),this.modelViewProjection.copy(this.getProjectionMatrix()).combine(this.getViewMatrix()),this._updateMVPMatrix=!1)},l.prototype.checkInverseModelView=function(){this._updateInverseMVMatrix&&(this.checkModelView(),r.invert(this.modelView,this.modelViewInverse),this._updateInverseMVMatrix=!1)},l.prototype.checkInverseModelViewProjection=function(){this._updateInverseMVPMatrix&&(this.checkModelViewProjection(),r.invert(this.modelViewProjection,this.modelViewProjectionInverse),this._updateInverseMVPMatrix=!1)},l.prototype.getViewMatrix=function(){return this.checkModelView(),this.modelView},l.prototype.getProjectionMatrix=function(){return this.checkProjection(),this.projection},l.prototype.getViewProjectionMatrix=function(){return this.checkModelViewProjection(),this.modelViewProjection},l.prototype.getViewInverseMatrix=function(){return this.checkInverseModelView(),this.modelViewInverse},l.prototype.getViewProjectionInverseMatrix=function(){return this.checkInverseModelViewProjection(),this.modelViewProjectionInverse},l.prototype.pack=function(e){var t=e.center,r=this._corners,i=this._extents;for(var s=0;s<r.length;s++)r[s].set(t);e instanceof u?i.setd(e.xExtent,e.yExtent,e.zExtent):e instanceof a&&i.setd(e.radius,e.radius,e.radius),r[0].add_d(i.x,i.y,i.z),r[1].add_d(i.x,-i.y,i.z),r[2].add_d(i.x,i.y,-i.z),r[3].add_d(i.x,-i.y,-i.z),r[4].add_d(-i.x,i.y,i.z),r[5].add_d(-i.x,-i.y,i.z),r[6].add_d(-i.x,i.y,-i.z),r[7].add_d(-i.x,-i.y,-i.z);var o=this.getViewMatrix(),f=Number.MAX_VALUE,l=-Number.MAX_VALUE,c=new n;for(var s=0;s<r.length;s++)c.setd(r[s].x,r[s].y,r[s].z,1),o.applyPre(c),f=Math.min(-c.z,f),l=Math.max(-c.z,l);f=Math.min(Math.max(this._frustumNear,f),this._frustumFar),l=Math.max(f,Math.min(this._frustumFar,l));var h=f/this._frustumNear;this._frustumLeft=this._frustumLeft*h,this._frustumRight=this._frustumRight*h,this._frustumTop=this._frustumTop*h,this._frustumBottom=this._frustumBottom*h,this._frustumNear=f,this._frustumFar=l},l.prototype.calculateFrustumCorners=function(e,t){e=e!==undefined?e:this._frustumNear,t=t!==undefined?t:this._frustumFar;var n=(this._frustumTop-this._frustumBottom)*e*.5/this._frustumNear,r=(this._frustumRight-this._frustumLeft)*e*.5/this._frustumNear,i=(this._frustumTop-this._frustumBottom)*t*.5/this._frustumNear,s=(this._frustumRight-this._frustumLeft)*t*.5/this._frustumNear;this.projectionMode===l.Parallel&&(n=(this._frustumTop-this._frustumBottom)*.5,r=(this._frustumRight-this._frustumLeft)*.5,i=(this._frustumTop-this._frustumBottom)*.5,s=(this._frustumRight-this._frustumLeft)*.5);var o=this.vNearPlaneCenter,u=this.vFarPlaneCenter,a=this.direction,f=this.left,c=this.up;return a.setv(this._direction).mul(e),o.setv(this.translation).addv(a),a.setv(this._direction).mul(t),u.setv(this.translation).addv(a),f.setv(this._left).mul(r),c.setv(this._up).mul(n),this._corners[0].setv(o).subv(f).subv(c),this._corners[1].setv(o).addv(f).subv(c),this._corners[2].setv(o).addv(f).addv(c),this._corners[3].setv(o).subv(f).addv(c),f.setv(this._left).mul(s),c.setv(this._up).mul(i),this._corners[4].setv(u).subv(f).subv(c),this._corners[5].setv(u).addv(f).subv(c),this._corners[6].setv(u).addv(f).addv(c),this._corners[7].setv(u).subv(f).addv(c),this._corners};var c=function(e){return e>0?1:e<0?-1:0};return l.prototype.setToObliqueMatrix=function(e,t){t=t||0;var r=this._clipPlane.setv(e);this.getViewMatrix().applyPost(r),r.w=this.translation.y*e.y+t,this._updatePMatrix=!0;var i=this.getProjectionMatrix();this._qCalc.setd((c(r.x)+i[8])/i[0],(c(r.y)+i[9])/i[5],-1,(1+i[10])/i[14]),r.mul(2/n.dot(r,this._qCalc)),i[2]=r.x,i[6]=r.y,i[10]=r.z+1,i[14]=r.w,this._updateMVPMatrix=!0,this._updateInverseMVPMatrix=!0},l}),define("goo/entities/components/CameraComponent",["goo/entities/components/Component","goo/math/Vector3","goo/renderer/Camera"],function(e,t,n){function r(e){this.type="CameraComponent",this.camera=e,this.leftVec=new t(-1,0,0),this.upVec=new t(0,1,0),this.dirVec=new t(0,0,-1)}return r.type="CameraComponent",r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype.setUpVector=function(e){e===0?(this.leftVec.setd(0,-1,0),this.upVec.setd(1,0,0),this.dirVec.setd(0,0,-1)):e===2?(this.leftVec.setd(-1,0,0),this.upVec.setd(0,0,1),this.dirVec.setd(0,-1,0)):(this.leftVec.setd(-1,0,0),this.upVec.setd(0,1,0),this.dirVec.setd(0,0,-1))},r.prototype.updateCamera=function(e){this.camera._left.setv(this.leftVec),e.matrix.applyPostVector(this.camera._left),this.camera._up.setv(this.upVec),e.matrix.applyPostVector(this.camera._up),this.camera._direction.setv(this.dirVec),e.matrix.applyPostVector(this.camera._direction),e.matrix.getTranslation(this.camera.translation),this.camera.update()},r.applyOnEntity=function(e,t){if(e instanceof n){var i=new r(e);return t.setComponent(i),!0}},r}),define("goo/renderer/light/Light",["goo/math/Vector3"],function(e){function t(t){this.translation=new e,this.color=t||new e(1,1,1),this.intensity=1,this.specularIntensity=1,this.shadowCaster=!1,this.lightCookie=null,this.shadowSettings={size:100,near:1,far:1e3,resolution:[512,512],upVector:e.UNIT_Y,darkness:0,shadowType:"VSM"},this.changedProperties=!1,this.changedColor=!1}return t}),define("goo/entities/components/LightComponent",["goo/entities/components/Component","goo/renderer/light/Light"],function(e,t){function n(e){this.type="LightComponent",this.light=e,this.hidden=!1}return n.prototype=Object.create(e.prototype),n.prototype.updateLight=function(e){this.light.update(e)},n.applyOnEntity=function(e,r){if(e instanceof t){var i=new n(e);return r.setComponent(i),!0}},n}),define("goo/entities/components/CSSTransformComponent",["goo/entities/components/Component"],function(e){function t(t,n){e.call(this),this.type="CSSTransformComponent",this.domElement=t,this.scale=1,this.faceCamera=typeof n=="undefined"?!1:n}return t.prototype=Object.create(e.prototype),t}),define("goo/animation/state/AbstractState",[],function(){function e(){this._globalStartTime=0,this.onFinished=null}return e.prototype.update=function(){},e.prototype.postUpdate=function(){},e.prototype.getCurrentSourceData=function(){},e.prototype.resetClips=function(e){this._globalStartTime=e},e.prototype.shiftClipTime=function(e){this._globalStartTime+=e},e}),define("goo/animation/state/SteadyState",["goo/animation/state/AbstractState"],function(e){function t(t){e.call(this),this._name=t,this._transitions={},this._sourceTree=null}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.setClipSource=function(e){this._sourceTree=e},t.prototype.update=function(e){this._sourceTree.setTime(e)||this.onFinished&&this.onFinished()},t.prototype.getCurrentSourceData=function(){return this._sourceTree.getSourceData()},t.prototype.resetClips=function(t){e.prototype.resetClips.call(this,t),this._sourceTree.resetClips(t)},t.prototype.shiftClipTime=function(t){e.prototype.shiftClipTime.call(this,t),this._sourceTree.shiftClipTime(t)},t.prototype.setTimeScale=function(e){this._sourceTree.setTimeScale(e)},t.prototype.clone=function(){var e=new t(this._name);for(var n in this._transitions)e._transitions[n]=this._transitions[n];return e._sourceTree=this._sourceTree.clone(),e},t}),define("goo/animation/clip/TransformData",["goo/math/Quaternion","goo/math/Vector3"],function(e,t){function n(n){this._rotation=(new e).copy(n?n._rotation:e.IDENTITY),this._scale=(new t).copy(n?n._scale:t.ONE),this._translation=(new t).copy(n?n._translation:t.ZERO)}return n.prototype.applyTo=function(e){e.setIdentity(),e.rotation.copyQuaternion(this._rotation),e.scale.setv(this._scale),e.translation.setv(this._translation),e.update()},n.prototype.set=function(e){this._rotation.copy(e._rotation),this._scale.copy(e._scale),this._translation.copy(e._translation)},n.prototype.blend=function(t,r,i){var s=i?i:new n;return s._translation.setv(this._translation).lerp(t._translation,r),s._scale.setv(this._scale).lerp(t._scale,r),e.slerp(this._rotation,t._rotation,r,s._rotation),s},n}),define("goo/animation/blendtree/BinaryLERPSource",["goo/math/MathUtils","goo/animation/clip/TransformData"],function(e,t){function n(e,t,n){this._sourceA=e?e:null,this._sourceB=t?t:null,this.blendWeight=n?n:null}return n.prototype.getSourceData=function(){var e=this._sourceA?this._sourceA.getSourceData():null,t=this._sourceB?this._sourceB.getSourceData():null;return n.combineSourceData(e,t,this.blendWeight)},n.prototype.setTime=function(e){var t=!1,n=!1;return this._sourceA&&(t=this._sourceA.setTime(e)),this._sourceB&&(n=this._sourceB.setTime(e)),t||n},n.prototype.resetClips=function(e){this._sourceA&&this._sourceA.resetClips(e),this._sourceB&&this._sourceB.resetClips(e)},n.prototype.shiftClipTime=function(e){this._sourceA&&this._sourceA.shiftClipTime(e),this._sourceB&&this._sourceB.shiftClipTime(e)},n.prototype.setTimeScale=function(e){this._sourceA.setTimeScale(e),this._sourceB.setTimeScale(e)},n.prototype.isActive=function(){var e=!1;return this._sourceA&&(e=e||this._sourceA.isActive()),this._sourceB&&(e=e||this._sourceB.isActive()),e},n.combineSourceData=function(e,r,i,s){if(!r)return e;if(!e)return r;var o=s?s:{};for(var u in e){var a=e[u],f=r[u];if(!isNaN(a)){n.blendFloatValues(o,u,i,a,f);continue}if(!(a instanceof t)){o[u]=a;continue}f?o[u]=a.blend(f,i,o[u]):o[u]?o[u].set(a):o[u]=new a.constructor(a)}for(var u in r){if(o[u])continue;o[u]=r[u]}return o},n.blendFloatValues=function(t,n,r,i,s){isNaN(s)?t[n]=i:t[n]=e.lerp(r,i[0],s[0])},n.prototype.clone=function(){return new n(this._sourceA,this._sourceB,this._blendWeight)},n}),define("goo/animation/layer/LayerLERPBlender",["goo/animation/blendtree/BinaryLERPSource"],function(e){function t(){this._blendWeight=null,this._layerA=null,this._layerB=null}return t.prototype.getBlendedSourceData=function(){var t=this._layerA.getCurrentSourceData(),n=this._layerB._currentState?this._layerB._currentState.getCurrentSourceData():null;return e.combineSourceData(t,n,this._blendWeight)},t}),define("goo/animation/layer/AnimationLayer",["goo/animation/state/SteadyState","goo/animation/layer/LayerLERPBlender","goo/entities/World","goo/math/MathUtils"],function(e,t,n,r){function i(e){this._name=e,this._steadyStates={},this._currentState=null,this._layerBlender=new t,this._transitions={},this._transitionStates={}}return i.BASE_LAYER_NAME="-BASE_LAYER-",i.prototype.getStates=function(){return Object.keys(this._steadyStates)},i.prototype.setState=function(e,t){this._steadyStates[e]=t},i.prototype.setBlendWeight=function(e){this._layerBlender&&(this._layerBlender._blendWeight=r.clamp(e,0,1))},i.prototype.getTransitions=function(){var e;this._currentState?e=Object.keys(this._currentState._transitions):e=[];if(this._transitions)for(var t in this._transitions)e.indexOf(t)===-1&&e.push(t);return e.sort(),e},i.prototype.update=function(e){this._currentState&&this._currentState.update(e||n.time)},i.prototype.postUpdate=function(){this._currentState&&this._currentState.postUpdate()},i.prototype.transitionTo=function(t,r){r=r||n.time;var i=this._currentState,s;if(this._steadyStates[t]===i)return!1;i&&i._transitions&&(s=i._transitions[t]||i._transitions["*"]),!s&&this._transitions&&(s=this._transitions[t]||this._transitions["*"]);if(i instanceof e&&s){var o=this._transitionStates[s.type];return this._doTransition(o,i,this._steadyStates[t],s,r),!0}if(!i){s=this._transitions[t];if(s){var o=this._transitionStates[s.type];if(o)return this._doTransition(o,null,this._steadyStates[t],s,r),!0}}return!1},i.prototype._doTransition=function(e,t,n,r,i){if(t){e._sourceState=t;var s=r.timeWindow||[-1,-1];if(!e.isValid(s,i)){console.warn("State not in allowed time window");return}t.onFinished=null}e._targetState=n,e.readFromConfig(r),e.resetClips(i),this.setCurrentState(e)},i.prototype.setCurrentState=function(e,t,r){r=r||n.time,this._currentState=e,e&&(t&&e.resetClips(r),e.onFinished=function(){this.setCurrentState(e._targetState||null),this.update()}.bind(this))},i.prototype.getCurrentState=function(){return this._currentState},i.prototype.setCurrentStateByName=function(e,t,n){if(e){var r=this._steadyStates[e];if(r)return this.setCurrentState(r,t,n),!0;console.warn("unable to find SteadyState named: "+e)}return!1},i.prototype.getCurrentSourceData=function(){return this._layerBlender?this._layerBlender.getBlendedSourceData():this._currentState?this._currentState.getCurrentSourceData():null},i.prototype.updateLayerBlending=function(e){this._layerBlender&&(this._layerBlender._layerA=e,this._layerBlender._layerB=this)},i.prototype.clearCurrentState=function(){this.setCurrentState(null)},i.prototype.resetClips=function(e){this._currentState&&this._currentState.resetClips(e||n.time)},i.prototype.shiftClipTime=function(e){this._currentState&&this._currentState.shiftClipTime(e||0)},i.prototype.setTimeScale=function(e){this._currentState&&this._currentState.setTimeScale(e)},i.prototype.clone=function(){var e=new i(this._name);for(var t in this._steadyStates)e._steadyStates[t]=this._steadyStates[t].clone(),this._steadyStates[t]===this._currentState&&(e._currentState=e._steadyStates[t]);for(var t in this._transitions)e._transitions[t]=this._transitions[t];for(var t in this._transitionStates)e._transitionStates[t]=new this._transitionStates[t].constructor;return e},i}),define("goo/animation/clip/JointData",["goo/animation/clip/TransformData"],function(e){function t(t){e.call(this,t),this._jointIndex=t?t._jointIndex:0}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.set=function(t){e.prototype.set.call(this,t),this._jointIndex=t._jointIndex},t.prototype.blend=function(n,r,i){var s=i;return s?s instanceof t&&(s._jointIndex=this._jointIndex):(s=new t,s._jointIndex=this._jointIndex),e.prototype.blend.call(this,n,r,s)},t.prototype.clone=function(){return new t(this)},t}),define("goo/animation/clip/TriggerData",[],function(){function e(){this._currentTriggers=[],this._currentIndex=-1,this.armed=!1}return e.prototype.arm=function(e,t){if(t===null||t.length===0)this._currentTriggers.length=0,this.armed=!1;else if(e!==this._currentIndex){this._currentTriggers.length=0;for(var n=0,r=t.length;n<r;n++)t[n]&&t[n]!==""&&this._currentTriggers.push(t[n]);this.armed=!0}this._currentIndex=e},e}),define("goo/entities/components/AnimationComponent",["goo/entities/components/Component","goo/entities/World","goo/animation/layer/AnimationLayer","goo/animation/clip/JointData","goo/animation/clip/TransformData","goo/animation/clip/TriggerData"],function(e,t,n,r,i,s){function o(e){this.type="AnimationComponent",this.layers=[],this.floats={},this._updateRate=1/60,this._lastUpdate=0,this._triggerCallbacks={};var t=new n(n.BASE_LAYER_NAME);this.layers.push(t),this._skeletonPose=e,this.paused=!1,this.lastTimeOfPause=null}return o.prototype=Object.create(e.prototype),o.prototype.transitionTo=function(e,t){return this.layers[0].transitionTo(e)?!0:t?this.layers[0].setCurrentStateByName(e):!1},o.prototype.getStates=function(){return this.layers[0].getStates()},o.prototype.getCurrentState=function(){return this.layers[0].getCurrentState()},o.prototype.getTransitions=function(){return this.layers[0].getTransitions()},o.prototype.update=function(e){if(this.paused)return;e=e||t.time;if(this._updateRate!==0){if(e>this._lastUpdate&&e-this._lastUpdate<this._updateRate)return;this._lastUpdate=e-(e-this._lastUpdate)%this._updateRate}for(var n=0,r=this.layers.length;n<r;n++)this.layers[n].update(e)},o.prototype.apply=function(e){var t=this.getCurrentSourceData(),n=this._skeletonPose;if(t){var o=Object.keys(t);for(var u=0,a=o.length;u<a;u++){var f=o[u],l=t[f];if(l instanceof r)n&&l._jointIndex>=0&&l.applyTo(n._localTransforms[l._jointIndex]);else if(l instanceof i)e&&(l.applyTo(e.transform),e.updateTransform(),this._updateWorldTransform(e));else if(l instanceof s){if(l.armed){for(var u=0,c=l._currentTriggers.length;u<c;u++){var h=this._triggerCallbacks[l._currentTriggers[u]];if(h&&h.length)for(var p=0,d=h.length;p<d;p++)h[p]()}l.armed=!1}}else l instanceof Array&&(this.floats[f]=l[0])}n&&n.updateTransforms()}},o.prototype._updateWorldTransform=function(e){e.updateWorldTransform();for(var t=0;t<e.children.length;t++)this._updateWorldTransform(e.children[t])},o.prototype.postUpdate=function(){for(var e=0,t=this.layers.length;e<t;e++)this.layers[e].postUpdate()},o.prototype.getCurrentSourceData=function(){if(this.layers.length===0)return[];var e=this.layers.length-1;this.layers[0]._layerBlender=null;for(var t=0;t<e;t++)this.layers[t+1].updateLayerBlending(this.layers[t]);return this.layers[e].getCurrentSourceData()},o.prototype.addLayer=function(e,t){isNaN(t)?this.layers.push(e):this.layers.splice(t,0,e)},o.prototype.resetClips=function(e){for(var t=0;t<this.layers.length;t++)this.layers[t].resetClips(e)},o.prototype.shiftClipTime=function(e){for(var t=0;t<this.layers.length;t++)this.layers[t].shiftClipTime(e)},o.prototype.setTimeScale=function(e){for(var t=0;t<this.layers.length;t++)this.layers[t].setTimeScale(e)},o.prototype.pause=function(){this.paused||(this.lastTimeOfPause=t.time,this.paused=!0)},o.prototype.stop=function(){this._skeletonPose&&this._skeletonPose.setToBindPose(),this.paused=!0,this.lastTimeOfPause=-1},o.prototype.resume=function(){this.paused&&(this.lastTimeOfPause===-1?this.resetClips():this.shiftClipTime(t.time-this.lastTimeOfPause)),this.paused=!1},o.prototype.clone=function(){var e=new o;return e.layers=this.layers.map(function(e){return e.clone()}),e},o}),define("goo/entities/EntityUtils",["goo/entities/components/TransformComponent","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/entities/components/CameraComponent","goo/entities/components/LightComponent","goo/entities/components/ScriptComponent","goo/renderer/Camera","goo/renderer/light/Light","goo/renderer/Material","goo/renderer/MeshData","goo/renderer/bounds/BoundingBox","goo/math/Transform","goo/entities/components/CSSTransformComponent","goo/entities/components/AnimationComponent"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){function d(){}function v(e,t){t.skeletonMap=t.skeletonMap||{originals:[],clones:[]};var n=t.skeletonMap.originals.indexOf(e),r;return n===-1?(r=e.clone(),t.skeletonMap.originals.push(e),t.skeletonMap.clones.push(r)):r=t.skeletonMap.clones[n],r}function m(r,i,s){var o=r.createEntity(i.name);for(var u=0;u<i._components.length;u++){var a=i._components[u];if(a instanceof e)o.transformComponent.transform.copy(a.transform);else if(a instanceof t){var f=new t(a.meshData);f.modelBound=new a.modelBound.constructor,a.currentPose&&(f.currentPose=v(a.currentPose,s)),o.setComponent(f)}else if(a instanceof n){var l=new n;for(var c=0;c<a.materials.length;c++)l.materials.push(a.materials[c]);o.setComponent(l)}else if(a instanceof p){var h=a.clone();h._skeletonPose=v(a._skeletonPose,s),o.setComponent(h)}else o.setComponent(a)}for(var c=0;c<i.transformComponent.children.length;c++){var d=i.transformComponent.children[c],g=m(r,d.entity,s);o.transformComponent.attachChild(g.transformComponent)}return s.callback&&s.callback(o),o}return d.clone=function(e,t,n){return n=n||{},n.shareData=n.shareData||!0,n.shareMaterial=n.shareMaterial||!0,n.cloneHierarchy=n.cloneHierarchy||!0,m(e,t,n)},d.traverse=function(e,t,n){n=n!==undefined?n:0;if(t(e,n)!==!1)for(var r=0;r<e.transformComponent.children.length;r++){var i=e.transformComponent.children[r];d.traverse(i.entity,t,n+1)}},d.getRoot=function(e){while(e.transformComponent.parent)e=e.transformComponent.parent.entity;return e},d.updateWorldTransform=function(e){e.updateWorldTransform();for(var t=0;t<e.children.length;t++)d.updateWorldTransform(e.children[t])},d.show=function(e){e.hidden=!1;var t=e;while(t.transformComponent.parent){t=t.transformComponent.parent.entity;if(t.hidden){e.meshRendererComponent&&(e.meshRendererComponent.hidden=!0);return}}d.traverse(e,function(e){if(e.hidden)return!1;e.meshRendererComponent&&(e.meshRendererComponent.hidden=e.hidden),e.lightComponent&&(e.lightComponent.hidden=e.hidden)})},d.hide=function(e){e.hidden=!0,d.traverse(e,function(e){e.meshRendererComponent&&(e.meshRendererComponent.hidden=!0),e.lightComponent&&(e.lightComponent.hidden=!0)})},d.createTypicalEntity=function(e){var l=e.createEntity();for(var h=1;h<arguments.length;h++){var p=arguments[h];if(p instanceof f){var d=new t(p);l.setComponent(d);if(!l.hasComponent("MeshRendererComponent")){var v=new n;l.setComponent(v)}}else if(p instanceof a){if(!l.hasComponent("MeshRendererComponent")){var v=new n;l.setComponent(v)}l.meshRendererComponent.materials.push(p)}else if(p instanceof u){var m=new i(p);l.setComponent(m)}else if(p instanceof o){var g=new r(p);l.setComponent(g)}else p instanceof c?l.transformComponent.transform=p:typeof p=="string"?l.name=p:Array.isArray(p)&&p.length===3?l.transformComponent.transform.translation.setd(p[0],p[1],p[2]):typeof p.run=="function"&&(l.hasComponent("ScriptComponent")||l.setComponent(new s),l.scriptComponent.scripts.push(p))}return l},d.createDOMEntity=function(e,t){var n=e.createEntity();return n.setComponent(new h(t)),n},d.getChildren=function(e){return e.transformComponent.children.map(function(e){return e.entity})},d.getTotalBoundingBox=function(e){var t=new l,n=!0;d.traverse(e,function(e){if(e.meshRendererComponent)if(n){var r=e.meshRendererComponent.worldBound;r instanceof l?r.clone(t):(t.center.setv(r.center),t.xExtent=t.yExtent=t.zExtent=r.radius),n=!1}else t.merge(e.meshRendererComponent.worldBound)});if(n){var r=e.transformComponent.worldTransform.translation;t=new l(r.clone(),.001,.001,.001)}return t},d}),define("goo/scripts/HeightMapBoundingScript",["goo/math/MathUtils"],function(e){function t(e){this.matrixData=e,this.width=e.length-1}return t.prototype.getMatrixData=function(){return this.matrixData},t.prototype.getPointInMatrix=function(e,t){return this.matrixData[e][t]},t.prototype.getAt=function(e,t){return e<0||e>this.width||t<0||t>this.width?0:this.getPointInMatrix(e,t)},t.prototype.getInterpolated=function(e,t){var n=this.getAt(Math.ceil(e),Math.ceil(t)),r=this.getAt(Math.ceil(e),Math.floor(t)),i=this.getAt(Math.floor(e),Math.ceil(t)),s=this.getAt(Math.floor(e),Math.floor(t)),o=e-Math.floor(e),u=t-Math.floor(t),a=n*o+i*(1-o),f=r*o+s*(1-o),l=a*u+f*(1-u);return l},t.prototype.getTriangleAt=function(e,t){var n=Math.ceil(e),r=Math.floor(e),i=Math.ceil(t),s=Math.floor(t),o=e-r,u=t-s,a={x:r,y:i,z:this.getAt(r,i)},f={x:n,y:s,z:this.getAt(n,s)},l;return o<1-u?l={x:r,y:s,z:this.getAt(r,s)}:l={x:n,y:i,z:this.getAt(n,i)},[a,f,l]},t.prototype.getPreciseHeight=function(t,n){var r=this.getTriangleAt(t,n),i=e.barycentricInterpolation(r[0],r[1],r[2],{x:t,y:n,z:0});return i.z},t.prototype.run=function(e){var t=e.transformComponent.transform.translation;t.data[1]=this.getInterpolated(t.data[0],t.data[2])},t}),define("goo/scripts/WorldFittedTerrainScript",["goo/scripts/HeightMapBoundingScript","goo/math/Vector3"],function(e,t){function s(e,t){if(e.minX>e.maxX)throw{name:"Terrain Exception",message:"minX is larger than maxX"};if(e.minY>e.maxY)throw{name:"Terrain Exception",message:"minY is larger than maxY"};if(e.minZ>e.maxZ)throw{name:"Terrain Exception",message:"minZ is larger than maxZ"};if(!t)throw{name:"Terrain Exception",message:"No heightmap data specified"};if(t.length!==t[0].length)throw{name:"Terrain Exception",message:"Heightmap data is not a square"};return!0}function o(t,n,r){return n=n||i,s(n,t,r),{dimensions:n,sideQuadCount:t.length-1,script:new e(t)}}function u(){this.heightMapData=[],this.yMargin=1}var n=new t,r=new t,i={minX:0,maxX:100,minY:0,maxY:50,minZ:0,maxZ:100};return u.prototype.addHeightData=function(e,t){var n=o(e,t,this.heightMapData);return this.heightMapData.push(n),n},u.prototype.getHeightDataForPosition=function(e){for(var t=0;t<this.heightMapData.length;t++){var n=this.heightMapData[t].dimensions;if(e[0]<=n.maxX&&e[0]>=n.minX&&e[1]<n.maxY+this.yMargin&&e[1]>n.minY-this.yMargin&&e[2]<=n.maxZ&&e[2]>=n.minZ)return this.heightMapData[t]}return null},u.prototype.displaceAxisDimensions=function(e,t,n,r){var i=e-t;return r*i/(n-t)},u.prototype.returnToWorldDimensions=function(e,t,n,r){var i=(n-t)/r,s=e*i;return t+s},u.prototype.getTerrainHeightAt=function(e){var t=this.getHeightDataForPosition(e);if(t===null)return null;var n=t.dimensions,r=this.displaceAxisDimensions(e[0],n.minX,n.maxX,t.sideQuadCount),i=this.displaceAxisDimensions(e[2],n.minZ,n.maxZ,t.sideQuadCount),s=t.script.getPreciseHeight(r,i);return s*(n.maxY-n.minY)+n.minY},u.prototype.getTerrainNormalAt=function(e){var t=this.getHeightDataForPosition(e);if(!t)return null;var i=t.dimensions,s=this.displaceAxisDimensions(e[0],i.minX,i.maxX,t.sideQuadCount),o=this.displaceAxisDimensions(e[2],i.minZ,i.maxZ,t.sideQuadCount),u=t.script.getTriangleAt(s,o);for(var a=0;a<u.length;a++)u[a].x=this.returnToWorldDimensions(u[a].x,i.minX,i.maxX,t.sideQuadCount),u[a].z=this.returnToWorldDimensions(u[a].z,i.minY,i.maxY,1),u[a].y=this.returnToWorldDimensions(u[a].y,i.minZ,i.maxZ,t.sideQuadCount);return n.set(u[1].x-u[0].x,u[1].z-u[0].z,u[1].y-u[0].y),r.set(u[2].x-u[0].x,u[2].z-u[0].z,u[2].y-u[0].y),n.cross(r),n.data[1]<0&&n.muld(-1,-1,-1),n.normalize(),n},u}),define("goo/util/CanvasUtils",[],function(){function e(){}return e.prototype.loadCanvasFromPath=function(e,t){var n=new Image;n.src=e;var r=document.createElement("canvas"),i=r.getContext("2d");n.onload=function(){r.width=n.width,r.height=n.height,i.drawImage(n,0,0),t(r)}},e.prototype.getMatrixFromCanvas=function(e){var t=e.getContext("2d"),n=function(n,r){return n<0||n>e.width||r<0||r>e.height?0:t.getImageData(n,r,1,1).data[0]/255},r=[];for(var i=0;i<e.width;i++){r.push([]);for(var s=0;s<e.height;s++)r[i].push(n(i,e.height-(s+1)))}return r},e}),define("goo/renderer/shaders/ShaderFragment",[],function(){function e(){}return e.noisecommon=["vec4 mod289(vec4 x) {","  return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec3 mod289(vec3 x) {","  return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec2 mod289(vec2 x) {","  return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec3 permute(vec3 x) {","  return mod289(((x*34.0)+1.0)*x);","}","vec4 permute(vec4 x) {","  return mod289(((x*34.0)+1.0)*x);","}"].join("\n"),e.noise2d=[e.noisecommon,"float snoise(vec2 v)","  {","  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0","                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)","                     -0.577350269189626,  // -1.0 + 2.0 * C.x","                      0.024390243902439); // 1.0 / 41.0","  vec2 i  = floor(v + dot(v, C.yy) );","  vec2 x0 = v -   i + dot(i, C.xx);","  vec2 i1;","  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0","  //i1.y = 1.0 - i1.x;","  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);","  // x0 = x0 - 0.0 + 0.0 * C.xx ;","  // x1 = x0 - i1 + 1.0 * C.xx ;","  // x2 = x0 - 1.0 + 2.0 * C.xx ;","  vec4 x12 = x0.xyxy + C.xxzz;","  x12.xy -= i1;","  i = mod289(i); // Avoid truncation effects in permutation","  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))","		+ i.x + vec3(0.0, i1.x, 1.0 ));","  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);","  m = m*m ;","  m = m*m ;","  vec3 x = 2.0 * fract(p * C.www) - 1.0;","  vec3 h = abs(x) - 0.5;","  vec3 ox = floor(x + 0.5);","  vec3 a0 = x - ox;","  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );","  vec3 g;","  g.x  = a0.x  * x0.x  + h.x  * x0.y;","  g.yz = a0.yz * x12.xz + h.yz * x12.yw;","  return 130.0 * dot(m, g);","}"].join("\n"),e.noise3d=[e.noisecommon,"vec4 taylorInvSqrt(vec4 r) {","	return 1.79284291400159 - 0.85373472095314 * r;","}","float snoise(vec3 v) {","	const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;","	const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);","	vec3 i  = floor(v + dot(v, C.yyy) );","	vec3 x0 =   v - i + dot(i, C.xxx) ;","	vec3 g = step(x0.yzx, x0.xyz);","	vec3 l = 1.0 - g;","	vec3 i1 = min( g.xyz, l.zxy );","	vec3 i2 = max( g.xyz, l.zxy );","	vec3 x1 = x0 - i1 + C.xxx;","	vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y","	vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y","	i = mod289(i); ","	vec4 p = permute( permute( permute( ","         i.z + vec4(0.0, i1.z, i2.z, 1.0 ))","       + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) ","       + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));","	float n_ = 0.142857142857; // 1.0/7.0","	vec3  ns = n_ * D.wyz - D.xzx;","	vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)","	vec4 x_ = floor(j * ns.z);","	vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)","	vec4 x = x_ *ns.x + ns.yyyy;","	vec4 y = y_ *ns.x + ns.yyyy;","	vec4 h = 1.0 - abs(x) - abs(y);","	vec4 b0 = vec4( x.xy, y.xy );","	vec4 b1 = vec4( x.zw, y.zw );","	vec4 s0 = floor(b0)*2.0 + 1.0;","	vec4 s1 = floor(b1)*2.0 + 1.0;","	vec4 sh = -step(h, vec4(0.0));","	vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;","	vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;","	vec3 p0 = vec3(a0.xy,h.x);","	vec3 p1 = vec3(a0.zw,h.y);","	vec3 p2 = vec3(a1.xy,h.z);","	vec3 p3 = vec3(a1.zw,h.w);","	vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));","	p0 *= norm.x;","	p1 *= norm.y;","	p2 *= norm.z;","	p3 *= norm.w;","	vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);","	m = m * m;","	return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3) ) );","}"].join("\n"),e.methods={packDepth:["vec4 packDepth( const in float depth ) {","	const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","	const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","	vec4 res = fract( depth * bit_shift );","	res -= res.xxyz * bit_mask;","	return res;","}"].join("\n"),unpackDepth:["float unpackDepth( const in vec4 rgba_depth ) {","	const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","	float depth = dot( rgba_depth, bit_shift );","	return depth;","}"].join("\n"),packDepth16:["vec2 packDepth16( const in float depth ) {","	const vec2 bias = vec2(1.0 / 255.0, 0.0);","	vec2 res = vec2(depth, fract(depth * 255.0));","	return res - (res.yy * bias);","}"].join("\n"),unpackDepth16:["float unpackDepth16( const in vec2 rg_depth ) {","	return rg_depth.x + (rg_depth.y / 255.0);","}"].join("\n"),hsv:["vec3 rgb2hsv(vec3 c) {","vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);","vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));","vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));","float d = q.x - min(q.w, q.y);","float e = 1.0e-10;","return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);","}","vec3 hsv2rgb(vec3 c){","vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);","vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);","return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);","}"].join("\n")},e}),define("goo/renderer/light/PointLight",["goo/renderer/light/Light"],function(e){function t(){e.apply(this,arguments),this.range=1e3}return t.prototype=Object.create(e.prototype),t.prototype.update=function(e){e.matrix.getTranslation(this.translation)},t}),define("goo/renderer/light/DirectionalLight",["goo/math/Vector3","goo/renderer/light/Light"],function(e,t){function n(){t.apply(this,arguments),this.direction=new e}return n.prototype=Object.create(t.prototype),n.prototype.update=function(e){e.matrix.getTranslation(this.translation),this.direction.setd(0,0,-1),e.matrix.applyPostVector(this.direction)},n}),define("goo/renderer/light/SpotLight",["goo/math/Vector3","goo/renderer/light/Light"],function(e,t){function n(){t.apply(this,arguments),this.direction=new e,this.range=1e3,this.angle=45,this.penumbra=null,this.exponent=16}return n.prototype=Object.create(t.prototype),n.prototype.update=function(e){e.matrix.getTranslation(this.translation),this.direction.setd(0,0,-1),e.matrix.applyPostVector(this.direction)},n}),define("goo/util/TangentGenerator",["goo/math/Vector2","goo/math/Vector3","goo/renderer/MeshData"],function(e,t,n){function r(){}return r.addTangentBuffer=function(r,i){function d(t){var n=[];for(var r=0;r<t.length;r+=2)n.push(new e(t[r+0],t[r+1]));return n}function v(e){var n=[];for(var r=0;r<e.length;r+=3)n.push(new t(e[r+0],e[r+1],e[r+2]));return n}i=i||0;var s=r.getAttributeBuffer(n.POSITION);if(!s)return;var o=r.getAttributeBuffer(n.NORMAL);if(!o)return;var u=r.getAttributeBuffer("TEXCOORD"+i);!u&&i!==0&&(u=r.getAttributeBuffer(n.TEXCOORD0));if(!u)return;var a=r.getIndexBuffer();if(!a)return;var f=r.vertexCount,l=r.indexCount/3,c=[],h=[];for(var p=0;p<f;p++)c[p]=new t,h[p]=new t;var m=v(s),g=v(o),y=d(u);for(var b=0;b<l;b++){var w=a[b*3],E=a[b*3+1],S=a[b*3+2],x=m[w],T=m[E],N=m[S],C=y[w],k=y[E],L=y[S],A=T.x-x.x,O=N.x-x.x,M=T.y-x.y,_=N.y-x.y,D=T.z-x.z,P=N.z-x.z,H=k.x-C.x,B=L.x-C.x,j=k.y-C.y,F=L.y-C.y,I=1/(H*F-B*j);if(isFinite(I)===!1)continue;var q=new t((F*A-j*O)*I,(F*M-j*_)*I,(F*D-j*P)*I),R=new t((H*O-B*A)*I,(H*_-B*M)*I,(H*P-B*D)*I);c[w].add(q),c[E].add(q),c[S].add(q),h[w].add(R),h[E].add(R),h[S].add(R)}r.attributeMap[n.TANGENT]=n.createAttribute(4,"Float"),r.rebuildData(r.vertexCount,r.indexCount,!0);var U=r.getAttributeBuffer(n.TANGENT),z=new t,W=new t;for(var b=0;b<f;b++){var X=g[b],V=c[b],$=X.dot(V);z.copy(V).sub(W.copy(X).mul($)).normalize(),U[b*4+0]=z.x,U[b*4+1]=z.y,U[b*4+2]=z.z,$=z.copy(X).cross(V).dot(h[b]);var J=$<0?-1:1;U[b*4+3]=J}return U},r}),define("goo/renderer/shaders/ShaderBuilder",["goo/renderer/MeshData","goo/renderer/light/PointLight","goo/renderer/light/DirectionalLight","goo/renderer/light/SpotLight","goo/renderer/Texture","goo/math/MathUtils","goo/util/TangentGenerator"],function(e,t,n,r,i,s,o){function u(){}var a=new n;return a.translation.setd(10,10,10),a.direction.setd(1,1,1).normalize(),u.defaultLight=a,u.SKYBOX=null,u.SKYSPHERE=null,u.ENVIRONMENT_TYPE=0,u.GLOBAL_AMBIENT=[0,0,0],u.USE_FOG=!1,u.FOG_SETTINGS=[0,1e4],u.FOG_COLOR=[1,1,1],u.uber={processor:function(t,n){var r=n.meshData.attributeMap,i=n.material,s=i._textureMaps;t.defines=t.defines||{},u.SKYBOX&&(i.uniforms.reflectivity>0||i.uniforms.refractivity>0)?i.setTexture("ENVIRONMENT_CUBE",u.SKYBOX):i.getTexture("ENVIRONMENT_CUBE")&&i.removeTexture("ENVIRONMENT_CUBE"),u.SKYSPHERE&&(i.uniforms.reflectivity>0||i.uniforms.refractivity>0)?(i.setTexture("ENVIRONMENT_SPHERE",u.SKYSPHERE),t.defines.ENVIRONMENT_TYPE=u.ENVIRONMENT_TYPE):i.getTexture("ENVIRONMENT_SPHERE")&&i.removeTexture("ENVIRONMENT_SPHERE");var a=Object.keys(r);for(var f=0,l=a.length;f<l;f++){var c=a[f];t.defines[c]||(t.defines[c]=!0)}var a=Object.keys(s);for(var f=0,l=a.length;f<l;f++){var h=a[f];if(s[h]===undefined||s[h]===null)continue;if(h==="SHADOW_MAP")continue;t.defines[h]||(t.defines[h]=!0);if(h==="DIFFUSE_MAP"){var p=s[h].offset,d=s[h].repeat;t.uniforms.offsetRepeat=t.uniforms.offsetRepeat||[0,0,1,1],t.uniforms.offsetRepeat[0]=p.x,t.uniforms.offsetRepeat[1]=p.y,t.uniforms.offsetRepeat[2]=d.x,t.uniforms.offsetRepeat[3]=d.y}}var a=Object.keys(t.defines);for(var f=0,l=a.length;f<l;f++){var c=a[f];if(c==="MAX_POINT_LIGHTS"||c==="MAX_DIRECTIONAL_LIGHTS"||c==="MAX_SPOT_LIGHTS"||c==="SHADOW_TYPE"||c==="JOINT_COUNT"||c==="WEIGHTS"||c==="PHYSICALLY_BASED_SHADING"||c==="ENVIRONMENT_TYPE"||c==="WRAP_AROUND")continue;!r[c]&&!s[c]&&delete t.defines[c]}n.material.uniforms.discardThreshold>=0?t.defines.DISCARD=!0:delete t.defines.DISCARD,u.USE_FOG?(t.defines.FOG=!0,t.uniforms.fogSettings=u.FOG_SETTINGS,t.uniforms.fogColor=u.FOG_COLOR):delete t.defines.FOG,t.defines.SKIP_SPECULAR=!0,t.defines.NORMAL&&t.defines.NORMAL_MAP&&!n.meshData.getAttributeBuffer(e.TANGENT)&&o.addTangentBuffer(n.meshData)}},u.light={processor:function(e,o){e.uniforms.materialAmbient=e.uniforms.materialAmbient||"AMBIENT",e.uniforms.materialEmissive=e.uniforms.materialEmissive||"EMISSIVE",e.uniforms.materialDiffuse=e.uniforms.materialDiffuse||"DIFFUSE",e.uniforms.materialSpecular=e.uniforms.materialSpecular||"SPECULAR",e.uniforms.materialSpecularPower=e.uniforms.materialSpecularPower||"SPECULAR_POWER",e.uniforms.globalAmbient=u.GLOBAL_AMBIENT,e.defines=e.defines||{};var a=o.lights,f=[];for(var l=0;l<a.length;l++){var c=a[l];c instanceof t?(e.uniforms["pointLight"+l]=[c.translation.data[0],c.translation.data[1],c.translation.data[2],c.range],e.uniforms["pointLightColor"+l]=[c.color.data[0]*c.intensity,c.color.data[1]*c.intensity,c.color.data[2]*c.intensity,c.specularIntensity],f.push("P")):c instanceof n?(e.uniforms["directionalLightDirection"+l]=[c.direction.data[0],c.direction.data[1],c.direction.data[2]],e.uniforms["directionalLightColor"+l]=[c.color.data[0]*c.intensity,c.color.data[1]*c.intensity,c.color.data[2]*c.intensity,c.specularIntensity],f.push("D")):c instanceof r&&(e.uniforms["spotLight"+l]=[c.translation.data[0],c.translation.data[1],c.translation.data[2],c.range],e.uniforms["spotLightColor"+l]=[c.color.data[0]*c.intensity,c.color.data[1]*c.intensity,c.color.data[2]*c.intensity,c.specularIntensity],e.uniforms["spotLightDirection"+l]=[c.direction.data[0],c.direction.data[1],c.direction.data[2]],e.uniforms["spotLightAngle"+l]=Math.cos(c.angle*s.DEG_TO_RAD/2),e.uniforms["spotLightPenumbra"+l]=c.penumbra!==undefined?Math.sin(c.penumbra*s.DEG_TO_RAD/4):0,f.push("S"));var h=c.lightCookie instanceof i;if((h||c.shadowCaster&&o.renderable.meshRendererComponent&&o.renderable.meshRendererComponent.receiveShadows)&&c.shadowSettings.shadowData){var p=c.shadowSettings.shadowData;c.shadowCaster&&(e.uniforms["shadowMaps"+l]="SHADOW_MAP"+l,o.material.setTexture("SHADOW_MAP"+l,p.shadowResult)),h?(e.uniforms["lightCookie"+l]="LIGHT_COOKIE"+l,o.material.setTexture("LIGHT_COOKIE"+l,c.lightCookie),f.push("C"),e.defines.COOKIE=!0):e.defines.COOKIE=!1;var d=p.lightCamera.getViewProjectionMatrix().data,v=e.uniforms["shadowLightMatrices"+l]=e.uniforms["shadowLightMatrices"+l]||[];for(var m=0;m<16;m++)v[m]=d[m];if(c.shadowCaster){var g=p.lightCamera.translation.data,y=e.uniforms["shadowLightPositions"+l]=e.uniforms["shadowLightPositions"+l]||[];y[0]=g[0],y[1]=g[1],y[2]=g[2],e.uniforms["cameraScales"+l]=1/(p.lightCamera.far-p.lightCamera.near),e.uniforms["shadowDarkness"+l]=c.shadowSettings.darkness;if(c.shadowSettings.shadowType==="PCF"){var b=e.uniforms["shadowMapSizes"+l]=e.uniforms["shadowMapSizes"+l]||[];b[0]=c.shadowSettings.resolution[0],b[1]=c.shadowSettings.resolution[1]}f.push("H",c.shadowSettings.shadowType==="PCF"?1:c.shadowSettings.shadowType==="VSM"?2:0)}}}e.defines.LIGHT=f.join("")},builder:function(e,s){var o=[],a=[],f=[],l=[];o.push("const mat4 ScaleMatrix = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0);"),f.push("uniform vec4 materialAmbient;","uniform vec4 materialEmissive;","uniform vec4 materialDiffuse;","uniform vec4 materialSpecular;","uniform float materialSpecularPower;","uniform vec3 globalAmbient;","float ChebychevInequality(in vec2 moments, in float t) {","if ( t <= moments.x ) return 1.0;","float variance = moments.y - (moments.x * moments.x);","variance = max(variance, 0.02);","float d = t - moments.x;","return variance / (variance + d * d);","}"),l.push("#if defined(SPECULAR_MAP) && defined(TEXCOORD0)","float specularStrength = texture2D(specularMap, texCoord0).x;","#else","float specularStrength = 1.0;","#endif","vec3 totalDiffuse = vec3(0.0);","vec3 totalSpecular = vec3(0.0);");var c=s.lights;for(var h=0;h<c.length;h++){var p=c[h];l.push("{","float shadow = 1.0;","vec3 normalizedViewPosition = normalize(viewPosition);");var d=p.lightCookie instanceof i;if(p.shadowCaster||d)o.push("uniform mat4 shadowLightMatrices"+h+";","varying vec4 shadowLightDepths"+h+";"),a.push("shadowLightDepths"+h+" = ScaleMatrix * shadowLightMatrices"+h+" * worldPos;"),p.shadowCaster&&f.push("uniform sampler2D shadowMaps"+h+";","uniform vec3 shadowLightPositions"+h+";","uniform float cameraScales"+h+";","uniform float shadowDarkness"+h+";"),d&&f.push("uniform sampler2D lightCookie"+h+";"),f.push("varying vec4 shadowLightDepths"+h+";"),p.shadowCaster&&p.shadowSettings.shadowType==="PCF"&&f.push("uniform vec2 shadowMapSizes"+h+";"),l.push("vec3 depth = shadowLightDepths"+h+".xyz / shadowLightDepths"+h+".w;"),p.shadowCaster&&(l.push("depth.z = length(vWorldPos.xyz - shadowLightPositions"+h+") * cameraScales"+h+";","if (depth.x >= 0.0 && depth.x <= 1.0 && depth.y >= 0.0 && depth.y <= 1.0 && shadowLightDepths"+h+".z >= 0.0 && depth.z <= 1.0) {"),p.shadowSettings.shadowType==="PCF"?l.push("depth.z *= 0.96;","float shadowPcf = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSizes"+h+".x;","float yPixelOffset = 1.0 / shadowMapSizes"+h+".y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","float fDepth = 0.0;","fDepth = texture2D(shadowMaps"+h+", depth.xy + vec2(dx0, dy0)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+h+", depth.xy + vec2(0.0, dy0)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+h+", depth.xy + vec2(dx1, dy0)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+h+", depth.xy + vec2(dx0, 0.0)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth =  texture2D(shadowMaps"+h+", depth.xy).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+h+", depth.xy + vec2(dx1, 0.0)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+h+", depth.xy + vec2(dx0, dy1)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+h+", depth.xy + vec2(0.0, dy1)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+h+", depth.xy + vec2(dx1, dy1)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","shadow = (1.0 - shadowPcf) * (1.0 - shadowDarkness"+h+") + shadowDarkness"+h+";"):p.shadowSettings.shadowType==="VSM"?l.push("vec4 texel = texture2D(shadowMaps"+h+", depth.xy);","vec2 moments = vec2(texel.x, texel.y);","shadow = ChebychevInequality(moments, depth.z);","shadow = pow(shadow, 8.0 - shadowDarkness"+h+" * 8.0);"):l.push("depth.z *= 0.96;","float shadowDepth = texture2D(shadowMaps"+h+", depth.xy).x;","if ( depth.z > shadowDepth ) shadow = shadowDarkness"+h+";"),l.push("}","shadow = clamp(shadow, 0.0, 1.0);"));p instanceof t?(f.push("uniform vec4 pointLight"+h+";","uniform vec4 pointLightColor"+h+";"),l.push("vec3 lVector = normalize(pointLight"+h+".xyz - vWorldPos.xyz);","float lDistance = 1.0 - min((length(pointLight"+h+".xyz - vWorldPos.xyz) / pointLight"+h+".w), 1.0);","float dotProduct = dot(N, lVector);","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max(dotProduct, 0.0);","float pointDiffuseWeightHalf = max(0.5 * dotProduct + 0.5, 0.0);","float wrapRGB = 1.0;","vec3 pointDiffuseWeight = mix(vec3(pointDiffuseWeightFull), vec3(pointDiffuseWeightHalf), wrapRGB);","#else","float pointDiffuseWeight = max(dotProduct, 0.0);","#endif","totalDiffuse += materialDiffuse.rgb * pointLightColor"+h+".rgb * pointDiffuseWeight * lDistance * shadow;","vec3 pointHalfVector = normalize(lVector + normalizedViewPosition);","float pointDotNormalHalf = max(dot(N, pointHalfVector), 0.0);","float pointSpecularWeight = pointLightColor"+h+".a * specularStrength * max(pow(pointDotNormalHalf, materialSpecularPower), 0.0);","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = (materialSpecularPower + 2.0001 ) / 8.0;","vec3 schlick = materialSpecular.rgb + vec3(1.0 - materialSpecular.rgb) * pow(1.0 - dot(lVector, pointHalfVector), 5.0);","totalSpecular += schlick * pointLightColor"+h+".rgb * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization * shadow;","#else","totalSpecular += materialSpecular.rgb * pointLightColor"+h+".rgb * pointSpecularWeight * pointDiffuseWeight * lDistance * shadow;","#endif")):p instanceof n?(f.push("uniform vec4 directionalLightColor"+h+";","uniform vec3 directionalLightDirection"+h+";"),l.push("vec3 dirVector = normalize(-directionalLightDirection"+h+");","float dotProduct = dot(N, dirVector);","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max(dotProduct, 0.0);","float dirDiffuseWeightHalf = max(0.5 * dotProduct + 0.5, 0.0);","float wrapRGB = 1.0;","vec3 dirDiffuseWeight = mix(vec3(dirDiffuseWeightFull), vec3(dirDiffuseWeightHalf), wrapRGB);","#else","float dirDiffuseWeight = max(dotProduct, 0.0);","#endif","vec3 cookie = vec3(1.0);"),d&&l.push("cookie = texture2D(lightCookie"+h+", depth.xy).rgb;"),l.push("totalDiffuse += materialDiffuse.rgb * directionalLightColor"+h+".rgb * dirDiffuseWeight * shadow * cookie;","vec3 dirHalfVector = normalize(dirVector + normalizedViewPosition);","float dirDotNormalHalf = max(dot(N, dirHalfVector), 0.0);","float dirSpecularWeight = directionalLightColor"+h+".a * specularStrength * max(pow(dirDotNormalHalf, materialSpecularPower), 0.0);","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = (materialSpecularPower + 2.0001) / 8.0;","vec3 schlick = materialSpecular.rgb + vec3(1.0 - materialSpecular.rgb) * pow(1.0 - dot(dirVector, dirHalfVector), 5.0);","totalSpecular += schlick * directionalLightColor"+h+".rgb * dirSpecularWeight * dirDiffuseWeight * specularNormalization * shadow * cookie;","#else","totalSpecular += materialSpecular.rgb * directionalLightColor"+h+".rgb * dirSpecularWeight * dirDiffuseWeight * shadow * cookie;","#endif")):p instanceof r&&(f.push("uniform vec4 spotLightColor"+h+";","uniform vec4 spotLight"+h+";","uniform vec3 spotLightDirection"+h+";","uniform float spotLightAngle"+h+";","uniform float spotLightPenumbra"+h+";"),l.push("vec3 lVector = normalize(spotLight"+h+".xyz - vWorldPos.xyz);","float lDistance = 1.0 - min((length(spotLight"+h+".xyz - vWorldPos.xyz) / spotLight"+h+".w), 1.0);","float spotEffect = dot(normalize(-spotLightDirection"+h+"), lVector);","if (spotEffect > spotLightAngle"+h+") {","if (spotLightPenumbra"+h+" > 0.0) {","spotEffect = (spotEffect - spotLightAngle"+h+") / spotLightPenumbra"+h+";","spotEffect = clamp(spotEffect, 0.0, 1.0);","} else {","spotEffect = 1.0;","}","float dotProduct = dot(N, lVector);","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max(dotProduct, 0.0);","float spotDiffuseWeightHalf = max(0.5 * dotProduct + 0.5, 0.0);","float wrapRGB = 1.0;","vec3 spotDiffuseWeight = mix(vec3(spotDiffuseWeightFull), vec3(spotDiffuseWeightHalf), wrapRGB);","#else","float spotDiffuseWeight = max(dotProduct, 0.0);","#endif","vec3 cookie = vec3(1.0);"),d&&l.push("cookie = texture2D(lightCookie"+h+", depth.xy).rgb;"),l.push("totalDiffuse += materialDiffuse.rgb * spotLightColor"+h+".rgb * spotDiffuseWeight * lDistance * spotEffect * shadow * cookie;","vec3 spotHalfVector = normalize(lVector + normalizedViewPosition);","float spotDotNormalHalf = max(dot(N, spotHalfVector), 0.0);","float spotSpecularWeight = spotLightColor"+h+".a * specularStrength * max(pow(spotDotNormalHalf, materialSpecularPower), 0.0);","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = (materialSpecularPower + 2.0001) / 8.0;","vec3 schlick = materialSpecular.rgb + vec3(1.0 - materialSpecular.rgb) * pow(1.0 - dot(lVector, spotHalfVector), 5.0);","totalSpecular += schlick * spotLightColor"+h+".rgb * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect * shadow * cookie;","#else","totalSpecular += materialSpecular.rgb * spotLightColor"+h+".rgb * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect * shadow * cookie;","#endif","}")),l.push("}")}l.push("#if defined(EMISSIVE_MAP) && defined(TEXCOORD0)","vec3 emissive = vec3(0.0);","#else","vec3 emissive = materialEmissive.rgb;","#endif","#ifdef SKIP_SPECULAR","final_color.xyz = final_color.xyz * (emissive + totalDiffuse + globalAmbient + materialAmbient.rgb);","#else","final_color.xyz = final_color.xyz * (emissive + totalDiffuse + globalAmbient + materialAmbient.rgb) + totalSpecular;","#endif","#if defined(EMISSIVE_MAP) && defined(TEXCOORD0)","final_color.rgb += texture2D(emissiveMap, texCoord0).rgb * materialEmissive.rgb;","#endif"),u.light.prevertex=o.join("\n"),u.light.vertex=a.join("\n"),u.light.prefragment=f.join("\n"),u.light.fragment=l.join("\n")}},u.animation={processor:function(e,t){var n=t.currentPose;e.defines=e.defines||{},n?(e.uniforms.jointPalette||(e.uniforms.jointPalette=u.animation.jointPalette),e.defines.JOINT_COUNT=Math.max(t.meshData.paletteMap.length*3,80)):delete e.defines.JOINT_COUNT},jointPalette:function(e){var t=e.meshData,n=e.currentPose;if(n){var r=n._matrixPalette,i=t.store;i||(i=new Float32Array(t.paletteMap.length*12),t.store=i);var s;for(var o=0;o<t.paletteMap.length;o++){s=r[t.paletteMap[o]];for(var a=0;a<12;a++)i[o*12+a]=s.data[u.animation.order[a]]}return i}},order:[0,4,8,12,1,5,9,13,2,6,10,14],prevertex:["#ifdef JOINTIDS","attribute vec4 vertexJointIDs;","#endif","#ifdef WEIGHTS","attribute vec4 vertexWeights;","#endif","#ifdef JOINT_COUNT","uniform vec4 jointPalette[JOINT_COUNT];","#endif"].join("\n"),vertex:["#if defined(JOINT_COUNT) && defined(WEIGHTS) && defined(JOINTIDS)","int x = 3*int(vertexJointIDs.x);","int y = 3*int(vertexJointIDs.y);","int z = 3*int(vertexJointIDs.z);","int w = 3*int(vertexJointIDs.w);","mat4 mat = mat4(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);","mat += mat4(","	jointPalette[x+0].x, jointPalette[x+1].x, jointPalette[x+2].x, 0,","	jointPalette[x+0].y, jointPalette[x+1].y, jointPalette[x+2].y, 0,","	jointPalette[x+0].z, jointPalette[x+1].z, jointPalette[x+2].z, 0,","	jointPalette[x+0].w, jointPalette[x+1].w, jointPalette[x+2].w, 1",") * vertexWeights.x;","mat += mat4(","	jointPalette[y+0].x, jointPalette[y+1].x, jointPalette[y+2].x, 0,","	jointPalette[y+0].y, jointPalette[y+1].y, jointPalette[y+2].y, 0,","	jointPalette[y+0].z, jointPalette[y+1].z, jointPalette[y+2].z, 0,","	jointPalette[y+0].w, jointPalette[y+1].w, jointPalette[y+2].w, 1",") * vertexWeights.y;","mat += mat4(","	jointPalette[z+0].x, jointPalette[z+1].x, jointPalette[z+2].x, 0,","	jointPalette[z+0].y, jointPalette[z+1].y, jointPalette[z+2].y, 0,","	jointPalette[z+0].z, jointPalette[z+1].z, jointPalette[z+2].z, 0,","	jointPalette[z+0].w, jointPalette[z+1].w, jointPalette[z+2].w, 1",") * vertexWeights.z;","mat += mat4(","	jointPalette[w+0].x, jointPalette[w+1].x, jointPalette[w+2].x, 0,","	jointPalette[w+0].y, jointPalette[w+1].y, jointPalette[w+2].y, 0,","	jointPalette[w+0].z, jointPalette[w+1].z, jointPalette[w+2].z, 0,","	jointPalette[w+0].w, jointPalette[w+1].w, jointPalette[w+2].w, 1",") * vertexWeights.w;","wMatrix = wMatrix * mat / mat[3][3];","#ifdef NORMAL","nMatrix = nMatrix * mat / mat[3][3];","#endif","#endif"].join("\n")},u}),define("goo/renderer/shaders/ShaderLib",["goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/shaders/ShaderFragment","goo/renderer/shaders/ShaderBuilder","goo/renderer/Util","goo/entities/World"],function(e,t,n,r,i,s){function o(){}return o.uber={processors:[r.uber.processor,r.light.processor,r.animation.processor],attributes:{vertexPosition:e.POSITION,vertexNormal:e.NORMAL,vertexTangent:e.TANGENT,vertexColor:e.COLOR,vertexUV0:e.TEXCOORD0,vertexUV1:e.TEXCOORD1,vertexJointIDs:e.JOINTIDS,vertexWeights:e.WEIGHTS},uniforms:{viewProjectionMatrix:t.VIEW_PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,normalMatrix:t.NORMAL_MATRIX,cameraPosition:t.CAMERA,diffuseMap:t.DIFFUSE_MAP,offsetRepeat:[0,0,1,1],normalMap:t.NORMAL_MAP,normalMultiplier:1,specularMap:t.SPECULAR_MAP,emissiveMap:t.EMISSIVE_MAP,aoMap:t.AO_MAP,lightMap:t.LIGHT_MAP,environmentCube:"ENVIRONMENT_CUBE",environmentSphere:"ENVIRONMENT_SPHERE",reflectionMap:"REFLECTION_MAP",transparencyMap:"TRANSPARENCY_MAP",opacity:1,reflectivity:0,refractivity:0,etaRatio:0,fresnel:0,discardThreshold:-0.01,fogSettings:[0,1e4],fogColor:[1,1,1],shadowDarkness:.5},builder:function(e,t){r.light.builder(e,t)},vshader:function(){return["attribute vec3 vertexPosition;","#ifdef NORMAL","attribute vec3 vertexNormal;","#endif","#ifdef TANGENT","attribute vec4 vertexTangent;","#endif","#ifdef COLOR","attribute vec4 vertexColor;","#endif","#ifdef TEXCOORD0","attribute vec2 vertexUV0;","uniform vec4 offsetRepeat;","varying vec2 texCoord0;","#endif","#ifdef TEXCOORD1","attribute vec2 vertexUV1;","varying vec2 texCoord1;","#endif","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform mat4 normalMatrix;","uniform vec3 cameraPosition;","varying vec3 vWorldPos;","varying vec3 viewPosition;","#ifdef NORMAL","varying vec3 normal;","#endif","#ifdef TANGENT","varying vec3 binormal;","varying vec3 tangent;","#endif","#ifdef COLOR","varying vec4 color;","#endif",r.light.prevertex,r.animation.prevertex,"void main(void) {","mat4 wMatrix = worldMatrix;","#ifdef NORMAL","mat4 nMatrix = normalMatrix;","#endif",r.animation.vertex,"vec4 worldPos = wMatrix * vec4(vertexPosition, 1.0);","vWorldPos = worldPos.xyz;","gl_Position = viewProjectionMatrix * worldPos;","viewPosition = cameraPosition - worldPos.xyz;","#ifdef NORMAL","	normal = normalize((nMatrix * vec4(vertexNormal, 0.0)).xyz);","#endif","#ifdef TANGENT","	tangent = normalize((nMatrix * vec4(vertexTangent.xyz, 0.0)).xyz);","	binormal = cross(normal, tangent) * vec3(vertexTangent.w);","#endif","#ifdef COLOR","	color = vertexColor;","#endif","#ifdef TEXCOORD0","	texCoord0 = vertexUV0 * offsetRepeat.zw + offsetRepeat.xy;","#endif","#ifdef TEXCOORD1","	texCoord1 = vertexUV1;","#endif",r.light.vertex,"}"].join("\n")},fshader:function(){return["#ifdef DIFFUSE_MAP","uniform sampler2D diffuseMap;","#endif","#ifdef NORMAL_MAP","uniform sampler2D normalMap;","uniform float normalMultiplier;","#endif","#ifdef SPECULAR_MAP","uniform sampler2D specularMap;","#endif","#ifdef EMISSIVE_MAP","uniform sampler2D emissiveMap;","#endif","#ifdef AO_MAP","uniform sampler2D aoMap;","#endif","#ifdef LIGHT_MAP","uniform sampler2D lightMap;","#endif","#ifdef TRANSPARENCY_MAP","uniform sampler2D transparencyMap;","#endif","#if defined(ENVIRONMENT_CUBE) || defined(ENVIRONMENT_SPHERE)","#ifdef ENVIRONMENT_CUBE","uniform samplerCube environmentCube;","#else","uniform sampler2D environmentSphere;","#endif","uniform float reflectivity;","uniform float fresnel;","uniform float refractivity;","uniform float etaRatio;","#ifdef REFLECTION_MAP","uniform sampler2D reflectionMap;","#endif","#endif","uniform float opacity;","#ifdef DISCARD","uniform float discardThreshold;","#endif","#ifdef FOG","uniform vec2 fogSettings;","uniform vec3 fogColor;","#endif","varying vec3 vWorldPos;","varying vec3 viewPosition;","#ifdef NORMAL","varying vec3 normal;","#endif","#ifdef TANGENT","varying vec3 binormal;","varying vec3 tangent;","#endif","#ifdef COLOR","varying vec4 color;","#endif","#ifdef TEXCOORD0","varying vec2 texCoord0;","#endif","#ifdef TEXCOORD1","varying vec2 texCoord1; //Use for lightmap","#endif",r.light.prefragment,"void main(void)","{","vec4 final_color = vec4(1.0);","#if defined(DIFFUSE_MAP) && defined(TEXCOORD0)","final_color *= texture2D(diffuseMap, texCoord0);","#endif","#ifdef COLOR","final_color *= color;","#endif","#if defined(TRANSPARENCY_MAP) && defined(TEXCOORD0)","final_color.a = texture2D(transparencyMap, texCoord0).a;","#endif","final_color.a *= opacity;","#ifdef DISCARD","if (final_color.a < discardThreshold) discard;","#endif","#ifdef AO_MAP","#ifdef TEXCOORD1","final_color.rgb *= texture2D(aoMap, texCoord1).rgb;","#elif defined(TEXCOORD0)","final_color.rgb *= texture2D(aoMap, texCoord0).rgb;","#endif","#endif","#ifdef LIGHT_MAP","#ifdef TEXCOORD1","final_color.rgb *= texture2D(lightMap, texCoord1).rgb * 2.0 - 0.5;","#elif defined(TEXCOORD0)","final_color.rgb *= texture2D(lightMap, texCoord0).rgb * 2.0 - 0.5;","#endif","#else","vec3 N = vec3(0.0, 1.0, 0.0);","#if defined(NORMAL)","N = normalize(normal);","#endif","#if defined(TANGENT) && defined(NORMAL_MAP) && defined(TEXCOORD0)","mat3 tangentToWorld = mat3(tangent, binormal, normal);","vec3 tangentNormal = texture2D(normalMap, texCoord0).xyz * vec3(2.0) - vec3(1.0);","tangentNormal.xy *= normalMultiplier;","vec3 worldNormal = (tangentToWorld * tangentNormal);","N = normalize(worldNormal);","#endif",r.light.fragment,"#endif","#if defined(ENVIRONMENT_CUBE) || defined(ENVIRONMENT_SPHERE)","if (refractivity > 0.0) {","vec3 refractionVector = refract(normalize(viewPosition), N, etaRatio);","refractionVector.x = -refractionVector.x;","#ifdef ENVIRONMENT_CUBE","vec4 environment = textureCube(environmentCube, refractionVector);","#else","refractionVector = -refractionVector;","float m = 4.0 * sqrt(refractionVector.x*refractionVector.x + refractionVector.y*refractionVector.y + (refractionVector.z+1.0)*(refractionVector.z+1.0));","vec4 environment = texture2D(environmentSphere, (refractionVector.xy / m) + 0.5);","#endif","final_color = mix(final_color, environment, refractivity);","}","if (reflectivity > 0.0) {","vec3 reflectionVector = reflect(viewPosition, N);","reflectionVector.yz = -reflectionVector.yz;","#ifdef ENVIRONMENT_CUBE","vec4 environment = textureCube(environmentCube, reflectionVector);","#else","reflectionVector = -reflectionVector;","float m = 4.0 * sqrt(reflectionVector.x*reflectionVector.x + reflectionVector.y*reflectionVector.y + (reflectionVector.z+1.0)*(reflectionVector.z+1.0));","vec4 environment = texture2D(environmentSphere, (reflectionVector.xy / m) + 0.5);","#endif","float reflectionAmount = reflectivity;","#if defined(REFLECTION_MAP) && defined(TEXCOORD0)","reflectionAmount *= texture2D(reflectionMap, texCoord0).r;","#endif","float fresnelVal = pow(1.0 - abs(dot(normalize(viewPosition), N)), fresnel * 4.0);","reflectionAmount *= fresnelVal;","final_color = mix(final_color, environment, reflectionAmount);","}","#endif","#ifndef LIGHT_MAP","final_color.rgb += totalSpecular;","final_color.a += min(length(totalSpecular), 1.0);","#endif","#ifdef FOG","float d = pow(smoothstep(fogSettings.x, fogSettings.y, length(viewPosition)), 1.0);","final_color.rgb = mix(final_color.rgb, fogColor, d);","#endif","gl_FragColor = final_color;","}"].join("\n")}},o.screenCopy={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{diffuseMap:t.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","varying vec2 texCoord0;","void main(void) {","	texCoord0 = vertexUV0;","	gl_Position = vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","varying vec2 texCoord0;","void main(void)","{","	gl_FragColor = texture2D(diffuseMap, texCoord0);","}"].join("\n")},o.copy={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewProjectionMatrix:t.VIEW_PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,opacity:1,diffuseMap:t.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","void main(void) {","	texCoord0 = vertexUV0;","	gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","uniform float opacity;","varying vec2 texCoord0;","void main(void)","{","	gl_FragColor = vec4(texture2D(diffuseMap, texCoord0).rgb, opacity);","}"].join("\n")},o.copyPure={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewProjectionMatrix:t.VIEW_PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,opacity:1,diffuseMap:t.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","void main(void) {","	texCoord0 = vertexUV0;","	gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","uniform float opacity;","varying vec2 texCoord0;","void main(void)","{","	vec4 col = texture2D(diffuseMap, texCoord0);","	gl_FragColor = vec4(col.rgb, col.a * opacity);","}"].join("\n")},o.simple={attributes:{vertexPosition:e.POSITION},uniforms:{viewProjectionMatrix:t.VIEW_PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","void main(void) {","	gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["void main(void)","{","	gl_FragColor = vec4(1.0);","}"].join("\n")},o.simpleColored={attributes:{vertexPosition:e.POSITION},uniforms:{viewProjectionMatrix:t.VIEW_PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,color:[1,1,1],opacity:1},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","void main(void) {","	gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform vec3 color;","uniform float opacity;","void main(void)","{","	if (opacity == 0.0) {","		discard;","	}","	gl_FragColor = vec4(color, opacity);","}"].join("\n")},o.simpleLit={processors:[r.light.processor],defines:{NORMAL:!0},attributes:{vertexPosition:e.POSITION,vertexNormal:e.NORMAL},uniforms:{viewProjectionMatrix:t.VIEW_PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,cameraPosition:t.CAMERA,opacity:1},builder:function(e,t){r.light.builder(e,t)},vshader:function(){return["attribute vec3 vertexPosition;","attribute vec3 vertexNormal;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;",r.light.prevertex,"varying vec3 normal;","varying vec3 vWorldPos;","varying vec3 viewPosition;","void main(void) {","	vec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);","	vWorldPos = worldPos.xyz;","	gl_Position = viewProjectionMatrix * worldPos;",r.light.vertex,"	normal = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;","	viewPosition = cameraPosition - worldPos.xyz;","}"].join("\n")},fshader:function(){return["#ifdef SPECULAR_MAP","uniform sampler2D specularMap;","#ifdef TEXCOORD0","varying vec2 texCoord0;","#endif","#endif","uniform float opacity;",r.light.prefragment,"#ifdef NORMAL","varying vec3 normal;","#endif","varying vec3 vWorldPos;","varying vec3 viewPosition;","void main(void)","{"," if (opacity == 0.0) {","	discard;"," }"," #ifdef NORMAL","	vec3 N = normalize(normal);"," #else"," vec3 N = vec3(0,0,1);"," #endif","	vec4 final_color = vec4(1.0);",r.light.fragment,"	final_color.a = opacity;","	gl_FragColor = final_color;","}"].join("\n")}},o.billboard={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewProjectionMatrix:t.VIEW_PROJECTION_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,viewMatrix:t.VIEW_MATRIX,worldMatrix:t.WORLD_MATRIX,diffuseMap:t.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","varying vec2 texCoord0;","void main(void) {","	texCoord0 = vertexUV0;","	gl_Position = viewProjectionMatrix * worldMatrix * vec4(0.0, 0.0, 0.0, 1.0) + projectionMatrix * vec4(vertexPosition.x, vertexPosition.y, 0.0, 0.0);","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","varying vec2 texCoord0;","void main(void)","{","	gl_FragColor = texture2D(diffuseMap, texCoord0);","}"].join("\n")},o.textured={defines:{TEXCOORD0:!0,DIFFUSE_MAP:!0},attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewProjectionMatrix:t.VIEW_PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,diffuseMap:t.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","void main(void) {","	texCoord0 = vertexUV0;","	gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["#if defined(TEXCOORD0) && defined(DIFFUSE_MAP)","uniform sampler2D diffuseMap;","varying vec2 texCoord0;","#endif","void main(void)","{"," #if defined(TEXCOORD0) && defined(DIFFUSE_MAP)","	gl_FragColor = texture2D(diffuseMap, texCoord0);"," #else"," gl_FragColor = vec4(1.0);"," #endif","}"].join("\n")},o.texturedLit={processors:[r.light.processor],attributes:{vertexPosition:e.POSITION,vertexNormal:e.NORMAL,vertexUV0:e.TEXCOORD0},uniforms:{viewProjectionMatrix:t.VIEW_PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,cameraPosition:t.CAMERA,diffuseMap:t.DIFFUSE_MAP},builder:function(e,t){r.light.builder(e,t)},vshader:function(){return["attribute vec3 vertexPosition;","attribute vec3 vertexNormal;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;",r.light.prevertex,"varying vec3 normal;","varying vec3 vWorldPos;","varying vec3 viewPosition;","varying vec2 texCoord0;","void main(void) {","	vec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);","	vWorldPos = worldPos.xyz;","	gl_Position = viewProjectionMatrix * worldPos;",r.light.vertex,"	normal = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;","	texCoord0 = vertexUV0;","	viewPosition = cameraPosition - worldPos.xyz;","}"].join("\n")},fshader:function(){return["uniform sampler2D diffuseMap;",r.light.prefragment,"varying vec3 normal;","varying vec3 vWorldPos;","varying vec3 viewPosition;","varying vec2 texCoord0;","void main(void)","{","	vec3 N = normalize(normal);","	vec4 final_color = texture2D(diffuseMap, texCoord0);",r.light.fragment,"	gl_FragColor = final_color;","}"].join("\n")}},o.convolution={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},attributes:{position:e.POSITION,uv:e.TEXCOORD0},uniforms:{viewMatrix:t.VIEW_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,tDiffuse:t.DIFFUSE_MAP,uImageIncrement:[.001953125,0],cKernel:[],size:1},vshader:["attribute vec3 position;","attribute vec2 uv;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform float size;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","	vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * size * uImageIncrement;","	gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( position, 1.0 );","}"].join("\n"),fshader:["uniform float cKernel[ KERNEL_SIZE_INT ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","uniform float size;","varying vec2 vUv;","void main() {","	vec2 imageCoord = vUv;","	vec4 sum = vec4( 0.0 );","	for( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {","		sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];","		imageCoord += uImageIncrement * size;","	}","	gl_FragColor = sum;","}"].join("\n"),buildKernel:function(e){function t(e,t){return Math.exp(-(e*e)/(2*t*t))}var n,r,i,s,o=25,u=2*Math.ceil(e*3)+1;u>o&&(u=o),s=(u-1)*.5,r=new Array(u),i=0;for(n=0;n<u;++n)r[n]=t(n-s,e),i+=r[n];for(n=0;n<u;++n)r[n]/=i;return r}},o.showDepth={attributes:{vertexPosition:e.POSITION},uniforms:{viewMatrix:t.VIEW_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,near:t.NEAR_PLANE,far:t.FAR_PLANE},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","void main(void) {","	gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform float near;","uniform float far;","void main(void)","{","	float depth = gl_FragCoord.z / gl_FragCoord.w;","	float d = 1.0 - smoothstep( near, far, depth );","	gl_FragColor = vec4(d);","}"].join("\n")},o.showNormals={defines:{NORMAL:!0},attributes:{vertexPosition:e.POSITION,vertexNormal:e.NORMAL},uniforms:{viewMatrix:t.VIEW_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,viewProjectionMatrix:t.VIEW_PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,opacity:1},vshader:["attribute vec3 vertexPosition;","attribute vec3 vertexNormal;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec3 normal;","void main() {","normal = vec3(worldMatrix * vec4(vertexNormal, 0.0));","gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform float opacity;","#ifdef NORMAL","varying vec3 normal;","#else","vec3 normal = vec3(0,0,1);","#endif","void main() {","gl_FragColor = vec4( 0.5 * normalize( normal ) + 0.5, opacity );","}"].join("\n")},o.bokehShader={attributes:{position:e.POSITION,uv:e.TEXCOORD0},uniforms:{viewMatrix:t.VIEW_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,tColor:t.DIFFUSE_MAP,tDepth:t.DEPTH_MAP,focus:1,aspect:1,aperture:.025,maxblur:1},vshader:["attribute vec3 position;","attribute vec2 uv;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( position, 1.0 );","}"].join("\n"),fshader:["varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float maxblur;","uniform float aperture;","uniform float focus;","uniform float aspect;","void main() {","vec2 aspectcorrect = vec2( 1.0, aspect );","vec4 depth1 = texture2D( tDepth, vUv );","float factor = depth1.x - focus;","vec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );","vec2 dofblur9 = dofblur * 0.9;","vec2 dofblur7 = dofblur * 0.7;","vec2 dofblur4 = dofblur * 0.4;","vec4 col = vec4( 0.0 );","col += texture2D( tColor, vUv.xy );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );","gl_FragColor = col / 41.0;","gl_FragColor.a = 1.0;","}"].join("\n")},o.particles={attributes:{vertexPosition:e.POSITION,vertexColor:e.COLOR,vertexUV0:e.TEXCOORD0},uniforms:{viewProjectionMatrix:t.VIEW_PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,diffuseMap:t.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec4 vertexColor;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","varying vec4 color;","void main(void) {","    texCoord0 = vertexUV0;","    color = vertexColor;","	 gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","varying vec2 texCoord0;","varying vec4 color;","void main(void)","{","	vec4 texCol = texture2D(diffuseMap, texCoord0);","   if (color.a == 0.0 || texCol.a == 0.0) discard;","	else gl_FragColor = texCol * color;","}"].join("\n")},o.sepia={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:t.VIEW_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,tDiffuse:t.DIFFUSE_MAP,amount:1},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform float amount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color = texture2D( tDiffuse, vUv );","vec3 c = color.rgb;","color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );","color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );","color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );","gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );","}"].join("\n")},o.dotscreen={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:t.VIEW_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,tDiffuse:t.DIFFUSE_MAP,tSize:[256,256],center:[.5,.5],angle:1.57,scale:1},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform vec2 center;","uniform float angle;","uniform float scale;","uniform vec2 tSize;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float pattern() {","float s = sin( angle ), c = cos( angle );","vec2 tex = vUv * tSize - center;","vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;","return ( sin( point.x ) * sin( point.y ) ) * 4.0;","}","void main() {","vec4 color = texture2D( tDiffuse, vUv );","float average = ( color.r + color.g + color.b ) / 3.0;","gl_FragColor = vec4( color.rgb * vec3( average * 10.0 - 5.0 + pattern() ), color.a );","}"].join("\n")},o.vignette={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:t.VIEW_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,tDiffuse:t.DIFFUSE_MAP,offset:1,darkness:1.5},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform float offset;","uniform float darkness;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );","gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );","}"].join("\n")},o.film={attributes:o.copy.attributes,uniforms:{tDiffuse:t.DIFFUSE_MAP,time:function(){return s.time},nIntensity:.5,sIntensity:.5,sCount:1024,grayscale:0,$link:o.copy.uniforms},vshader:o.copy.vshader,fshader:["uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","uniform sampler2D tDiffuse;","varying vec2 texCoord0;","void main() {","	vec4 cTextureScreen = texture2D( tDiffuse, texCoord0 );","	float x = texCoord0.x * texCoord0.y * time * 1000.0;","	x = mod( x, 13.0 ) * mod( x, 123.0 );","	float dx = mod( x, 0.01 );","	vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );","	vec2 sc = vec2( sin( texCoord0.y * sCount ), cos( texCoord0.y * sCount ) );","	cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","	cResult = cTextureScreen.rgb + nIntensity * ( cResult - cTextureScreen.rgb );","	if( grayscale ) {","		cResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );","	}","	gl_FragColor = vec4( cResult, cTextureScreen.a );","}"].join("\n")},o.noise={attributes:o.copy.attributes,uniforms:{tDiffuse:t.DIFFUSE_MAP,time:function(){return s.time},nIntensity:.5,grayscale:0,$link:o.copy.uniforms},vshader:o.copy.vshader,fshader:["uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform sampler2D tDiffuse;","varying vec2 texCoord0;","void main() {","	vec4 cTextureScreen = texture2D( tDiffuse, texCoord0 );","	float x = texCoord0.x * texCoord0.y * time * 1000.0;","	vec3 cResult;","	if ( !grayscale ) {","	float y = fract(sin(dot(vec2(mod( x + 20.0, 87.0 ), mod( x + 150.0, 23.0 )), vec2(12.9898,78.233))) * 43758.5453);","	float z = fract(sin(dot(vec2(mod( x + 30.0, 19.0 ), mod( x + 200.0, 103.0 )), vec2(12.9898,78.233))) * 43758.5453);","	x = fract(sin(dot(vec2(mod( x, 13.0 ), mod( x + 50.0, 123.0 )), vec2(12.9898,78.233))) * 43758.5453);","	cResult = vec3(x, y, z);","	} else {","	x = fract(sin(dot(vec2(mod( x, 13.0 ), mod( x + 50.0, 123.0 )), vec2(12.9898,78.233))) * 43758.5453);","	cResult = vec3(x);","	}","	gl_FragColor = vec4( mix(cTextureScreen.rgb, cResult, nIntensity), cTextureScreen.a );","}"].join("\n")},o.bleachbypass={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:t.VIEW_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,tDiffuse:t.DIFFUSE_MAP,opacity:1},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 base = texture2D( tDiffuse, vUv );","vec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );","float lum = dot( lumCoeff, base.rgb );","vec3 blend = vec3( lum );","float L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );","vec3 result1 = 2.0 * base.rgb * blend;","vec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );","vec3 newColor = mix( result1, result2, L );","float A2 = opacity * base.a;","vec3 mixRGB = A2 * newColor.rgb;","mixRGB += ( ( 1.0 - A2 ) * base.rgb );","gl_FragColor = vec4( mixRGB, base.a );","}"].join("\n")},o.horizontalTiltShift={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:t.VIEW_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,tDiffuse:t.DIFFUSE_MAP,h:1/128,r:.5},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform sampler2D tDiffuse;","uniform float h;","uniform float r;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float hh = h * abs( r - vUv.y );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x,            vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},o.colorify={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:t.VIEW_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,tDiffuse:t.DIFFUSE_MAP,color:[1,1,1],amount:1},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform vec3 color;","uniform float amount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( gl_FragColor.rgb, luma );","gl_FragColor.rgb = mix(gl_FragColor.rgb, v * color, amount);","}"].join("\n")},o.hatch={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:t.VIEW_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,tDiffuse:t.DIFFUSE_MAP,width:0,spread:10,replace:!0},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform sampler2D tDiffuse;","uniform float width;","uniform float spread;","uniform bool replace;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","float lum = length(gl_FragColor.rgb);","vec3 mult = vec3(1.0, 1.0, 1.0);","float halfSpread = (spread*0.5);","if (lum < 1.00) {","float diff = abs(mod(gl_FragCoord.x + gl_FragCoord.y, spread) - halfSpread);","if (diff <= width) {","mult *= vec3(1.0 - (width - diff) / width);","}","}","if (lum < 0.75) {","float diff = abs(mod(gl_FragCoord.x - gl_FragCoord.y, spread) - halfSpread);","if (diff <= width) {","mult *= vec3(1.0 - (width - diff) / width);","}","}","if (lum < 0.50) {","float diff = abs(mod(gl_FragCoord.x + halfSpread + gl_FragCoord.y, spread) - halfSpread);","if (diff <= width) {","mult *= vec3(1.0 - (width - diff) / width);","}","}","if (lum < 0.25) {","float diff = abs(mod(gl_FragCoord.x + halfSpread - gl_FragCoord.y, spread) - halfSpread);","if (diff <= width) {","mult *= vec3(1.0 - (width - diff) / width);","}","}","if (replace) {","gl_FragColor.rgb = mult;","} else {","gl_FragColor.rgb *= mult;","}","}"].join("\n")},o.normalmap={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:t.VIEW_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,heightMap:t.DIFFUSE_MAP,resolution:[512,512],height:.05},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform float height;","uniform vec2 resolution;","uniform sampler2D heightMap;","varying vec2 vUv;","void main() {","float val = texture2D( heightMap, vUv ).x;","float valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;","float valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;","gl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );","}"].join("\n")},o.ssao={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:t.VIEW_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,tDiffuse:t.DIFFUSE_MAP,tDepth:t.DEPTH_MAP,size:[512,512],cameraNear:t.MAIN_NEAR_PLANE,cameraFar:t.MAIN_FAR_PLANE,fogNear:t.MAIN_NEAR_PLANE,fogFar:t.MAIN_FAR_PLANE,fogEnabled:0,onlyAO:0,aoClamp:.3,lumInfluence:0},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform float cameraNear;","uniform float cameraFar;","uniform float fogNear;","uniform float fogFar;","uniform bool fogEnabled;","uniform bool onlyAO;","uniform vec2 size;","uniform float aoClamp;","uniform float lumInfluence;","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","varying vec2 vUv;","#define DL 2.399963229728653","#define EULER 2.718281828459045","float width = size.x;","float height = size.y;","float cameraFarPlusNear = cameraFar + cameraNear;","float cameraFarMinusNear = cameraFar - cameraNear;","float cameraCoef = 2.0 * cameraNear;","const int samples = 16;","const float radius = 2.0;","const bool useNoise = false;","const float noiseAmount = 0.0003;","const float diffArea = 0.4;","const float gDisplace = 0.4;","const vec3 onlyAOColor = vec3( 1.0, 1.0, 1.0 );","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","vec2 rand( const vec2 coord ) {","vec2 noise;","if ( useNoise ) {","float nx = dot ( coord, vec2( 12.9898, 78.233 ) );","float ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );","noise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );","} else {","float ff = fract( 1.0 - coord.s * ( width / 2.0 ) );","float gg = fract( coord.t * ( height / 2.0 ) );","noise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;","}","return ( noise * 2.0  - 1.0 ) * noiseAmount;","}","float doFog() {","float zdepth = unpackDepth( texture2D( tDepth, vUv ) );","float depth = -cameraFar * cameraNear / ( zdepth * cameraFarMinusNear - cameraFar );","return smoothstep( fogNear, fogFar, depth );","}","float readDepth( const in vec2 coord ) {","return cameraCoef / ( cameraFarPlusNear - unpackDepth( texture2D( tDepth, coord ) ) * cameraFarMinusNear );","}","float compareDepths( const in float depth1, const in float depth2, inout int far ) {","float garea = 2.0;","float diff = ( depth1 - depth2 ) * 100.0;","if ( diff < gDisplace ) {","garea = diffArea;","} else {","far = 1;","}","float dd = diff - gDisplace;","float gauss = pow( EULER, -2.0 * dd * dd / ( garea * garea ) );","return gauss;","}","float calcAO( float depth, float dw, float dh ) {","float dd = radius - depth * radius;","vec2 vv = vec2( dw, dh );","vec2 coord1 = vUv + dd * vv;","vec2 coord2 = vUv - dd * vv;","float temp1 = 0.0;","float temp2 = 0.0;","int far = 0;","temp1 = compareDepths( depth, readDepth( coord1 ), far );","if ( far > 0 ) {","temp2 = compareDepths( readDepth( coord2 ), depth, far );","temp1 += ( 1.0 - temp1 ) * temp2;","}","return temp1;","}","void main() {","vec2 noise = rand( vUv );","float depth = readDepth( vUv );","float tt = clamp( depth, aoClamp, 1.0 );","float w = ( 1.0 / width )  / tt + ( noise.x * ( 1.0 - noise.x ) );","float h = ( 1.0 / height ) / tt + ( noise.y * ( 1.0 - noise.y ) );","float pw;","float ph;","float ao;","float dz = 1.0 / float( samples );","float z = 1.0 - dz / 2.0;","float l = 0.0;","for ( int i = 0; i <= samples; i ++ ) {","float r = sqrt( 1.0 - z );","pw = cos( l ) * r;","ph = sin( l ) * r;","ao += calcAO( depth, pw * w, ph * h );","z = z - dz;","l = l + DL;","}","ao /= float( samples );","ao = 1.0 - ao;","if ( fogEnabled ) {","ao = mix( ao, 1.0, doFog() );","}","vec3 color = texture2D( tDiffuse, vUv ).rgb;","vec3 lumcoeff = vec3( 0.299, 0.587, 0.114 );","float lum = dot( color.rgb, lumcoeff );","vec3 luminance = vec3( lum );","vec3 final = vec3( color * mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );","if ( onlyAO ) {","final = onlyAOColor * vec3( mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );","}","gl_FragColor = vec4( final, 1.0 );","}"].join("\n")},o.skinning={defines:{JOINT_COUNT:56,WEIGHTS:4},attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0,vertexWeights:e.WEIGHTS,vertexJointIDs:e.JOINTIDS},uniforms:{viewProjectionMatrix:t.VIEW_PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,diffuseMap:t.DIFFUSE_MAP,jointPalette:function(e){var t=e.meshData,n=t.currentPose;if(n){var r=n._matrixPalette,i=t.paletteMap.length*16,s=t.store;s||(s=new Float32Array(i),t.store=s);var o;for(var u=0;u<t.paletteMap.length;u++){o=r[t.paletteMap[u]];for(var a=0;a<4;a++)for(var f=0;f<4;f++)s[u*16+a*4+f]=o.data[f*4+a]}return s}}},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","attribute vec4 vertexWeights;","attribute vec4 vertexJointIDs;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform mat4 jointPalette[JOINT_COUNT];","varying vec2 texCoord0;","void main(void) {","	mat4 mat = mat4(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);","	mat += jointPalette[int(vertexJointIDs.x)] * vertexWeights.x;","	mat += jointPalette[int(vertexJointIDs.y)] * vertexWeights.y;","	mat += jointPalette[int(vertexJointIDs.z)] * vertexWeights.z;","	mat += jointPalette[int(vertexJointIDs.w)] * vertexWeights.w;","	texCoord0 = vertexUV0;","	gl_Position = viewProjectionMatrix * worldMatrix * mat * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","varying vec2 texCoord0;","void main(void)","{","	gl_FragColor = texture2D(diffuseMap, texCoord0);","}"].join("\n")},o.rgbshift={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:t.VIEW_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,tDiffuse:t.DIFFUSE_MAP,amount:.005,angle:0},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform sampler2D tDiffuse;","uniform float amount;","uniform float angle;","varying vec2 vUv;","void main() {","vec2 offset = amount * vec2( cos(angle), sin(angle));","vec4 cr = texture2D(tDiffuse, vUv + offset);","vec4 cga = texture2D(tDiffuse, vUv);","vec4 cb = texture2D(tDiffuse, vUv - offset);","gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","}"].join("\n")},o.brightnesscontrast={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:t.VIEW_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,tDiffuse:t.DIFFUSE_MAP,brightness:0,contrast:0,saturation:0},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform sampler2D tDiffuse;","uniform float brightness;","uniform float contrast;","uniform float saturation;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","gl_FragColor.rgb += brightness;","if (contrast > 0.0) {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;","} else {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;","}","vec3 gray = vec3(dot(vec3(0.2126,0.7152,0.0722), gl_FragColor.rgb));","gl_FragColor.rgb = mix(gl_FragColor.rgb, gray, -saturation);","}"].join("\n")},o.hsb={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:t.VIEW_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,tDiffuse:t.DIFFUSE_MAP,hue:0,saturation:0,brightness:0},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform sampler2D tDiffuse;","uniform float hue;","uniform float saturation;","uniform float brightness;","varying vec2 vUv;",n.methods.hsv,"void main() {","gl_FragColor = texture2D(tDiffuse, vUv);","vec3 fragHSV = rgb2hsv(gl_FragColor.rgb).xyz;","fragHSV.x += hue * 0.5;","fragHSV.y *= saturation + 1.0 - max(brightness, 0.0) * 2.0;","fragHSV.z *= min(brightness + 1.0, 1.0);","fragHSV.z += max(brightness, 0.0);","fragHSV.xyz = clamp(fragHSV.xyz, vec3(-10.0, 0.0, 0.0), vec3(10.0, 1.0, 1.0));","gl_FragColor.rgb = hsv2rgb(fragHSV);","}"].join("\n")},o.luminosity={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:t.VIEW_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,tDiffuse:t.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","gl_FragColor = vec4( v, v, v, texel.w );","}"].join("\n")},o.point={attributes:{vertexPosition:e.POSITION,vertexColor:e.COLOR},uniforms:{viewProjectionMatrix:t.VIEW_PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,pointSize:2},vshader:["attribute vec3 vertexPosition;","attribute vec4 vertexColor;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform float pointSize;","varying vec4 color;","void main(void) {","	color = vertexColor;","	gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","	gl_PointSize = pointSize;","}"].join("\n"),fshader:["varying vec4 color;","void main(void)","{","	gl_FragColor = color;","}"].join("\n")},o.toon={attributes:{vertexPosition:e.POSITION,vertexNormal:e.NORMAL},uniforms:{viewMatrix:t.VIEW_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,cameraPosition:t.CAMERA,lightPosition:t.LIGHT0,HighlightColour:[.9,.8,.7,1],MidColour:[.65,.55,.45,1],ShadowColour:[.4,.3,.2,1],HighlightSize:.2,ShadowSize:.01,OutlineWidth:.15},vshader:["attribute vec3 vertexPosition;","attribute vec3 vertexNormal;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;","uniform vec3 lightPosition;","varying vec3 N;","varying vec3 V;","varying vec3 L;","void main()","{","	vec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);","	N = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;","	L = lightPosition - worldPos.xyz;","	V = cameraPosition - worldPos.xyz;","	gl_Position = projectionMatrix * viewMatrix * worldPos;","}"].join("\n"),fshader:["uniform vec4 HighlightColour;","uniform vec4 MidColour;","uniform vec4 ShadowColour;","uniform float HighlightSize;","uniform float ShadowSize;","uniform float OutlineWidth;","varying vec3 N;","varying vec3 L;","varying vec3 V;","void main()","{","	vec3 n = normalize(N);","	vec3 l = normalize(L);","	vec3 v = normalize(V);","    float lambert = dot(l,n);","    vec4 colour = MidColour;","    if (lambert > 1.0 - HighlightSize) colour = HighlightColour;","    if (lambert < ShadowSize) colour = ShadowColour;","    if (dot(n,v) < OutlineWidth) colour = vec4(0.0,0.0,0.0,1.0);","    gl_FragColor = colour;","}"].join("\n")},o.differenceOfGaussians={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:t.VIEW_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,gaussBlurredImage1:"BLUR1",gaussBlurredImage2:"BLUR2",originalImage:"ORIGINAL",threshold:.01},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","void main(void) {","	texCoord0 = vertexUV0;","	gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform sampler2D gaussBlurredImage1;","uniform sampler2D gaussBlurredImage2;","uniform sampler2D originalImage;","uniform float threshold;","varying vec2 texCoord0;","void main(void)","{","	vec4 blur1 = texture2D(gaussBlurredImage1, texCoord0);","	vec4 blur2 = texture2D(gaussBlurredImage2, texCoord0);","	vec4 originalColor = texture2D(originalImage, texCoord0);","	vec3 col = clamp(blur1.rgb - blur2.rgb, 0.0, 1.0);","	float value = (col.r + col.g + col.b) / 3.0;","	value = step(threshold, value);","	vec3 outputColor = mix(originalColor.rgb, vec3(value), value);","	gl_FragColor = vec4(outputColor, 1.0);","}"].join("\n")},o.downsample={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:t.VIEW_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,tDiffuse:t.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","}"].join("\n")},o.boxfilter={attributes:{vertexPosition:e.POSITION,vertexUV0:e.TEXCOORD0},uniforms:{viewMatrix:t.VIEW_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,tDiffuse:t.DIFFUSE_MAP,viewport:[128,128]},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform sampler2D tDiffuse;","uniform vec2 viewport;","varying vec2 vUv;","void main() {","vec3 result = vec3(0.0);","for(int x=-1; x<=1; x++) {","	for(int y=-1; y<=1; y++) {","		result += texture2D(tDiffuse, vUv + vec2(x, y) / viewport).rgb;","	}","}","gl_FragColor = vec4(result / vec3(9.0), 1.0);","}"].join("\n")},o.lightDepth={processors:[r.animation.processor],defines:{SHADOW_TYPE:0,WEIGHTS:!0,JOINTIDS:!0},attributes:{vertexPosition:e.POSITION,vertexJointIDs:e.JOINTIDS,vertexWeights:e.WEIGHTS},uniforms:{viewMatrix:t.VIEW_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,cameraScale:t.MAIN_DEPTH_SCALE},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec4 worldPosition;",r.animation.prevertex,"void main(void) {","mat4 wMatrix = worldMatrix;",r.animation.vertex,"worldPosition = viewMatrix * wMatrix * vec4(vertexPosition, 1.0);","gl_Position = projectionMatrix * worldPosition;","}"].join("\n"),fshader:["uniform float cameraScale;","varying vec4 worldPosition;","void main(void)","{","float linearDepth = length(worldPosition) * cameraScale;","#if SHADOW_TYPE == 0","gl_FragColor = vec4(linearDepth);","#elif SHADOW_TYPE == 1","gl_FragColor = vec4(linearDepth);","#elif SHADOW_TYPE == 2","gl_FragColor = vec4(linearDepth, linearDepth * linearDepth, 0.0, 0.0);","#endif","}"].join("\n")},o.packDepth={attributes:{vertexPosition:e.POSITION},uniforms:{viewMatrix:t.VIEW_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,farPlane:t.FAR_PLANE},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec4 vPosition;","void main(void) {","	vPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","	gl_Position = projectionMatrix * vPosition;","}"].join("\n"),fshader:["uniform float farPlane;",n.methods.packDepth,"varying vec4 vPosition;","void main(void)","{","	float linearDepth = min(length(vPosition), farPlane) / farPlane;","	gl_FragColor = packDepth(linearDepth);","}"].join("\n")},o.pickingShader={defines:{WEIGHTS:!0,JOINTIDS:!0},attributes:{vertexPosition:e.POSITION,vertexJointIDs:e.JOINTIDS,vertexWeights:e.WEIGHTS},uniforms:{viewMatrix:t.VIEW_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,cameraFar:t.FAR_PLANE,id:function(e){return e.renderable.id+1}},processors:[r.animation.processor],vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform float cameraFar;",r.animation.prevertex,"varying float depth;","void main() {","mat4 wMatrix = worldMatrix;",r.animation.vertex,"vec4 mvPosition = viewMatrix * wMatrix * vec4( vertexPosition, 1.0 );","depth = length(mvPosition.xyz) / cameraFar;","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fshader:["uniform float id;","varying float depth;",n.methods.packDepth16,"void main() {","vec2 packedId = vec2(floor(id/255.0), mod(id, 255.0)) * vec2(1.0/255.0);","vec2 packedDepth = packDepth16(depth);","gl_FragColor = vec4(packedId, packedDepth);","}"].join("\n")},o}),define("goo/util/rsvp",["exports"],function(e){function v(e,n){t.async(function(){e.trigger("promise:resolved",{detail:n}),e.isResolved=!0,e.resolvedValue=n})}function m(e,n){t.async(function(){e.trigger("promise:failed",{detail:n}),e.isRejected=!0,e.rejectedValue=n})}function g(e){var t,n=[],r=new h,i=e.length;i===0&&r.resolve([]);var s=function(e,t){n[e]=t,--i===0&&r.resolve(n)},o=function(e){return function(t){s(e,t)}},u=function(e){r.reject(e)};for(t=0;t<i;t++)e[t].then(o(t),u);return r}function y(e,n){t[e]=n}var t={},n=typeof window!="undefined"?window:{},r=n.MutationObserver||n.WebKitMutationObserver,i=window.process;if(typeof i!="undefined"&&{}.toString.call(i)==="[object process]")t.async=function(e,t){i.nextTick(function(){e.call(t)})};else if(r){var s=[],o=new r(function(){var e=s.slice();s=[],e.forEach(function(e){var t=e[0],n=e[1];t.call(n)})}),u=document.createElement("div");o.observe(u,{attributes:!0}),window.addEventListener("unload",function(){o.disconnect(),o=null}),t.async=function(e,t){s.push([e,t]),u.setAttribute("drainQueue","drainQueue")}}else t.async=function(e,t){setTimeout(function(){e.call(t)},1)};var a=function(e,t){this.type=e;for(var n in t){if(!t.hasOwnProperty(n))continue;this[n]=t[n]}},f=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n][0]===t)return n;return-1},l=function(e){var t=e._promiseCallbacks;return t||(t=e._promiseCallbacks={}),t},c={mixin:function(e){return e.on=this.on,e.off=this.off,e.trigger=this.trigger,e},on:function(e,t,n){var r=l(this),i,s;e=e.split(/\s+/),n=n||this;while(s=e.shift())i=r[s],i||(i=r[s]=[]),f(i,t)===-1&&i.push([t,n])},off:function(e,t){var n=l(this),r,i,s;e=e.split(/\s+/);while(i=e.shift()){if(!t){n[i]=[];continue}r=n[i],s=f(r,t),s!==-1&&r.splice(s,1)}},trigger:function(e,t){var n=l(this),r,i,s,o,u;if(r=n[e])for(var f=0,c=r.length;f<c;f++)i=r[f],s=i[0],o=i[1],typeof t!="object"&&(t={detail:t}),u=new a(e,t),s.call(o,u)}},h=function(){this.on("promise:resolved",function(e){this.trigger("success",{detail:e.detail})},this),this.on("promise:failed",function(e){this.trigger("error",{detail:e.detail})},this)},p=function(){},d=function(e,t,n,r){var i=typeof n=="function",s,o,u,a;if(i)try{s=n(r.detail),u=!0}catch(f){a=!0,o=f}else s=r.detail,u=!0;s&&typeof s.then=="function"?s.then(function(e){t.resolve(e)},function(e){t.reject(e)}):i&&u?t.resolve(s):a?t.reject(o):t[e](s)};h.prototype={then:function(e,n){var r=new h;return this.isResolved&&t.async(function(){d("resolve",r,e,{detail:this.resolvedValue})},this),this.isRejected&&t.async(function(){d("reject",r,n,{detail:this.rejectedValue})},this),this.on("promise:resolved",function(t){d("resolve",r,e,t)}),this.on("promise:failed",function(e){d("reject",r,n,e)}),r},resolve:function(e){v(this,e),this.resolve=p,this.reject=p},reject:function(e){m(this,e),this.resolve=p,this.reject=p}},c.mixin(h.prototype),e.Promise=h,e.Event=a,e.EventTarget=c,e.all=g,e.configure=y}),define("goo/util/Ajax",["goo/util/rsvp"],function(e){function t(e){this._loadStack=[],this._callback=e}return t.prototype.get=function(t){var n=new e.Promise,r=this._progress.bind(this),i={loaded:0,total:0,lengthComputable:!1};this._loadStack.push(i),t=t||{};var s=t.url||"",o="GET",u=!0,a=new XMLHttpRequest;return a.open(o,s,u),t.responseType&&(a.responseType=t.responseType),a.onreadystatechange=function(){a.readyState===4&&(a.status>=200&&a.status<=299?(i.loaded=i.total,r(),n.resolve(a)):n.reject(a.statusText))},a.addEventListener("progress",function(e){i.loaded=e.loaded||e.position,i.total=e.total||e.totalSize,i.lengthComputable=e.lengthComputable,r()},!1),a.send(),n},t.prototype._progress=function(){if(this._callback){var e={total:0,loaded:0,count:this._loadStack.length};for(var t=0;t<this._loadStack.length;t++)e.total+=this._loadStack[t].total,e.loaded+=this._loadStack[t].loaded;this._callback(e)}},t.ARRAY_BUFFER="arraybuffer",t.prototype.load=function(e,n){if(typeof e=="undefined"||e===null)throw new Error("Ajax(): `path` was undefined/null");var r={url:e};n===t.ARRAY_BUFFER&&(r.responseType=t.ARRAY_BUFFER);var i=this.get(r).then(function(e){return e.response});return i.then(null,function(e){throw console.error("Ajax.load(): Could not retrieve data from `"+r.url+"`.\n Reason: "+e),new Error("Ajax.load(): Could not retrieve data from `"+r.url+"`.\n Reason: "+e)}),i},t.prototype.loadImage=function(n,r){window.URL=window.URL||window.webkitURL;var i=new e.Promise,s=new Image;return s.addEventListener("load",function(){s.dataReady=!0,window.URL&&window.URL.revokeObjectURL!=undefined&&window.URL.revokeObjectURL(s.src),i.resolve(s)},!1),s.addEventListener("error",function(e){console.log(e),i.reject("Ajax.loadImage(): Couldn't load from ["+n+"]")},!1),r?this.load(n,function(e){var t=new Uint8Array(e,0,e.byteLength),r="image/jpeg";/\.png$/.test(n)&&(r="image/png");var i=new Blob([t],{type:r});return s.src=window.URL.createObjectURL(i),s},t.ARRAY_BUFFER):s.src=n,i},t}),define("goo/loaders/Loader",["goo/util/rsvp","goo/util/Ajax"],function(e,t){function n(e){if(typeof e!="undefined"&&e!==null&&typeof e!="object")throw new Error("Loader(): Argument `parameters` must be of type `object`");if(typeof e=="undefined"||e===null)e={};this.rootPath=e.rootPath||"",this.xhr=e.xhr||new t(this._progressCallback.bind(this)),this._progressCallbacks=[],this.total=0}return n.prototype.load=function(e,t,r){if(typeof e=="undefined"||e===null)throw new Error("Loader(): `path` was undefined/null");var i={url:this._buildURL(e)};r===n.ARRAY_BUFFER&&(i.responseType=n.ARRAY_BUFFER);var s=this.xhr.get(i).then(function(e){return e.response});return t&&(s=s.then(function(e){return typeof t=="function"?t(e):e})),s.then(function(){console.log("Loaded: "+i.url)}),s.then(null,function(e){throw console.error("Loader.load(): Could not retrieve data from `"+i.url+"`.\n Reason: "+e),new Error("Loader.load(): Could not retrieve data from `"+i.url+"`.\n Reason: "+e)}),s},n.prototype.addProgressCallback=function(e){this._progressCallbacks.push(e)},n.prototype.removeProgressCallback=function(e){for(var t=0;t<this._progressCallbacks.length;t++)if(this._progressCallbacks[t]===e){this._progressCallbacks.splice(t,1);break}},n.prototype._progressCallback=function(e){this.total&&(e.total=this.total);for(var t=0;t<this._progressCallbacks.length;t++)this._progressCallbacks[t](e)},n.prototype.loadImage=function(t,r){window.URL=window.URL||window.webkitURL;var i=new e.Promise,s=new Image;return s.addEventListener("load",function(){s.dataReady=!0,window.URL&&window.URL.revokeObjectURL!=undefined&&window.URL.revokeObjectURL(s.src),i.resolve(s)},!1),s.addEventListener("error",function(){i.reject("Loader.loadImage(): Couldn't load from ["+t+"]")},!1),r?this.load(t,function(e){var n=new Uint8Array(e,0,e.byteLength),r="image/jpeg";/\.png$/.test(t)&&(r="image/png");var i=new Blob([n],{type:r});s.src=window.URL.createObjectURL(i)},n.ARRAY_BUFFER):s.src=this._buildURL(t),i},n.prototype._buildURL=function(e){return this.rootPath+window.escape(e)},n.ARRAY_BUFFER="arraybuffer",n}),define("goo/loaders/dds/DdsUtils",[],function(){function e(){}return e.getDdsExtension=function(e){var t=["","WEBKIT_","MOZ_"];for(var n=0;n<t.length;n++){var r=e.getExtension(t[n]+"WEBGL_compressed_texture_s3tc");if(typeof r!="undefined"&&r!==null)return r}return null},e.isSupported=function(t){return e.getDdsExtension(t)!==null},e.shiftCount=function(e){if(e===0)return 0;var t=0;while((e&1)===0){e>>=1,t++;if(t>32)throw"invalid mask!"}return t},e.isSet=function(e,t){return(e&t)===t},e.getIntFromString=function(t){var n=[];for(var r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return e.getIntFromBytes(n)},e.getIntFromBytes=function(e){var t=0;return t|=(e[0]&255)<<0,e.length>1&&(t|=(e[1]&255)<<8),e.length>2&&(t|=(e[2]&255)<<16),e.length>3&&(t|=(e[3]&255)<<24),t},e.getComponents=function(e){switch(e){case"Alpha":return 1;case"RGB":return 3;case"RGBA":return 4;case"Luminance":return 1;case"LuminanceAlpha":return 2;case"PrecompressedDXT1":return 1;case"PrecompressedDXT1A":return 1;case"PrecompressedDXT3":return 2;case"PrecompressedDXT5":return 2}return 0},e.flipDXT=function(t,n,r,i){var s=new Uint8Array(t.length),o=n+3>>2,u=r+3>>2,a=e.getComponents(i)*8;for(var f=0;f<u;f++){var l=u-f-1;for(var c=0;c<o;c++){var h=(l*o+c)*a,p=(f*o+c)*a;switch(i){case"PrecompressedDXT1":case"PrecompressedDXT1A":s[h+0]=t[p+0],s[h+1]=t[p+1],s[h+2]=t[p+2],s[h+3]=t[p+3],s[h+4]=t[p+7],s[h+5]=t[p+6],s[h+6]=t[p+5],s[h+7]=t[p+4];break;case"PrecompressedDXT3":s[h+0]=t[p+6],s[h+1]=t[p+7],s[h+2]=t[p+4],s[h+3]=t[p+5],s[h+4]=t[p+2],s[h+5]=t[p+3],s[h+6]=t[p+0],s[h+7]=t[p+1],s[h+8]=t[p+8],s[h+9]=t[p+9],s[h+10]=t[p+10],s[h+11]=t[p+11],s[h+12]=t[p+15],s[h+13]=t[p+14],s[h+14]=t[p+13],s[h+15]=t[p+12];break;case"PrecompressedDXT5":s[h+0]=t[p+0],s[h+1]=t[p+1],e.getBytesFromUInt24(s,h+5,e.flipUInt24(e.getUInt24(t,p+2))),e.getBytesFromUInt24(s,h+2,e.flipUInt24(e.getUInt24(t,p+5))),s[h+8]=t[p+8],s[h+9]=t[p+9],s[h+10]=t[p+10],s[h+11]=t[p+11],s[h+12]=t[p+15],s[h+13]=t[p+14],s[h+14]=t[p+13],s[h+15]=t[p+12]}}}return s},e.getUInt24=function(e,t){var n=0;return n|=(e[t+0]&255)<<0,n|=(e[t+1]&255)<<8,n|=(e[t+2]&255)<<16,n},e.getBytesFromUInt24=function(e,t,n){e[t+0]=n&255,e[t+1]=(n&65280)>>8,e[t+2]=(n&16711680)>>16},e.ThreeBitMask=7,e.flipUInt24=function(t){var n=[];for(var r=0;r<2;r++)n.push([0,0,0,0]);n[0][0]=t&e.ThreeBitMask,t>>=3,n[0][1]=t&e.ThreeBitMask,t>>=3,n[0][2]=t&e.ThreeBitMask,t>>=3,n[0][3]=t&e.ThreeBitMask,t>>=3,n[1][0]=t&e.ThreeBitMask,t>>=3,n[1][1]=t&e.ThreeBitMask,t>>=3,n[1][2]=t&e.ThreeBitMask,t>>=3,n[1][3]=t&e.ThreeBitMask;var i=0;return i|=n[1][0]<<0,i|=n[1][1]<<3,i|=n[1][2]<<6,i|=n[1][3]<<9,i|=n[0][0]<<12,i|=n[0][1]<<15,i|=n[0][2]<<18,i|=n[0][3]<<21,i},e}),define("goo/loaders/dds/DdsLoader",["goo/loaders/dds/DdsUtils"],function(e){function t(){this.dwSize=0,this.dwFlags=0,this.dwFourCC=0,this.dwRGBBitCount=0,this.dwRBitMask=0,this.dwGBitMask=0,this.dwBBitMask=0,this.dwABitMask=0}function n(){this.dwSize=0,this.dwFlags=0,this.dwHeight=0,this.dwWidth=0,this.dwLinearSize=0,this.dwDepth=0,this.dwMipMapCount=0,this.dwAlphaBitDepth=0,this.dwReserved1=[],this.ddpf=null,this.dwCaps=0,this.dwCaps2=0,this.dwCaps3=0,this.dwCaps4=0,this.dwTextureStage=0}function r(){this.flipVertically=!1,this.bpp=0,this.header=null,this.headerDX10=null,this.mipmapByteSizes=[]}function i(){}return t.HEADER_OFFSET=19,t.DDPF_ALPHAPIXELS=1,t.DDPF_ALPHA=2,t.DDPF_FOURCC=4,t.DDPF_RGB=64,t.DDPF_YUV=512,t.DDPF_LUMINANCE=131072,t.read=function(e){var n=new t;n.dwSize=e[t.HEADER_OFFSET+0];if(n.dwSize!==32)throw"invalid pixel format size: "+n.dwSize;return n.dwFlags=e[t.HEADER_OFFSET+1],n.dwFourCC=e[t.HEADER_OFFSET+2],n.dwRGBBitCount=e[t.HEADER_OFFSET+3],n.dwRBitMask=e[t.HEADER_OFFSET+4],n.dwGBitMask=e[t.HEADER_OFFSET+5],n.dwBBitMask=e[t.HEADER_OFFSET+6],n.dwABitMask=e[t.HEADER_OFFSET+7],n},n.DDSD_CAPS=1,n.DDSD_HEIGHT=2,n.DDSD_WIDTH=4,n.DDSD_PITCH=8,n.DDSD_PIXELFORMAT=4096,n.DDSD_MIPMAPCOUNT=131072,n.DDSD_LINEARSIZE=524288,n.DDSD_DEPTH=8388608,n.DDSCAPS_COMPLEX=8,n.DDSCAPS_MIPMAP=4194304,n.DDSCAPS_TEXTURE=4096,n.DDSCAPS2_CUBEMAP=512,n.DDSCAPS2_CUBEMAP_POSITIVEX=1024,n.DDSCAPS2_CUBEMAP_NEGATIVEX=2048,n.DDSCAPS2_CUBEMAP_POSITIVEY=4096,n.DDSCAPS2_CUBEMAP_NEGATIVEY=8192,n.DDSCAPS2_CUBEMAP_POSITIVEZ=16384,n.DDSCAPS2_CUBEMAP_NEGATIVEZ=32768,n.DDSCAPS2_VOLUME=2097152,n.read=function(r){var i=new n;i.dwSize=r[1];if(i.dwSize!==124)throw"invalid dds header size: "+i.dwSize;i.dwFlags=r[2],i.dwHeight=r[3],i.dwWidth=r[4],i.dwLinearSize=r[5],i.dwDepth=r[6],i.dwMipMapCount=r[7],i.dwAlphaBitDepth=r[8];for(var s=0;s<i.dwReserved1.length;s++)i.dwReserved1[s]=r[9+s];i.ddpf=t.read(r),i.dwCaps=r[27],i.dwCaps2=r[28],i.dwCaps3=r[29],i.dwCaps4=r[30],i.dwTextureStage=r[31];var o=1+Math.ceil(Math.log(Math.max(i.dwHeight,i.dwWidth))/Math.log(2));return e.isSet(i.dwCaps,n.DDSCAPS_MIPMAP)?e.isSet(i.dwFlags,n.DDSD_MIPMAPCOUNT)?i.dwMipMapCount!==o&&console.warn("Got "+i.dwMipMapCount+" mipmaps, expected "+o):i.dwMipMapCount=o:i.dwMipMapCount=1,i},r.prototype.calcMipmapSizes=function(e){var t=this.header.dwWidth,n=this.header.dwHeight,r=0;for(var i=0;i<this.header.dwMipMapCount;i++)r=e?~~((t+3)/4)*~~((n+3)/4)*this.bpp*2:~~(t*n*this.bpp/8),this.mipmapByteSizes.push(~~((r+3)/4)*4),t=~~(t/2)>1?~~(t/2):1,n=~~(n/2)>1?~~(n/2):1},i.updateDepth=function(t,r){if(e.isSet(r.header.dwCaps2,n.DDSCAPS2_CUBEMAP)){var i=0;e.isSet(r.header.dwCaps2,n.DDSCAPS2_CUBEMAP_POSITIVEX)&&i++,e.isSet(r.header.dwCaps2,n.DDSCAPS2_CUBEMAP_NEGATIVEX)&&i++,e.isSet(r.header.dwCaps2,n.DDSCAPS2_CUBEMAP_POSITIVEY)&&i++,e.isSet(r.header.dwCaps2,n.DDSCAPS2_CUBEMAP_NEGATIVEY)&&i++,e.isSet(r.header.dwCaps2,n.DDSCAPS2_CUBEMAP_POSITIVEZ)&&i++,e.isSet(r.header.dwCaps2,n.DDSCAPS2_CUBEMAP_NEGATIVEZ)&&i++;if(i!==6)throw new Error("Cubemaps without all faces defined are not currently supported.");t.depth=i}else t.depth=r.header.dwDepth>0?r.header.dwDepth:1},i.readDXT=function(t,n,r,i){i.image.isCompressed=!0;if(!r.flipVertically)return new Uint8Array(t.buffer,t.byteOffset+0,n);var s=r.header.dwWidth,o=r.header.dwHeight,u=new Uint8Array(n),a=0;for(var f=0;f<r.header.dwMipMapCount;f++){var l=t.subarray(a,a+r.mipmapByteSizes[f]),c=e.flipDXT(l,s,o,i.format);u.set(c,a),a+=c.length,s=~~(s/2)>1?~~(s/2):1,o=~~(o/2)>1?~~(o/2):1}return u},i.readUncompressed=function(t,n,r,i,s,o,u,a){var f=e.shiftCount(u.header.ddpf.dwRBitMask),l=e.shiftCount(u.header.ddpf.dwGBitMask),c=e.shiftCount(u.header.ddpf.dwBBitMask),h=e.shiftCount(u.header.ddpf.dwABitMask),p=~~(u.header.ddpf.dwRGBBitCount/8),d=e.getComponents(a.format)*1,v=new Uint8Array(n),m=u.header.dwWidth,g=u.header.dwHeight,y=0,b=0,w=0,E=[];for(w=0;w<p;w++)E.push(0);for(var S=0;S<u.header.dwMipMapCount;S++){for(var x=0;x<g;x++)for(var T=0;T<m;T++){for(w=0;w<p;w++)E[w]=t[b++];w=e.getIntFromBytes(E);var N=(w&u.header.ddpf.dwRBitMask)>>f,C=(w&u.header.ddpf.dwGBitMask)>>l,k=(w&u.header.ddpf.dwBBitMask)>>c,L=(w&u.header.ddpf.dwABitMask)>>h;s?v[y++]=L:i?(v[y++]=N,o&&(v[y++]=L)):r&&(v[y++]=N,v[y++]=C,v[y++]=k,o&&(v[y++]=L))}y+=m*g*d,m=~~(m/2)>1?~~(m/2):1,g=~~(g/2)>1?~~(g/2):1}return v},i.populate=function(n,r,s){var o=r.header.ddpf.dwFlags,u=e.isSet(o,t.DDPF_FOURCC),a=e.isSet(o,t.DDPF_RGB),f=e.isSet(o,t.DDPF_ALPHAPIXELS),l=e.isSet(o,t.DDPF_LUMINANCE),c=e.isSet(o,t.DDPF_ALPHA);n.type="UnsignedByte";if(u){var h=r.header.ddpf.dwFourCC;if(h===e.getIntFromString("DXT1"))r.bpp=4,n.format="PrecompressedDXT1A";else if(h===e.getIntFromString("DXT3"))r.bpp=8,n.format="PrecompressedDXT3";else{if(h!==e.getIntFromString("DXT5"))throw h===e.getIntFromString("DX10")?new Error("dxt10 LATC formats not supported currently: "+r.headerDX10.dxgiFormat):h===e.getIntFromString("DXT2")?"DXT2 is not supported.":h===e.getIntFromString("DXT4")?"DXT4 is not supported.":"unsupported compressed dds format found ("+h+")";r.bpp=8,n.format="PrecompressedDXT5"}}else{r.bpp=r.header.ddpf.dwRGBBitCount;if(a)f?n.format="RGBA":n.format="RGB";else{if(!l&&!f)throw new Error("unsupported uncompressed dds format found.");l&&f?n.format="LuminanceAlpha":l?n.format="Luminance":c&&(n.format="Alpha")}}r.calcMipmapSizes(u),n.image.mipmapSizes=r.mipmapByteSizes;var p=0;for(var d=0;d<r.mipmapByteSizes.length;d++)p+=r.mipmapByteSizes[d];var v=[];for(var d=0;d<n.image.depth;d++)u?v.push(i.readDXT(s,p,r,n)):(a||l||c)&&v.push(i.readUncompressed(s,p,a,l,c,f,r,n));n.image.data=n.image.depth===1?v[0]:v,n.image.useArrays=!0},i.prototype.load=function(t,s,o,u,a){var f=new Int32Array(t,u+0,32),l=f[0];if(l!==e.getIntFromString("DDS "))throw"Not a dds file.";var c=new r;c.flipVertically=o,c.header=n.read(f),c.headerDX10=c.header.ddpf.dwFourCC===e.getIntFromString("DX10")?n.read(Int32Array.create(t,u+128,5)):null;var h=s.image;if(typeof h=="undefined"||h===null)h={},s.image=h;h.width=c.header.dwWidth,h.height=c.header.dwHeight,i.updateDepth(h,c);var p=128+(c.headerDX10?20:0);i.populate(s,c,new Uint8Array(t,u+p,a-p));if(!c.mipmapByteSizes||c.mipmapByteSizes.length<2)s.minFilter="BilinearNoMipMaps";h.bpp=c.bpp,h.dataReady=!0,s.needsUpdate=!0},i.SUPPORTS_DDS=!1,i.prototype.isSupported=function(){return i.SUPPORTS_DDS},i.prototype.toString=function(){return"DdsLoader"},i}),define("goo/loaders/crunch/CrunchLoader",["goo/loaders/dds/DdsLoader","goo/loaders/dds/DdsUtils"],function(e,t){function n(){}return n.cCRNFmtDXT1=0,n.cCRNFmtDXT3=1,n.cCRNFmtDXT5=2,n.prototype.arrayBufferCopy=function(e,t,n,r){var i=n/4,s=r%4,o=new Uint32Array(e.buffer,0,(r-s)/4),u=new Uint32Array(t.buffer),a;for(a=0;a<o.length;a++)u[i+a]=o[a];for(a=r-s;a<r;a++)t[n+a]=e[a]},n.prototype.load=function(e,r,i){if(typeof window.CrunchModule=="undefined"){console.warn("Crunch library not loaded! Include a script tag pointing to lib/crunch/crunch.js in your html-file.");return}var s=window.CrunchModule,o=new Uint8Array(e),u=e.byteLength,a=s._malloc(u),f,l,c,h,p,d,v,m;this.arrayBufferCopy(o,s.HEAPU8,a,u),f=s._crn_get_dxt_format(a,u);var g;switch(f){case n.cCRNFmtDXT1:r.format="PrecompressedDXT1A",g=4;break;case n.cCRNFmtDXT3:r.format="PrecompressedDXT3",g=8;break;case n.cCRNFmtDXT5:r.format="PrecompressedDXT5",g=8;break;default:return console.error("Unsupported image format"),0}h=s._crn_get_width(a,u),p=s._crn_get_height(a,u),d=s._crn_get_levels(a,u),c=s._crn_get_uncompressed_size(a,u,0),l=s._malloc(c);var y=r.image;if(typeof y=="undefined"||y===null)y={},r.image=y;y.width=h,y.height=p,y.depth=1;var b=[];r.image.mipmapSizes=[];for(m=0;m<d;++m)m&&(c=s._crn_get_uncompressed_size(a,u,m)),s._crn_decompress(a,u,l,c,m),v=new Uint8Array(s.HEAPU8.buffer,l,c),i&&(v=t.flipDXT(v,h,p,r.format)),b.push(v),r.image.mipmapSizes.push(c),h*=.5,p*=.5;r.image.data=b,r.image.useArrays=!0,r.type="UnsignedByte",r.image.isCompressed=!0,d<=1&&(r.minFilter="BilinearNoMipMaps"),y.bpp=g,y.dataReady=!0,r.needsUpdate=!0,s._free(a),s._free(l)},n.prototype.dxtToRgb565=function(e,t,n,r){var i=new Uint16Array(4),s=new Uint16Array(n*r),o=0,u=0,a=0,f=0,l=0,c=0,h=0,p=0,d=0,v=n/4,m=r/4;for(var g=0;g<m;g++)for(var y=0;y<v;y++)a=t+4*(g*v+y),i[0]=e[a],i[1]=e[a+1],f=i[0]&31,l=i[0]&2016,c=i[0]&63488,h=i[1]&31,p=i[1]&2016,d=i[1]&63488,i[2]=5*f+3*h>>3|5*l+3*p>>3&2016|5*c+3*d>>3&63488,i[3]=5*h+3*f>>3|5*p+3*l>>3&2016|5*d+3*c>>3&63488,o=e[a+2],u=g*4*n+y*4,s[u]=i[o&3],s[u+1]=i[o>>2&3],s[u+2]=i[o>>4&3],s[u+3]=i[o>>6&3],u+=n,s[u]=i[o>>8&3],s[u+1]=i[o>>10&3],s[u+2]=i[o>>12&3],s[u+3]=i[o>>14],o=e[a+3],u+=n,s[u]=i[o&3],s[u+1]=i[o>>2&3],s[u+2]=i[o>>4&3],s[u+3]=i[o>>6&3],u+=n,s[u]=i[o>>8&3],s[u+1]=i[o>>10&3],s[u+2]=i[o>>12&3],s[u+3]=i[o>>14];return s},n.prototype.isSupported=function(){return e.SUPPORTS_DDS},n.prototype.toString=function(){return"CrunchLoader"},n}),define("goo/loaders/tga/TgaLoader",[],function(){function e(){this.header=null,this.offset=0,this.use_rle=!1,this.use_pal=!1,this.use_rgb=!1,this.use_grey=!1}return e.TYPE_NO_DATA=0,e.TYPE_INDEXED=1,e.TYPE_RGB=2,e.TYPE_GREY=3,e.TYPE_RLE_INDEXED=9,e.TYPE_RLE_RGB=10,e.TYPE_RLE_GREY=11,e.ORIGIN_MASK=48,e.ORIGIN_SHIFT=4,e.ORIGIN_BL=0,e.ORIGIN_BR=1,e.ORIGIN_UL=2,e.ORIGIN_UR=3,e.prototype.load=function(e,t){this.loadData(new Uint8Array(e));var n=this.getImageData();t.setImage(n,null,n.width,n.height),n.dataReady=!0,t.needsUpdate=!0},e.prototype.loadData=function(t){if(t.length<19)throw new Error("Targa::load() - Not enough data to contain header.");this.offset=0,this.header={id_length:t[this.offset++],colormap_type:t[this.offset++],image_type:t[this.offset++],colormap_index:t[this.offset++]|t[this.offset++]<<8,colormap_length:t[this.offset++]|t[this.offset++]<<8,colormap_size:t[this.offset++],origin:[t[this.offset++]|t[this.offset++]<<8,t[this.offset++]|t[this.offset++]<<8],width:t[this.offset++]|t[this.offset++]<<8,height:t[this.offset++]|t[this.offset++]<<8,pixel_size:t[this.offset++],flags:t[this.offset++]},this.checkHeader();if(this.header.id_length+this.offset>t.length)throw new Error("Targa::load() - No data ?");this.offset+=this.header.id_length;switch(this.header.image_type){case e.TYPE_RLE_INDEXED:this.use_rle=!0;break;case e.TYPE_INDEXED:this.use_pal=!0;break;case e.TYPE_RLE_RGB:this.use_rle=!0;break;case e.TYPE_RGB:this.use_rgb=!0;break;case e.TYPE_RLE_GREY:this.use_rle=!0;break;case e.TYPE_GREY:this.use_grey=!0}this.parse(t)},e.prototype.checkHeader=function(){switch(this.header.image_type){case e.TYPE_INDEXED:case e.TYPE_RLE_INDEXED:if(this.header.colormap_length>256||this.header.colormap_size!==24||this.header.colormap_type!==1)throw new Error("Targa::checkHeader() - Invalid type colormap data for indexed type");break;case e.TYPE_RGB:case e.TYPE_GREY:case e.TYPE_RLE_RGB:case e.TYPE_RLE_GREY:if(this.header.colormap_type)throw new Error("Targa::checkHeader() - Invalid type colormap data for colormap type");break;case e.TYPE_NO_DATA:throw new Error("Targa::checkHeader() - No data on this TGA file");default:throw new Error("Targa::checkHeader() - Invalid type '"+this.header.image_type+"'")}if(this.header.width<=0||this.header.height<=0)throw new Error("Targa::checkHeader() - Invalid image size");if(this.header.pixel_size!==8&&this.header.pixel_size!==16&&this.header.pixel_size!==24&&this.header.pixel_size!==32)throw new Error("Targa::checkHeader() - Invalid pixel size '"+this.header.pixel_size+"'")},e.prototype.parse=function(e){var t,n,r,i,s;t=this.header,n=t.flags&15,i=t.pixel_size>>3,s=t.width*t.height*i,this.use_pal&&(this.palettes=e.subarray(this.offset,this.offset+=t.colormap_length*i));if(this.use_rle){r=new Uint8Array(s);var o,u,a,f=0,l=new Uint8Array(i);while(f<s){o=e[this.offset++],u=(o&127)+1;if(o&128){for(a=0;a<i;++a)l[a]=e[this.offset++];for(a=0;a<u;++a)r.set(l,f+a*i);f+=i*u}else{u*=i;for(a=0;a<u;++a)r[f+a]=e[this.offset++];f+=u}}}else r=e.subarray(this.offset,this.offset+=this.use_pal?t.width*t.height:s);this.image=r},e.prototype.getImageData=function(t){var n=this.header.width,r=this.header.height,i,s,o,u,a,f,l,c;c=t||document&&document.createElement("canvas").getContext("2d").createImageData(n,r)||{width:n,height:r,data:new Uint8Array(n*r*4)};switch((this.header.flags&e.ORIGIN_MASK)>>e.ORIGIN_SHIFT){default:case e.ORIGIN_UL:i=0,o=1,f=n,s=0,u=1,a=r;break;case e.ORIGIN_BL:i=0,o=1,f=n,s=r-1,u=-1,a=-1;break;case e.ORIGIN_UR:i=n-1,o=-1,f=-1,s=0,u=1,a=r;break;case e.ORIGIN_BR:i=n-1,o=-1,f=-1,s=r-1,u=-1,a=-1}return l="getImageData"+(this.use_grey?"Grey":"")+this.header.pixel_size+"bits",this[l](c.data,s,u,a,i,o,f),c},e.prototype.getCanvas=function(){var e=document.createElement("canvas"),t=e.getContext("2d"),n=t.createImageData(this.header.width,this.header.height);return e.width=this.header.width,e.height=this.header.height,t.putImageData(this.getImageData(n),0,0),e},e.prototype.getDataURL=function(e){return this.getCanvas().toDataURL(e||"image/png")},e.prototype.getImageData8bits=function(e,t,n,r,i,s,o){var u=this.image,a=this.palettes,f=this.header.width,l,c=0,h,p;for(p=t;p!==r;p+=n)for(h=i;h!==o;h+=s,c++)l=u[c],e[(h+f*p)*4+3]=255,e[(h+f*p)*4+2]=a[l*3+0],e[(h+f*p)*4+1]=a[l*3+1],e[(h+f*p)*4+0]=a[l*3+2];return e},e.prototype.getImageData16bits=function(e,t,n,r,i,s,o){var u=this.image,a=this.header.width,f,l=0,c,h;for(h=t;h!==r;h+=n)for(c=i;c!==o;c+=s,l+=2)f=u[l+0]+(u[l+1]<<8),e[(c+a*h)*4+0]=(f&31744)>>7,e[(c+a*h)*4+1]=(f&992)>>2,e[(c+a*h)*4+2]=(f&31)>>3,e[(c+a*h)*4+3]=f&32768?0:255;return e},e.prototype.getImageData24bits=function(e,t,n,r,i,s,o){var u=this.image,a=this.header.width,f=0,l,c;for(c=t;c!==r;c+=n)for(l=i;l!==o;l+=s,f+=3)e[(l+a*c)*4+3]=255,e[(l+a*c)*4+2]=u[f+0],e[(l+a*c)*4+1]=u[f+1],e[(l+a*c)*4+0]=u[f+2];return e},e.prototype.getImageData32bits=function(e,t,n,r,i,s,o){var u=this.image,a=this.header.width,f=0,l,c;for(c=t;c!==r;c+=n)for(l=i;l!==o;l+=s,f+=4)e[(l+a*c)*4+2]=u[f+0],e[(l+a*c)*4+1]=u[f+1],e[(l+a*c)*4+0]=u[f+2],e[(l+a*c)*4+3]=u[f+3];return e},e.prototype.getImageDataGrey8bits=function(e,t,n,r,i,s,o){var u=this.image,a=this.header.width,f,l=0,c,h;for(h=t;h!==r;h+=n)for(c=i;c!==o;c+=s,l++)f=u[l],e[(c+a*h)*4+0]=f,e[(c+a*h)*4+1]=f,e[(c+a*h)*4+2]=f,e[(c+a*h)*4+3]=255;return e},e.prototype.getImageDataGrey16bits=function(e,t,n,r,i,s,o){var u=this.image,a=this.header.width,f=0,l,c;for(c=t;c!==r;c+=n)for(l=i;l!==o;l+=s,f+=2)e[(l+a*c)*4+0]=u[f+0],e[(l+a*c)*4+1]=u[f+0],e[(l+a*c)*4+2]=u[f+0],e[(l+a*c)*4+3]=u[f+1];return e},e.prototype.isSupported=function(){return!0},e.prototype.toString=function(){return"TgaLoader"},e}),define("goo/util/Latch",[],function(){function e(e,t){this.count=e,this.callback=t}return e.prototype.countDown=function(){this.count--,this.isDone()&&this.callback&&this.callback.done?this.callback.done():this.callback&&this.callback.progress&&this.callback.progress(this.count)},e.prototype.isDone=function(){return this.count===0},e}),define("goo/renderer/TextureCreator",["goo/loaders/Loader","goo/renderer/Texture","goo/loaders/dds/DdsLoader","goo/loaders/crunch/CrunchLoader","goo/loaders/tga/TgaLoader","goo/renderer/Util","goo/util/Latch"],function(e,t,n,r,i,s,o){function u(t){t=t||{},this.verticalFlip=t.verticalFlip!==undefined?t.verticalFlip:!0,this._loader=t.loader!==undefined?t.loader:new e,this.textureLoaders={".dds":new n,".crn":new r,".tga":new i}}function a(e,t){return e.indexOf(t,e.length-t.length)!==-1}u.cache={},u.UNSUPPORTED_FALLBACK=".png",u.clearCache=function(){u.cache={}},u.prototype.loadTexture2D=function(n,r,i){if(u.cache[n]!==undefined)return i&&i(),u.cache[n];var o={onSuccess:function(e){c.load(e,h,f.verticalFlip,0,e.byteLength),u._finishedLoading(),i&&i()}.bind(this),onError:function(e){console.warn("Error loading texture: "+n+" | "+e)}.bind(this)},f=this;for(var l in this.textureLoaders)if(a(n.toLowerCase(),l)){var c=this.textureLoaders[l];if(!c||!c.isSupported()){n=n.substring(0,n.length-l.length),n+=u.UNSUPPORTED_FALLBACK,r=r||{},r.flipY=!1;break}var h=new t(s.clone(u.DEFAULT_TEXTURE_2D.image),r);return h.image.dataReady=!1,h.a=n,u.cache[n]=h,this._loader.load(n,null,e.ARRAY_BUFFER).then(o.onSuccess,o.onError),h}if(u.cache[n]!==undefined)return i&&i(),u.cache[n];var p=new t(null,r);return u.cache[n]=p,this._loader.loadImage(n).then(function(e){p.setImage(e),u._finishedLoading(e),i&&i()}).then(null,function(e){console.error(e)}),p},u.prototype.loadTextureVideo=function(e,n,r,i){if(u.cache[e]!==undefined)return u.cache[e];var o=document.createElement("video");for(var a in r)o[a]=r[a];o.loop=typeof n=="boolean"?n:!0,o.addEventListener("error",function(t){console.warn("Couldn't load video URL ["+e+"]",t),i&&i(t)},!1);var f=new t(o,{wrapS:"EdgeClamp",wrapT:"EdgeClamp"});return f.readyCallback=function(){if(o.readyState>=3){console.log("Video ready: "+o.videoWidth+", "+o.videoHeight),o.width=o.videoWidth,o.height=o.videoHeight;if(s.isPowerOfTwo(o.width)===!1||s.isPowerOfTwo(o.height)===!1)f.generateMipmaps=!1,f.minFilter="BilinearNoMipMaps";return o.play(),o.dataReady=!0,!0}return!1},f.updateCallback=function(){return!o.paused},o.crossOrigin="anonymous",o.src=e,u.cache[e]=f,f},u.prototype.loadTextureWebCam=function(){var e=document.createElement("video");e.autoplay=!0,e.loop=!0;var n=new t(e,{wrapS:"EdgeClamp",wrapT:"EdgeClamp"});return n.readyCallback=function(){if(e.readyState>=3){console.log("WebCam video ready: "+e.videoWidth+", "+e.videoHeight),e.width=e.videoWidth,e.height=e.videoHeight;if(s.isPowerOfTwo(e.width)===!1||s.isPowerOfTwo(e.height)===!1)n.generateMipmaps=!1,n.minFilter="BilinearNoMipMaps";return e.dataReady=!0,!0}return!1},n.updateCallback=function(){return!e.paused},window.URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia?navigator.getUserMedia({video:!0},function(t){e.src=window.URL.createObjectURL(t)},function(e){console.warn("Unable to capture WebCam. Please reload the page.",e)}):console.warn("No support for WebCam getUserMedia found!"),n},u.prototype.loadTextureCube=function(e,n){var r=new t(null,n);r.variant="CUBE";var i=[],s=new o(6,{done:function(){var e=i[0].width,t=i[0].height;for(var n=0;n<6;n++){var s=i[n];if(e!==s.width||t!==s.height)r.generateMipmaps=!1,r.minFilter="BilinearNoMipMaps",console.error("Images not all the same size!")}r.setImage(i),r.image.dataReady=!0,r.image.width=e,r.image.height=t}}),u=this;for(var a=0;a<e.length;a++)(function(t){var n=e[t];typeof n=="string"?u._loader.loadImage(n).then(function(e){i[t]=e,s.countDown()}):(i[t]=n,s.countDown())})(a);return r},u._globalCallback=null,u._finishedLoading=function(e){if(u._globalCallback)try{u._globalCallback(e)}catch(t){console.error("Error in texture callback:",t)}};var f=new Uint8Array([255,255,255,255]);return u.DEFAULT_TEXTURE_2D=new t(f,null,1,1),u.DEFAULT_TEXTURE_CUBE=new t([f,f,f,f,f,f],null,1,1),u.DEFAULT_TEXTURE_CUBE.variant="CUBE",u}),define("3d/TerrainColorer",["goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/renderer/Texture","goo/renderer/TextureCreator"],function(e,t,n,r,i,s,o,u){function f(e,t){var n=document.createElement("canvas"),r=n.getContext("2d"),u=new Image;console.log("MAKE TERRAIN MATERIAL",e);var a=function(e){var r=i.createMaterial(s.uber,"ground_colors"),a=new o(n,null,e.width,e.height);r.setTexture("DIFFUSE_MAP",a),r.materialState.ambient=[0,0,0,1],r.materialState.diffuse=[.4590909090909091,.4690909090909091,.2590909090909091,1],r.cullState.frontFace="CW",r.cullState.cullFace="Back",r.cullState.enabled=!1,r.materialState.specular=[.02,.016,.006,.5],r.materialState.emissive=[0,0,0,1],r.materialState.shininess=4.1,console.log("CANVAS MATERIAL LOADED",r),t(r,a,u,n)};u.onload=function(){console.log("TERRAIN MATERIAL IMAGE LOADED",u),n.width=u.width,n.height=u.height,r.drawImage(u,0,0,u.width,u.height),n.dataReady=!0,a(n)},u.src=e}var a="resources/images/textures/ground_stones_normal.png";return{makeTerrainMaterial:f}}),define("physics/PhysicalWorld",["application/EventManager","goo/entities/components/ScriptComponent","goo/entities/EntityUtils","goo/math/Quaternion","goo/math/Matrix3x3","goo/math/Vector3"],function(e,t,n,r,i,s){function E(e,t){var n=e.dataViews.POSITION,r=e.indexData.data,i=e.indexCount/3,s=e.vertexCount,o=new Ammo.btTriangleIndexVertexArray,u=g,a=new Ammo.btIndexedMesh,f=4,l=Ammo.allocate(f*n.length,"float",Ammo.ALLOC_NORMAL),c=1;for(var h=0,p=n.length;h<p;h++)Ammo.setValue(l+h*f,c*n[h],"float");var d=!0,v=d?4:2,m=d?"i32":"i16",y=Ammo.allocate(v*r.length,m,Ammo.ALLOC_NORMAL);for(var h=0,p=r.length;h<p;h++)Ammo.setValue(y+h*v,r[h],m);var b=v*3,w=f*3;a.set_m_numTriangles(i),a.set_m_triangleIndexBase(y),a.set_m_triangleIndexStride(b),a.set_m_numVertices(s),a.set_m_vertexBase(l),a.set_m_vertexStride(w),o.addIndexedMesh(a,u);var E=!0,S=!0,x=new Ammo.btBvhTriangleMeshShape(o,E,S);return x}function S(e,t,n,r){console.log("Phys Mesh: ",e);var i=E(e),s=new Ammo.btTransform;s.setIdentity(),s.setOrigin(new Ammo.btVector3(t,n,r));var o=0,a=new Ammo.btVector3(0,0,0),f=new Ammo.btDefaultMotionState(s),l=new Ammo.btRigidBodyConstructionInfo(o,f,i,a),c=new Ammo.btRigidBody(l);c.setFriction(5),u.addRigidBody(c)}function x(e,t){}function T(){u.stepSimulation(1/60,3)}function N(){console.log("Init Physics"),a=new Ammo.btTransform,f=new r;var t=new Ammo.btDefaultCollisionConfiguration,n=new Ammo.btCollisionDispatcher(t),i=new Ammo.btDbvtBroadphase,s=new Ammo.btSequentialImpulseConstraintSolver;u=new Ammo.btDiscreteDynamicsWorld(n,i,s,t),u.setGravity(new Ammo.btVector3(0,-9.81,0)),e.registerListener(e.list().RENDER_TICK,T)}function C(){var e=new t;return e.run=function(e,t,n){var r=e.getComponent("transformComponent");e.ammoComponent.getMotionState().getWorldTransform(a);var i=a.getOrigin();r.setTranslation(i.x(),i.y(),i.z());var s=a.getRotation();f.setd(s.x(),s.y(),s.z(),s.w()),r.transform.rotation.copyQuaternion(f)},e}function k(e,n){var r=new t;return n.physTransform=new Ammo.btTransform,n.physQuat=new Ammo.btQuaternion,r.run=function(e,t,n){e.ammoShapeComponent.getWorldTransform(e.physTransform),e.physTransform.getOrigin().setX(e.gameSpatial.pos.data[0]),e.physTransform.getOrigin().setY(e.gameSpatial.pos.data[1]),e.physTransform.getOrigin().setZ(e.gameSpatial.pos.data[2]),d.set(e.gameSpatial.rot),d.rotateX(-Math.PI*.5);var r=d.toAngles();e.physQuat.setEuler(r.data[2],r.data[0],r.data[1]),e.physTransform.setRotation(e.physQuat),e.ammoShapeComponent.setWorldTransform(e.physTransform),e.ammoShapeComponent.activate()},r}function L(e,t,n){var r=E(e),i=new Ammo.btTransform;i.setIdentity(),i.setOrigin(new Ammo.btVector3(n.spatial.pos.data[0],n.spatial.pos.data[1],n.spatial.pos.data[2]));var s=0,o=new Ammo.btVector3(0,0,0),a=new Ammo.btDefaultMotionState(i),f=new Ammo.btRigidBodyConstructionInfo(s,a,r,o),c=new Ammo.btRigidBody(f);l.setValue(1,0,1),c.setLinearFactor(l),u.addRigidBody(c),t.ammoShapeComponent=c,c.setFriction(1),n.rbPtr=c.ptr,t.scriptComponent.scripts.push(k(n,t))}function A(e,t){L(t.transformComponent.children[0].entity.meshDataComponent.meshData,t,e)}function O(e,t){var n=5*e*e*e,r=new Ammo.btTransform;r.setIdentity(),r.getOrigin().setX(t[0]),r.getOrigin().setY(t[1]+e),r.getOrigin().setZ(t[2]);var i=new Ammo.btVector3(0,0,0),s=new Ammo.btSphereShape(e);s.calculateLocalInertia(n,i);var o=new Ammo.btDefaultMotionState(r),a=new Ammo.btRigidBodyConstructionInfo(n,o,s,i),f=new Ammo.btRigidBody(a);return f.setFriction(.5),u.addRigidBody(f),f}function _(e,t){h.setX(e[0]),h.setY(e[1]),h.setZ(e[2]),p.setX(t[0]),p.setY(t[1]),p.setZ(t[2]),M.set_m_closestHitFraction(1),M.get_m_rayFromWorld().setValue(e[0],e[1],e[2]),M.get_m_rayToWorld().setValue(t[0],t[1],t[2]),u.rayTest(h,p,M);var n=M.get_m_closestHitFraction(),r=!1;return n<1&&(r={fraction:n,normal:M.get_m_hitNormalWorld(),rbPtr:M.get_m_collisionObject().ptr}),r}function D(e,t){return _([e[0],e[1]-t*.5,e[2]],[e[0],e[1]-t*1.5,e[2]])}function P(e,n){var r=new t;return e.gameEntity=n,r.run=function(e,t){e.gameEntity.spatial.pos.set(e.sphereEntity.transformComponent.transform.translation),e.gameEntity.moveSphere.spatialControl.sphereMovement.groundContact=D(e.gameEntity.spatial.pos,e.gameEntity.pieceData.dimensions.mobRadius)},e.setComponent(r),e.sphereEntity.deactivate=function(){j(e.sphereEntity.ammoComponent)},e.sphereEntity.activate=function(t,n,r){B(e.sphereEntity.ammoComponent,t,n,r)},e}function H(e){u.removeRigidBody(e)}function B(e,t,n,r){e.activate();if(t){r||(r=.5);var i=e.getCenterOfMassTransform();i.getOrigin().setX(t[0]),i.getOrigin().setY(t[1]+r),i.getOrigin().setZ(t[2]),console.log(t[0],t[1],t[2]),e.setCenterOfMassTransform(i)}n&&(console.log("SET VEL: ",n),e.setLinearVelocity(new Ammo.btVector3(n[0],n[1],n[2]))),e.enabled=!0}function j(e){e.enabled=!1}function F(e,t,n,r){var i=t.maxX-t.minX,s=t.maxY-t.minY,o=t.maxZ-t.minZ,a=4,f=Ammo.allocate(a*n*r,"float",Ammo.ALLOC_NORMAL);for(var l=0;l<r;l++)for(var c=0;c<n;c++)Ammo.setValue(f+(l*n+c)*a,e[c][l]*s,"float");var h=1,p=t.minY,d=t.maxY,v=1,m=0,g=!1,y=new Ammo.btHeightfieldTerrainShape(n,r,f,h,p,d,v,m,g),b=i/n,w=o/r,E=1,S=new Ammo.btVector3(b,E,w);y.setLocalScaling(S);var x=new Ammo.btTransform;x.setIdentity(),x.setOrigin(new Ammo.btVector3(t.minX,t.minY,t.minZ));var T=new Ammo.btDefaultMotionState(x),N=new Ammo.btVector3(0,0,0),C=0,k=new Ammo.btRigidBodyConstructionInfo(C,T,y,N),L=new Ammo.btRigidBody(k);u.addRigidBody(L)}var o=new s,u,a,f,l=new Ammo.btVector3,c=new Ammo.btVector3,h=new Ammo.btVector3,p=new Ammo.btVector3,d=new i,v=0,m=1,g=2,y=3,b=4,w=5,M=new Ammo.ClosestRayResultCallback(h,p);return{addHeightmap:F,initPhysics:N,stepAmmoSimulation:T,addPhysicalWorldMesh:S,setTrimeshPhysicsTransform:x,physicsRayRange:_,createAmmoJSSphere:O,createAmmoShapeComponent:A,createAmmoComponentScript:C,attachSphericalMovementScript:P,removeAmmoComponent:H,deactivateAmmoComponent:j,activateAmmoComponent:B}}),define("3d/Colorer",["application/EventManager","goo/renderer/Texture"],function(e,t){var n={},r=function(e){var t=""+Math.floor(e[0]*255),n=""+Math.floor(e[1]*255),r=""+Math.floor(e[2]*255);return"rgb("+t+", "+n+", "+r+")"},i=function(e){var t=""+Math.floor(e[0]*255),n=""+Math.floor(e[1]*255),r=""+Math.floor(e[2]*255),i=""+e[3];return"rgba("+t+", "+n+", "+r+", "+i+")"},s=function(){var e=Math.floor(Math.random()*3),t=[.5,.5,.5];return t[e]=.8,r(t)},o=function(e,t,n,r){var i={texture:t,sourceImage:n,canvas:r,width:r.width,height:r.height,context:r.getContext("2d")};return i},u=function(e,t,n){e.context.fillStyle=i(t.color),e.context.fillRect(n[0]-n[2]*.5,n[1]-n[3]*.5,n[2],n[3]),e.texture.needsUpdate=!0},a=function(e,t){return e.context.getImageData(t[0],t[1],1,1).data},f=function(e){return e.context.getImageData(0,0,e.height,e.width).data};return{registerCanvasTexture:o,getPaintableRGBA:a,getPaintableCanvasData:f,paintPaintable:u}}),define("goo/noise/Noise",["goo/math/MathUtils"],function(e){function t(){}return t.shifter=[37,91,12,128,216,96,51,153,39,231,223,180,160,157,135,179,74,50,205,151,4,213,196,58,212,120,53,45,10,195,137,159,103,144,109,170,202,48,121,13,245,68,232,28,210,174,197,80,107,206,156,116,155,240,162,79,41,59,147,117,0,242,118,164,129,101,98,126,214,105,89,26,130,254,85,199,8,165,76,75,187,166,64,143,217,149,78,7,172,230,87,119,42,247,84,139,16,141,134,86,154,71,253,60,99,235,168,30,34,55,113,140,191,69,31,106,40,82,73,33,81,14,234,131,255,88,169,136,248,148,220,138,219,102,44,127,36,200,95,208,54,152,47,20,23,15,52,123,177,224,122,171,215,173,211,188,190,133,244,167,236,35,63,145,221,104,65,24,70,100,56,150,49,77,110,228,112,209,198,1,237,185,250,225,93,201,124,108,218,72,243,21,22,6,114,38,125,29,66,249,222,111,241,11,186,61,176,183,17,163,229,161,57,238,227,132,67,83,207,226,46,189,115,193,194,233,182,192,18,27,25,2,3,252,97,62,184,239,175,92,246,142,251,204,203,32,146,90,19,9,178,158,181,94,43,5],t.split=function(t){var n=Math.floor(t),r=e.scurve5(t-n);return{i0:n+0,i1:n+1,f0:1-r,f1:0+r}},t.fractal1d=function(e,t,n,r,i,s){var o=0,u=1,a=0;for(var f=0;f<n;f++)o+=u*s.evaluate1d(e,t),a+=u,u*=r,e*=i;return o/a},t.fractal2d=function(e,t,n,r,i,s,o){var u=0,a=1,f=0;for(var l=0;l<r;l++)u+=a*o.evaluate2d(e,t,n),f+=a,a*=i,e*=s,t*=s;return u/f},t.fractal3d=function(e,t,n,r,i,s,o,u){var a=0,f=1,l=0;for(var c=0;c<i;c++)a+=f*u.evaluate3d(e,t,n,r),l+=f,f*=s,e*=o,t*=o,n*=o;return a/l},t.fractal4d=function(e,t,n,r,i,s,o,u,a){var f=0,l=1,c=0;for(var h=0;h<s;h++)f+=l*a.evaluate4d(e,t,n,r,i),c+=l,l*=o,e*=u,t*=u,n*=u,r*=u;return f/c},t}),define("goo/noise/ValueNoise",["goo/noise/Noise"],function(e){function t(){e.call(this)}return t.prototype=Object.create(e.prototype),t.sources=[0,1/15,2/15,.2,4/15,5/15,.4,7/15,8/15,.6,10/15,11/15,.8,13/15,14/15,1],t.evaluate1d=function(n,r){var i=e.split(n/r),s=e.shifter[i.i0&255]&15,o=e.shifter[i.i1&255]&15,u=0;return u+=i.f0*t.sources[s],u+=i.f1*t.sources[o],u},t.evaluate2d=function(n,r,i){var s=e.split(n/i),o=e.split(r/i),u=e.shifter[e.shifter[o.i0&255]+s.i0&255]&15,a=e.shifter[e.shifter[o.i0&255]+s.i1&255]&15,f=e.shifter[e.shifter[o.i1&255]+s.i0&255]&15,l=e.shifter[e.shifter[o.i1&255]+s.i1&255]&15,c=0;return c+=o.f0*s.f0*t.sources[u],c+=o.f0*s.f1*t.sources[a],c+=o.f1*s.f0*t.sources[f],c+=o.f1*s.f1*t.sources[l],c},t.evaluate3d=function(n,r,i,s){var o=e.split(n/s),u=e.split(r/s),a=e.split(i/s),f=e.shifter[e.shifter[e.shifter[a.i0&255]+u.i0&255]+o.i0&255]&15,l=e.shifter[e.shifter[e.shifter[a.i0&255]+u.i0&255]+o.i1&255]&15,c=e.shifter[e.shifter[e.shifter[a.i0&255]+u.i1&255]+o.i0&255]&15,h=e.shifter[e.shifter[e.shifter[a.i0&255]+u.i1&255]+o.i1&255]&15,p=e.shifter[e.shifter[e.shifter[a.i1&255]+u.i0&255]+o.i0&255]&15,d=e.shifter[e.shifter[e.shifter[a.i1&255]+u.i0&255]+o.i1&255]&15,v=e.shifter[e.shifter[e.shifter[a.i1&255]+u.i1&255]+o.i0&255]&15,m=e.shifter[e.shifter[e.shifter[a.i1&255]+u.i1&255]+o.i1&255]&15,g=0;return g+=a.f0*u.f0*o.f0*t.sources[f],g+=a.f0*u.f0*o.f1*t.sources[l],g+=a.f0*u.f1*o.f0*t.sources[c],g+=a.f0*u.f1*o.f1*t.sources[h],g+=a.f1*u.f0*o.f0*t.sources[p],g+=a.f1*u.f0*o.f1*t.sources[d],g+=a.f1*u.f1*o.f0*t.sources[v],g+=a.f1*u.f1*o.f1*t.sources[m],g},t.evaluate4d=function(n,r,i,s,o){var u=e.split(n/o),a=e.split(r/o),f=e.split(i/o),l=e.split(s/o),c=e.shifter[e.shifter[e.shifter[e.shifter[l.i0&255]+f.i0&255]+a.i0&255]+u.i0&255]&15,h=e.shifter[e.shifter[e.shifter[e.shifter[l.i0&255]+f.i0&255]+a.i0&255]+u.i1&255]&15,p=e.shifter[e.shifter[e.shifter[e.shifter[l.i0&255]+f.i0&255]+a.i1&255]+u.i0&255]&15,d=e.shifter[e.shifter[e.shifter[e.shifter[l.i0&255]+f.i0&255]+a.i1&255]+u.i1&255]&15,v=e.shifter[e.shifter[e.shifter[e.shifter[l.i0&255]+f.i1&255]+a.i0&255]+u.i0&255]&15,m=e.shifter[e.shifter[e.shifter[e.shifter[l.i0&255]+f.i1&255]+a.i0&255]+u.i1&255]&15,g=e.shifter[e.shifter[e.shifter[e.shifter[l.i0&255]+f.i1&255]+a.i1&255]+u.i0&255]&15,y=e.shifter[e.shifter[e.shifter[e.shifter[l.i0&255]+f.i1&255]+a.i1&255]+u.i1&255]&15,b=e.shifter[e.shifter[e.shifter[e.shifter[l.i1&255]+f.i0&255]+a.i0&255]+u.i0&255]&15,w=e.shifter[e.shifter[e.shifter[e.shifter[l.i1&255]+f.i0&255]+a.i0&255]+u.i1&255]&15,E=e.shifter[e.shifter[e.shifter[e.shifter[l.i1&255]+f.i0&255]+a.i1&255]+u.i0&255]&15,S=e.shifter[e.shifter[e.shifter[e.shifter[l.i1&255]+f.i0&255]+a.i1&255]+u.i1&255]&15,x=e.shifter[e.shifter[e.shifter[e.shifter[l.i1&255]+f.i1&255]+a.i0&255]+u.i0&255]&15,T=e.shifter[e.shifter[e.shifter[e.shifter[l.i1&255]+f.i1&255]+a.i0&255]+u.i1&255]&15,N=e.shifter[e.shifter[e.shifter[e.shifter[l.i1&255]+f.i1&255]+a.i1&255]+u.i0&255]&15,C=e.shifter[e.shifter[e.shifter[e.shifter[l.i1&255]+f.i1&255]+a.i1&255]+u.i1&255]&15,k=0;return k+=l.f0*f.f0*a.f0*u.f0*t.sources[c],k+=l.f0*f.f0*a.f0*u.f1*t.sources[h],k+=l.f0*f.f0*a.f1*u.f0*t.sources[p],k+=l.f0*f.f0*a.f1*u.f1*t.sources[d],k+=l.f0*f.f1*a.f0*u.f0*t.sources[v],k+=l.f0*f.f1*a.f0*u.f1*t.sources[m],k+=l.f0*f.f1*a.f1*u.f0*t.sources[g],k+=l.f0*f.f1*a.f1*u.f1*t.sources[y],k+=l.f1*f.f0*a.f0*u.f0*t.sources[b],k+=l.f1*f.f0*a.f0*u.f1*t.sources[w],k+=l.f1*f.f0*a.f1*u.f0*t.sources[E],k+=l.f1*f.f0*a.f1*u.f1*t.sources[S],k+=l.f1*f.f1*a.f0*u.f0*t.sources[x],k+=l.f1*f.f1*a.f0*u.f1*t.sources[T],k+=l.f1*f.f1*a.f1*u.f0*t.sources[N],k+=l.f1*f.f1*a.f1*u.f1*t.sources[C],k},t}),define("goo/renderer/pass/RenderTarget",["goo/math/Vector2"],function(e){function t(t,n,r){this.glTexture=null,this._glRenderBuffer=null,this._glFrameBuffer=null,this.width=Math.floor(t),this.height=Math.floor(n),r=r||{},this.wrapS=r.wrapS!==undefined?r.wrapS:"EdgeClamp",this.wrapT=r.wrapT!==undefined?r.wrapT:"EdgeClamp",this.magFilter=r.magFilter!==undefined?r.magFilter:"Bilinear",this.minFilter=r.minFilter!==undefined?r.minFilter:"BilinearNoMipMaps",this.anisotropy=r.anisotropy!==undefined?r.anisotropy:1,this.format=r.format!==undefined?r.format:"RGBA",this.type=r.type!==undefined?r.type:"UnsignedByte",this.variant="2D",this.offset=new e(0,0),this.repeat=new e(1,1),this.generateMipmaps=r.generateMipmaps!==undefined?r.generateMipmaps:!1,this.premultiplyAlpha=r.premultiplyAlpha!==undefined?r.premultiplyAlpha:!1,this.unpackAlignment=r.unpackAlignment!==undefined?r.unpackAlignment:1,this.flipY=r.flipY!==undefined?r.flipY:!0,this.depthBuffer=r.depthBuffer!==undefined?r.depthBuffer:!0,this.stencilBuffer=r.stencilBuffer!==undefined?r.stencilBuffer:!0}return t.prototype.clone=function(){var e=new t(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.variant=this.variant,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.unpackAlignment=this.unpackAlignment,e.flipY=this.flipY,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e},t}),define("goo/addons/water/FlatWaterRenderer",["goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/Camera","goo/math/Plane","goo/renderer/pass/RenderTarget","goo/math/Vector3","goo/math/Vector4","goo/renderer/Material","goo/renderer/TextureCreator","goo/renderer/shaders/ShaderFragment"],function(e,t,n,r,i,s,o,u,a,f){function l(e){e=e||{},this.useRefraction=e.useRefraction!==undefined?e.useRefraction:!0,this.waterCamera=new n(45,1,.1,2e3),this.renderList=[],this.waterPlane=new r;var t=Math.floor(window.innerWidth/(e.divider||2)),f=Math.floor(window.innerHeight/(e.divider||2));this.reflectionTarget=new i(t,f),this.useRefraction&&(this.refractionTarget=new i(t,f),this.depthTarget=new i(t,f));var l=u.createMaterial(c,"WaterMaterial");l.shader.defines.REFRACTION=this.useRefraction,l.cullState.enabled=!1;var p=e.normalsUrl||"../resources/water/waternormals3.png";l.setTexture("NORMAL_MAP",(new a).loadTexture2D(p)),l.setTexture("REFLECTION_MAP",this.reflectionTarget),this.useRefraction&&(l.setTexture("REFRACTION_MAP",this.refractionTarget),l.setTexture("DEPTH_MAP",this.depthTarget)),this.waterMaterial=l,this.followCam=!0,this.updateWaterPlaneFromEntity=e.updateWaterPlaneFromEntity!==undefined?this.updateWaterPlaneFromEntity:!0,this.calcVect=new s,this.camReflectDir=new s,this.camReflectUp=new s,this.camReflectLeft=new s,this.camLocation=new s,this.camReflectPos=new s,this.offset=new s,this.clipPlane=new o,this.waterEntity=null,this.depthMaterial=u.createMaterial(h,"depth")}l.prototype.process=function(e,t,n,r,i){t=t.filter(function(e){return e.meshRendererComponent.isReflectable});var s=this.waterPlane;this.waterCamera.copy(r),this.updateWaterPlaneFromEntity&&(s.constant=this.waterEntity.transformComponent.transform.translation.y);var o=r.translation.y>s.constant;this.waterEntity.skip=!0;if(o){this.useRefraction&&(n.process(this.waterCamera,t,this.renderList),this.clipPlane.setd(s.normal.x,-s.normal.y,s.normal.z,s.constant),this.waterCamera.setToObliqueMatrix(this.clipPlane),e.render(this.renderList,this.waterCamera,i,this.depthTarget,!0,this.depthMaterial),e.render(this.renderList,this.waterCamera,i,this.refractionTarget,!0));var u=this.calcVect,a=this.camReflectDir,f=this.camReflectUp,l=this.camReflectLeft,c=this.camLocation,h=this.camReflectPos;c.set(r.translation);var p=s.pseudoDistance(c);u.set(s.normal).mul(p*2),h.set(c.sub(u)),c.set(r.translation).add(r._direction),p=s.pseudoDistance(c),u.set(s.normal).mul(p*2),a.set(c.sub(u)).sub(h).normalize(),c.set(r.translation).add(r._up),p=s.pseudoDistance(c),u.set(s.normal).mul(p*2),f.set(c.sub(u)).sub(h).normalize(),l.set(f).cross(a).normalize(),this.waterCamera.translation.set(h),this.waterCamera._direction.set(a),this.waterCamera._up.set(f),this.waterCamera._left.set(l),this.waterCamera.normalize(),this.waterCamera.update();if(this.skybox&&this.followCam){var d=this.skybox.transformComponent.worldTransform;d.translation.setv(h),d.update()}}this.waterMaterial.shader.uniforms.abovewater=o,n.process(this.waterCamera,t,this.renderList),e.setRenderTarget(this.reflectionTarget),e.clear();if(this.skybox)if(this.skybox instanceof Array){this.clipPlane.setd(s.normal.x,s.normal.y,s.normal.z,s.constant),this.waterCamera.setToObliqueMatrix(this.clipPlane,10);for(var v=0;v<this.skybox.length;v++)e.render(this.skybox[v],this.waterCamera,i,this.reflectionTarget,!1),this.skybox[v].skip=!0}else e.render(this.skybox,this.waterCamera,i,this.reflectionTarget,!1),this.skybox.skip=!0;this.clipPlane.setd(s.normal.x,s.normal.y,s.normal.z,s.constant),this.waterCamera.setToObliqueMatrix(this.clipPlane),e.render(this.renderList,this.waterCamera,i,this.reflectionTarget,!1),this.waterEntity.skip=!1;if(this.skybox)if(this.skybox instanceof Array)for(var v=0;v<this.skybox.length;v++)this.skybox[v].skip=!1;else this.skybox.skip=!1;if(o&&this.skybox&&this.followCam){var m=r.translation,d=this.skybox.transformComponent.worldTransform;d.translation.setv(m).addv(this.offset),d.update(),this.waterCamera._updatePMatrix=!0}},l.prototype.setSkyBox=function(e){this.skybox=e,e.meshRendererComponent&&(this.skybox.meshRendererComponent.materials[0].depthState.enabled=!1,this.skybox.meshRendererComponent.materials[0].renderQueue=0,this.skybox.meshRendererComponent.cullMode="Never")},l.prototype.setWaterEntity=function(e){this.waterEntity=e,this.waterEntity.meshRendererComponent.materials[0]=this.waterMaterial};var c={defines:{REFRACTION:!1},attributes:{vertexPosition:e.POSITION,vertexNormal:e.NORMAL},uniforms:{viewMatrix:t.VIEW_MATRIX,projectionMatrix:t.PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,normalMatrix:t.NORMAL_MATRIX,cameraPosition:t.CAMERA,cameraTranslation:t.CAMERA_TRANSLATION,normalMap:"NORMAL_MAP",reflection:"REFLECTION_MAP",refraction:"REFRACTION_MAP",depthmap:"DEPTH_MAP",vertexTangent:[1,0,0,1],waterColor:[.0625,.0625,.0625],abovewater:!0,fogColor:[1,1,1],sunDirection:[.66,.66,.33],sunColor:[1,1,.5],sunShininess:100,sunSpecPower:4,fogStart:0,fogScale:2e3,timeMultiplier:1,time:t.TIME,distortionMultiplier:.025,fresnelPow:2,normalMultiplier:3,fresnelMultiplier:1,waterScale:5,doFog:!0,resolution:t.RESOLUTION},vshader:["attribute vec3 vertexPosition;","attribute vec3 vertexNormal;","uniform vec4 vertexTangent;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform mat4 normalMatrix;","uniform vec3 cameraPosition;","uniform vec3 cameraTranslation;","uniform float waterScale;","varying vec2 texCoord0;","varying vec3 eyeVec;","varying vec4 viewCoords;","varying vec3 worldPos;","void main(void) {","	worldPos = (worldMatrix * vec4(vertexPosition, 1.0)).xyz;","	texCoord0 = (worldPos.xz + cameraTranslation.xz) * waterScale;","	vec3 n = normalize((normalMatrix * vec4(vertexNormal.x, vertexNormal.y, -vertexNormal.z, 0.0)).xyz);","	vec3 t = normalize((normalMatrix * vec4(vertexTangent.xyz, 0.0)).xyz);","	vec3 b = cross(n, t) * vertexTangent.w;","	mat3 rotMat = mat3(t, b, n);","	vec3 eyeDir = worldPos - cameraPosition;","	eyeVec = eyeDir * rotMat;","	viewCoords = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","	gl_Position = viewCoords;","}"].join("\n"),fshader:["uniform sampler2D normalMap;","uniform sampler2D reflection;","#ifdef REFRACTION","uniform sampler2D refraction;","uniform sampler2D depthmap;","#endif","uniform vec3 waterColor;","uniform bool abovewater;","uniform vec3 fogColor;","uniform float fogStart;","uniform float fogScale;","uniform float time;","uniform float timeMultiplier;","uniform float distortionMultiplier;","uniform float fresnelPow;","uniform vec3 sunDirection;","uniform vec3 sunColor;","uniform float sunShininess;","uniform float sunSpecPower;","uniform float normalMultiplier;","uniform float fresnelMultiplier;","uniform bool doFog;","uniform vec2 resolution;","varying vec2 texCoord0;","varying vec3 eyeVec;","varying vec4 viewCoords;","varying vec3 worldPos;","vec4 combineTurbulence(in vec2 coords) {","	float t = time * timeMultiplier;","	vec4 coarse1 = texture2D(normalMap, coords * vec2(0.0012, 0.001) + vec2(0.019 * t, 0.021 * t));","	vec4 coarse2 = texture2D(normalMap, coords * vec2(0.001, 0.0011) + vec2(-0.017 * t, 0.016 * t));","	vec4 detail1 = texture2D(normalMap, coords * vec2(0.008) + vec2(0.06 * t, 0.03 * t));","	vec4 detail2 = texture2D(normalMap, coords * vec2(0.006) + vec2(0.05 * t, -0.04 * t));","	return (detail1 * 0.25 + detail2 * 0.25 + coarse1 * 0.75 + coarse2 * 1.0) / 2.25 - 0.48;","}","#ifdef REFRACTION",f.methods.unpackDepth,"#endif","void main(void)","{","	float fogDist = clamp((viewCoords.z-fogStart)/fogScale,0.0,1.0);","	vec2 normCoords = texCoord0;","	vec4 noise = combineTurbulence(normCoords);","	vec3 normalVector = normalize(noise.xyz * vec3(normalMultiplier, normalMultiplier, 1.0));","	vec3 localView = normalize(eyeVec);","	float fresnel = dot(normalize(normalVector * vec3(fresnelMultiplier, fresnelMultiplier, 1.0)), localView);","	if ( abovewater == false ) {","		fresnel = -fresnel;","	}","	fresnel *= 1.0 - fogDist;","	float fresnelTerm = 1.0 - fresnel;","	fresnelTerm = pow(fresnelTerm, fresnelPow);","	fresnelTerm = clamp(fresnelTerm, 0.0, 1.0);","	fresnelTerm = fresnelTerm * 0.95 + 0.05;","	vec2 projCoord = viewCoords.xy / viewCoords.q;","	projCoord = (projCoord + 1.0) * 0.5;","	projCoord.y -= 1.0 / resolution.y;","#ifdef REFRACTION","	float depthUnpack = unpackDepth(texture2D(depthmap, projCoord));","	if (depthUnpack > 0.5) {depthUnpack = 0.0;}","	float depth2 = clamp(depthUnpack * 400.0, 0.0, 1.0);","	vec2 projCoordRefr = vec2(projCoord);","	projCoordRefr += (normalVector.xy * distortionMultiplier) * (depth2);","	projCoordRefr = clamp(projCoordRefr, 0.001, 0.999);","	depthUnpack = unpackDepth(texture2D(depthmap, projCoordRefr));","	float depth = clamp(depthUnpack * 40.0, 0.8, 1.0);","#endif","	projCoord += (normalVector.xy * distortionMultiplier);","	projCoord = clamp(projCoord, 0.001, 0.999);","	if ( abovewater == true ) {","		projCoord.x = 1.0 - projCoord.x;","	}","	vec4 waterColorX = vec4(waterColor, 1.0);","	vec4 reflectionColor = texture2D(reflection, projCoord);","	if ( abovewater == false ) {","		reflectionColor *= vec4(0.8,0.9,1.0,1.0);","		vec4 endColor = mix(reflectionColor,waterColorX,fresnelTerm);","		gl_FragColor = mix(endColor,waterColorX,fogDist);","	}","	else {","		vec3 sunSpecReflection = normalize(reflect(-sunDirection, normalVector));","		float sunSpecDirection = max(0.0, dot(localView, sunSpecReflection));","		vec3 specular = pow(sunSpecDirection, sunShininess) * sunSpecPower * sunColor;","		vec4 endColor = waterColorX;","#ifdef REFRACTION","		vec4 refractionColor = texture2D(refraction, projCoordRefr) * vec4(0.6);","		endColor = mix(refractionColor, waterColorX, depth);","#endif","		endColor = mix(endColor, reflectionColor, fresnelTerm);","		if (doFog) {","			gl_FragColor = (vec4(specular, 1.0) + mix(endColor,reflectionColor,fogDist)) * (1.0-fogDist) + vec4(fogColor, 1.0) * fogDist;","		} else {","			gl_FragColor = vec4(specular, 1.0) + mix(endColor,reflectionColor,fogDist);","		}","	}","}"].join("\n")},h={attributes:{vertexPosition:e.POSITION},uniforms:{viewProjectionMatrix:t.VIEW_PROJECTION_MATRIX,worldMatrix:t.WORLD_MATRIX,farPlane:t.FAR_PLANE},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec4 vPosition;","void main(void) {","	vPosition = worldMatrix * vec4(vertexPosition, 1.0);","	gl_Position = viewProjectionMatrix * vPosition;","}"].join("\n"),fshader:["uniform float farPlane;",f.methods.packDepth,"varying vec4 vPosition;","void main(void)","{","	float linearDepth = abs(vPosition.y) / farPlane;","	gl_FragColor = packDepth(linearDepth);","}"].join("\n")};return l}),define("goo/util/MeshBuilder",["goo/renderer/MeshData","goo/math/Vector3","goo/entities/EntityUtils"],function(e,t,n){function r(){this.meshDatas=[],this.vertexData={},this.indexData=[],this.vertexCounter=0,this.indexCounter=0,this.indexLengths=[],this.indexModes=[]}r.prototype.addEntity=function(e){n.traverse(e,function(e){e.transformComponent._dirty&&e.transformComponent.updateTransform()}),n.traverse(e,function(e){e.transformComponent._dirty&&n.updateWorldTransform(e.transformComponent)}),n.traverse(e,function(e){e.meshDataComponent&&this.addMeshData(e.meshDataComponent.meshData,e.transformComponent.worldTransform)})};var i=new t;return r.prototype.addMeshData=function(t,n){if(t.vertexCount>=65536)throw new Error("Maximum number of vertices for a mesh to add is 65535. Got: "+t.vertexCount);this.vertexCounter+t.vertexCount>=65536&&this._generateMesh();var r=n.matrix,s=n.rotation,o=t.attributeMap,u=Object.keys(o);for(var a=0,f=u.length;a<f;a++){var l=u[a],c=o[l],h=this.vertexData[l];h||(this.vertexData[l]={},h=this.vertexData[l],h.array=[],h.map={count:c.count,type:c.type,stride:c.stride,offset:c.offset,normalized:c.normalized});var p=t.getAttributeBuffer(l),d=p.length,v=h.array,m=c.count,g=this.vertexCounter*m;if(l===e.POSITION)for(var y=0;y<d;y+=m)i.setd(p[y+0],p[y+1],p[y+2]),r.applyPostPoint(i),v[g+y+0]=i.data[0],v[g+y+1]=i.data[1],v[g+y+2]=i.data[2];else if(l===e.NORMAL)for(var y=0;y<d;y+=m)i.setd(p[y+0],p[y+1],p[y+2]),s.applyPost(i),v[g+y+0]=i.data[0],v[g+y+1]=i.data[1],v[g+y+2]=i.data[2];else if(l===e.TANGENT)for(var y=0;y<d;y+=m)i.setd(p[y+0],p[y+1],p[y+2]),s.applyPost(i),v[g+y+0]=i.data[0],v[g+y+1]=i.data[1],v[g+y+2]=i.data[2],v[g+y+3]=p[y+3];else for(var y=0;y<d;y++)v[g+y]=p[y]}var b=t.getIndexBuffer();for(var y=0,f=t.indexCount;y<f;y++)this.indexData[this.indexCounter+y]=b[y]+this.vertexCounter;this.vertexCounter+=t.vertexCount,this.indexCounter+=t.indexCount,t.indexLengths?this.indexLengths=this.indexLengths.concat(t.indexLengths):this.indexLengths=this.indexLengths.concat(t.getIndexBuffer().length),this.indexModes=this.indexModes.concat(t.indexModes)},r.prototype._generateMesh=function(){var t={};for(var n in this.vertexData){var r=this.vertexData[n];t[n]=r.map}var i=new e(t,this.vertexCounter,this.indexCounter);for(var n in this.vertexData){var r=this.vertexData[n].array;i.getAttributeBuffer(n).set(r)}i.getIndexBuffer().set(this.indexData),i.indexLengths=this.indexLengths,i.indexModes=this.indexModes;var s=i.indexModes[0],o=0,u=[],a=[];for(var f=0;f<i.indexModes.length;f++){var l=i.indexModes[f];s!==l&&(u.push(s),a.push(o),s=l,o=0),o+=i.indexLengths[f],f===i.indexModes.length-1&&(u.push(l),a.push(o),s=l,o=0)}i.indexLengths=a,i.indexModes=u,this.meshDatas.push(i),this.vertexData={},this.indexData=[],this.vertexCounter=0,this.indexCounter=0,this.indexLengths=[],this.indexModes=[]},r.prototype.build=function(){return this.vertexCounter>0&&this._generateMesh(),this.meshDatas},r}),define("goo/util/Enum",[],function(){function e(e,t){return Object.getOwnPropertyNames(t).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function t(t,n){this.name=t,n&&e(this,n),Object.freeze(this)}function n(e){arguments.length===1&&e!==null&&typeof e=="object"?Object.keys(e).forEach(function(n){this[n]=new t(n,e[n])},this):Array.prototype.forEach.call(arguments,function(e){this[e]=new t(e)},this),Object.freeze(this)}return t.prototype=Object.create(null),t.prototype.constructor=t,t.prototype.toString=function(){return"|"+this.name+"|"},Object.freeze(t.prototype),n.prototype.symbols=function(){return Object.keys(this).map(function(e){return this[e]},this)},n.prototype.contains=function(e){return!e instanceof t?!1:this[e.name]===e},n}),define("goo/shapes/Box",["goo/renderer/MeshData","goo/util/Enum"],function(e,t){function n(t,r,i,s,o,u){if(arguments.length===1&&arguments[0]instanceof Object){var a=arguments[0];t=a.width,r=a.height,i=a.length,s=a.tileX,o=a.tileY,u=a.textureMode}this.xExtent=t!==undefined?t*.5:.5,this.yExtent=r!==undefined?r*.5:.5,this.zExtent=i!==undefined?i*.5:.5,this.tileX=s||1,this.tileY=o||1,typeof u=="string"&&(u=n.TextureModes[u]),this.textureMode=u!==undefined?u:n.TextureModes.Uniform;var f=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]);e.call(this,f,24,36),this.rebuild()}return n.prototype=Object.create(e.prototype),n.prototype.rebuild=function(){function f(e){for(var t=0;t<e.length;t++){var n=e[t]*3;a.push(u[n]),a.push(u[n+1]),a.push(u[n+2])}}function h(){for(var e=0;e<l.length/3;e++)for(var t=0;t<4;t++){var n=e*3;c.push(l[n]),c.push(l[n+1]),c.push(l[n+2])}}var t=this.xExtent,r=this.yExtent,i=this.zExtent,s=this.tileX,o=this.tileY,u=[-t,-r,-i,t,-r,-i,t,r,-i,-t,r,-i,t,-r,i,-t,-r,i,t,r,i,-t,r,i],a=[];f([0,1,2,3,1,4,6,2,4,5,7,6,5,0,3,7,2,6,7,3,0,5,4,1]),this.getAttributeBuffer(e.POSITION).set(a);var l=[0,0,-1,1,0,0,0,0,1,-1,0,0,0,1,0,0,-1,0],c=[];h(),this.getAttributeBuffer(e.NORMAL).set(c);var p=[];if(this.textureMode===n.TextureModes.Uniform)for(var d=0;d<6;d++)p.push(s),p.push(0),p.push(0),p.push(0),p.push(0),p.push(o),p.push(s),p.push(o);else p.push(1,1/3,.75,1/3,.75,2/3,1,2/3),p.push(.75,1/3,.5,1/3,.5,2/3,.75,2/3),p.push(.5,1/3,.25,1/3,.25,2/3,.5,2/3),p.push(.25,1/3,0,1/3,0,2/3,.25,2/3),p.push(.5,1,.5,2/3,.25,2/3,.25,1),p.push(.25,0,.25,1/3,.5,1/3,.5,0);return this.getAttributeBuffer(e.TEXCOORD0).set(p),this.getIndexBuffer().set([2,1,0,3,2,0,6,5,4,7,6,4,10,9,8,11,10,8,14,13,12,15,14,12,18,17,16,19,18,16,22,21,20,23,22,20]),this},n.TextureModes=new t("Uniform","Unfolded"),n}),define("goo/shapes/Quad",["goo/renderer/MeshData"],function(e){function t(t,n,r,i){if(arguments.length===1&&arguments[0]instanceof Object){var s=arguments[0];t=s.width,n=s.height,r=s.tileX,i=s.tileY}this.xExtent=t!==undefined?t*.5:.5,this.yExtent=n!==undefined?n*.5:.5,this.tileX=r||1,this.tileY=i||1;var o=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]);e.call(this,o,4,6),this.rebuild()}return t.prototype=Object.create(e.prototype),t.prototype.rebuild=function(){var t=this.xExtent,n=this.yExtent,r=this.tileX,i=this.tileY;return this.getAttributeBuffer(e.POSITION).set([-t,-n,0,-t,n,0,t,n,0,t,-n,0]),this.getAttributeBuffer(e.NORMAL).set([0,0,1,0,0,1,0,0,1,0,0,1]),this.getAttributeBuffer(e.TEXCOORD0).set([0,0,0,i,r,i,r,0]),this.getIndexBuffer().set([0,3,1,1,3,2]),this},t}),define("goo/shapes/Sphere",["goo/renderer/MeshData","goo/util/Enum","goo/math/Vector3","goo/math/MathUtils"],function(e,t,n,r){function i(t,n,r,s){if(arguments.length===1&&arguments[0]instanceof Object){var o=arguments[0];t=o.zSamples,n=o.radialSamples,r=o.radius,s=o.textureMode}this.zSamples=(t!==undefined?t:8)+1,this.radialSamples=n!==undefined?n:8,this.radius=r!==undefined?r:.5,typeof s=="string"&&(s=i.TextureModes[s]),this.textureMode=s!==undefined?s:i.TextureModes.Polar,this.viewInside=!1;var u=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]),a=this.textureMode===i.TextureModes.Chromeball?this.zSamples+1:this.zSamples;this._useSharedPoleVertices=this.textureMode!==i.TextureModes.Projected&&this.textureMode!==i.TextureModes.Linear;var f=this._useSharedPoleVertices?2:0,l=(a-f)*(this.radialSamples+1)+f,c=6*(a-2)*this.radialSamples;e.call(this,u,l,c),this.rebuild()}function s(e,t,n){e[n*3+0]=e[t*3+0],e[n*3+1]=e[t*3+1],e[n*3+2]=e[t*3+2]}return i.prototype=Object.create(e.prototype),i.prototype.rebuild=function(){var t=this.getAttributeBuffer(e.POSITION),o=this.getAttributeBuffer(e.NORMAL),u=this.getAttributeBuffer(e.TEXCOORD0),a=this.getIndexBuffer(),f=1/this.radialSamples,l=2/(this.zSamples-1),c=[],h=[];for(var p=0;p<this.radialSamples;p++){var d=r.TWO_PI*f*p;h[p]=Math.cos(d),c[p]=Math.sin(d)}c[this.radialSamples]=c[0],h[this.radialSamples]=h[0];var v=0,m=this.zSamples;this._useSharedPoleVertices&&(v=1,m=this.zSamples-1);var g=0,y=new n,b=new n,w=new n;for(var E=v;E<m;E++){var S=r.HALF_PI*(-1+l*E),x=Math.sin(S),T=this.radius*x,N=b.set(0,0,0);N.z+=T;var C=Math.sqrt(Math.abs(this.radius*this.radius-T*T)),k,L=g;for(var p=0;p<this.radialSamples;p++){var A=p*f,O=w.set(h[p],c[p],0);n.mul(O,C,y),t[g*3+0]=N.x+y.x,t[g*3+1]=N.y+y.y,t[g*3+2]=N.z+y.z,k=y.set(t[g*3+0],t[g*3+1],t[g*3+2]),k.normalize(),this.viewInside?(o[g*3+0]=-k.x,o[g*3+1]=-k.y,o[g*3+2]=-k.z):(o[g*3+0]=k.x,o[g*3+1]=k.y,o[g*3+2]=k.z);var M=0;!this._useSharedPoleVertices&&(E===v||E===m-1)&&(M=.5*f);if(this.textureMode===i.TextureModes.Linear)u[g*2+0]=A+M,u[g*2+1]=.5*(x+1);else if(this.textureMode===i.TextureModes.Projected)u[g*2+0]=A+M,u[g*2+1]=(r.HALF_PI+Math.asin(x))/Math.PI;else if(this.textureMode===i.TextureModes.Polar){var _=(r.HALF_PI-Math.abs(S))/Math.PI,D=_*h[p]+.5,P=_*c[p]+.5;u[g*2+0]=D,u[g*2+1]=P}else if(this.textureMode===i.TextureModes.Chromeball){var _=Math.sin((r.HALF_PI+S)/2);_/=2;var D=_*h[p]+.5,P=_*c[p]+.5;u[g*2+0]=D,u[g*2+1]=P}g++}s(t,L,g),s(o,L,g);if(this.textureMode===i.TextureModes.Linear)u[g*2+0]=1,u[g*2+1]=.5*(x+1);else if(this.textureMode===i.TextureModes.Projected)u[g*2+0]=1,u[g*2+1]=(r.HALF_PI+Math.asin(x))/Math.PI;else if(this.textureMode===i.TextureModes.Polar){var _=(r.HALF_PI-Math.abs(S))/Math.PI;u[g*2+0]=_+.5,u[g*2+1]=.5}else if(this.textureMode===i.TextureModes.Chromeball){var _=Math.sin((r.HALF_PI+S)/2);_/=2,u[g*2+0]=_+.5,u[g*2+1]=.5}g++}if(this.textureMode===i.TextureModes.Chromeball){var H=r.HALF_PI-.001,B=this.radius*Math.sin(H),j=Math.sqrt(Math.abs(this.radius*this.radius-B*B)),L=g;for(var p=0;p<this.radialSamples;p++){t[g*3+0]=j*h[p],t[g*3+1]=j*c[p],t[g*3+2]=B;var k=y.set(t[g*3+0],t[g*3+1],t[g*3+2]);k.normalize(),this.viewInside?(o[g*3+0]=-k.x,o[g*3+1]=-k.y,o[g*3+2]=-k.z):(o[g*3+0]=k.x,o[g*3+1]=k.y,o[g*3+2]=k.z);var _=Math.sin((r.HALF_PI+H)/2);_/=2;var D=_*h[p]+.5,P=_*c[p]+.5;u[g*2+0]=D,u[g*2+1]=P,g++}s(t,L,g),s(o,L,g);var _=Math.sin((r.HALF_PI+H)/2);_/=2,u[g*2+0]=_+.5,u[g*2+1]=.5,g++}this._useSharedPoleVertices&&(t[g*3+0]=0,t[g*3+1]=0,t[g*3+2]=-this.radius,this.viewInside?(o[g*3+0]=0,o[g*3+1]=0,o[g*3+2]=1):(o[g*3+0]=0,o[g*3+1]=0,o[g*3+2]=-1),this.textureMode===i.TextureModes.Polar||this.textureMode===i.TextureModes.Chromeball?(u[g*2+0]=.5,u[g*2+1]=.5):(u[g*2+0]=.5,u[g*2+1]=0),g++,t[g*3+0]=0,t[g*3+1]=0,t[g*3+2]=this.radius,this.viewInside?(o[g*3+0]=0,o[g*3+1]=0,o[g*3+2]=-1):(o[g*3+0]=0,o[g*3+1]=0,o[g*3+2]=1),this.textureMode===i.TextureModes.Polar?(u[g*2+0]=.5,u[g*2+1]=.5):this.textureMode===i.TextureModes.Chromeball?(u[g*2+0]=1,u[g*2+1]=-0.5):(u[g*2+0]=.5,u[g*2+1]=1));var F=0,I=this.textureMode===i.TextureModes.Chromeball?this.zSamples+1:this.zSamples,q=0;this._useSharedPoleVertices||(q=this.radialSamples+1);for(var E=0;E<I-3;E++){var R=q,U=R+1;q+=this.radialSamples+1;var z=q,W=z+1;for(var g=0;g<this.radialSamples;g++)this.viewInside?(a[F++]=R++,a[F++]=z,a[F++]=U,a[F++]=U++,a[F++]=z++,a[F++]=W++):(a[F++]=R++,a[F++]=U,a[F++]=z,a[F++]=U++,a[F++]=W++,a[F++]=z++)}for(var g=0;g<this.radialSamples;g++){var R,U,z;this._useSharedPoleVertices?(R=g,U=this.vertexCount-2,z=g+1):(R=g,U=g+this.radialSamples+2,z=g+this.radialSamples+1),this.viewInside?(a[F++]=R,a[F++]=z,a[F++]=U):(a[F++]=R,a[F++]=U,a[F++]=z)}var X=(m-v-1)*(this.radialSamples+1);for(var g=0;g<this.radialSamples;g++){var R,U,z;this._useSharedPoleVertices?(R=g+X,U=g+1+X,z=this.vertexCount-1):(R=g+X-this.radialSamples-1,U=g+X-this.radialSamples,z=g+X),this.viewInside?(a[F++]=R,a[F++]=z,a[F++]=U):(a[F++]=R,a[F++]=U,a[F++]=z)}return this},i.TextureModes=new t("Linear","Projected","Polar","Chromeball"),i}),define("goo/shapes/Cylinder",["goo/renderer/MeshData"],function(e){function t(t,n){if(arguments.length===1&&arguments[0]instanceof Object){var r=arguments[0];t=r.radialSamples,n=r.radius}this.radialSamples=t||8,this.radius=n||1;var i=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]);e.call(this,i,this.radialSamples*4+2+2,this.radialSamples*3*4),this.indexModes=["Triangles"],this.rebuild()}return t.prototype=Object.create(e.prototype),t.prototype.rebuild=function(){var t=[],n=[],r=[],i=[],s=Math.PI*2/this.radialSamples,o=1/this.radialSamples,u=this.radialSamples*4+2+2-1;for(var a=0,f=0,l=0;a<this.radialSamples;a++,f+=s,l+=o){var c=Math.cos(f),h=Math.sin(f),p=c*this.radius,d=h*this.radius;t.push(p,d,.5,p,d,-0.5,p,d,.5,p,d,-0.5),n.push(0,0,1,0,0,-1,c,h,0,c,h,0),r.push(c/4+.25,h/4+.75,c/4+.25,h/4+.25,.5,l,1,l)}t.push(this.radius,0,.5,this.radius,0,-0.5),n.push(1,0,0,1,0,0),r.push(.5,1,1,1);for(var a=0;a<this.radialSamples-1;a++)i.push(u,a*4+0,a*4+4,a*4+1,u-1,a*4+5,a*4+4+2,a*4+2,a*4+4+3,a*4+2,a*4+3,a*4+4+3);return i.push(u,a*4+0,0,a*4+1,u-1,1,a*4+4,a*4+2,a*4+5,a*4+2,a*4+3,a*4+5),t.push(0,0,-0.5,0,0,.5),n.push(0,0,-0.5,0,0,.5),r.push(.25,.25,.25,.75),this.getAttributeBuffer(e.POSITION).set(t),this.getAttributeBuffer(e.NORMAL).set(n),this.getAttributeBuffer(e.TEXCOORD0).set(r),this.getIndexBuffer().set(i),this},t}),define("goo/shapes/Torus",["goo/renderer/MeshData","goo/math/Vector3","goo/math/MathUtils"],function(e,t,n){function r(t,n,r,i){if(arguments.length===1&&arguments[0]instanceof Object){var s=arguments[0];t=s.circleSamples,n=s.radialSamples,r=s.tubeRadius,i=s.centerRadius}this._circleSamples=t!==undefined?t:8,this._radialSamples=n!==undefined?n:8,this._tubeRadius=r!==undefined?r:1,this._centerRadius=i!==undefined?i:2,this.viewInside=!1;var o=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]),u=(this._circleSamples+1)*(this._radialSamples+1),a=6*this._circleSamples*this._radialSamples;e.call(this,o,u,a),this.rebuild()}function i(e,t,n){e[n*3+0]=e[t*3+0],e[n*3+1]=e[t*3+1],e[n*3+2]=e[t*3+2]}function s(e,t,n){e[n*2+0]=e[t*2+0],e[n*2+1]=e[t*2+1]}return r.prototype=Object.create(e.prototype),r.prototype.rebuild=function(){var r=this.getAttributeBuffer(e.POSITION),o=this.getAttributeBuffer(e.NORMAL),u=this.getAttributeBuffer(e.TEXCOORD0),a=this.getIndexBuffer(),f=1/this._circleSamples,l=1/this._radialSamples,c=0,h=new t,p=new t,d=new t;for(var v=0;v<this._circleSamples;v++){var m=v*f,g=n.TWO_PI*m,y=Math.cos(g),b=Math.sin(g);h.set(y,b,0),t.mul(h,this._centerRadius,p);var w=c;for(var E=0;E<this._radialSamples;E++){var S=E*l,x=n.TWO_PI*S,T=Math.cos(x),N=Math.sin(x);d.copy(h).mul(T),d.z=d.z+N,d.normalize(),this.viewInside?(o[c*3+0]=-d.x,o[c*3+1]=-d.y,o[c*3+2]=-d.z):(o[c*3+0]=d.x,o[c*3+1]=d.y,o[c*3+2]=d.z),d.mul(this._tubeRadius).add(p),r[c*3+0]=d.x,r[c*3+1]=d.y,r[c*3+2]=d.z,u[c*2+0]=S,u[c*2+1]=m,c++}i(r,w,c),i(o,w,c),u[c*2+0]=1,u[c*2+1]=m,c++}for(var C=0;C<=this._radialSamples;C++,c++)i(r,C,c),i(o,C,c),s(u,C,c),u[c*2+1]=1;var k=0,L=0;for(var v=0;v<this._circleSamples;v++){var A=L,O=A+1;L+=this._radialSamples+1;var M=L,_=M+1;for(c=0;c<this._radialSamples;c++)this.viewInside?(a[k++]=A++,a[k++]=O,a[k++]=M,a[k++]=O++,a[k++]=_++,a[k++]=M++):(a[k++]=A++,a[k++]=M,a[k++]=O,a[k++]=O++,a[k++]=M++,a[k++]=_++)}return this},r}),define("goo/shapes/ShapeCreator",["goo/shapes/Box","goo/shapes/Quad","goo/shapes/Sphere","goo/shapes/Cylinder","goo/shapes/Torus"],function(e,t,n,r,i){function s(){}return s.createQuad=function(e,n,r,i){return new t(e,n,r,i)},s.createBox=function(t,n,r,i,s){return new e(t,n,r,i,s)},s.createSphere=function(e,t,r,i){return new n(e,t,r,i)},s.createCylinder=function(e,t,n){return new r(e,t,n)},s.createTorus=function(e,t,n,r){return new i(e,t,n,r)},s}),define("3d/addons/Vegetation",["goo/renderer/Material","goo/renderer/Camera","goo/math/Vector3","goo/math/Transform","goo/renderer/TextureCreator","goo/renderer/Texture","goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/light/DirectionalLight","goo/util/CanvasUtils","goo/util/Ajax","goo/util/MeshBuilder","goo/noise/Noise","goo/noise/ValueNoise","goo/shapes/TerrainSurface","goo/shapes/ShapeCreator","goo/renderer/shaders/ShaderBuilder","goo/util/rsvp"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){function w(e,t,n){b=e,this.terrainData=n;var r=this.terrainData.dimensions,i=r.minX+(r.maxX-r.minX)*.5,s=r.minZ+(r.maxZ-r.minZ)*.5,o=[i,r.minY+1,s];this.canvasData=t.getTerrainCanvasDataAtPos(o)}var y="resources/images/textures",b;w.prototype.init=function(t,s,o){var u=new g.Promise,a=this.terrainData.dimensions,f=[];for(var l=0;l<E.length;l++){var h=this.createBase(E[l]);f[l]=h}var p=13,d=13,v=new c,m=new r,w=35,x=6e4;while(x>0){var T=a.minX+(a.maxX-a.minX)*Math.random(),N=a.minZ+(a.maxZ-a.minZ)*Math.random(),C=[T,10,N],k=t.getHeightAt(C),L=t.getGroundNormal(C);k===null&&(console.log("No height at pos: ",C),k=0),L===null&&(console.log("Pos outside terrain: ",C),L=new n(0,1,0));var A=L.dot(n.UNIT_Y),O=(Math.random()+Math.random()-1)/2+.5,M=Math.floor(O*f.length);if(k<1){M=Math.floor(Math.random()*2);if(k<-1.4){x--;continue}}if(A<.9){x--;continue}if(s(this.canvasData,C)>.3){x--;continue}var _=Math.random()*Math.random()*3+1;m.scale.setd(_,_,_),m.translation.setd(0,0,0);var D=Math.random()*Math.PI*.5,P=Math.sin(D),H=Math.cos(D);m.lookAt(new n(P,0,H),L),m.translation.setd(T,k,N),m.update();var h=f[M];v.addMeshData(h,m),o(C,_*.2+.2*Math.random(),2+_*2+Math.random()*2),x--}var B=v.build(),j=e.createMaterial(S,"vegetation"),F=(new i).loadTexture2D(y+"/nature1024.png",null,function(){u.resolve()});j.setTexture("DIFFUSE_MAP",F),j.cullState.enabled=!1,j.uniforms.discardThreshold=.9,j.blendState.blending="NoBlending",j.uniforms.materialAmbient=[.4,.4,.4,1],j.uniforms.materialSpecular=[.1,.1,.01,1],j.uniforms.specularIntensity=.01,j.renderQueue=2001;for(var I in B){var q=b.world.createEntity(B[I],j);q.meshRendererComponent.castShadows=!1,q.meshRendererComponent.isReflectable=!1,q.meshRendererComponent.receiveShadows=!1,q.meshRendererComponent.materials.push(j),q.addToWorld()}return u};var E=[{w:1.4,h:2.1,tx:.004,ty:.7,tw:.13,th:.13},{w:1.4,h:2.1,tx:.004,ty:.54,tw:.15,th:.16},{w:.5,h:.5,tx:.02,ty:.875,tw:.128,th:.11},{w:2.6,h:4.1,tx:.14,ty:.73,tw:.19,th:.27},{w:1.8,h:1.1,tx:.34,ty:.79,tw:.33,th:.21},{w:1.8,h:1.1,tx:.34,ty:.79,tw:.33,th:.21},{w:.8,h:.5,tx:.14,ty:.59,tw:.28,th:.13}];w.prototype.createBase=function(e){var t=v.createQuad(e.w,e.h,1,1);t.attributeMap.BASE=o.createAttribute(1,"Float"),t.rebuildData(t.vertexCount,t.indexCount,!0),t.getAttributeBuffer(o.TEXCOORD0).set([e.tx,e.ty,e.tx,e.ty+e.th,e.tx+e.tw,e.ty+e.th,e.tx+e.tw,e.ty]),t.getAttributeBuffer("BASE").set([0,1*e.h,1*e.h,0]);var n=new c,i=new r;i.translation.y=e.h*.5,i.update(),n.addMeshData(t,i),i.setRotationXYZ(0,Math.PI*.5,0),i.update(),n.addMeshData(t,i);var s=n.build();return s[0]};var S={processors:[m.light.processor],attributes:{vertexPosition:o.POSITION,vertexNormal:o.NORMAL,vertexUV0:o.TEXCOORD0,base:"BASE"},uniforms:{viewProjectionMatrix:u.VIEW_PROJECTION_MATRIX,worldMatrix:u.WORLD_MATRIX,cameraPosition:u.CAMERA,diffuseMap:u.DIFFUSE_MAP,discardThreshold:-0.01,time:u.TIME},builder:function(e,t){m.light.builder(e,t)},vshader:function(){return["attribute vec3 vertexPosition;","attribute vec3 vertexNormal;","attribute vec2 vertexUV0;","attribute float base;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;","uniform float time;",m.light.prevertex,"varying vec3 normal;","varying vec3 vWorldPos;","varying vec3 viewPosition;","varying vec2 texCoord0;","void main(void) {","vec3 swayPos = vertexPosition;","swayPos.x += sin(time * 0.5 + swayPos.x * 0.4) * base * sin(time * 1.5 + swayPos.y * 0.4) * 0.1 + 0.08;","	vec4 worldPos = worldMatrix * vec4(swayPos, 1.0);","	vWorldPos = worldPos.xyz;","	gl_Position = viewProjectionMatrix * worldPos;",m.light.vertex,"	normal = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;","	texCoord0 = vertexUV0;","	viewPosition = cameraPosition - worldPos.xyz;","}"].join("\n")},fshader:function(){return["uniform sampler2D diffuseMap;","uniform float discardThreshold;",m.light.prefragment,"varying vec3 normal;","varying vec3 vWorldPos;","varying vec3 viewPosition;","varying vec2 texCoord0;","void main(void)","{","	vec4 final_color = texture2D(diffuseMap, texCoord0);","if (final_color.a < discardThreshold) discard;","	vec3 N = normalize(normal);",m.light.fragment,"	gl_FragColor = final_color;","}"].join("\n")}};return w}),define("goo/loaders/handlers/ConfigHandler",[],function(){function e(e,t,n,r){this.world=e,this.getConfig=t,this.updateObject=n,this.options=r}return e.prototype.update=function(){},e.prototype.remove=function(){},e.handlerClasses={},e.getHandler=function(t){return e.handlerClasses[t]},e._registerClass=function(t,n){return n._type=t,e.handlerClasses[t]=n},e}),define("goo/loaders/handlers/ComponentHandler",[],function(){function e(e,t,n,r){this.world=e,this.getConfig=t,this.updateObject=n,this.options=r}return e.prototype._prepare=function(){},e.prototype._create=function(){throw new Error("ComponentHandler._create is abstract, use ComponentHandler.getHandler(type)")},e.prototype.update=function(e,t){this._prepare(t);var n;return e==null||e[this.constructor._type+"Component"]==null?n=this._create(e,t):n=e[this.constructor._type+"Component"],n},e.prototype.remove=function(e){return e!=null&&e.clearComponent(this.constructor._type+"Component"),e},e.handlerClasses={},e.getHandler=function(t){return e.handlerClasses[t]},e._registerClass=function(t,n){n._type=t,e.handlerClasses[t]=n},e}),define("goo/util/StringUtil",[],function(){var e={};e.endsWith=function(e,t){return e.indexOf(t,e.length-t.length)!==-1},e.startsWith=function(e,t){return e.indexOf(t)===0},e.capitalize=function(e){return e.charAt(0).toUpperCase()+e.substring(1)},e.uncapitalize=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},e.getUntil=function(e,t){var n=e.indexOf(t);return n===-1?e:e.slice(0,n)},e.getFrom=function(e,t){var n=e.indexOf(t);return n===-1?"":e.slice(n+t.length,e.length)},e.getIndexedName=function(e,t,n){n||(n="_");var r=new RegExp(e+"("+n+"\\d+)?"),i,s=0;for(i in t){var o=t[i],u=r.exec(o);if(u)if(u.length>1&&u[1]){var a=parseInt(u[1].substring(n.length),10);a>=s&&(s=a+1)}else s=1}return e+n+s},e.getUniqueName=function(t,n,r){return n.indexOf(t)===-1?t:e.getIndexedName(t,n,r)},e.toAscii=function(e){return e.replace(/([^\x00-\x7F])/g,"x")},e.hashCode=function(e){var t=0;if(e.length===0)return t;for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);t=(t<<5)-t+r,t&=t}return btoa(t).replace("/","_").replace("+","-")};var t=+(new Date);return e.getUniqueId=function(){t++;var n=Array.prototype.slice.call(arguments,0).join("");return e.hashCode(t+""+n)},e}),define("goo/util/PromiseUtil",["goo/util/rsvp"],function(e){var t={};return t.createDummyPromise=function(t,n){var r;return r=new e.Promise,n?r.reject(n):r.resolve(t),r},t.optimisticAll=function(t){var n=0,r=t.length,i={results:[],errors:[]},s=new e.Promise;if(r>0)for(var o=0;o<r;o++)t[o].then(function(e){i.results.push(e),n++,n===r&&s.resolve(i)},function(e){i.errors.push(e),n++,n===r&&s.resolve(i)});else s.resolve(i);return s},t.defer=function(t,n){var r,i,s;return s=new e.Promise,n.apply?(r=new e.Promise,i=r.then(function(){return n()}),setTimeout(function(){r.resolve()},t),i):(setTimeout(function(){s.resolve(n)},t),s)},t}),define("goo/util/ObjectUtil",[],function(){var e={},t=Array.prototype,n=Object.prototype,r={},i=t.slice,s=n.toString,o=n.hasOwnProperty,u=Array.isArray,a=Object.keys,f=t.forEach;e.has=function(e,t){return o.call(e,t)},e.defaults=function(e){return l(i.call(arguments,1),function(t){if(t)for(var n in t)if(typeof e[n]=="undefined"||e[n]===null)e[n]=t[n]}),e},e.extend=function(e){return l(i.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},e.isObject=function(e){return e===Object(e)},e.clone=function(t){return e.isObject(t)?e.isArray(t)?t.slice():e.extend({},t):t},e.keys=a||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var n=[];for(var r in t)e.has(t,r)&&(n[n.length]=r);return n},e.isArray=u||function(e){return s.call(e)==="[object Array]"};var l=e.each=e.forEach=function(t,n,i){if(typeof t=="undefined"||t===null)return;if(f&&t.forEach===f)t.forEach(n,i);else if(t.length===+t.length){for(var s=0,o=t.length;s<o;s++)if(n.call(i,t[s],s,t)===r)return}else for(var u in t)if(e.has(t,u)&&n.call(i,t[u],u,t)===r)return};return e.deepClone=function(t){if(!t)return t;var n=[Number,String,Boolean],r;n.forEach(function(e){t instanceof e&&(r=e(t))});if(typeof r=="undefined")if(Object.prototype.toString.call(t)==="[object Array]")r=[],t.forEach(function(t,n){r[n]=e.deepClone(t)});else if(typeof t=="object")if(t.nodeType&&typeof t.cloneNode=="function")var r=t.cloneNode(!0);else if(!t.prototype)if(t instanceof Date)r=new Date(t);else{r={};for(var i in t)r[i]=e.deepClone(t[i])}else r=t;else r=t;return r},e.indexOf=function(e,t){for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},e}),define("goo/loaders/handlers/CameraComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/entities/components/CameraComponent","goo/renderer/Camera","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil"],function(e,t,n,r,i,s){function o(){e.apply(this,arguments)}return o.prototype=Object.create(e.prototype),e._registerClass("camera",o),o.prototype.constructor=o,o.prototype._prepare=function(e){return s.defaults(e,{fov:45,near:1,far:1e4,projectionMode:0,size:100,aspect:1,lockedRatio:!1})},o.prototype._create=function(e){var r=new n(45,1,1,1e3),i=new t(r);return e.setComponent(i),i},o.prototype.update=function(t,n){var r=e.prototype.update.call(this,t,n);r.camera.setProjectionMode(n.projectionMode),r.camera.lockedRatio=n.lockedRatio||!1;if(n.projectionMode===0)r.camera.setFrustumPerspective(n.fov,n.aspect||1,n.near,n.far);else{var s=n.size;r.camera.setFrustum(n.near,n.far,-s,s,s,-s,n.aspect||1),r.camera.size=s}return i.createDummyPromise(r)},o.prototype.remove=function(t){return e.prototype.remove.call(this,t)},o}),define("goo/loaders/handlers/EntityHandler",["goo/loaders/handlers/ConfigHandler","goo/loaders/handlers/ComponentHandler","goo/util/rsvp","goo/util/StringUtil","goo/util/PromiseUtil","goo/util/ObjectUtil","goo/entities/EntityUtils"],function(e,t,n,r,i,s,o){function u(){e.apply(this,arguments)}return u.prototype=Object.create(e.prototype),e._registerClass("entity",u),u.prototype._prepare=function(){},u.prototype._create=function(e){var t=this.world.createEntity(e);return t.ref=e,t},u.prototype._getHandler=function(e){this._componentHandlers||(this._componentHandlers={});if(!this._componentHandlers[e]){var n=t.getHandler(e);n&&(this._componentHandlers[e]=new n(this.world,this.getConfig,this.updateObject,this.options))}return this._componentHandlers[e]},u.prototype.update=function(e,t,n){function s(t){return t.ref===e}var u=this.world.entityManager.getEntityByName(e);if(!u){var a=this.world._addedEntities.filter(s);a&&(u=a[0])}u||(u=this._create(e));var f=[];for(var l in t.components){var c=t.components[l],h=this._getHandler(l);if(h){var p=h.update(u,c,n);!p||!p.then?console.error("Handler for "+l+" did not return promise"):f.push(p)}else console.warn("No componentHandler for "+l)}return u._components.forEach(function(e){var i=e.type;i=i.slice(0,i.lastIndexOf("Component")),i=r.uncapitalize(i),i==="howler"&&(i="sound"),t.components[i]||(h=this._getHandler(i),h?h.remove(u,n):console.warn("No componentHandler for "+i))}.bind(this)),f.length?i.optimisticAll(f).then(function(){return t.hidden?o.hide(u):o.show(u),u}):(console.error("No promises in "+e+" ",t),i.createDummyPromise(u))},u.prototype.remove=function(e){var t=this.world.entityManager.getEntityByName(e);typeof t=="object"&&this.world.removeEntity(t)},u}),define("goo/loaders/handlers/LightComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/entities/components/LightComponent","goo/renderer/light/PointLight","goo/renderer/light/SpotLight","goo/renderer/light/DirectionalLight","goo/math/Vector","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil"],function(e,t,n,r,i,s,o,u,a){function f(){e.apply(this,arguments)}return f.prototype=Object.create(e.prototype),f.prototype.constructor=f,e._registerClass("light",f),f.prototype._prepare=function(e){a.defaults(e,{direction:[0,0,0],color:[1,1,1,1],attenuate:!0,shadowCaster:!1,lightCookie:null}),e.type!=="DirectionalLight"&&(e.range=e.range!==undefined?e.range:1e3),e.shadowCaster&&(e.shadowSettings=e.shadowSettings||{},a.defaults(e.shadowSettings,{type:"Blur",projection:e.type==="DirectionalLight"?"Parallel":"Perspective",fov:55,size:400,near:1,far:1e3,resolution:[512,512],upVector:[0,1,0],darkness:.5}))},f.prototype._create=function(e,s){var o;switch(s.type){case"SpotLight":o=new r;break;case"DirectionalLight":o=new i;break;default:o=new n}var u=new t(o);return e.setComponent(u),u},f.prototype.update=function(t,n){var r=e.prototype.update.call(this,t,n),i=r.light;for(var o in n){var f=n[o];if(i.hasOwnProperty(o))if(o==="shadowSettings")for(var o in f){var l=f[o];i.shadowSettings[o]instanceof s?i.shadowSettings[o].set(l):i.shadowSettings[o]=a.clone(l)}else i[o]instanceof s?i[o].set(f):i[o]=a.clone(f)}var c=this,h=function(e,t){return c.getConfig(t).then(function(n){return c.updateObject(t,n,c.options).then(function(n){return{type:e,ref:t,texture:n}})})};if(n.lightCookie){var p,d=n.lightCookie;typeof d=="string"?p=h("cookie",d):d&&d.enabled&&(p=h("cookie",d.textureRef)),p&&p.then(function(e){e.texture?i.lightCookie=e.texture:i.lightCookie=null}).then(null,function(e){console.error("Error loading texture: "+e)})}return u.createDummyPromise(r)},f}),define("goo/loaders/handlers/MaterialHandler",["goo/loaders/handlers/ConfigHandler","goo/renderer/Material","goo/renderer/Util","goo/renderer/shaders/ShaderLib","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil"],function(e,t,n,r,i,s,o){function u(){e.apply(this,arguments),this._objects={}}return u.prototype=Object.create(e.prototype),e._registerClass("material",u),u.ENGINE_SHADER_PREFIX="GOO_ENGINE_SHADERS/",u.prototype._prepare=function(e){e.blendState||(e.blendState={}),o.defaults(e.blendState,{blending:"NoBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"}),e.cullState||(e.cullState={}),o.defaults(e.cullState,{enabled:!0,cullFace:"Back",frontFace:"CCW"}),e.depthState||(e.depthState={}),o.defaults(e.depthState,{enabled:!0,write:!0}),e.renderQueue==null&&(e.renderQueue=-1)},u.prototype._create=function(e){return this._objects||(this._objects={}),this._objects[e]=new t(e)},u.prototype.update=function(e,t){var r=this,s=this._objects[e]||this._create(e);return this._prepare(t),this._getShaderObject(t.shaderRef,t.wireframe).then(function(u){if(!u){console.warn("Unknown shader",t.shaderRef,"- not updating material",e);return}t.wireframe&&(s.wireframe=t.wireframe),s.blendState=n.clone(t.blendState),s.cullState=n.clone(t.cullState),s.depthState=n.clone(t.depthState),s.dualTransparency=t.dualTransparency||!1,t.renderQueue===-1?s.renderQueue=null:s.renderQueue=t.renderQueue,s.shader=u,s.uniforms={};for(var a in t.uniforms)typeof t.uniforms[a].enabled=="undefined"?s.uniforms[a]=o.clone(t.uniforms[a]):t.uniforms[a].enabled?s.uniforms[a]=o.clone(t.uniforms[a].value):delete s.uniforms[a];var f=[],l=function(e,t){return f.push(r.getConfig(t).then(function(n){return r.updateObject(t,n,r.options).then(function(n){return{type:e,ref:t,texture:n}})}))};for(var c in t.texturesMapping){var h=t.texturesMapping[c];typeof h=="string"?l(c,h):h&&h.enabled?l(c,h.textureRef):s.removeTexture(c);for(var p in s._textureMaps)t.texturesMapping[p]||s.removeTexture(p)}return f.length?i.all(f).then(function(e){for(var t=0;t<e.length;t++){var n=e[t];n.texture&&s.setTexture(n.type,n.texture)}return s}).then(null,function(e){return console.error("Error loading textures: "+e)}):s})},u.prototype.remove=function(e){return delete this._objects[e]},u.prototype._getShaderObject=function(e,n){var o=this;if(n){var a=new i.Promise,f=t.createShader(r.simple);return a.resolve(f),a}if(e){if(e.indexOf(u.ENGINE_SHADER_PREFIX)===0){var l=e.slice(u.ENGINE_SHADER_PREFIX.length),f=t.createShader(r[l]);return s.createDummyPromise(f)}return this.getConfig(e).then(function(t){return o.updateObject(e,t,o.options)})}var c=t.createShader(r.texturedLit,"DefaultShader");return s.createDummyPromise(c)},u}),define("goo/shapes/Disk",["goo/renderer/MeshData"],function(e){function t(t,n,r){if(arguments.length===1&&arguments[0]instanceof Object){var i=arguments[0];t=i.nSegments,n=i.radius,r=i.pointiness}this.nSegments=t||8,this.radius=n||1,this.pointiness=r||0;var s=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]);e.call(this,s,this.nSegments+1,this.nSegments*3),this.indexModes=["Triangles"],this.rebuild()}return t.prototype=Object.create(e.prototype),t.prototype.rebuild=function(){var t=[],n=[],r=[],i=[],s=Math.atan2(this.radius,this.pointiness),o=Math.PI*2/this.nSegments;for(var u=0,a=0;u<this.nSegments;u++,a+=o)t.push(Math.cos(a)*this.radius,Math.sin(a)*this.radius,0),n.push(Math.cos(a)*Math.cos(s),Math.sin(a)*Math.cos(s),Math.sin(s)),r.push(Math.cos(a)*.5+.5,Math.sin(a)*.5+.5),i.push(this.nSegments,u,(u+1)%this.nSegments);return t.push(0,0,this.pointiness),n.push(0,0,1),r.push(.5,.5),this.getAttributeBuffer(e.POSITION).set(t),this.getAttributeBuffer(e.NORMAL).set(n),this.getAttributeBuffer(e.TEXCOORD0).set(r),this.getIndexBuffer().set(i),this},t}),define("goo/shapes/Cone",["goo/renderer/MeshData"],function(e){function t(t,n,r){if(arguments.length===1&&arguments[0]instanceof Object){var i=arguments[0];t=i.radialSamples,n=i.radius,r=i.height}this.radialSamples=t||8,this.radius=n||1,this.height=typeof r=="undefined"?2:r;var s=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]);e.call(this,s,this.radialSamples*3+this.radialSamples+1,this.radialSamples*3*2),this.indexModes=["Triangles"],this.rebuild()}return t.prototype=Object.create(e.prototype),t.prototype.rebuild=function(){var t=[],n=[],r=[],i=[],s=Math.atan2(this.radius,this.height),o=Math.PI*2/this.radialSamples,u=1/this.radialSamples;for(var a=0,f=0,l=0;a<this.radialSamples;a++,f+=o,l+=u)t.push(0,0,this.height,Math.cos(f)*this.radius,Math.sin(f)*this.radius,0,Math.cos(f+o)*this.radius,Math.sin(f+o)*this.radius,0),n.push(0,0,1,Math.cos(f)*Math.cos(s),Math.sin(f)*Math.cos(s),Math.sin(s),Math.cos(f+o)*Math.cos(s),Math.sin(f+o)*Math.cos(s),Math.sin(s)),r.push(l+u/2,1,l,.5,l+u,.5),i.push(a*3+0,a*3+1,a*3+2);var c=a*3+0;t.push(0,0,0),n.push(0,0,-1),r.push(.25,.25);for(var a=1,f=0;a<=this.radialSamples-1;a++,f+=o)t.push(Math.cos(f)*this.radius,Math.sin(f)*this.radius,0),n.push(0,0,-1),r.push(Math.cos(f)*.25+.25,Math.sin(f)*.25+.25),i.push(c+a,c,c+a+1);return t.push(Math.cos(f)*this.radius,Math.sin(f)*this.radius,0),n.push(0,0,-1),r.push(Math.cos(f)*.25+.25,Math.sin(f)*.25+.25),i.push(c+this.radialSamples,c,c+1),this.getAttributeBuffer(e.POSITION).set(t),this.getAttributeBuffer(e.NORMAL).set(n),this.getAttributeBuffer(e.TEXCOORD0).set(r),this.getIndexBuffer().set(i),this},t}),define("goo/util/ShapeCreatorMemoized",["goo/shapes/Box","goo/shapes/Quad","goo/shapes/Sphere","goo/shapes/Cylinder","goo/shapes/Torus","goo/shapes/Disk","goo/shapes/Cone"],function(e,t,n,r,i,s,o){function u(){}function f(e,t){var n=Object.keys(t),r=n.map(function(e){return e+""+t[e]}).join("");return e+r}function l(e,t,n){var r=f(e,t);if(a[r])return a[r];var i=n();return a[r]=i,i}var a={};return u.createQuad=function(e,n){var r=1,i=1,s=1,o=1;return!n||r!==n.xExtent||i!==n.yExtent||s!==n.tileX||o!==n.tileY?l("quad",{},function(){return new t(r,i,s,o)}):n},u.createBox=function(t,n){var r=1,i=1,s=1,o=1,u=1;return!n||r!==n.xExtent||i!==n.yExtent||s!==n.zExtent||o!==n.tileX||u!==n.tileY?l("box",{},function(){return new e(r,i,s,o,u)}):n},u.createSphere=function(e,t){e=e||{},e.zSamples=e.zSamples||8,e.radialSamples=e.radialSamples||8,e.textureMode=e.textureMode||"Projected";var r=1;return!t||e.zSamples!==t.zSamples-1||e.radialSamples!==t.radialSamples||e.textureMode!==t.textureMode.name||r!==t.radius?l("sphere",e,function(){return new n(e.zSamples,e.radialSamples,r,e.textureMode)}):t},u.createCylinder=function(e,t){e=e||{},e.radialSamples=e.radialSamples||8;var n=1;return!t||e.radialSamples!==t.radialSamples||n!==t.radius?l("cylinder",e,function(){return new r(e.radialSamples,n)}):t},u.createTorus=function(e,t){e=e||{},e.radialSamples=e.radialSamples||8,e.circleSamples=e.circleSamples||12,e.tubeRadius=e.tubeRadius||.2;var n=1;return!t||e.radialSamples!==t._radialSamples||e.circleSamples!==t._circleSamples||e.tubeRadius!==t._tubeRadius||n!==t._centerRadius?new i(e.circleSamples,e.radialSamples,e.tubeRadius,n):t},u.createDisk=function(e,t){e=e||{},e.radialSamples=e.radialSamples||8,e.pointiness=typeof e.pointiness=="undefined"?0:e.pointiness;var n=1;return!t||e.radialSamples!==t.nSegments||e.pointiness!==t.pointiness||n!==t.radius?e.pointiness===Math.floor(e.pointiness)?l("disk",e,function(){return new s(e.radialSamples,n,e.pointiness)}):new s(e.radialSamples,n,e.pointiness):t},u.createCone=function(e,t){e=e||{},e.radialSamples=e.radialSamples||8,e.height=typeof e.height=="undefined"?0:e.height;var n=1;return!t||e.radialSamples!==t.radialSamples||e.height!==t.height||n!==t.radius?e.height===Math.floor(e.height)?l("cone",e,function(){return new o(e.radialSamples,n,e.height)}):new o(e.radialSamples,n,e.height):t},u}),define("goo/loaders/handlers/MeshDataComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/entities/components/MeshDataComponent","goo/renderer/bounds/BoundingBox","goo/util/ShapeCreatorMemoized","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil","goo/util/StringUtil"],function(e,t,n,r,i,s,o,u){function a(){e.apply(this,arguments)}return a.prototype=Object.create(e.prototype),e._registerClass("meshData",a),a.prototype.constructor=a,a.prototype._prepare=function(e){return o.defaults(e,{})},a.prototype._create=function(){},a.prototype.update=function(o,a){var f=this,l,c;e.prototype.update.call(this,o,a);var h;a.shape&&(h=r["create"+u.capitalize(a.shape)]);if(h instanceof Function){var p=h(a.shapeOptions,o.meshDataComponent?o.meshDataComponent.meshData:null);l=s.createDummyPromise(p),c=s.createDummyPromise()}else{var d=a.meshRef;d||console.error("No meshRef in meshDataComponent for "+o.ref),l=this.getConfig(d).then(function(e){return f.updateObject(d,e)});var v=a.poseRef||a.pose;v?c=this.getConfig(v).then(function(e){return f.updateObject(v,e)}):c=s.createDummyPromise()}return i.all([l,c]).then(function(e){var r=e[0],i=e[1],s=new t(r);if(r.boundingBox){var u=r.boundingBox.min,a=r.boundingBox.max,f=[a[0]-u[0],a[1]-u[1],a[2]-u[2]],l=[(a[0]+u[0])*.5,(a[1]+u[1])*.5,(a[2]+u[2])*.5],c=new n;c.xExtent=f[0]/2,c.yExtent=f[1]/2,c.zExtent=f[2]/2,c.center.seta(l),s.modelBound=c,s.autoCompute=!1}return i&&(s.currentPose=i),o.clearComponent("MeshDataComponent"),o.setComponent(s),s})},a}),define("goo/animation/Joint",["goo/math/Transform"],function(e){function t(t){this._name=t,this._index=0,this._parentIndex=0,this._inverseBindPose=new e}return t.NO_PARENT=-32768,t}),define("goo/animation/SkeletonPose",["goo/math/Transform","goo/animation/Joint","goo/math/Matrix4x4"],function(e,t,n){function r(t){this._skeleton=t,this._localTransforms=[],this._globalTransforms=[],this._matrixPalette=[],this._poseListeners=[];var r=this._skeleton._joints.length;for(var i=0;i<r;i++)this._localTransforms[i]=new e;for(var i=0;i<r;i++)this._globalTransforms[i]=new e;for(var i=0;i<r;i++)this._matrixPalette[i]=new n;this.setToBindPose()}return r.prototype.setToBindPose=function(){for(var e=0;e<this._localTransforms.length;e++){this._localTransforms[e].matrix.copy(this._skeleton._joints[e]._inverseBindPose.matrix).invert();var r=this._skeleton._joints[e]._parentIndex;r!==t.NO_PARENT&&n.combine(this._skeleton._joints[r]._inverseBindPose.matrix,this._localTransforms[e].matrix,this._localTransforms[e].matrix)}this.updateTransforms()},r.prototype.updateTransforms=function(){for(var e=0;e<this._skeleton._joints.length;e++){var r=this._skeleton._joints[e]._parentIndex;r!==t.NO_PARENT?n.combine(this._globalTransforms[r].matrix,this._localTransforms[e].matrix,this._globalTransforms[e].matrix):this._globalTransforms[e].matrix.copy(this._localTransforms[e].matrix),n.combine(this._globalTransforms[e].matrix,this._skeleton._joints[e]._inverseBindPose.matrix,this._matrixPalette[e])}this.firePoseUpdated()},r.prototype.firePoseUpdated=function(){for(var e=this._poseListeners.length-1;e>=0;e--)this._poseListeners[e].poseUpdated(this)},r.prototype.clone=function(){return new r(this._skeleton)},r}),define("goo/loaders/JsonUtils",["goo/renderer/BufferUtils","goo/math/Transform","goo/math/Matrix3x3","goo/math/Matrix4x4","goo/math/Vector3","goo/math/Quaternion"],function(e,t,n,r,i,s){function o(){}o.fillAttributeBufferFromCompressedString=function(e,t,n,r,i){var s=t.getAttributeBuffer(n),u=r.length,a=e.length/r.length,f,l,c,h,p;for(p=0;p<u;p++)if(r[p]===0)return;for(p=0;p<u;p++){f=0;for(h=0;h<a;h++){l=e.charCodeAt(h+p*a),c=h*u+p,f+=o.unzip(l);var d=(f+i[p])*r[p];s[c]=d}}},o.fillAttributeBuffer=function(e,t,n){var r=t.getAttributeBuffer(n);for(var i=0;i<e.length;i++)r[i]=e[i]},o.getIntBuffer=function(t,n){var r=e.createIndexBuffer(t.length,n);return r.set(t),r};var u=61404;return o.rewrap=function(e){var t=e%u;return t<0&&(t+=u),t},o.getIntBufferFromCompressedString=function(t,n){var r=0,i=e.createIndexBuffer(t.length,n);for(var s=0;s<t.length;++s){var u=t.charCodeAt(s),a=r+o.unzip(u);r=a,i[s]=this.rewrap(a)}return i},o.unzip=function(e){return e>=57344&&(e-=2048),e-=35,e=e>>1^-(e&1),e},o.parseTransform=function(e){var n=new t;return n.translation=o.parseVector3(e.translation),n.scale=o.parseVector3(e.scale),n.rotation=o.parseMatrix3(e.rotation),n},o.parseTransformQuat=function(e){var n=new t;return n.translation=o.parseVector3(e.translation),n.scale=o.parseVector3(e.scale),n.rotation=o.parseQuaternion(e.rotation).toRotationMatrix(),n},o.parseTransformEuler=function(e){var n=new t;n.translation=o.parseVector3(e.translation),n.scale=o.parseVector3(e.scale);var r=o.parseVector3(e.rotation);return n.setRotationXYZ(r.x,r.y,r.z),n},o.parseTransformMatrix=function(e){var n=new t;return n.matrix=o.parseMatrix4(e.matrix),n},o.parseMatrix3=function(e){var t=new n;return t.e00=e[0],t.e01=e[1],t.e02=e[2],t.e10=e[3],t.e11=e[4],t.e12=e[5],t.e20=e[6],t.e21=e[7],t.e22=e[8],t},o.parseMatrix4=function(e){var t=new r;return t.e00=e[0],t.e01=e[1],t.e02=e[2],t.e03=e[3],t.e10=e[4],t.e11=e[5],t.e12=e[6],t.e13=e[7],t.e20=e[8],t.e21=e[9],t.e22=e[10],t.e23=e[11],t.e30=e[12],t.e31=e[13],t.e32=e[14],t.e33=e[15],t},o.parseQuaternion=function(e){var t=new s;return t.x=e[0],t.y=e[1],t.z=e[2],t.w=e[3],t},o.parseVector3=function(e){return new i(e[0],e[1],e[2])},o.parseChannelTimes=function(e,t){var n=e.times;if(n){if(t){var r=e.timeOffsetScale,i=r[0],s=r[1];return o.parseFloatArrayFromCompressedString(n,[s],[i])}return n}return null},o.parseFloatLERPValues=function(e,t){var n=e.values;if(n){if(t){var r=e.offsetScale,i=r[0],s=r[1];return o.parseFloatArrayFromCompressedString(n,[s],[i])}return n}return null},o.parseRotationSamples=function(e,t,n){var r=e.rotationSamples;if(r){if(n){var i=1-(t+1>>1),s=1/-i;return o.parseFloatArrayFromCompressedString(r,[s,s,s,s],[i,i,i,i])}return o.parseQuaternionSamples(r)}return null},o.parseTranslationSamples=function(e,t,n){var r=e.uniformTranslation;if(r){var i=r,s=i[0],u=i[1],a=i[2],f=[];for(var l=0;l<t;l++)f[l*3+0]=s,f[l*3+1]=u,f[l*3+2]=a;return f}var c=e.translationSamples;if(c){if(n){var h=e.translationOffsetScale,p=h[0],d=h[1],v=h[2],m=h[3];return o.parseFloatArrayFromCompressedString(c,[m,m,m],[p,d,v])}return o.parseVector3Samples(c)}return null},o.parseScaleSamples=function(e,t,n){var r=e.uniformScale;if(r){var i=r,s=i[0],u=i[1],a=i[2],f=[];for(var l=0;l<t;l++)f[l*3+0]=s,f[l*3+1]=u,f[l*3+2]=a;return f}var c=e.scaleSamples;if(c){if(n){var h=e.scaleOffsetScale,p=h[0],d=h[1],v=h[2],i=h[3];return o.parseFloatArrayFromCompressedString(c,[i,i,i],[p,d,v])}return o.parseVector3Samples(c)}return null},o.parseQuaternionSamples=function(e){var t=e;if(!t)return null;var n=[],r=new s;for(var i=0,o=t.length;i<o;i++){var u=t[i];if(u==="*")n[i*4+0]=r.x,n[i*4+1]=r.y,n[i*4+2]=r.z,n[i*4+3]=r.w;else if(u instanceof Array&&u.length===4){var a=u[0],f=u[1],l=u[2],c=u[3];r.set(a,f,l,c),n[i*4+0]=r.x,n[i*4+1]=r.y,n[i*4+2]=r.z,n[i*4+3]=r.w}}return n},o.parseVector3Samples=function(e){var t=e;if(!t)return null;var n=[],r=new i;for(var s=0,o=t.length;s<o;s++){var u=t[s];if(u==="*")n[s*3+0]=r.x,n[s*3+1]=r.y,n[s*3+2]=r.z;else if(u instanceof Array&&u.length===3){var a=u[0],f=u[1],l=u[2];r.set(a,f,l),n[s*3+0]=r.x,n[s*3+1]=r.y,n[s*3+2]=r.z}}return n},o.parseFloatArrayFromCompressedString=function(e,t,n){var r=e,i=[],s=t.length,u=r.length/t.length,a,f,l,c,h;for(h=0;h<s;h++){a=0;for(c=0;c<u;c++){f=r.charCodeAt(c+h*u),l=c*s+h,a+=o.unzip(f);var p=(a+n[h])*t[h];i[l]=p}}return i},o}),define("goo/util/ArrayUtil",[],function(){var e={};return e.getTypedArray=function(e,t){var n=t[0],r=t[1],i=t[2];if(i==="float32")return new Float32Array(e,n,r);if(i==="uint8")return new Uint8Array(e,n,r);if(i==="uint16")return new Uint16Array(e,n,r);if(i==="uint32")return new Uint32Array(e,n,r);throw new Error("Binary format "+i+" is not supported")},e.remove=function(e,t,n){var r=-1;if(typeof n=="function"){for(var i=0;i<e.length;i++)if(n(e[i],t)){r=i;break}}else r=e.indexOf(t);r>-1&&e.splice(r,1)},e.find=function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return e[n];return null},e}),define("goo/loaders/handlers/MeshDataHandler",["goo/loaders/handlers/ConfigHandler","goo/renderer/MeshData","goo/animation/SkeletonPose","goo/loaders/JsonUtils","goo/util/PromiseUtil","goo/util/ArrayUtil"],function(e,t,n,r,i,s){function o(){e.apply(this,arguments),this._objects={}}return o.prototype=Object.create(e.prototype),e._registerClass("mesh",o),o.prototype.update=function(e,t){var n=this;return this._objects[e]?i.createDummyPromise(this._objects[e]):t.binaryRef?this.getConfig(t.binaryRef).then(function(r){if(!r)throw new Error("Binary mesh data was empty");return n._createMeshData(t,r).then(function(t){return n._objects[e]=t})}):this._createMeshData(t,null).then(function(t){return n._objects[e]=t})},o.prototype.remove=function(){},o.prototype._createMeshData=function(e,t){var n;e.compression&&e.compression.compressed&&(n={compressedVertsRange:e.compression.compressedVertsRange||16383,compressedColorsRange:e.compression.compressedColorsRange||255,compressedUnitVectorRange:e.compression.compressedUnitVectorRange||1023});var r=this._createMeshDataObject(e);return this._fillMeshData(r,e,t,n),i.createDummyPromise(r)},o.prototype._createMeshDataObject=function(e){var n,r,i,s,o,u,a=e.data||e;e.type==="SkinnedMesh"?(u=4,s=t.SKINMESH):(u=0,s=t.MESH),o=a.vertexCount;if(o===0)return null;a.indexLengths!=null?r=a.indexLengths[0]:a.indices!=null?r=a.indices.length:r=0,n={},a.vertices&&a.vertices.length>0&&(n.POSITION=t.createAttribute(3,"Float")),a.normals&&a.normals.length>0&&(n.NORMAL=t.createAttribute(3,"Float")),a.tangents&&a.tangents.length>0&&(n.TANGENT=t.createAttribute(4,"Float")),a.colors&&a.colors.length>0&&(n.COLOR=t.createAttribute(4,"Float")),u>0&&a.weights&&(n.WEIGHTS=t.createAttribute(4,"Float")),u>0&&a.joints&&(n.JOINTIDS=t.createAttribute(4,"Float"));if(a.textureCoords&&a.textureCoords.length>0)for(var f=0;f<a.textureCoords.length;f++)n["TEXCOORD"+f]=t.createAttribute(2,"Float");return i=new t(n,o,r),i.type=s,i},o.prototype._fillMeshData=function(e,n,i,o){var u=this,a=n.data||n,f;e.type===t.SKINMESH?f=4:f=0;var l=function(t,a){var f;if(a!=null?a.length:void 0)o&&typeof a=="string"?(f=u._getCompressionOptions(t,n,o),r.fillAttributeBufferFromCompressedString(a,e,t,f.scale,f.offset)):i?e.getAttributeBuffer(t).set(s.getTypedArray(i,a)):r.fillAttributeBuffer(a,e,t)};l(t.POSITION,a.vertices),l(t.NORMAL,a.normals),l(t.TANGENT,a.tangents),l(t.COLOR,a.colors),e.type===t.SKINMESH&&l(t.WEIGHTS,a.weights);if(a.textureCoords!=null&&a.textureCoords.length>0){var c=a.textureCoords;for(var h=0;h<c.length;h++){var p=c[h],d="TEXCOORD"+h;l(d,p.UVs||p)}}if(f>0&&a.joints!=null&&a.joints.length>0){var v=e.getAttributeBuffer(t.JOINTIDS),m=this._getIntBuffer(a.joints,32767,i,o);if(e.type===t.SKINMESH){var g=[],y=0;for(var b=0;b<m.length;b++){var w=m[b];g[w]===void 0&&(g[w]=y++),v.set([g[w]],b)}var E=[];for(var w=0;w<g.length;w++){var y=g[w];y!==null&&(E[y]=w)}e.paletteMap=E,e.weightsPerVertex=f}else for(var S=0;0<m.capacity();S++)v.putCast(S,m.get(S))}a.indices&&e.getIndexBuffer().set(this._getIntBuffer(a.indices,a.vertexCount,i,o)),a.indexModes&&(e.indexModes=a.indexModes.slice(0)),a.indexLengths&&(e.indexLengths=a.indexLengths.slice(0));if(a.boundingVolume){if(a.boundingVolume.type!=="BoundingBox")throw new Error("Bounding volume was not BoundingBox");e.boundingBox={min:a.boundingVolume.min,max:a.boundingVolume.max}}return e},o.prototype._getIntBuffer=function(e,t,n,i){return e?i?r.getIntBufferFromCompressedString(e,t):n?s.getTypedArray(n,e):r.getIntBuffer(e,t):null},o.prototype._getCompressionOptions=function(e,n,r){var i,s,o,u,a=n.data||n;if(e===t.POSITION)s=a.vertexOffsets,o={offset:[s.xOffset,s.yOffset,s.zOffset],scale:[a.vertexScale,a.vertexScale,a.vertexScale]};else if(e===t.WEIGHTS)i=0,u=1/r.compressedVertsRange,o={offset:[i],scale:[u]};else if(e===t.NORMAL)i=1-(r.compressedUnitVectorRange+1>>1),u=1/-i,o={offset:[i,i,i],scale:[u,u,u]};else if(e===t.TANGENT)i=1-(r.compressedUnitVectorRange+1>>1),u=1/-i,o={offset:[i,i,i,i],scale:[u,u,u,u]};else if(e===t.COLOR)i=0,u=1/(r.compressedColorsRange+1),o={offset:[i,i,i,i],scale:[u,u,u,u]};else if(e.substr(0,8)==="TEXCOORD"){var f=parseInt(e.substr(8),10),l=a.textureCoords[f];o={offset:l.UVOffsets,scale:l.UVScales}}return o},o}),define("goo/loaders/handlers/MeshRendererComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/entities/components/MeshRendererComponent","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil"],function(e,t,n,r,i,s,o){function u(){e.apply(this,arguments)}return u.prototype=Object.create(e.prototype),e._registerClass("meshRenderer",u),u.prototype.constructor=u,u.prototype._prepare=function(e){return o.defaults(e,{materialRefs:[],cullMode:"Dynamic",castShadows:!0,receiveShadows:!0,hidden:!1})},u.prototype._create=function(e){var n=new t;return e.setComponent(n),n},u.prototype.update=function(t,u){var a=this,f,l=e.prototype.update.call(this,t,u),c=u.materialRefs;if(!c||c.length===0){var h=n.createShader(r.uber,"DefaultShader"),p=new n;p.shader=h,f=s.createDummyPromise([p])}else{var d=[],v=function(e){return d.push(a._getMaterial(e))};for(var m=0;m<c.length;m++)v(c[m]);f=i.all(d)}return f.then(function(e){var t,n;if(l.materials&&l.materials.length){var r;for(var i=0;i<l.materials.length;i++){var s=l.materials[i];if(s.name==="gooSelectionIndicator"){r=s;break}}r&&e.push(r)}l.materials=e;for(t in u)n=u[t],t!=="materials"&&t!=="hidden"&&l.hasOwnProperty(t)&&(l[t]=o.clone(n));return l}).then(null,function(e){return console.error("Error handling materials "+e)})},u.prototype._getMaterial=function(e){var t=this;return this.getConfig(e).then(function(n){return t.updateObject(e,n,t.options)})},u}),define("goo/loaders/handlers/SceneHandler",["goo/loaders/handlers/ConfigHandler","goo/util/rsvp"],function(e,t){function n(){e.apply(this,arguments)}return n.prototype=Object.create(e.prototype),e._registerClass("scene",n),n.prototype._prepare=function(){},n.prototype._create=function(){},n.prototype.update=function(e,n){var r=this,i=[];if(n.entityRefs!=null&&n.entityRefs.length){var s=function(e){return i.push(r.getConfig(e).then(function(t){return r.updateObject(e,t,r.options)}))};for(var o=0;o<n.entityRefs.length;o++)s(n.entityRefs[o]);return t.all(i).then(function(e){for(var t=0;t<e.length;t++){var n=e[t];(r.options.beforeAdd==null||r.options.beforeAdd.apply==null||r.options.beforeAdd(n))&&n.addToWorld()}}).then(null,function(e){return console.error("Error updating entities: "+e)})}return console.warn("No entity refs in scene "+e),n},n.prototype.remove=function(){},n}),define("goo/loaders/handlers/ShaderHandler",["goo/loaders/handlers/ConfigHandler","goo/renderer/Material","goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/shaders/ShaderBuilder","goo/util/rsvp","goo/util/ObjectUtil"],function(e,t,n,r,i,s,o){function u(){e.apply(this,arguments)}return u.prototype=Object.create(e.prototype),e._registerClass("shader",u),u.prototype._create=function(){},u.prototype.update=function(e,n){var r;if(n!=null&&n.attributes!=null&&n.uniforms!=null){r={attributes:n.attributes,uniforms:n.uniforms};for(var u in r.uniforms){var a=r.uniforms[u];if(typeof a=="string"){var f=/^function\s?\(([^\)]*)\)\s*\{(.*)\}$/,l=a.match(f);if((l!=null?l.length:void 0)===3){var c=l[1].replace(" ","").split(","),h=l[2];r.uniforms[u]=new Function(c,h)}}}if(n.processors){r.processors=[];for(var p=0;p<n.processors.length;p++){var d=n.processors[p];if(!i[d])throw new Error("Unknown processor: "+d);r.processors.push(i[d].processor)}}n.defines&&(r.defines=n.defines)}else r=this._getDefaultShaderDefinition();var v=[this.getConfig(n.vshaderRef),this.getConfig(n.fshaderRef)];return s.all(v).then(function(i){var s,u;u=i[0],s=i[1];if(!u){console.warn("Vertex shader",n.vshaderRef,"in shader",e,"not found");return}if(!s){console.warn("Fragment shader",n.fshaderRef,"in shader",e,"not found");return}return o.extend(r,{attributes:n.attributes||{},uniforms:n.uniforms||{},vshader:u,fshader:s}),t.createShader(r,e)})},u.prototype.remove=function(){},u.prototype._getDefaultShaderDefinition=function(){return{attributes:{vertexPosition:n.POSITION,vertexNormal:n.NORMAL,vertexUV0:n.TEXCOORD0},uniforms:{viewMatrix:r.VIEW_MATRIX,projectionMatrix:r.PROJECTION_MATRIX,worldMatrix:r.WORLD_MATRIX,cameraPosition:r.CAMERA,lightPosition:r.LIGHT0,diffuseMap:r.DIFFUSE_MAP,materialAmbient:r.AMBIENT,materialDiffuse:r.DIFFUSE,materialSpecular:r.SPECULAR,materialSpecularPower:r.SPECULAR_POWER}}},u}),define("goo/animation/Skeleton",["goo/animation/Joint"],function(e){function t(e,t){this._name=e,this._joints=t}return t.prototype.clone=function(){var n=this._name,r=this._joints,i=[];for(var s=0,o=r.length;s<o;s++){var u=r[s],a=u._name,f=new e(a);f._index=u._index,f._parentIndex=u._parentIndex,f._inverseBindPose.copy(u._inverseBindPose),f._inverseBindPose.update(),i[s]=f}return new t(n,i)},t}),define("goo/loaders/handlers/SkeletonHandler",["goo/loaders/handlers/ConfigHandler","goo/animation/Joint","goo/animation/Skeleton","goo/animation/SkeletonPose","goo/loaders/JsonUtils","goo/util/PromiseUtil"],function(e,t,n,r,i,s){function o(){e.apply(this,arguments)}return o.prototype=Object.create(e.prototype),e._registerClass("skeleton",o),o.prototype._create=function(e){var s=[];for(var o=0;o<e.joints.length;o++){var u=e.joints[o],a=new t(u.name);a._index=Math.round(u.index),a._parentIndex=Math.round(u.parentIndex);var f;u.inverseBindPose.matrix?f=i.parseTransformMatrix:u.inverseBindPose.rotation.length===4?f=i.parseTransformQuat:u.inverseBindPose.rotation.length===3?f=i.parseTransformEuler:f=i.parseTransform,a._inverseBindPose.copy(f(u.inverseBindPose)),u.inverseBindPose.matrix||a._inverseBindPose.update(),s.push(a)}var l=new n(e.name,s),c=new r(l);return c.setToBindPose(),c},o.prototype.update=function(e,t){var n=this._create(t);return s.createDummyPromise(n)},o.prototype.remove=function(){},o}),define("goo/loaders/handlers/TextureHandler",["goo/loaders/handlers/ConfigHandler","goo/renderer/TextureCreator","goo/renderer/Texture","goo/loaders/dds/DdsLoader","goo/loaders/crunch/CrunchLoader","goo/loaders/tga/TgaLoader","goo/util/rsvp","goo/util/PromiseUtil","goo/renderer/Util","goo/util/ObjectUtil"],function(e,t,n,r,i,s,o,u,a,f){function l(){e.apply(this,arguments),this._objects={}}return l.prototype=Object.create(e.prototype),e._registerClass("texture",l),l.prototype.constructor=l,l.minFilters=["NearestNeighborNoMipMaps","NearestNeighborNearestMipMap","NearestNeighborLinearMipMap","BilinearNoMipMaps","BilinearNearestMipMap","Trilinear"],l.magFilters=["NearestNeighbor","Bilinear"],l.loaders={dds:r,crn:i,tga:s},l.prototype._prepare=function(e){f.defaults(e,{wrapU:"Repeat",wrapV:"Repeat",magFilter:"Bilinear",minFilter:"Trilinear",anisotropy:1,offset:[0,0],repeat:[1,1],flipY:!0})},l.prototype._create=function(e){var r=this._objects[e]=new n(a.clone(t.DEFAULT_TEXTURE_2D.image));return r.image.dataReady=!1,r},l.prototype.update=function(e,n,r){var i=n.url,s=i?i.split(".").pop().toLowerCase():void 0,a=r&&r.texture&&r.texture.reload!==undefined,c,h;if(s==="mp4"){h=new o.Promise;var p=new t;return c=p.loadTextureVideo(n.url,!0),u.createDummyPromise(c)}c=this._objects[e]||this._create(e),this._prepare(n),c.wrapS=n.wrapU,c.wrapT=n.wrapV,l.magFilters.indexOf(n.magFilter)!==-1&&(c.magFilter=n.magFilter),l.minFilters.indexOf(n.minFilter)!==-1&&(c.minFilter=n.minFilter),c.anisotropy=Math.max(n.anisotropy,1),c.offset.set(n.offset),c.repeat.set(n.repeat),c.flipY=n.flipY,c.setNeedsUpdate();if(!n.url)return console.log("Texture "+e+" has no url"),c.setImage(),u.createDummyPromise(c);if(!(a||n.url!==c.a&&(!c.image||!c.image.src||n.url!==c.image.src.slice(-n.url.length))))return u.createDummyPromise(c);if(s in l.loaders){var d=new l.loaders[s];c.a=i,h=this.getConfig(i).then(function(e){if(e&&e.preloaded)f.extend(c.image,e.image),c.format=e.format,c.needsUpdate=!0;else{if(!d.load)throw new Error("Loader for type "+s+" has no load() function");d.load(e,c,n.flipY,0,e.byteLength)}return c}).then(null,function(e){console.error("Error loading texture: ",e)})}else{if(s!=="jpg"&&s!=="jpeg"&&s!=="png"&&s!=="gif")throw new Error("Unknown texture type "+s);h=this.getConfig(i,!1).then(function(e){return c.setImage(e),c}).then(null,function(e){console.error("Error loading texture: ",e)})}return this.options&&this.options.dontWaitForTextures?u.createDummyPromise(c):h},l.prototype.remove=function(e){return console.log("Deleting texture "+e),delete this._objects[e]},l}),define("goo/loaders/handlers/TransformComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/entities/components/TransformComponent","goo/math/MathUtils","goo/math/Quaternion","goo/util/PromiseUtil","goo/util/ObjectUtil","goo/util/ArrayUtil"],function(e,t,n,r,i,s,o){function u(){e.apply(this,arguments)}return u.prototype=Object.create(e.prototype),u.prototype.constructor=u,e._registerClass("transform",u),u.prototype._prepare=function(e){return s.defaults(e,{translation:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})},u.prototype._create=function(e){var n=new t;return e.setComponent(n),n},u.prototype.update=function(t,s){var u=this,a=e.prototype.update.call(this,t,s);a.transform.translation.set(s.translation),s.rotation.length===3?a.transform.setRotationXYZ(n.radFromDeg(s.rotation[0]),n.radFromDeg(s.rotation[1]),n.radFromDeg(s.rotation[2])):s.rotation.length===4?(new r(s.rotation)).toRotationMatrix(a.transform.rotation):a.transform.rotation.set(s.rotation),a.transform.scale.set(s.scale);if(s.parentRef!=null){var f=this.getConfig(s.parentRef).then(function(e){return u.updateObject(s.parentRef,e,u.options).then(function(e){if(e==null)return console.warn("Could not find parent with ref "+s.parentRef);var t=a.parent;if(t==null||t.entity!==e)return e.transformComponent.attachChild(a)})});return f.then(function(){return a.setUpdated(),a})}return a.parent&&(console.log("Orphaned entity"),o.remove(a.parent.children,a),a.parent.setUpdated(),a.parent=null),a.setUpdated(),i.createDummyPromise(a)},u.prototype.remove=function(e){var t=e.transformComponent;t.transform.translation.set(0,0,0),t.transform.setRotationXYZ(0,0,0),t.transform.scale.set(1,1,1),t.setUpdated()},u}),define("goo/loaders/handlers/AnimationComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/entities/components/AnimationComponent","goo/math/MathUtils","goo/util/rsvp","goo/util/PromiseUtil"],function(e,t,n,r,i){function s(){e.apply(this,arguments)}return s.prototype=Object.create(e.prototype),s.prototype.constructor=s,e._registerClass("animation",s),s.prototype._prepare=function(){},s.prototype._create=function(e){var n=new t;return e.setComponent(n),n},s.prototype.update=function(t,n,s){var o=this,u,a,f=e.prototype.update.call(this,t,n);s&&s.animation&&s.animation.paused!==undefined&&(s.animation.paused?f.stop():f.resume());var l=n.layersRef,c=n.poseRef,h=[];return c?u=this.getConfig(c).then(function(e){o.updateObject(c,e,o.options).then(function(e){return f._skeletonPose=e})}):u=i.createDummyPromise(),h.push(u),l?a=this._getAnimationLayers(l).then(function(e){return f.layers=e}):(console.warn("No animation tree ref"),a=i.createDummyPromise([])),h.push(a),r.all(h).then(function(){return f})},s.prototype._getAnimationLayers=function(e){var t=this;return this.getConfig(e).then(function(n){return t.updateObject(e,n,t.options)})},s}),define("goo/animation/clip/AnimationClipInstance",["goo/entities/World"],function(e){function t(){this._active=!0,this._loopCount=0,this._timeScale=1,this._startTime=0,this._prevClockTime=0,this._prevUnscaledClockTime=0,this._clipStateObjects={}}return t.prototype.setTimeScale=function(t,n){var n=n||e.time;if(this._active&&this._timeScale!==t)if(this._timeScale!==0&&t!==0){var r=n,i=r-this._startTime;i*=this._timeScale,i/=t,this._startTime=r-i}else if(this._timeScale===0){var r=n;this._startTime=r-this._prevUnscaledClockTime}this._timeScale=t},t.prototype.getApplyTo=function(e){var t=e._channelName,n=this._clipStateObjects[t];return n||(n=e.createStateDataObject(),this._clipStateObjects[t]=n),n},t.prototype.clone=function(){var e=new t;return e._active=this._active,e._loopCount=this._loopCount,e._timeScale=this._timeScale,e},t}),define("goo/animation/blendtree/ClipSource",["goo/math/MathUtils","goo/animation/clip/AnimationClipInstance"],function(e,t){function n(e,n,r){this._clip=e,this._clipInstance=new t,this._filterChannels={},this._filter=null,this.setFilter(n,r),this._startTime=-Infinity,this._endTime=Infinity}return n.prototype.setFilter=function(e,t){if(e&&t){this._filter=["Exclude","Include"].indexOf(e)>-1?e:null;for(var n=0;n<t.length;n++)this._filterChannels[t[n]]=!0}else this._filter=null},n.prototype.setTime=function(t){var n=this._clipInstance;n._startTime||(n._startTime=t);var r,i;if(n._active){n._timeScale!==0?(n._prevUnscaledClockTime=t-n._startTime,r=n._timeScale*n._prevUnscaledClockTime,n._prevClockTime=r):r=n._prevClockTime;var s=Math.min(this._clip._maxTime,this._endTime),o=Math.max(this._startTime,0);i=s-o;if(s===-1)return!1;if(s!==0){n._loopCount===-1?r<0?(r*=-1,r%=i,r=i-r,r+=o):(r%=i,r+=o):n._loopCount>0&&i*n._loopCount>=Math.abs(r)&&(r<0?(r*=-1,r%=i,r=i-r,r+=o):(r%=i,r+=o));if(r>s||r<0)r=e.clamp(r,0,s),n._active=!1}this._clip.update(r,n)}return n._active},n.prototype.resetClips=function(e){this._clipInstance._startTime=e,this._clipInstance._active=!0},n.prototype.shiftClipTime=function(e){this._clipInstance._startTime+=e,this._clipInstance._active=!0},n.prototype.setTimeScale=function(e){this._clipInstance.setTimeScale(e)},n.prototype.isActive=function(){return this._clipInstance._active&&this._clip._maxTime!==-1},n.prototype.getSourceData=function(){if(!this._filter||!this._filterChannels)return this._clipInstance._clipStateObjects;var e=this._clipInstance._clipStateObjects,t={},n=this._filter==="Include";for(var r in e)this._filterChannels[r]!==undefined===n&&(t[r]=e[r]);return t},n.prototype.clone=function(){var e=new n(this._clip);e._clipInstance=this._clipInstance.clone(),e._filter=this._filter;for(var t in this._filterChannels)e._filterChannels[t]=this._filterChannels[t];return e._startTime=this._startTime,e._endTime=this._endTime,e},n}),define("goo/animation/clip/AbstractAnimationChannel",[],function(){function e(e,t,n){this._blendType=n||"Linear",this._channelName=e,(t instanceof Array||t instanceof Float32Array)&&t.length?this._times=new Float32Array(t):this._times=[],this._lastStartFrame=0}return e.prototype.getSampleCount=function(){return this._times.length},e.prototype.getMaxTime=function(){return this._times.length?this._times[this._times.length-1]:0},e.prototype.updateSample=function(e,t){var n=this._times.length;if(!n)return;var r=n-1;if(e<0||n===1)this.setCurrentSample(0,0,t);else if(e>=this._times[r])this.setCurrentSample(r,0,t);else{var i=0;if(e>=this._times[this._lastStartFrame]){i=this._lastStartFrame;for(var s=this._lastStartFrame;s<n-1;s++){if(this._times[s]>=e)break;i=s}}else for(var s=0;s<this._lastStartFrame;s++){if(this._times[s]>=e)break;i=s}var o=(e-this._times[i])/(this._times[i+1]-this._times[i]);this.setCurrentSample(i,o,t),this._lastStartFrame=i}},e}),define("goo/animation/clip/TransformChannel",["goo/animation/clip/AbstractAnimationChannel","goo/animation/clip/TransformData","goo/math/Quaternion","goo/math/Vector3"],function(e,t,n,r){function i(t,i,s,o,u,a){e.call(this,t,i,a);if(s.length/4!==i.length||o.length/3!==i.length||u.length/3!==i.length)throw new Error("All provided arrays must be the same length (accounting for type)! Channel: "+t);this._rotations=new Float32Array(s),this._translations=new Float32Array(o),this._scales=new Float32Array(u),this.tmpVec=new r,this.tmpQuat=new n,this.tmpQuat2=new n}return i.prototype=Object.create(e.prototype),i.prototype.createStateDataObject=function(){return new t},i.prototype.setCurrentSample=function(e,t,r){var i=r,s=e*4,o=e*3,u=(e+1)*4,a=(e+1)*3;if(t===0){i._rotation.data[0]=this._rotations[s+0],i._rotation.data[1]=this._rotations[s+1],i._rotation.data[2]=this._rotations[s+2],i._rotation.data[3]=this._rotations[s+3],i._translation.data[0]=this._translations[o+0],i._translation.data[1]=this._translations[o+1],i._translation.data[2]=this._translations[o+2],i._scale.data[0]=this._scales[o+0],i._scale.data[1]=this._scales[o+1],i._scale.data[2]=this._scales[o+2];return}if(t===1){i._rotation.data[0]=this._rotations[u+0],i._rotation.data[1]=this._rotations[u+1],i._rotation.data[2]=this._rotations[u+2],i._rotation.data[3]=this._rotations[u+3],i._translation.data[0]=this._translations[a+0],i._translation.data[1]=this._translations[a+1],i._translation.data[2]=this._translations[a+2],i._scale.data[0]=this._scales[a+0],i._scale.data[1]=this._scales[a+1],i._scale.data[2]=this._scales[a+2];return}i._rotation.data[0]=this._rotations[s+0],i._rotation.data[1]=this._rotations[s+1],i._rotation.data[2]=this._rotations[s+2],i._rotation.data[3]=this._rotations[s+3],this.tmpQuat.data[0]=this._rotations[u+0],this.tmpQuat.data[1]=this._rotations[u+1],this.tmpQuat.data[2]=this._rotations[u+2],this.tmpQuat.data[3]=this._rotations[u+3],i._rotation.equals(this.tmpQuat)||(n.slerp(i._rotation,this.tmpQuat,t,this.tmpQuat2),i._rotation.setv(this.tmpQuat2)),i._translation.data[0]=(1-t)*this._translations[o+0]+t*this._translations[a+0],i._translation.data[1]=(1-t)*this._translations[o+1]+t*this._translations[a+1],i._translation.data[2]=(1-t)*this._translations[o+2]+t*this._translations[a+2],i._scale.data[0]=(1-t)*this._scales[o+0]+t*this._scales[a+0],i._scale.data[1]=(1-t)*this._scales[o+1]+t*this._scales[a+1],i._scale.data[2]=(1-t)*this._scales[o+2]+t*this._scales[a+2]},i.prototype.getData=function(e,n){var r=n?n:new t;return this.setCurrentSample(e,0,r),r},i}),define("goo/animation/clip/JointChannel",["goo/animation/clip/TransformChannel","goo/animation/clip/JointData"],function(e,t){function n(t,n,r,i,s,o,u){e.call(this,t,r,i,s,o,u),this._jointName=t,this._jointIndex=n}return n.prototype=Object.create(e.prototype),n.JOINT_CHANNEL_NAME="_jnt",n.prototype.createStateDataObject=function(){return new t},n.prototype.setCurrentSample=function(t,n,r){e.prototype.setCurrentSample.call(this,t,n,r),r._jointIndex=this._jointIndex},n.prototype.getData=function(n,r){var i=r?r:new t;return e.prototype.getData.call(this,n,i),i._jointIndex=this._jointIndex,i},n}),define("goo/animation/blendtree/ManagedTransformSource",["goo/animation/clip/JointChannel","goo/animation/clip/JointData","goo/animation/clip/JointChannel","goo/animation/clip/JointData","goo/math/Vector3","goo/math/Quaternion"],function(e,t,n,r,i,s){function o(e){this._sourceName=e?e:null,this._data={}}return o.prototype.setTranslation=function(e,t){var n=this._data[e];n instanceof r&&n._translation.setv(t)},o.prototype.getTranslation=function(e,t){var n=this._data[e];return n instanceof r&&(t=t||new i,t.setv(n._translation)),t},o.prototype.setScale=function(e,t){var n=this._data[e];n instanceof r&&n._scale.setv(t)},o.prototype.getScale=function(e,t){var n=this._data[e];return n instanceof r&&(t=t||new i,t.setv(n._scale)),t},o.prototype.setRotation=function(e,t){var n=this._data[e];n instanceof r&&n._rotation.set(t)},o.prototype.getRotation=function(e,t){var n=this._data[e];return n instanceof r&&(t=t||new s,t.setv(n._rotation)),t},o.prototype.initFromClip=function(e,t,n){if(t==="Include"&&n&&n.length)for(var r=0,i=n.length;r<i;r++){var s=n[r],o=e.findChannelByName(s);if(o){var u=o.getData(0);this._data[s]=u}else console.error("Channel not in clip: "+s)}else for(var r=0,i=e._channels.length;r<i;r++){var o=e._channels[r],s=o._channelName;if(t==="Exclude"&&n&&n.length&&n.indexOf(s)>-1){var u=o.getData(0);this._data[s]=u}}},o.prototype.resetClips=function(){},o.prototype.setTimeScale=function(){},o.prototype.setTime=function(){return!0},o.prototype.isActive=function(){return!0},o.prototype.getChannelData=function(e){return this._data[e]},o.prototype.getSourceData=function(){return this._data},o.prototype.clone=function(){var e={};for(var t in this._data)e[t]=this._data[t].clone();return new o(this._sourceName,e)},o}),define("goo/animation/blendtree/FrozenClipSource",[],function(){function e(e,t){this._source=e,this._time=t}return e.prototype.getSourceData=function(){return this._source.getSourceData()},e.prototype.resetClips=function(){this._source.resetClips(0)},e.prototype.setTime=function(){return this._source.setTime(this._time),!0},e.prototype.isActive=function(){return!0},e.prototype.setTimeScale=function(){},e.prototype.clone=function(){var t=new e(this._source.clone(),this._time);return t},e}),define("goo/loaders/handlers/AnimationStateHandler",["goo/loaders/handlers/ConfigHandler","goo/animation/state/SteadyState","goo/animation/blendtree/ClipSource","goo/animation/blendtree/ManagedTransformSource","goo/animation/blendtree/BinaryLERPSource","goo/animation/blendtree/FrozenClipSource","goo/util/rsvp","goo/util/PromiseUtil"],function(e,t,n,r,i,s,o,u){function a(){e.apply(this,arguments),this._objects={}}return a.prototype=Object.create(e),a.prototype.constructor=a,e._registerClass("animstate",a),a.prototype.update=function(e,t){var n=this._objects[e]||this._create(e);return n._name=t.name,this._parseClipSource(t.clipSource,n._sourceTree).then(function(e){return n._sourceTree=e,n})},a.prototype.remove=function(e){this._objects[e]&&delete this._objects[e]},a.prototype._create=function(e){return this._objects[e]=new t},a.prototype._parseClipSource=function(e,t){var a=this;switch(e.type){case"Clip":return this.getConfig(e.clipRef).then(function(r){return a.updateObject(e.clipRef,r,a.options).then(function(r){return!t||!t instanceof n?t=new n(r,e.filter,e.channels):(t._clip=r,t.setFilter(e.filter,e.channels)),e.loopCount&&(t._clipInstance._loopCount=+e.loopCount),e.timeScale&&(t._clipInstance._timeScale=e.timeScale),t})});case"Managed":if(!t||!t instanceof r)t=new r;var f=t;return e.clipRef?this.getConfig(e.clipRef).then(function(t){return a.updateObject(e.clipRef,t,a.options)}).then(function(t){return f.initFromClip(t,e.filter,e.channels),f}):u.createDummyPromise(f);case"Lerp":var l=[this._parseClipSource(e.clipSourceA),this._parseClipSource(e.clipSourceB)];return o.all(l).then(function(t){var n=new i(t[0],t[1]);return e.blendWeight&&(n.blendWeight=e.blendWeight),n});case"Frozen":return this._parseClipSource(e.clipSource).then(function(n){return!!t&&t instanceof s?(t._source=n,t._time=e.frozenTime||0):t=new s(n,e.frozenTime||0),t});default:return console.error("Unable to parse clip source"),u.createDummyPromise()}},a}),define("goo/animation/state/AbstractTransitionState",["goo/animation/state/AbstractState","goo/animation/blendtree/BinaryLERPSource","goo/math/MathUtils"],function(e,t,n){function r(){e.call(this),this._sourceState=null,this._targetState=null,this._percent=0,this._sourceData=null,this._fadeTime=0,this._blendType="Linear"}return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype.update=function(e){var t=e-this._globalStartTime;if(t>this._fadeTime&&this.onFinished){this.onFinished();return}var r=t/this._fadeTime;switch(this._blendType){case"SCurve3":this._percent=n.scurve3(r);break;case"SCurve5":this._percent=n.scurve5(r);break;default:this._percent=r}},r.prototype.readFromConfig=function(e){e&&(e.fadeTime!==undefined&&(this._fadeTime=e.fadeTime),e.blendType!==undefined&&(this._blendType=e.blendType))},r.prototype.getCurrentSourceData=function(){var e=this._sourceState?this._sourceState.getCurrentSourceData():null,n=this._targetState?this._targetState.getCurrentSourceData():null;return this._sourceData||(this._sourceData={}),t.combineSourceData(e,n,this._percent,this._sourceData)},r.prototype.isValid=function(e,t){var n=t-this._sourceState._globalStartTime,r=e[0],i=e[1];return r<=0?i<=0?!0:n<=i:i<=0?n>=r:r<=i?r<=n&&n<=i:n>=r||n<=i},r.prototype.resetClips=function(t){e.prototype.resetClips.call(this,t),this._percent=0},r.prototype.shiftClipTime=function(t){e.prototype.shiftClipTime.call(this,t)},r.prototype.setTimeScale=function(e){this._sourceState&&this._sourceState.setTimeScale(e),this._targetState&&this._targetState.setTimeScale(e)},r}),define("goo/animation/state/FadeTransitionState",["goo/animation/state/AbstractTransitionState"],function(e){function t(){e.call(this)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.update=function(t){e.prototype.update.call(this,t),this._sourceState&&this._sourceState.update(t),this._targetState&&this._targetState.update(t)},t.prototype.postUpdate=function(){this._sourceState&&this._sourceState.postUpdate(),this._targetState&&this._targetState.postUpdate()},t.prototype.resetClips=function(t){e.prototype.resetClips.call(this,t),this._targetState&&this._targetState.resetClips(t)},t.prototype.shiftClipTime=function(t){e.prototype.shiftClipTime.call(this,t),this._targetState&&this._targetState.shiftClipTime(t),this._sourceState&&this._sourceState.shiftClipTime(t)},t}),define("goo/animation/state/SyncFadeTransitionState",["goo/animation/state/FadeTransitionState"],function(e){function t(){e.call(this)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.resetClips=function(t){e.prototype.resetClips.call(this,t),this._targetState.resetClips(this._sourceState._globalStartTime)},t.prototype.shiftClipTime=function(t){e.prototype.shiftClipTime.call(this,t),this._targetState.shiftClipTime(this._sourceState._globalStartTime+t),this._sourceState.shiftClipTime(t)},t}),define("goo/animation/state/FrozenTransitionState",["goo/animation/state/AbstractTransitionState"],function(e){function t(){e.call(this)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.update=function(t){e.prototype.update.call(this,t),this._targetState&&this._targetState.update(t)},t.prototype.postUpdate=function(){this._targetState&&this._targetState.postUpdate()},t.prototype.resetClips=function(t){e.prototype.resetClips.call(this,t),this._targetState.resetClips(t)},t.prototype.shiftClipTime=function(t){e.prototype.shiftClipTime.call(this,t),this._targetState.shiftClipTime(t)},t}),define("goo/loaders/handlers/AnimationLayersHandler",["goo/loaders/handlers/ConfigHandler","goo/animation/layer/AnimationLayer","goo/animation/layer/LayerLERPBlender","goo/animation/state/FadeTransitionState","goo/animation/state/SyncFadeTransitionState","goo/animation/state/FrozenTransitionState","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil"],function(e,t,n,r,i,s,o,u,a){function f(){e.apply(this,arguments),this._objects={}}return f.prototype=Object.create(e),e._registerClass("animation",f),f.prototype.update=function(e,t,n){var r=this._objects[e]||this._create(e),i=[];if(n&&n.animation&&n.animation.shallow){for(var s=0;s<t.layers.length;s++){var a=r[s];a._layerBlender&&(a._layerBlender._blendWeight=t.layers[s].blendWeight),t.layers[s].defaultState&&a._steadyStates[t.layers[s].defaultState]?a._currentState!==a._steadyStates[t.layers[s].defaultState]&&a.setCurrentStateByName(t.layers[s].defaultState,!0):a.setCurrentState()}return u.createDummyPromise(r)}if(t.layers instanceof Array)for(var s=0;s<t.layers.length;s++){var f=t.layers[s];i.push(this._parseLayer(f,r[s]))}else{var s=1;i.push(this._parseLayer(t.layers.DEFAULT,r[0]));for(var l in t.layers){var f=t.layers[l];l!=="DEFAULT"&&i.push(this._parseLayer(f,r[s++]))}}return o.all(i).then(function(e){r.length=0;for(var t=0;t<e.length;t++)r.push(e[t]);return r})},f.prototype.remove=function(e){this._objects[e]&&delete this._objects[e]},f.prototype._create=function(e){return this._objects[e]=[]},f.prototype._parseLayer=function(e,n){function s(e,t,n){return r.getConfig(t).then(function(i){return r.updateObject(t,i,r.options).then(function(r){return{state:r,ref:t,config:i,key:e,transitions:n}})})}var r=this;e.blendWeight===undefined&&(e.blendWeight=1),n?n._name=e.name:n=new t(e.name),n._layerBlender&&(e.blendWeight!==undefined?n._layerBlender._blendWeight=e.blendWeight:n._layerBlender._blendWeight=1);var i=[];for(var u in e.states)i.push(s(u,e.states[u].stateRef,e.states[u].transitions));return o.all(i).then(function(e){n._steadyStates={};for(var t=0;t<e.length;t++){var i=e[t];n._steadyStates[i.key]=i.state}for(var t=0;t<e.length;t++){var s=e[t].transitions,o=e[t].state;o._transitions={};if(s)for(var u in s){var f=s[u];if(n._steadyStates[u]||u==="*"){var l=a.clone(f);o._transitions[u]=l,n._transitionStates[l.type]||(n._transitionStates[l.type]=r._getTransitionByType(l.type))}}}}).then(function(){n._transitions={};if(e.transitions)for(var t in e.transitions){var i=e.transitions[t];if(n._steadyStates[t]||t==="*"){var s=a.clone(i);n._transitions[t]=s,n._transitionStates[s.type]||(n._transitionStates[s.type]=r._getTransitionByType(s.type))}}return e.defaultState&&n._steadyStates[e.defaultState]?n._currentState!==n._steadyStates[e.defaultState]&&n.setCurrentStateByName(e.defaultState,!0):n.setCurrentState(),n})},f.prototype._getTransitionByType=function(e){switch(e){case"Fade":return new r;case"SyncFade":return new i;case"Frozen":return new s;default:return console.log("Defaulting to frozen transition type"),new s}},f}),define("goo/animation/clip/AnimationClip",[],function(){function e(e,t){this._name=e,this._channels=t||[],this._maxTime=-1,this.updateMaxTimeIndex()}return e.prototype.update=function(e,t){for(var n=0,r=this._channels.length;n<r;++n){var i=this._channels[n],s=t.getApplyTo(i);i.updateSample(e,s)}},e.prototype.addChannel=function(e){this._channels.push(e),this.updateMaxTimeIndex()},e.prototype.removeChannel=function(e){var t=this._channels.indexOf(e);return t>=0?(this._channels.splice(t,1),this.updateMaxTimeIndex(),!0):!1},e.prototype.findChannelByName=function(e){for(var t=0,n=this._channels.length;t<n;++t){var r=this._channels[t];if(e===r._channelName)return r}return null},e.prototype.updateMaxTimeIndex=function(){this._maxTime=-1;var e;for(var t=0;t<this._channels.length;t++){var n=this._channels[t];e=n.getMaxTime(),e>this._maxTime&&(this._maxTime=e)}},e.prototype.toString=function(){return this._name+": "+this._channels.map(function(e){return e._channelName})},e}),define("goo/animation/clip/InterpolatedFloatChannel",["goo/animation/clip/AbstractAnimationChannel","goo/math/MathUtils"],function(e,t){function n(t,n,r,i){e.call(this,t,n,i),this._values=r?r.slice(0):null}return n.prototype=Object.create(e.prototype),n.prototype.createStateDataObject=function(){return[0]},n.prototype.setCurrentSample=function(e,n,r){r[0]=t.lerp(n,this._values[e],this._values[e+1])},n.prototype.getData=function(e,t){var n=t||[];return n[0]=this._values[e],n},n}),define("goo/animation/clip/TriggerChannel",["goo/animation/clip/AbstractAnimationChannel","goo/animation/clip/TriggerData"],function(e,t){function n(t,n,r,i){e.call(this,t,n,i),this._keys=r?r.slice(0):null,this.guarantee=!1}return n.prototype=Object.create(e.prototype),n.prototype.createStateDataObject=function(){return new t},n.prototype.setCurrentSample=function(e,t,n){var r=n._currentIndex,i=t!==1?e:e+1;if(r===i||!this.guarantee)n.arm(i,[this._keys[i]]);else{var s=[];if(r>i){for(var o=r+1;o<this._keys.length;o++)s.push(this._keys[o]);r=-1}for(var o=r+1;o<=i;o++)s.push(this._keys[o]);n.arm(i,s)}},n}),define("goo/loaders/handlers/AnimationClipHandler",["goo/loaders/handlers/ConfigHandler","goo/animation/clip/AnimationClip","goo/loaders/JsonUtils","goo/animation/clip/JointChannel","goo/animation/clip/TransformChannel","goo/animation/clip/InterpolatedFloatChannel","goo/animation/clip/TriggerChannel","goo/util/PromiseUtil","goo/util/ArrayUtil"],function(e,t,n,r,i,s,o,u,a){function f(){e.apply(this,arguments),this._objects={}}return f.prototype=Object.create(e.prototype),e._registerClass("clip",f),f.prototype._create=function(e){return this._objects[e]=new t},f.prototype.update=function(e,t){var n=this._objects[e]||this._create(e);n._name=t.name;var r,i=this;return t.binaryRef?this.getConfig(t.binaryRef).then(function(e){if(!e)throw new Error("Binary clip data was empty");return i._updateAnimationClip(t,e,n)}):(r=this._updateAnimationClip(t,null,n),u.createDummyPromise(r))},f.prototype._updateAnimationClip=function(e,t,u){u._channels=[];var f=e.useCompression||!1,l=null;f&&(l=e.compressedRange||32767);if(e.channels&&e.channels.length)for(var c=0;c<e.channels.length;c++){var h,p,d,v,m,g,y=e.channels[c];t?p=a.getTypedArray(t,y.times):p=new Float32Array(n.parseChannelTimes(y,f));var g=y.blendType,b=y.type;if(b==="Joint"||b==="Transform")t?(d=a.getTypedArray(t,y.rotationSamples),v=a.getTypedArray(t,y.translationSamples),m=a.getTypedArray(t,y.scaleSamples)):(d=n.parseRotationSamples(y,l,f),v=n.parseTranslationSamples(y,p.length,f),m=n.parseScaleSamples(y,p.length,f));if(b==="Joint")h=new r(y.jointName,y.jointIndex,p,d,v,m,g);else if(y.type==="Transform")h=new i(y.name,p,d,v,m,g);else if(y.type==="FloatLERP")h=new s(y.name,p,n.parseFloatLERPValues(y,f),g);else{if(y.type!=="Trigger"){console.warn("Unhandled channel type: "+y.type);continue}h=new o(y.name,p,y.keys),y.guarantee&&(h.guarantee=!0)}u.addChannel(h)}return u},f}),define("goo/util/Skybox",["goo/shapes/ShapeCreator","goo/shapes/Sphere","goo/renderer/MeshData","goo/renderer/Material","goo/renderer/Shader","goo/renderer/TextureCreator","goo/math/Transform"],function(e,t,n,r,i,s,o){function u(n,f,l,c){var h;if(n===u.SPHERE)this.meshData=e.createSphere(48,48,1,l||t.TextureModes.Projected),f instanceof Array&&(f=f[0]),f&&(h=(new s).loadTexture2D(f));else{if(n!==u.BOX)throw new Error("Unknown geometry type");this.meshData=e.createBox(1,1,1),f.length&&(h=(new s).loadTextureCube(f,{flipY:!1}))}var p=r.createMaterial(a[n],"Skybox material");p.setTexture(i.DIFFUSE_MAP,h),p.cullState.cullFace="Front",p.depthState.enabled=!1,p.renderQueue=1,this.materials=[p],this.transform=new o;var d=n===u.SPHERE?Math.PI/2:0;this.transform.rotation.fromAngles(d,c,0),this.transform.update(),this.active=!0}u.SPHERE="sphere",u.BOX="box";var a={};return a.box={attributes:{vertexPosition:n.POSITION},uniforms:{viewMatrix:i.VIEW_MATRIX,projectionMatrix:i.PROJECTION_MATRIX,worldMatrix:i.WORLD_MATRIX,cameraPosition:i.CAMERA,near:i.NEAR_PLANE,diffuseMap:i.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;","uniform float near;","varying vec3 eyeVec;","void main(void) {","	vec4 worldPos = worldMatrix * vec4(vertexPosition * near * 10.0, 1.0);"," worldPos += vec4(cameraPosition, 0.0);","	gl_Position = projectionMatrix * viewMatrix * worldPos;","	eyeVec = worldPos.xyz - cameraPosition;"," eyeVec.x = -eyeVec.x;"," eyeVec = (worldMatrix * vec4(eyeVec, 0.0)).xyz;","}"].join("\n"),fshader:["precision mediump float;","uniform samplerCube diffuseMap;","varying vec3 eyeVec;","void main(void)","{","	vec4 cube = textureCube(diffuseMap, eyeVec);","	gl_FragColor = cube;","}"].join("\n")},a.sphere={attributes:{vertexPosition:n.POSITION,vertexUV0:n.TEXCOORD0},uniforms:{viewMatrix:i.VIEW_MATRIX,projectionMatrix:i.PROJECTION_MATRIX,worldMatrix:i.WORLD_MATRIX,cameraPosition:i.CAMERA,near:i.NEAR_PLANE,diffuseMap:i.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;","uniform float near;","varying vec2 texCoord0;","varying vec3 eyeVec;","void main(void) {","	texCoord0 = vertexUV0;","	vec4 worldPos = worldMatrix * vec4(vertexPosition * near * 10.0, 1.0);"," worldPos += vec4(cameraPosition, 0.0);","	gl_Position = projectionMatrix * viewMatrix * worldPos;","	eyeVec = cameraPosition - worldPos.xyz;","}"].join("\n"),fshader:["precision mediump float;","uniform sampler2D diffuseMap;","varying vec2 texCoord0;","void main(void)","{","	gl_FragColor = texture2D(diffuseMap, texCoord0);","}"].join("\n")},u}),define("goo/renderer/RendererRecord",[],function(){function e(){this.currentBuffer={ArrayBuffer:{buffer:null,valid:!1},ElementArrayBuffer:{buffer:null,valid:!1}},this.currentFrameBuffer=null,this.clippingTestValid=!1,this.clippingTestEnabled=!1,this.clips=[],this.enabledTextures=0,this.texturesValid=!1,this.currentTextureArraysUnit=0,this.textureRecord=[],this.usedProgram=null,this.boundAttributes=[],this.depthRecord={},this.cullRecord={},this.blendRecord={},this.offsetRecord={},this.lineRecord={},this.pointRecord={}}return e.prototype.invalidateBuffer=function(e){this.currentBuffer[e].buffer=null,this.currentBuffer[e].valid=!1},e}),define("goo/renderer/pass/FullscreenUtil",["goo/shapes/ShapeCreator","goo/renderer/Camera","goo/math/Vector3"],function(e,t,n){function r(){}var i=new t;return i.projectionMode=t.Parallel,i.setFrustum(0,1,-1,1,1,-1),i._left.copy(n.UNIT_X).invert(),i._up.copy(n.UNIT_Y),i._direction.copy(n.UNIT_Z),i.onFrameChange(),r.camera=i,r.quad=e.createQuad(2,2),r}),define("goo/renderer/pass/FullscreenPass",["goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/shaders/ShaderLib"],function(e,t,n){function r(r){this.material=e.createMaterial(r||n.simple),this.useReadBuffer=!0,this.renderToScreen=!1,this.renderable={meshData:t.quad,materials:[this.material]},this.enabled=!0,this.clear=!1,this.needsSwap=!0}return r.prototype.render=function(e,n,r){this.useReadBuffer&&this.material.setTexture("DIFFUSE_MAP",r),this.renderToScreen?e.render(this.renderable,t.camera,[],null,this.clear):e.render(this.renderable,t.camera,[],n,this.clear)},r}),define("goo/renderer/shadow/ShadowHandler",["goo/math/Vector3","goo/renderer/pass/FullscreenPass","goo/renderer/Camera","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/renderer/pass/RenderTarget","goo/math/Vector4","goo/renderer/light/PointLight","goo/renderer/light/DirectionalLight","goo/renderer/light/SpotLight"],function(e,t,n,r,i,s,o,u,a,f){function l(){this.depthMaterial=r.createMaterial(i.lightDepth,"depthMaterial"),this.depthMaterial.cullState.cullFace="Back",this.fullscreenPass=new t,this.downsample=r.createShader(i.downsample,"downsample");var n=2;this.blurfilter=r.createShader(i.convolution,"blurfilter");var s=2*Math.ceil(n*3)+1;this.blurfilter.defines={KERNEL_SIZE_FLOAT:s.toFixed(1),KERNEL_SIZE_INT:s.toFixed(0)},this.blurfilter.uniforms.cKernel=i.convolution.buildKernel(n),this.oldClearColor=new o(0,0,0,0),this.shadowClearColor=new o(1,1,1,1),this.renderList=[],this.shadowList=[],this.tmpVec=new e,this.first=!0}return l.prototype._createShadowData=function(e){var t=e.resolution[0],n=e.resolution[1];e.shadowData=e.shadowData||{},e.shadowData.shadowTarget=new s(t,n,{type:"Float",magFilter:"NearestNeighbor",minFilter:"NearestNeighborNoMipMaps"}),e.shadowData.shadowResult=null,e.shadowType==="VSM"&&(e.shadowData.shadowTargetDown=new s(t/2,n/2,{type:"Float"}),e.shadowData.shadowBlurred=new s(t/2,n/2,{type:"Float"})),e.shadowRecord=e.shadowRecord||{},e.shadowRecord.resolution=e.shadowRecord.resolution||[],e.shadowRecord.resolution[0]=t,e.shadowRecord.resolution[0]=t,e.shadowRecord.shadowType=e.shadowType},l.prototype._testStatesEqual=function(e,t){var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(var i=0;i<n.length;i++){var s=n[i];if(e[s]!==t[s])return!1}return!0},l.prototype.checkShadowRendering=function(t,r,i,s){if(this.first===!0){this.first=!1;return}this.shadowResults=[],this.shadowLights=[];for(var o=0;o<s.length;o++){var a=s[o];if(a.shadowCaster||a.lightCookie){var l=a.shadowSettings;l.shadowData||(this._createShadowData(l),l.shadowData.lightCamera=new n(55,1,1,1e3));var c=l.shadowRecord,h=l.shadowData.lightCamera;h.translation.copy(a.translation),a.direction?(this.tmpVec.setv(a.translation).addv(a.direction),h.lookAt(this.tmpVec,l.upVector)):h.lookAt(e.ZERO,l.upVector);if(c.angle!==a.angle||!c.resolution||c.resolution[0]!==l.resolution[0]||c.resolution[1]!==l.resolution[1]||c.near!==l.near||c.far!==l.far||c.size!==l.size){(!c.resolution||c.resolution[0]!==l.resolution[0]||c.resolution[1]!==l.resolution[1])&&this._createShadowData(l);if(a instanceof f)h.setFrustumPerspective(a.angle,l.resolution[0]/l.resolution[1],l.near,l.far);else if(a instanceof u)h.setFrustumPerspective(90,l.resolution[0]/l.resolution[1],l.near,l.far);else{var p=l.size;h.setFrustum(l.near,l.far,-p,p,p,-p),h.projectionMode=n.Parallel}h.update(),c.resolution=c.resolution||[],c.resolution[0]=l.resolution[0],c.resolution[1]=l.resolution[1],c.angle=a.angle,c.near=l.near,c.far=l.far,c.size=l.size}l.shadowType==="VSM"&&c.shadowType!==l.shadowType&&(this._createShadowData(l),c.shadowType=l.shadowType),h.onFrameChange();if(a.shadowCaster){this.depthMaterial.shader.defines.SHADOW_TYPE=l.shadowType==="VSM"?2:0,this.depthMaterial.uniforms.cameraScale=1/(h.far-h.near),this.oldClearColor.copy(t.clearColor),t.setClearColor(this.shadowClearColor.r,this.shadowClearColor.g,this.shadowClearColor.b,this.shadowClearColor.a),this.shadowList.length=0;for(var d=0;d<i.length;d++){var v=i[d];v.meshRendererComponent&&v.meshRendererComponent.castShadows&&!v.isSkybox&&this.shadowList.push(v)}r.process(h,this.shadowList,this.renderList),t.render(this.renderList,h,[],l.shadowData.shadowTarget,!0,this.depthMaterial);switch(l.shadowType){case"VSM":this.fullscreenPass.material.shader=this.downsample,this.fullscreenPass.render(t,l.shadowData.shadowTargetDown,l.shadowData.shadowTarget,0),this.fullscreenPass.material.shader=this.blurfilter,this.fullscreenPass.material.uniforms.uImageIncrement=[2/l.resolution[0],0],this.fullscreenPass.render(t,l.shadowData.shadowBlurred,l.shadowData.shadowTargetDown,0),this.fullscreenPass.material.uniforms.uImageIncrement=[0,2/l.resolution[1]],this.fullscreenPass.render(t,l.shadowData.shadowTargetDown,l.shadowData.shadowBlurred,0),l.shadowData.shadowResult=l.shadowData.shadowTargetDown;break;case"PCF":l.shadowData.shadowResult=l.shadowData.shadowTarget;break;case"Basic":l.shadowData.shadowResult=l.shadowData.shadowTarget;break;default:l.shadowData.shadowResult=l.shadowData.shadowTarget}t.setClearColor(this.oldClearColor.r,this.oldClearColor.g,this.oldClearColor.b,this.oldClearColor.a)}}}},l}),define("goo/entities/Bus",["goo/util/ArrayUtil"],function(e){function t(){this.trie={name:"",listeners:[],children:{}}}return t.prototype.emit=function(e,t,n){typeof e=="string"&&(e=[e]);for(var r=0;r<e.length;r++)this._emitToSingle(e[r],t,n)},t.prototype._getNode=function(e,t){var n=this.trie,r=e.split(".");for(var i=0;i<r.length;i++){var s=r[i];if(n.children[s])n=n.children[s];else{if(!t)return;var o={listeners:[],children:[]};n.children[s]=o,n=o}}return n},t.prototype._emitToSingle=function(e,t,n){var r=this._getNode(e,n);r&&(this._emitToAll(r,t),n&&(r.latestData=t))},t.prototype._emitToAll=function(e,t){for(var n=0;n<e.listeners.length;n++)e.listeners[n](t);var r=Object.keys(e.children);for(var n=0;n<r.length;n++)this._emitToAll(e.children[r],t)},t.prototype.addListener=function(e,t,n){var r=this.trie,i=e.split(".");for(var s=0;s<i.length;s++){var o=i[s];if(r.children[o])r=r.children[o];else{var u={listeners:[],children:[]};r.children[o]=u,r=u}}r.listeners.indexOf(t)===-1&&(r.listeners.push(t),n&&r.latestData&&t(r.latestData))},t.prototype.removeListener=function(t,n){var r=this._getNode(t);r&&e.remove(r.listeners,n)},t.prototype.removeAllOnChannel=function(e){var t=this._getNode(e);t&&(t.listeners=[])},t.prototype.removeChannelAndChildren=function(e){var t=e.split("."),n=t.pop(),r=t.join("."),i=this._getNode(r);delete i.children[n]},t.prototype._removeListener=function(t,n){e.remove(t.listeners,n);var r=Object.keys(t.children);for(var i=0;i<r.length;i++)this._removeListener(t.children[r[i]],n)},t.prototype.removeListenerFromAllChannels=function(e){this._removeListener(this.trie,e)},t}),define("goo/entities/SystemBus",["goo/entities/Bus"],function(e){return new e}),define("goo/renderer/Renderer",["goo/renderer/RendererRecord","goo/renderer/Util","goo/renderer/TextureCreator","goo/renderer/pass/RenderTarget","goo/math/Vector4","goo/entities/Entity","goo/renderer/Texture","goo/loaders/dds/DdsLoader","goo/loaders/dds/DdsUtils","goo/renderer/Material","goo/math/Transform","goo/renderer/RenderQueue","goo/renderer/shaders/ShaderLib","goo/renderer/shadow/ShadowHandler","goo/entities/SystemBus"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){function m(t){t=t||{};var n=t.canvas;n===undefined&&(n=document.createElement("canvas"),n.width=500,n.height=500),n.screencanvas=!0,this.domElement=n,this._alpha=t.alpha!==undefined?t.alpha:!1,this._premultipliedAlpha=t.premultipliedAlpha!==undefined?t.premultipliedAlpha:!0,this._antialias=t.antialias!==undefined?t.antialias:!0,this._stencil=t.stencil!==undefined?t.stencil:!1,this._preserveDrawingBuffer=t.preserveDrawingBuffer!==undefined?t.preserveDrawingBuffer:!1,this._onError=t.onError;var r={alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:this._stencil,preserveDrawingBuffer:this._preserveDrawingBuffer};this.context=null;if(!window.WebGLRenderingContext)throw{name:"GooWebGLError",message:"WebGL is not supported",supported:!1,enabled:!1};var s=["experimental-webgl","webgl","moz-webgl","webkit-3d"];for(var o=0;o<s.length;o++)try{this.context=n.getContext(s[o],r);if(this.context&&typeof this.context.getParameter=="function")break}catch(l){}if(!this.context)throw{name:"GooWebGLError",message:"WebGL is supported but disabled",supported:!0,enabled:!1};if(t.debug){var h=new XMLHttpRequest;h.open("GET","/js/goo/lib/webgl-debug.js",!1),h.onreadystatechange=function(){h.readyState===4&&h.status>=200&&h.status<=299&&window.eval.call(window,h.responseText)},h.send(null),typeof window.WebGLDebugUtils=="undefined"?console.warn("You need to include webgl-debug.js in your script definition to run in debug mode."):(console.log("Running in webgl debug mode."),t.validate?(console.log('Running with "undefined arguments" validation.'),this.context=window.WebGLDebugUtils.makeDebugContext(this.context,this.onDebugError.bind(this),g)):this.context=window.WebGLDebugUtils.makeDebugContext(this.context,this.onDebugError.bind(this)))}this.rendererRecord=new e,this.glExtensionCompressedTextureS3TC=u.SUPPORTS_DDS=a.isSupported(this.context),this.glExtensionTextureFloat=this.context.getExtension("OES_texture_float"),this.glExtensionTextureFloatLinear=this.context.getExtension("OES_texture_float_linear"),this.glExtensionTextureHalfFloat=this.context.getExtension("OES_texture_half_float"),this.glExtensionStandardDerivatives=this.context.getExtension("OES_standard_derivatives"),this.glExtensionTextureFilterAnisotropic=this.context.getExtension("EXT_texture_filter_anisotropic")||this.context.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.context.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.glExtensionDepthTexture=this.context.getExtension("WEBGL_depth_texture")||this.context.getExtension("WEBKIT_WEBGL_depth_texture")||this.context.getExtension("MOZ_WEBGL_depth_texture"),this.glExtensionElementIndexUInt=this.context.getExtension("OES_element_index_uint"),this.glExtensionTextureFloat||console.log("Float textures not supported."),this.glExtensionTextureFloatLinear||console.log("Float textures with linear filtering not supported."),this.glExtensionStandardDerivatives||console.log("Standard derivatives not supported."),this.glExtensionTextureFilterAnisotropic||console.log("Anisotropic texture filtering not supported."),this.glExtensionCompressedTextureS3TC||console.log("S3TC compressed textures not supported."),this.glExtensionDepthTexture||console.log("Depth textures not supported."),this.glExtensionElementIndexUInt||console.log("32 bit indices not supported."),this.context.getShaderPrecisionFormat===undefined&&(this.context.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),this.capabilities={maxTexureSize:this.context.getParameter(v.MAX_TEXTURE_SIZE),maxCubemapSize:this.context.getParameter(v.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderbufferSize:this.context.getParameter(v.MAX_RENDERBUFFER_SIZE),maxViewPortDims:this.context.getParameter(v.MAX_VIEWPORT_DIMS),maxAnisotropy:this.glExtensionTextureFilterAnisotropic?this.context.getParameter(this.glExtensionTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,maxVertexTextureUnits:this.context.getParameter(v.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxFragmentTextureUnits:this.context.getParameter(v.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTextureUnits:this.context.getParameter(v.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.context.getParameter(v.MAX_VERTEX_ATTRIBS),maxVertexUniformVectors:this.context.getParameter(v.MAX_VERTEX_UNIFORM_VECTORS),maxFragmentUniformVectors:this.context.getParameter(v.MAX_FRAGMENT_UNIFORM_VECTORS),maxVaryingVectors:this.context.getParameter(v.MAX_VARYING_VECTORS),aliasedPointSizeRange:this.context.getParameter(v.ALIASED_POINT_SIZE_RANGE),aliasedLineWidthRange:this.context.getParameter(v.ALIASED_LINE_WIDTH_RANGE),samples:this.context.getParameter(v.SAMPLES),sampleBuffers:this.context.getParameter(v.SAMPLE_BUFFERS),depthBits:this.context.getParameter(v.DEPTH_BITS),stencilBits:this.context.getParameter(v.STENCIL_BITS),subpixelBits:this.context.getParameter(v.SUBPIXEL_BITS),supportedExtensionsList:this.context.getSupportedExtensions(),renderer:this.context.getParameter(v.RENDERER),vendor:this.context.getParameter(v.VENDOR),version:this.context.getParameter(v.VERSION),shadingLanguageVersion:this.context.getParameter(v.SHADING_LANGUAGE_VERSION),vertexShaderHighpFloat:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.HIGH_FLOAT),vertexShaderMediumpFloat:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.MEDIUM_FLOAT),vertexShaderLowpFloat:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.LOW_FLOAT),fragmentShaderHighpFloat:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.HIGH_FLOAT),fragmentShaderMediumpFloat:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.MEDIUM_FLOAT),fragmentShaderLowpFloat:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.LOW_FLOAT),vertexShaderHighpInt:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.HIGH_INT),vertexShaderMediumpInt:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.MEDIUM_INT),vertexShaderLowpInt:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.LOW_INT),fragmentShaderHighpInt:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.HIGH_INT),fragmentShaderMediumpInt:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.MEDIUM_INT),fragmentShaderLowpInt:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.LOW_INT)},this.maxTextureSize=isNaN(t.maxTextureSize)?this.capabilities.maxTexureSize:Math.min(t.maxTextureSize,this.capabilities.maxTexureSize),this.shaderPrecision=t.shaderPrecision||"highp",this.shaderPrecision==="highp"&&this.capabilities.vertexShaderHighpFloat.precision>0&&this.capabilities.fragmentShaderHighpFloat.precision>0?this.shaderPrecision="highp":this.shaderPrecision!=="lowp"&&this.capabilities.vertexShaderMediumpFloat.precision>0&&this.capabilities.fragmentShaderMediumpFloat.precision>0?this.shaderPrecision="mediump":this.shaderPrecision="lowp",this.downScale=t.downScale||1,this.clearColor=new i,this._clearColor=new Float64Array(4),this.setClearColor(.3,.3,.3,1),this.context.clearDepth(1),this.context.clearStencil(0),this.context.stencilMask(0),this.context.enable(v.DEPTH_TEST),this.context.depthFunc(v.LEQUAL),this.viewportX=0,this.viewportY=0,this.viewportWidth=0,this.viewportHeight=0,this.currentWidth=0,this.currentHeight=0,this._overrideMaterials=[],this._mergedMaterial=new f("Merged Material"),this.renderQueue=new c,this.info={calls:0,vertices:0,indices:0,reset:function(){this.calls=0,this.vertices=0,this.indices=0},toString:function(){return"Calls: "+this.calls+" Vertices: "+this.vertices+" Indices: "+this.indices}},this.shadowHandler=new p,this.hardwarePicking=null}function g(e,t){for(var n=0;n<t.length;++n)t[n]===undefined&&console.error("undefined passed to gl."+e+"("+window.WebGLDebugUtils.glFunctionArgsToString(e,t)+")")}var v=window.WebGLRenderingContext;return m.prototype.onDebugError=function(e,t,n){var r="WebGL error "+window.WebGLDebugUtils.glEnumToString(e)+" in "+t+"(";for(var i=0;i<n.length;++i)r+=(i===0?"":", ")+window.WebGLDebugUtils.glFunctionArgToString(t,i,n[i]);r+=")",console.error(r),this._onError&&this._onError(r)},m.mainCamera=null,d.addListener("goo.setCurrentCamera",function(e){m.mainCamera=e.camera}),m.prototype.checkResize=function(e){var t=window.devicePixelRatio||1,n,r;document.querySelector?(n=this.domElement.offsetWidth,r=this.domElement.offsetHeight):(n=window.innerWidth,r=window.innerHeight),n=n*t/this.downScale,r=r*t/this.downScale;var i=n,s=r;e&&e.lockedRatio===!0&&e.aspect&&(n=r*e.aspect);var o=n/r;this.setSize(n,r,i,s),e&&e.lockedRatio===!1&&e.aspect!==o&&(e.aspect=o,e.projectionMode===0?e.setFrustumPerspective():e.setFrustum(),e.onFrameChange())},m.prototype.setSize=function(e,t,n,r){n===undefined&&(n=e),r===undefined&&(r=t),this.domElement.width=n,this.domElement.height=r;if(e>n){var i=n/e;e=n,t=r*i}var s=(n-e)*.5,o=(r-t)*.5;(s!==this.viewportX||o!==this.viewportY||e!==this.viewportWidth||t!==this.viewportHeight)&&this.setViewport(s,o,e,t),this.hardwarePicking!==null&&(this.hardwarePicking.pickingTarget=null)},m.prototype.setViewport=function(e,t,n,r){this.viewportX=e!==undefined?e:0,this.viewportY=t!==undefined?t:0,this.viewportWidth=n!==undefined?n:this.domElement.width,this.viewportHeight=r!==undefined?r:this.domElement.height,this.context.viewport(this.viewportX,this.viewportY,this.viewportWidth,this.viewportHeight),d.emit("goo.viewportResize",{x:this.viewportX,y:this.viewportY,width:this.viewportWidth,height:this.viewportHeight},!0)},m.prototype.setClearColor=function(e,t,n,r){if(this._clearColor[0]===e&&this._clearColor[1]===t&&this._clearColor[2]===n&&this._clearColor[3]===r)return;this._clearColor[0]=e,this._clearColor[1]=t,this._clearColor[2]=n,this._clearColor[3]=r,this.clearColor.seta(this._clearColor),this.context.clearColor(e,t,n,r)},m.prototype.bindData=function(e){var t=e.glBuffer;t!==null?(this.setBoundBuffer(t,e.target),e._dataNeedsRefresh&&(this.context.bufferSubData(this.getGLBufferTarget(e.target),0,e.data),e._dataNeedsRefresh=!1)):(t=this.context.createBuffer(),e.glBuffer=t,this.rendererRecord.invalidateBuffer(e.target),this.setBoundBuffer(t,e.target),this.context.bufferData(this.getGLBufferTarget(e.target),e.data,this.getGLBufferUsage(e._dataUsage)))},m.prototype.setShadowType=function(e){this.shadowHandler.shadowType=e},m.prototype.updateShadows=function(e,t,n){this.shadowHandler.checkShadowRendering(this,e,t,n)},m.prototype.render=function(e,n,r,i,s,o){o?this._overrideMaterials=o instanceof Array?o:[o]:this._overrideMaterials=[];if(!n)return;m.mainCamera===null&&(m.mainCamera=n),this.setRenderTarget(i),s===undefined||s===null||s===!0?this.clear():typeof s=="object"&&this.clear(s.color,s.depth,s.stencil);var u={camera:n,mainCamera:m.mainCamera,lights:r,shadowHandler:this.shadowHandler,renderer:this};if(Array.isArray(e)){this.renderQueue.sort(e,n);for(var a=0;a<e.length;a++){var f=e[a];if(f.isSkybox&&this._overrideMaterials.length>0)continue;this.fillRenderInfo(f,u),this.renderMesh(u)}}else this.fillRenderInfo(e,u),this.renderMesh(u);i&&i.generateMipmaps&&t.isPowerOfTwo(i.width)&&t.isPowerOfTwo(i.height)&&this.updateRenderTargetMipmap(i)},m.prototype.fillRenderInfo=function(e,t){e instanceof s?(t.meshData=e.meshDataComponent.meshData,t.materials=e.meshRendererComponent.materials,t.transform=e.particleComponent?l.IDENTITY:e.transformComponent.worldTransform,e.meshDataComponent.currentPose?t.currentPose=e.meshDataComponent.currentPose:delete t.currentPose):(t.meshData=e.meshData,t.materials=e.materials,t.transform=e.transform,e.currentPose?t.currentPose=e.currentPose:delete t.currentPose),t.renderable=e},m.prototype._override=function(e,t,n){n.empty();var r=Object.keys(n);for(var i=0,s=r.length;i<s;i++){var o=r[i],u=n[o],a=e[o],f=t[o];if(u instanceof Object&&o!=="shader"){var l=Object.keys(a);for(var c=0,h=l.length;c<h;c++){var p=l[c];u[p]=a[p]}var l=Object.keys(f);for(var c=0,h=l.length;c<h;c++){var p=l[c];u[p]===undefined&&(u[p]=f[p])}}else a!==undefined?n[o]=a:n[o]=f}},m.prototype.renderMesh=function(e){var t=e.meshData;if(t.vertexData===null||t.vertexData!==null&&t.vertexData.data.byteLength===0||t.indexData!==null&&t.indexData.data.byteLength===0)return;this.bindData(t.vertexData);var n=e.materials,r=null,i=t,s=0;this._overrideMaterials.length===0?s=n.length:s=this._overrideMaterials.length;for(var o=0;o<s;o++){var u=null,a=null;o<n.length&&(u=n[o]),o<this._overrideMaterials.length&&(a=this._overrideMaterials[o]),u&&a?(this._override(a,u,this._mergedMaterial),u=this._mergedMaterial):a&&(u=a);if(!u.shader){u.errorOnce||(console.warn("No shader set on material: "+u.name),u.errorOnce=!0);continue}u.errorOnce=!1,u.wireframe&&r!=="wire"?(t.wireframeData||(t.wireframeData=t.buildWireframeData()),t=t.wireframeData,this.bindData(t.vertexData),r="wire"):u.flat&&r!=="flat"?(t.flatMeshData||(t.flatMeshData=t.buildFlatMeshData()),t=t.flatMeshData,this.bindData(t.vertexData),r="flat"):!u.wireframe&&!u.flat&&r!==null&&(t=i,this.bindData(t.vertexData),r=null),e.material=u,e.meshData=t;var f=u.shader;if(f.processors||f.defines){if(f.processors)for(var l=0;l<f.processors.length;l++)f.processors[l](f,e);var c=Object.keys(f.defines),h=c.length,p=[];for(var l=0;l<h;l++){var d=c[l];p.push(d+"_"+f.defines[d])}p.sort();var v=p.join("_")+"_"+f.name,m=this.rendererRecord.shaderCache=this.rendererRecord.shaderCache||{};if(!m[v])f.builder&&f.builder(f,e),f=u.shader=f.clone(),m[v]=f;else{f=m[v];if(f!==u.shader){var g=u.shader.uniforms,y=Object.keys(g);for(var b=0,w=y.length;b<w;b++){var d=y[b];f.uniforms[d]=g[d]}u.shader=f}}}f.apply(e,this),this.updateDepthTest(u),this.updateCulling(u),this.updateBlending(u),this.updateOffset(u),this.updateTextures(u),this.updateLineAndPointSettings(u),this._checkDualTransparency(u,t),this.updateCulling(u),this._drawBuffers(t),this.info.calls++,this.info.vertices+=t.vertexCount,this.info.indices+=t.indexCount}},m.prototype._drawBuffers=function(e){e.getIndexBuffer()!==null?(this.bindData(e.getIndexData()),e.getIndexLengths()!==null?this.drawElementsVBO(e.getIndexBuffer(),e.getIndexModes(),e.getIndexLengths()):this.drawElementsVBO(e.getIndexBuffer(),e.getIndexModes(),[e.getIndexBuffer().length])):e.getIndexLengths()!==null?this.drawArraysVBO(e.getIndexModes(),e.getIndexLengths()):this.drawArraysVBO(e.getIndexModes(),[e.vertexCount])},m.prototype._checkDualTransparency=function(e,t){if(e.dualTransparency){var n=e.cullState.cullFace,r=n==="Front"?"Back":"Front";e.cullState.cullFace=r,this.updateCulling(e),this._drawBuffers(t),e.cullState.cullFace=n}},m.prototype.readPixels=function(e,t,n,r,i){this.context.readPixels(e,t,n,r,v.RGBA,v.UNSIGNED_BYTE,i)},m.prototype.drawElementsVBO=function(e,t,n){var r=0,i=0,s=e.type=e.type||this.getGLArrayType(e),o=this.getGLByteSize(e);for(var u=0;u<n.length;u++){var a=n[u],f=this.getGLIndexMode(t[i]);this.context.drawElements(f,a,s,r*o),r+=a,i<t.length-1&&i++}},m.prototype.drawArraysVBO=function(e,t){var n=0,r=0;for(var i=0;i<t.length;i++){var s=t[i],o=this.getGLIndexMode(e[r]);this.context.drawArrays(o,n,s),n+=s,r<e.length-1&&r++}},m.prototype.renderToPick=function(e,t,n,s,o,u,a,l){if(this.viewportWidth*this.viewportHeight===0)return;var c=4;if(this.hardwarePicking===null){var p=f.createEmptyMaterial(h.pickingShader,"pickingMaterial");p.blendState={blending:"NoBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"},this.hardwarePicking={pickingTarget:new r(this.viewportWidth/c,this.viewportHeight/c,{minFilter:"NearestNeighborNoMipMaps",magFilter:"NearestNeighbor"}),pickingMaterial:p,pickingBuffer:new Uint8Array(4),clearColorStore:new i},s=!1}else this.hardwarePicking.pickingTarget===null&&(this.hardwarePicking.pickingTarget=new r(this.viewportWidth/c,this.viewportHeight/c,{minFilter:"NearestNeighborNoMipMaps",magFilter:"NearestNeighbor"}),s=!1);if(!s){this.hardwarePicking.clearColorStore.setv(this.clearColor);if(o&&u!==undefined&&a!==undefined){var d=window.devicePixelRatio||1,m=Math.floor((u*d-this.viewportX)/c),g=Math.floor((this.viewportHeight-(a*d-this.viewportY))/c);this.context.enable(v.SCISSOR_TEST),this.context.scissor(m,g,1,1)}var y=[];for(var b=0,w=e.length;b<w;b++){var E=e[b];(!E.meshRendererComponent||E.meshRendererComponent.isPickable)&&y.push(E)}this.render(y,t,[],this.hardwarePicking.pickingTarget,n,l||this.hardwarePicking.pickingMaterial),o&&this.context.disable(v.SCISSOR_TEST)}else this.setRenderTarget(this.hardwarePicking.pickingTarget)},m.prototype.pick=function(e,t,n,r){if(this.viewportWidth*this.viewportHeight===0){n.id=-1,n.depth=0;return}var i=window.devicePixelRatio||1,s=4,o=Math.floor((e*i-this.viewportX)/s),u=Math.floor((this.viewportHeight-(t*i-this.viewportY))/s);this.readPixels(o,u,1,1,this.hardwarePicking.pickingBuffer);var a=this.hardwarePicking.pickingBuffer[0]*255+this.hardwarePicking.pickingBuffer[1]-1,f=(this.hardwarePicking.pickingBuffer[2]/255+this.hardwarePicking.pickingBuffer[3]/65025)*r.far;n.id=a,n.depth=f},m.prototype.updateLineAndPointSettings=function(e){var t=this.rendererRecord.lineRecord,n=e.lineWidth||1;t.lineWidth!==n&&(this.context.lineWidth(n),t.lineWidth=n)},m.prototype.updateDepthTest=function(e){var t=this.rendererRecord.depthRecord,n=e.depthState;t.enabled!==n.enabled&&(n.enabled?this.context.enable(v.DEPTH_TEST):this.context.disable(v.DEPTH_TEST),t.enabled=n.enabled),t.write!==n.write&&(n.write?this.context.depthMask(!0):this.context.depthMask(!1),t.write=n.write)},m.prototype.updateCulling=function(e){var t=this.rendererRecord.cullRecord,n=e.cullState.cullFace,r=e.cullState.frontFace,i=e.cullState.enabled;t.enabled!==i&&(i?this.context.enable(v.CULL_FACE):this.context.disable(v.CULL_FACE),t.enabled=i);if(t.cullFace!==n){var s=n==="Front"?v.FRONT:n==="Back"?v.BACK:v.FRONT_AND_BACK;this.context.cullFace(s),t.cullFace=n}if(t.frontFace!==r){switch(r){case"CCW":this.context.frontFace(v.CCW);break;case"CW":this.context.frontFace(v.CW)}t.frontFace=r}},m.prototype.updateTextures=function(e){var i=this.context,s=e.shader.textureSlots;for(var o=0;o<s.length;o++){var u=s[o],a=e.getTexture(u.mapping);if(a===undefined)continue;var f=a;a instanceof Array==0&&(f=[a]);for(var l=0;l<f.length;l++){a=f[l];var c=u.index instanceof Array?u.index[l]:u.index;if(a===null||a instanceof r==0&&(a.image===undefined||a.checkDataReady()===!1))u.format==="sampler2D"?a=n.DEFAULT_TEXTURE_2D:u.format==="samplerCube"&&(a=n.DEFAULT_TEXTURE_CUBE);var h=this.rendererRecord.textureRecord[c];h===undefined&&(h=this.rendererRecord.textureRecord[c]={}),a.glTexture===null?(a.glTexture=i.createTexture(),this.updateTexture(i,a,c,h)):a instanceof r==0&&a.checkNeedsUpdate()?(this.updateTexture(i,a,c,h),a.needsUpdate=!1):this.bindTexture(i,a,c,h);var p=a.image!==undefined?a.image:a,d=t.isPowerOfTwo(p.width)&&t.isPowerOfTwo(p.height);this.updateTextureParameters(a,d)}}},m.prototype.updateTextureParameters=function(e,t){var n=this.context,r=e.textureRecord;r===undefined&&(r={},e.textureRecord=r);var i=this.getGLType(e.variant);r.magFilter!==e.magFilter&&(n.texParameteri(i,v.TEXTURE_MAG_FILTER,this.getGLMagFilter(e.magFilter)),r.magFilter=e.magFilter);var s=t?e.minFilter:this.getFilterFallback(e.minFilter);r.minFilter!==s&&(n.texParameteri(i,v.TEXTURE_MIN_FILTER,this.getGLMinFilter(s)),r.minFilter=s);var o=t?e.wrapS:"EdgeClamp";if(r.wrapS!==o){var u=this.getGLWrap(o,n);n.texParameteri(i,v.TEXTURE_WRAP_S,u),r.wrapS=o}var a=t?e.wrapT:"EdgeClamp";if(r.wrapT!==a){var f=this.getGLWrap(a,n);n.texParameteri(i,v.TEXTURE_WRAP_T,f),r.wrapT=a}if(this.glExtensionTextureFilterAnisotropic&&e.type!=="Float"){var l=e.anisotropy;r.anisotropy!==l&&(n.texParameterf(i,this.glExtensionTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(l,this.capabilities.maxAnisotropy)),r.anisotropy=l)}},m.prototype.bindTexture=function(e,t,n,r){if(r.boundTexture===undefined||t.glTexture!==undefined&&r.boundTexture!==t.glTexture)e.activeTexture(v.TEXTURE0+n),e.bindTexture(this.getGLType(t.variant),t.glTexture),r.boundTexture=t.glTexture},m.prototype.getGLType=function(e){switch(e){case"2D":return v.TEXTURE_2D;case"CUBE":return v.TEXTURE_CUBE_MAP}throw"invalid texture type: "+e},m.prototype.loadCompressedTexture=function(e,t,n,r){var i=n.image.mipmapSizes,s=0,o=0,u=n.image.width,f=n.image.height,l=a.getDdsExtension(e),c=l.COMPRESSED_RGBA_S3TC_DXT5_EXT;if(n.format==="PrecompressedDXT1")c=l.COMPRESSED_RGB_S3TC_DXT1_EXT;else if(n.format==="PrecompressedDXT1A")c=l.COMPRESSED_RGBA_S3TC_DXT1_EXT;else if(n.format==="PrecompressedDXT3")c=l.COMPRESSED_RGBA_S3TC_DXT3_EXT;else{if(n.format!=="PrecompressedDXT5")throw new Error("Unhandled compression format: "+r.getDataFormat().name());c=l.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(typeof i=="undefined"||i===null)r instanceof Uint8Array?e.compressedTexImage2D(t,0,c,u,f,0,r):e.compressedTexImage2D(t,0,c,u,f,0,new Uint8Array(r.buffer,r.byteOffset,r.byteLength));else{n.generateMipmaps=!1;if(r instanceof Array)for(var h=0;h<r.length;h++)e.compressedTexImage2D(t,h,c,u,f,0,r[h]),u=~~(u/2)>1?~~(u/2):1,f=~~(f/2)>1?~~(f/2):1;else for(var h=0;h<i.length;h++)o=i[h],e.compressedTexImage2D(t,h,c,u,f,0,new Uint8Array(r.buffer,r.byteOffset+s,o)),u=~~(u/2)>1?~~(u/2):1,f=~~(f/2)>1?~~(f/2):1,s+=o;var p=1+Math.ceil(Math.log(Math.max(n.image.height,n.image.width))/Math.log(2)),d=i[i.length-1];if(i.length<p)for(var h=i.length;h<p;h++)d=~~((u+3)/4)*~~((f+3)/4)*n.image.bpp*2,e.compressedTexImage2D(t,h,c,u,f,0,new Uint8Array(d)),u=~~(u/2)>1?~~(u/2):1,f=~~(f/2)>1?~~(f/2):1}},m.prototype.updateTexture=function(e,n,r,i){e.activeTexture(v.TEXTURE0+r),e.bindTexture(this.getGLType(n.variant),n.glTexture),i.boundTexture=n.glTexture,e.pixelStorei(v.UNPACK_ALIGNMENT,n.unpackAlignment),e.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),e.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,n.flipY);var s=n.image;if(n.variant==="2D")s?(!s.isCompressed&&(n.generateMipmaps||s.width>this.maxTextureSize||s.height>this.maxTextureSize)&&(this.checkRescale(n,s,s.width,s.height,this.maxTextureSize),s=n.image),s.isData===!0?s.isCompressed?this.loadCompressedTexture(e,v.TEXTURE_2D,n,s.data):e.texImage2D(v.TEXTURE_2D,0,this.getGLInternalFormat(n.format),s.width,s.height,n.hasBorder?1:0,this.getGLInternalFormat(n.format),this.getGLPixelDataType(n.type),s.data):e.texImage2D(v.TEXTURE_2D,0,this.getGLInternalFormat(n.format),this.getGLInternalFormat(n.format),this.getGLPixelDataType(n.type),s),n.generateMipmaps&&!s.isCompressed&&e.generateMipmap(v.TEXTURE_2D)):e.texImage2D(v.TEXTURE_2D,0,this.getGLInternalFormat(n.format),n.width,n.height,0,this.getGLInternalFormat(n.format),this.getGLPixelDataType(n.type),null);else if(n.variant==="CUBE"){if(s&&(n.generateMipmaps||s.width>this.capabilities.maxCubemapSize||s.height>this.capabilities.maxCubemapSize)){for(var u=0;u<o.CUBE_FACES.length;u++)this.checkRescale(n,s.data[u],s.width,s.height,this.capabilities.maxCubemapSize,u);n.image.width=Math.min(this.capabilities.maxCubemapSize,t.nearestPowerOfTwo(n.image.width)),n.image.height=Math.min(this.capabilities.maxCubemapSize,t.nearestPowerOfTwo(n.image.height)),s=n.image}for(var a=0;a<o.CUBE_FACES.length;a++){var f=o.CUBE_FACES[a];s?s.isData===!0?s.isCompressed?this.loadCompressedTexture(e,this.getGLCubeMapFace(f),n,s.data[a]):e.texImage2D(this.getGLCubeMapFace(f),0,this.getGLInternalFormat(n.format),s.width,s.height,n.hasBorder?1:0,this.getGLInternalFormat(n.format),this.getGLPixelDataType(n.type),s.data[a]):e.texImage2D(this.getGLCubeMapFace(f),0,this.getGLInternalFormat(n.format),this.getGLInternalFormat(n.format),this.getGLPixelDataType(n.type),s.data[a]):e.texImage2D(this.getGLCubeMapFace(f),0,this.getGLInternalFormat(n.format),n.width,n.height,0,this.getGLInternalFormat(n.format),this.getGLPixelDataType(n.type),null)}s&&n.generateMipmaps&&!s.isCompressed&&e.generateMipmap(v.TEXTURE_CUBE_MAP)}},m.prototype.checkRescale=function(e,n,r,i,s,o){var u=t.nearestPowerOfTwo(r),a=t.nearestPowerOfTwo(i);u=Math.min(u,s),a=Math.min(a,s);if(r!==u||i!==a){var f=document.createElement("canvas");f.width=u,f.height=a,n.getAttribute&&f.setAttribute("data-ref",n.getAttribute("data-ref"));var l=f.getContext("2d");l.drawImage(n,0,0,r,i,0,0,u,a),document.body.appendChild(f),f.dataReady=!0,f.src=n.src,o===undefined?e.image=f:e.image.data[o]=f,f.parentNode.removeChild(f)}},m.prototype.getGLWrap=function(e){switch(e){case"Repeat":return v.REPEAT;case"MirroredRepeat":return v.MIRRORED_REPEAT;case"EdgeClamp":return v.CLAMP_TO_EDGE}throw"invalid WrapMode type: "+e},m.prototype.getGLInternalFormat=function(e){switch(e){case"RGBA":return v.RGBA;case"RGB":return v.RGB;case"Alpha":return v.ALPHA;case"Luminance":return v.LUMINANCE;case"LuminanceAlpha":return v.LUMINANCE_ALPHA;default:throw"Unsupported format: "+e}},m.prototype.getGLPixelDataType=function(e){switch(e){case"UnsignedByte":return v.UNSIGNED_BYTE;case"UnsignedShort565":return v.UNSIGNED_SHORT_5_6_5;case"UnsignedShort4444":return v.UNSIGNED_SHORT_4_4_4_4;case"UnsignedShort5551":return v.UNSIGNED_SHORT_5_5_5_1;case"Float":return v.FLOAT;default:throw"Unsupported type: "+e}},m.prototype.getFilterFallback=function(e){switch(e){case"NearestNeighborNoMipMaps":case"NearestNeighborNearestMipMap":case"NearestNeighborLinearMipMap":return"NearestNeighborNoMipMaps";case"BilinearNoMipMaps":case"Trilinear":case"BilinearNearestMipMap":return"BilinearNoMipMaps";default:return"NearestNeighborNoMipMaps"}},m.prototype.getGLMagFilter=function(e){switch(e){case"Bilinear":return v.LINEAR;case"NearestNeighbor":return v.NEAREST}throw"invalid MagnificationFilter type: "+e},m.prototype.getGLMinFilter=function(e){switch(e){case"BilinearNoMipMaps":return v.LINEAR;case"Trilinear":return v.LINEAR_MIPMAP_LINEAR;case"BilinearNearestMipMap":return v.LINEAR_MIPMAP_NEAREST;case"NearestNeighborNoMipMaps":return v.NEAREST;case"NearestNeighborNearestMipMap":return v.NEAREST_MIPMAP_NEAREST;case"NearestNeighborLinearMipMap":return v.NEAREST_MIPMAP_LINEAR}throw"invalid MinificationFilter type: "+e},m.prototype.getGLBufferTarget=function(e){return e==="ElementArrayBuffer"?v.ELEMENT_ARRAY_BUFFER:v.ARRAY_BUFFER},m.prototype.getGLArrayType=function(e){return e instanceof Uint8Array?v.UNSIGNED_BYTE:e instanceof Uint16Array?v.UNSIGNED_SHORT:e instanceof Uint32Array?v.UNSIGNED_INT:e instanceof Int8Array?v.UNSIGNED_BYTE:e instanceof Int16Array?v.UNSIGNED_SHORT:e instanceof Int32Array?v.UNSIGNED_INT:null},m.prototype.getGLByteSize=function(e){return e instanceof Uint8Array?1:e instanceof Uint16Array?2:e instanceof Uint32Array?4:e instanceof Int8Array?1:e instanceof Int16Array?2:e instanceof Int32Array?4:1},m.prototype.getGLCubeMapFace=function(e){switch(e){case"PositiveX":return v.TEXTURE_CUBE_MAP_POSITIVE_X;case"NegativeX":return v.TEXTURE_CUBE_MAP_NEGATIVE_X;case"PositiveY":return v.TEXTURE_CUBE_MAP_POSITIVE_Y;case"NegativeY":return v.TEXTURE_CUBE_MAP_NEGATIVE_Y;case"PositiveZ":return v.TEXTURE_CUBE_MAP_POSITIVE_Z;case"NegativeZ":return v.TEXTURE_CUBE_MAP_NEGATIVE_Z}throw"Invalid cubemap face: "+e},m.prototype.getGLBufferUsage=function(e){var t=v.STATIC_DRAW;switch(e){case"StaticDraw":t=v.STATIC_DRAW;break;case"DynamicDraw":t=v.DYNAMIC_DRAW;break;case"StreamDraw":t=v.STREAM_DRAW}return t},m.prototype.getGLIndexMode=function(e){var t=v.TRIANGLES;switch(e){case"Triangles":t=v.TRIANGLES;break;case"TriangleStrip":t=v.TRIANGLE_STRIP;break;case"TriangleFan":t=v.TRIANGLE_FAN;break;case"Lines":t=v.LINES;break;case"LineStrip":t=v.LINE_STRIP;break;case"LineLoop":t=v.LINE_LOOP;break;case"Points":t=v.POINTS}return t},m.prototype.updateBlending=function(e){var t=this.rendererRecord.blendRecord,n=this.context,r=e.blendState.blending;r!==t.blending&&(r==="NoBlending"?n.disable(v.BLEND):r==="AdditiveBlending"?(n.enable(v.BLEND),n.blendEquation(v.FUNC_ADD),n.blendFunc(v.SRC_ALPHA,v.ONE)):r==="SubtractiveBlending"?(n.enable(v.BLEND),n.blendEquation(v.FUNC_ADD),n.blendFunc(v.ZERO,v.ONE_MINUS_SRC_COLOR)):r==="MultiplyBlending"?(n.enable(v.BLEND),n.blendEquation(v.FUNC_ADD),n.blendFunc(v.DST_COLOR,v.ONE_MINUS_SRC_ALPHA)):r==="AlphaBlending"?(n.enable(v.BLEND),n.blendEquation(v.FUNC_ADD),n.blendFunc(v.SRC_ALPHA,v.ONE_MINUS_SRC_ALPHA)):r==="CustomBlending"?n.enable(v.BLEND):(n.enable(v.BLEND),n.blendEquationSeparate(v.FUNC_ADD,v.FUNC_ADD),n.blendFuncSeparate(v.SRC_ALPHA,v.ONE_MINUS_SRC_ALPHA,v.ONE,v.ONE_MINUS_SRC_ALPHA)),t.blending=r);if(r==="CustomBlending"){var i=e.blendState.blendEquation,s=e.blendState.blendSrc,o=e.blendState.blendDst;i!==t.blendEquation&&(n.blendEquation(this.getGLBlendParam(i)),t.blendEquation=i);if(s!==t.blendSrc||o!==t.blendDst)n.blendFunc(this.getGLBlendParam(s),this.getGLBlendParam(o)),t.blendSrc=s,t.blendDst=o}else t.blendEquation=null,t.blendSrc=null,t.blendDst=null},m.prototype.updateOffset=function(e){var t=this.rendererRecord.offsetRecord,n=this.context,r=e.offsetState.enabled,i=e.offsetState.factor,s=e.offsetState.units;t.enabled!==r&&(r?n.enable(v.POLYGON_OFFSET_FILL):n.disable(v.POLYGON_OFFSET_FILL),t.enabled=r),r&&(t.factor!==i||t.units!==s)&&(n.polygonOffset(i,s),t.factor=i,t.units=s)},m.prototype.setBoundBuffer=function(e,t){var n=this.rendererRecord.currentBuffer[t];if(!n.valid||n.buffer!==e)this.context.bindBuffer(this.getGLBufferTarget(t),e),n.buffer=e,n.valid=!0},m.prototype.bindVertexAttribute=function(e,t){this.context.vertexAttribPointer(e,t.count,this.getGLDataType(t.type),t.normalized,t.stride,t.offset)},m.prototype.getGLDataType=function(e){switch(e){case"Float":case"HalfFloat":case"Double":return v.FLOAT;case"Byte":return v.BYTE;case"UnsignedByte":return v.UNSIGNED_BYTE;case"Short":return v.SHORT;case"UnsignedShort":return v.UNSIGNED_SHORT;case"Int":return v.INT;case"UnsignedInt":return v.UNSIGNED_INT;default:throw"Unknown datatype: "+e}},m.prototype.getGLBlendParam=function(e){switch(e){case"AddEquation":return v.FUNC_ADD;case"SubtractEquation":return v.FUNC_SUBTRACT;case"ReverseSubtractEquation":return v.FUNC_REVERSE_SUBTRACT;case"ZeroFactor":return v.ZERO;case"OneFactor":return v.ONE;case"SrcColorFactor":return v.SRC_COLOR;case"OneMinusSrcColorFactor":return v.ONE_MINUS_SRC_COLOR;case"SrcAlphaFactor":return v.SRC_ALPHA;case"OneMinusSrcAlphaFactor":return v.ONE_MINUS_SRC_ALPHA;case"DstAlphaFactor":return v.DST_ALPHA;case"OneMinusDstAlphaFactor":return v.ONE_MINUS_DST_ALPHA;case"DstColorFactor":return v.DST_COLOR;case"OneMinusDstColorFactor":return v.ONE_MINUS_DST_COLOR;case"SrcAlphaSaturateFactor":return v.SRC_ALPHA_SATURATE;default:throw"Unknown blend param: "+e}},m.prototype.clear=function(e,t,n){var r=0;if(e===undefined||e)r|=v.COLOR_BUFFER_BIT;if(t===undefined||t)r|=v.DEPTH_BUFFER_BIT;if(n===undefined||n)r|=v.STENCIL_BUFFER_BIT;var i=this.rendererRecord.depthRecord;i.write!==!0&&(this.context.depthMask(!0),i.write=!0),this.context.clear(r)},m.prototype.flush=function(){this.context.flush()},m.prototype.finish=function(){this.context.finish()},m.prototype.setupFrameBuffer=function(e,t,n){this.context.bindFramebuffer(v.FRAMEBUFFER,e),this.context.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,n,t.glTexture,0)},m.prototype.setupRenderBuffer=function(e,t){this.context.bindRenderbuffer(v.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(this.context.renderbufferStorage(v.RENDERBUFFER,v.DEPTH_COMPONENT16,t.width,t.height),this.context.framebufferRenderbuffer(v.FRAMEBUFFER,v.DEPTH_ATTACHMENT,v.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(this.context.renderbufferStorage(v.RENDERBUFFER,v.DEPTH_STENCIL,t.width,t.height),this.context.framebufferRenderbuffer(v.FRAMEBUFFER,v.DEPTH_STENCIL_ATTACHMENT,v.RENDERBUFFER,e)):this.context.renderbufferStorage(v.RENDERBUFFER,v.RGBA4,t.width,t.height)},m.prototype.setRenderTarget=function(e){if(e&&!e._glFrameBuffer){e.depthBuffer===undefined&&(e.depthBuffer=!0),e.stencilBuffer===undefined&&(e.stencilBuffer=!0),e.glTexture=this.context.createTexture();var n=t.isPowerOfTwo(e.width)&&t.isPowerOfTwo(e.height),r=this.getGLInternalFormat(e.format),i=this.getGLDataType(e.type);e._glFrameBuffer=this.context.createFramebuffer(),e._glRenderBuffer=this.context.createRenderbuffer(),this.context.bindTexture(v.TEXTURE_2D,e.glTexture),this.updateTextureParameters(e,n),this.context.texImage2D(v.TEXTURE_2D,0,r,e.width,e.height,0,r,i,null),this.setupFrameBuffer(e._glFrameBuffer,e,v.TEXTURE_2D),this.setupRenderBuffer(e._glRenderBuffer,e),e.generateMipmaps&&n&&this.context.generateMipmap(v.TEXTURE_2D),this.context.bindTexture(v.TEXTURE_2D,null),this.context.bindRenderbuffer(v.RENDERBUFFER,null),this.context.bindFramebuffer(v.FRAMEBUFFER,null)}var s,o,u,a,f;e?(s=e._glFrameBuffer,a=0,f=0,o=e.width,u=e.height):(s=null,a=this.viewportX,f=this.viewportY,o=this.viewportWidth,u=this.viewportHeight),s!==this.rendererRecord.currentFrameBuffer&&(this.context.bindFramebuffer(v.FRAMEBUFFER,s),this.context.viewport(a,f,o,u),this.rendererRecord.currentFrameBuffer=s,this.rendererRecord.textureRecord=[]),this.currentWidth=o,this.currentHeight=u},m.prototype.updateRenderTargetMipmap=function(e){this.context.bindTexture(v.TEXTURE_2D,e.glTexture),this.context.generateMipmap(v.TEXTURE_2D),this.context.bindTexture(v.TEXTURE_2D,null)},m.prototype.getCapabilitiesString=function(){var e=[];for(var t in this.capabilities){var n=this.capabilities[t],r="";if(n instanceof ArrayBufferView){r+="[";for(var i=0;i<n.length;i++)r+=n[i],i<n.length-1&&(r+=",");r+="]"}else r=n;e.push(t+": "+r)}return e.join("\n")},m.prototype._deallocateMeshData=function(){},m.prototype._deallocateTexture=function(){},m.prototype._deallocateRenderTarget=function(){},m.prototype._deallocateShader=function(){},m}),define("goo/renderer/pass/Composer",["goo/renderer/pass/RenderTarget","goo/renderer/pass/FullscreenPass","goo/renderer/shaders/ShaderLib","goo/entities/SystemBus"],function(e,t,n,r){function s(i){this.writeBuffer=i;if(this.writeBuffer===undefined){var s=window.innerWidth||1,o=window.innerHeight||1;this.writeBuffer=new e(s,o)}this.readBuffer=this.writeBuffer.clone(),this.passes=[],this._clearColor=[0,0,0,1],this.copyPass=new t(n.copy),this.size=null,this.dirty=!1,r.addListener("goo.viewportResize",function(e){this.dirty=!0,this.size=e}.bind(this),!0)}var i=window.WebGLRenderingContext;return s.prototype.swapBuffers=function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},s.prototype._checkPassResize=function(e,t){return!e.viewportSize||e.viewportSize.x!==t.x||e.viewportSize.y!==t.y||e.viewportSize.width!==t.width||e.viewportSize.height!==t.height?!0:!1},s.prototype.addPass=function(e){this.passes.push(e),e.updateSize&&this.size&&this._checkPassResize(e,this.size)&&(e.updateSize(this.size),e.viewportSize=this.size)},s.prototype.setClearColor=function(e){this._clearColor[0]=e[0],this._clearColor[1]=e[1],this._clearColor[2]=e[2],this._clearColor[3]=e[3]},s.prototype.updateSize=function(){var t=this.size;if(!t)return;var n=t.width,r=t.height;this.writeBuffer=new e(n,r),this.readBuffer=this.writeBuffer.clone();for(var i=0,s=this.passes.length;i<s;i++){var o=this.passes[i];o.updateSize&&this._checkPassResize(o,t)&&(o.updateSize(t),o.viewportSize=t)}},s.prototype.render=function(e,t,n,r){this.dirty&&(this.updateSize(),this.dirty=!1);var s=!1,o,u,a=this.passes.length;for(u=0;u<a;u++){o=this.passes[u];if(!o.enabled)continue;o.render(e,this.writeBuffer,this.readBuffer,t,s,n,r,this._clearColor);if(o.needsSwap){if(s){var f=this.renderer.context;f.stencilFunc(i.NOTEQUAL,1,4294967295),this.copyPass.render(e,this.writeBuffer,this.readBuffer,t,n,r),f.stencilFunc(i.EQUAL,1,4294967295)}this.swapBuffers()}}},s}),define("goo/renderer/pass/RenderPass",["goo/renderer/Renderer","goo/math/Vector4"],function(e,t){function n(e,n){this.renderList=e,this.filter=n,this.clearColor=new t(0,0,0,0),this.oldClearColor=new t,this.renderToScreen=!1,this.overrideMaterial=null,this.enabled=!0,this.clear=!0,this.needsSwap=!1}return n.prototype.render=function(t,n,r,i,s,o,u,a){o=o||e.mainCamera;if(!o)return;u=u||[],a&&(this.oldClearColor.setv(t.clearColor),t.setClearColor(a[0],a[1],a[2],a[3]));var f;this.filter?f=this.renderList.filter(this.filter):f=this.renderList,this.renderToScreen?t.render(f,o,u,null,this.clear,this.overrideMaterial):t.render(f,o,u,r,this.clear,this.overrideMaterial);if(this.clearColor){var l=this.oldClearColor.data;t.setClearColor(l[0],l[1],l[2],l[3])}},n}),define("goo/particles/ParticleLib",[],function(){var e={};return e.getSmoke=function(e){return e=e||{},e.scale=typeof e.scale!="undefined"?e.scale:1,e.spread=typeof e.spread!="undefined"?e.spread:2,e.rate=typeof e.spread!="undefined"?e.rate:25,e.velocity=typeof e.velocity!="undefined"?e.velocity:function(t){var n=t.velocity;return n.data[0]=(Math.random()-.5)*2*e.spread*e.scale,n.data[1]=(Math.random()+4)*2*e.scale,n.data[2]=(Math.random()-.5)*2*e.spread*e.scale,n},e.color=e.color||[0,0,0],{totalParticlesToSpawn:-1,releaseRatePerSecond:e.rate,minLifetime:.5,maxLifetime:4,getEmissionVelocity:e.velocity,timeline:[{timeOffset:0,spin:0,mass:1,size:3*e.scale,color:[e.color[0],e.color[1],e.color[2],1]},{timeOffset:1,size:6*e.scale,color:[e.color[0],e.color[1],e.color[2],0]}]}},e.getFire=function(e){return e=e||{},e.scale=typeof e.scale!="undefined"?e.scale:1,e.spread=typeof e.spread!="undefined"?e.spread:2,e.velocity=typeof e.velocity!="undefined"?e.velocity:10,e.startColor=e.startColor||[1,1,0],e.endColor=e.endColor||[1,0,0],{totalParticlesToSpawn:-1,releaseRatePerSecond:30,minLifetime:.5,maxLifetime:2,getEmissionVelocity:function(t){var n=t.velocity;return n.data[0]=(Math.random()-.5)*2*e.spread*e.scale,n.data[1]=(Math.random()+1)*e.velocity*e.scale,n.data[2]=(Math.random()-.5)*2*e.spread*e.scale,n},timeline:[{timeOffset:0,spin:0,mass:1,size:2*e.scale,color:[e.startColor[0],e.startColor[1],e.startColor[2],0]},{timeOffset:.05,color:[e.startColor[0],e.startColor[1],e.startColor[2],1]},{timeOffset:.45,color:[e.endColor[0],e.endColor[1],e.endColor[2],.8]},{timeOffset:.5,size:3*e.scale,color:[0,0,0,0]}]}},e.getSnow=function(e){return e=e||{},e.scale=typeof e.scale!="undefined"?e.scale:2,e.spread=typeof e.spread!="undefined"?e.spread:50,e.velocity=typeof e.velocity!="undefined"?e.velocity:3,e.color=e.color||[1,1,1],{particleCount:1e3,totalParticlesToSpawn:-1,releaseRatePerSecond:50,minLifetime:15,maxLifetime:25,getEmissionPoint:function(t){var n=t.position;return e.getEmissionPoint(n),n},getEmissionVelocity:function(t){var n=t.velocity;return e.getEmissionVelocity(n),n},timeline:[{timeOffset:0,spin:0,mass:1,size:1*e.scale,color:[e.color[0],e.color[1],e.color[2],0]},{timeOffset:.05,color:[e.color[0],e.color[1],e.color[2],1]},{timeOffset:.7,color:[e.color[0],e.color[1],e.color[2],.8]},{timeOffset:.25,spin:5,size:.5*e.scale,color:[e.color[0],e.color[1],e.color[2],0]}]}},e}),define("goo/particles/ParticleUtils",["goo/math/Vector3"],function(e){function t(){}return t.getRandomVelocityOffY=function(e,n,r,i,s){var o=n+Math.random()*(r-n),u=Math.PI*2*Math.random();return e.x=Math.cos(u)*Math.sin(o),e.y=Math.cos(o),e.z=Math.sin(u)*Math.sin(o),s&&t.applyEntityTransformVector(e,s),e.mul(i),e},t.randomPointInCube=function(e,t,n,r,i){return e.x=Math.random()*2*t-t+(i?i.x:0),e.y=Math.random()*2*n-n+(i?i.y:0),e.z=Math.random()*2*r-r+(i?i.z:0),e},t.createConstantForce=function(t){var n=new e(t);return{enabled:!0,prepare:function(){},apply:function(e,t){t.velocity.x+=n.x*e,t.velocity.y+=n.y*e,t.velocity.z+=n.z*e}}},t.applyEntityTransformPoint=function(e,t){return!t.transformComponent||!t.transformComponent.worldTransform?e:t.transformComponent.worldTransform.applyForward(e,e)},t.applyEntityTransformVector=function(e,t){return!t.transformComponent||!t.transformComponent.worldTransform?e:t.transformComponent.worldTransform.applyForwardVector(e,e)},t.applyTimeline=function(e,t){var n=e.age,r=e.lifeSpan,i=0,s=0,o=0,u=0,a=r,f=r,l=r,c=r,h=0,p=0,d=null,v=null,m=null,g=null,y=null,b=null,w=null,E=null,S=null;for(var x=0,T=t.length;x<T;x++){var N=t[x];h+=(N.timeOffset?N.timeOffset:0)*r,b===null&&(h>n?N.color!==undefined&&(a=h,b=N):N.color!==undefined&&(i=h,d=N)),w===null&&(h>n?N.mass!==undefined&&(f=h,w=N):N.mass!==undefined&&(s=h,v=N)),h<=n&&N.uvIndex!==undefined&&(y=N),E===null&&(h>n?N.size!==undefined&&(l=h,E=N):N.size!==undefined&&(o=h,m=N)),S===null&&(h>n?N.spin!==undefined&&(c=h,S=N):N.spin!==undefined&&(u=h,g=N))}p=(n-i)/(a-i);var C=d!==null?d.color:[1,1,1,1],k=b!==null?b.color:C;e.color.data[0]=(1-p)*C[0]+p*k[0],e.color.data[1]=(1-p)*C[1]+p*k[1],e.color.data[2]=(1-p)*C[2]+p*k[2],e.color.data[3]=(1-p)*C[3]+p*k[3],p=(n-s)/(f-s);var C=v!==null?v.mass:1,k=w!==null?w.mass:C;e.mass=(1-p)*C+p*k,e.uvIndex=y!==null?y.uvIndex:0,p=(n-o)/(l-o);var C=m!==null?m.size:1,k=E!==null?E.size:C;e.size=(1-p)*C+p*k,p=(n-u)/(c-u);var C=g!==null?g.spin:0,k=S!==null?S.spin:C;e.spin=(1-p)*C+p*k},t}),define("goo/particles/Particle",["goo/particles/ParticleUtils","goo/math/Vector","goo/math/Vector3","goo/math/Vector4","goo/renderer/MeshData"],function(e,t,n,r,i){function o(e,t){this.alive=!1,this.position=new n,this.velocity=new n,this.lifeSpan=0,this.parent=e,this.age=0,this.index=t,this.color=new r(1,0,0,1),this.size=0,this.spin=0,this.mass=1,this.emitter=null,this.uvIndex=0,this.lastUVIndex=-1,this.bbX=new n,this.bbY=new n,this.lastColor=new r}var s=new n;return o.prototype.respawnParticle=function(e){this.emitter=e,this.lifeSpan=e.nextParticleLifeSpan(),this.alive=!0,this.age=0},o.prototype.update=function(r,o){if(!this.alive)return;this.age+=r;if(this.age>this.lifeSpan){this.kill();return}this.position.add_d(this.velocity.x*r,this.velocity.y*r,this.velocity.z*r),e.applyTimeline(this,this.emitter&&this.emitter.timeline?this.emitter.timeline:this.parent.timeline);if(!t.equals(this.lastColor,this.color)){var u=this.parent.meshData.getAttributeBuffer(i.COLOR);u.set(this.color.data,this.index*16+0),u.set(this.color.data,this.index*16+4),u.set(this.color.data,this.index*16+8),u.set(this.color.data,this.index*16+12),this.lastColor.setv(this.color)}this.emitter&&this.emitter.getParticleBillboardVectors(this,o);if(this.spin===0)this.bbX.muld(this.size,this.size,this.size),this.bbY.muld(this.size,this.size,this.size);else{var a=Math.cos(this.spin)*this.size,f=Math.sin(this.spin)*this.size,l=this.bbY.x,c=this.bbY.y,h=this.bbY.z;this.bbY.setv(this.bbX),this.bbX.muld(a,a,a).add_d(l*f,c*f,h*f),this.bbY.muld(-f,-f,-f).add_d(l*a,c*a,h*a)}var p=this.parent.meshData.getAttributeBuffer(i.POSITION);n.subv(this.position,this.bbX,s).subv(this.bbY),p.set(s.data,this.index*12+0),n.subv(this.position,this.bbX,s).addv(this.bbY),p.set(s.data,this.index*12+3),n.addv(this.position,this.bbX,s).addv(this.bbY),p.set(s.data,this.index*12+6),n.addv(this.position,this.bbX,s).subv(this.bbY),p.set(s.data,this.index*12+9);if(this.lastUVIndex!==this.uvIndex){var d=this.parent.meshData.getAttributeBuffer(i.TEXCOORD0),v=this.uvIndex%this.parent.uRange/this.parent.uRange,m=1-Math.floor(this.uvIndex/this.parent.vRange)/this.parent.vRange,g=1/this.parent.uRange,y=1/this.parent.vRange;d.set([v+g,m-y],this.index*8+0),d.set([v+g,m],this.index*8+2),d.set([v,m],this.index*8+4),d.set([v,m-y],this.index*8+6),this.lastUVIndex=this.uvIndex}},o.prototype.kill=function(){this.alive=!1;var e=this.parent.meshData.getAttributeBuffer(i.POSITION),t=e.subarray(this.index*12,this.index*12+3);e.set(t,this.index*12+3),e.set(t,this.index*12+6),e.set(t,this.index*12+9)},o}),define("goo/particles/ParticleEmitter",["goo/particles/ParticleUtils","goo/renderer/Renderer"],function(e,t){function n(t){t=t||{},this.totalParticlesToSpawn=isNaN(t.totalParticlesToSpawn)?-1:t.totalParticlesToSpawn,this.maxLifetime=isNaN(t.maxLifetime)?3:t.maxLifetime,this.minLifetime=isNaN(t.minLifetime)?2:t.minLifetime,this.timeline=t.timeline?t.timeline:undefined,this.influences=t.influences?t.influences:[],this.getEmissionPoint=t.getEmissionPoint?t.getEmissionPoint:function(t,n){var r=t.position;return r.setd(0,0,0),e.applyEntityTransformPoint(r,n)},this.getEmissionVelocity=t.getEmissionVelocity?t.getEmissionVelocity:function(t,n){var r=t.velocity;return r.setd(0,1,0),e.applyEntityTransformVector(r,n)},this.getParticleBillboardVectors=t.getParticleBillboardVectors?t.getParticleBillboardVectors:n.CAMERA_BILLBOARD_FUNC,this.releaseRatePerSecond=isNaN(t.releaseRatePerSecond)?10:t.releaseRatePerSecond,this.particlesWaitingToRelease=0,this.enabled=t.enabled!==undefined?t.enabled===!0:!0}return n.CAMERA_BILLBOARD_FUNC=function(e){var n=t.mainCamera;n&&(e.bbX.setv(n._left),e.bbY.setv(n._up))},n.prototype.nextParticleLifeSpan=function(){return this.minLifetime+(this.maxLifetime-this.minLifetime)*Math.random()},n}),define("goo/entities/components/ParticleComponent",["goo/entities/components/Component","goo/particles/Particle","goo/particles/ParticleEmitter","goo/renderer/MeshData"],function(e,t,n,r){function i(t){this.type="ParticleComponent",e.call(this),t=t||{},this.emitters=[];if(t.emitters)for(var r=0,i=t.emitters.length;r<i;r++)this.emitters.push(new n(t.emitters[r]));this.timeline=t.timeline?t.timeline:[],this.uRange=isNaN(t.uRange)?1:t.uRange,this.vRange=isNaN(t.vRange)?1:t.vRange;var s=isNaN(t.particleCount)?100:t.particleCount;this.recreateParticles(s),this.enabled=!0}return i.prototype=Object.create(e.prototype),i.prototype.generateMeshData=function(){var e=r.defaultMap([r.POSITION,r.COLOR,r.TEXCOORD0]);this.meshData=new r(e,this.particleCount*4,this.particleCount*6);var t=this.meshData.getAttributeBuffer(r.TEXCOORD0),n=this.meshData.getIndexBuffer();for(var i=0,s=this.particleCount;i<s;i++)t.set([1,0],i*8+0),t.set([1,1],i*8+2),t.set([0,1],i*8+4),t.set([0,0],i*8+6),n.set([i*4+0,i*4+3,i*4+1,i*4+1,i*4+3,i*4+2],i*6)},i.prototype.recreateParticles=function(e){this.particleCount=e,this.particles=[];for(var n=0;n<this.particleCount;n++)this.particles[n]=new t(this,n);this.generateMeshData()},i}),define("goo/util/ParticleSystemUtils",["goo/entities/components/ParticleComponent","goo/entities/components/MeshRendererComponent","goo/entities/components/MeshDataComponent","goo/renderer/Texture","goo/particles/ParticleEmitter"],function(e,t,n,r,i){function s(){}return s.createParticleSystemEntity=function(r,s,o){var u=r.world.createEntity(),a=new e({particleCount:s.particleCount||500});a.emitters.push(new i(s)),u.setComponent(a);var f=new n(a.meshData);u.setComponent(f);var l=new t;return l.materials.push(o),l.cullMode="Never",u.setComponent(l),u},s.createFlareTexture=function(e,t){e=e||64,t=t||{},t.startRadius=typeof t.startRadius!="undefined"?t.startRadius:0,t.endRadius=typeof t.endRadius!="undefined"?t.endRadius:e/2,t.steps=t.steps||[{fraction:0,value:1},{fraction:1,value:0}];var n=document.createElement("canvas");n.width=e,n.height=e;var i=n.getContext("2d"),s=i.createRadialGradient(e/2,e/2,t.startRadius,e/2,e/2,t.endRadius);for(var o=0;o<t.steps.length;o++){var u=t.steps[o];s.addColorStop(u.fraction,"rgba(255, 255, 255, "+u.value+")")}i.fillStyle=s,i.fillRect(0,0,e,e);var a=i.getImageData(0,0,e,e).data;a=new Uint8Array(a);var f=new r(a,null,e,e);return f},s.createSplashTexture=function(e,t){function s(e,t,n){var r=i.createRadialGradient(e,t,0,e,t,n);r.addColorStop(0,"rgba(255, 255, 255, 0.5)"),r.addColorStop(1,"rgba(255, 255, 255, 0)"),i.fillStyle=r,i.fillRect(e-n,t-n,2*n,2*n)}function u(e,t,n,r,i,u){var a=(n-e)/o,f=(r-t)/o,l=(u-i)/o;for(var c=0,h=e,p=t,d=i;c<o;c++,h+=a,p+=f,d+=l)s(h,p,d)}function a(e,t,n,r,i,s,o){for(var a=0;a<o;a++){var f=Math.random()*Math.PI*2,l=Math.random()*4+n,c=Math.random()*4-r;u(e+Math.cos(f)*l,t+Math.sin(f)*l,e+Math.cos(f)*c,t+Math.sin(f)*c,i,s)}}e=e||64,t=t||{},t.nTrails=typeof t.nTrails!="undefined"?t.nTrails:8,t.trailStartRadius=typeof t.trailStartRadius!="undefined"?t.trailStartRadius:1,t.trailEndRadius=typeof t.trailEndRadius!="undefined"?t.trailEndRadius:4;var n=document.createElement("canvas");n.width=e,n.height=e;var i=n.getContext("2d"),o=30;a(e/2,e/2,e/2/10*1,e/2/10*9,t.trailStartRadius,t.trailEndRadius,t.nTrails);var f=i.getImageData(0,0,e,e).data;f=new Uint8Array(f);var l=new r(f,null,e,e);return l},s.createPlanktonTexture=function(e,t){function s(e,t,n){var r=i.createRadialGradient(e,t,0,e,t,n);r.addColorStop(0,"rgba(255, 255, 255, 1)"),r.addColorStop(.3,"rgba(255, 255, 255, 1)"),r.addColorStop(1,"rgba(255, 255, 255, 0)"),i.fillStyle=r,i.fillRect(e-n,t-n,2*n,2*n)}function o(n){for(var r=0;r<n;r++){var i=Math.random()*(e-t.maxRadius*2)+t.maxRadius,o=Math.random()*(e-t.maxRadius*2)+t.maxRadius;s(i,o,Math.random()*(t.maxRadius-t.minRadius)+t.minRadius)}}e=e||64,t=t||{},t.nPoints=typeof t.nPoints!="undefined"?t.nPoints:10,t.minRadius=typeof t.minRadius!="undefined"?t.minRadius:2,t.maxRadius=typeof t.maxRadius!="undefined"?t.maxRadius:5;var n=document.createElement("canvas");n.width=e,n.height=e;var i=n.getContext("2d");o(t.nPoints);var u=i.getImageData(0,0,e,e).data;u=new Uint8Array(u);var a=new r(u,null,e,e);return a},s.createSnowflakeTexture=function(e,t){function s(e,t){var n=2*Math.PI/e;for(var r=0;r<e;r++)i.rotate(n),t()}function o(){i.beginPath(),i.moveTo(0,0),i.lineTo(0,90);for(var e=0;e<6;e++)i.moveTo(0,25+e*10),i.lineTo(16-e*1.5,35+e*10),i.moveTo(0,25+e*10),i.lineTo(-(16-e*1.5),35+e*10);i.stroke()}e=e||64,t=t||{};var n=document.createElement("canvas");n.width=e,n.height=e;var i=n.getContext("2d");i.strokeStyle="#FFF",i.lineWidth=4,i.lineCap="round",i.translate(e/2,e/2),i.scale(e/100/2,e/100/2),s(7,o);var u=i.getImageData(0,0,e,e).data;u=new Uint8Array(u);var a=new r(u,null,e,e);return a},s}),define("goo/util/Snow",["goo/entities/SystemBus","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/renderer/TextureCreator","goo/particles/ParticleLib","goo/util/ParticleSystemUtils","goo/renderer/Renderer","goo/math/Vector3"],function(e,t,n,r,i,s,o,u){function a(e){this.velocity=10,this.height=25,this.material=t.createMaterial(n.particles);var r=s.createFlareTexture(64);r.generateMipmaps=!0,this.material.setTexture("DIFFUSE_MAP",r),this.material.blendState.blending="AdditiveBlending",this.material.cullState.enabled=!1,this.material.depthState.write=!1,this.material.renderQueue=2002;var a=this;this.particleCloudEntity=s.createParticleSystemEntity(e,i.getSnow({getEmissionPoint:function(e){e.copy(o.mainCamera?o.mainCamera.translation:new u),e.data[0]+=Math.random()*1e3-500,e.data[1]+=a.height,e.data[2]+=Math.random()*1e3-500},getEmissionVelocity:function(e){e.data[0]=(Math.random()-.5)*2,e.data[1]=-(Math.random()+1)*a.velocity,e.data[2]=(Math.random()-.5)*2}}),this.material),this.particleCloudEntity.name="_ParticleSystemSnow",this.onCameraChange=function(e){e.entity.attachChild(this.particleCloudEntity)}.bind(this),this.particleCloudEntity.transformComponent.transform.translation.copy(o.mainCamera?o.mainCamera.translation:new u),this.particleCloudEntity.addToWorld()}return a.prototype.setEmissionVelocity=function(e){if(e){this.velocity=e;var t=this.particleCloudEntity.particleComponent,n=t.particles;for(var r=0;r<n.length;r++)n[r].velocity[1]=-(Math.random()+1)*this.velocity}},a.prototype.setEmissionHeight=function(e){e&&(this.height=e)},a.prototype.setReleaseRatePerSecond=function(e){if(e){var t=this.particleCloudEntity.particleComponent,n=t.emitters[0];n.releaseRatePerSecond=e}},a.prototype.remove=function(){this.particleCloudEntity.removeFromWorld()},a}),define("goo/loaders/handlers/ProjectHandler",["goo/loaders/handlers/ConfigHandler","goo/util/rsvp","goo/util/PromiseUtil","goo/util/Skybox","goo/math/MathUtils","goo/shapes/Sphere","goo/renderer/Renderer","goo/renderer/pass/Composer","goo/renderer/pass/RenderPass","goo/math/Vector4","goo/renderer/shaders/ShaderLib","goo/renderer/shaders/ShaderBuilder","goo/renderer/pass/FullscreenPass","goo/renderer/Util","goo/renderer/Texture","goo/entities/EntityUtils","goo/entities/SystemBus","goo/util/ArrayUtil","goo/util/ObjectUtil","goo/util/Snow"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b){function w(){e.apply(this,arguments),this._skybox=null,this._skyboxTexture=null,this._skyboxGeographic=!1,this._composer=null,this._passes=[],this.weatherState={}}return w.prototype=Object.create(e.prototype),e._registerClass("project",w),w.prototype._prepare=function(e){e.skybox=e.skybox||{},y.defaults(e.skybox,{shape:"Box",imageUrls:["","","","","",""],rotation:0,environmentType:1}),e.backgroundColor=e.backgroundColor||[.75,.76,.78,1],e.globalAmbient=e.globalAmbient||[0,0,0],e.useFog=e.useFog||!1,e.fogColor=e.fogColor||[1,1,1],e.fogNear=e.fogNear||0,e.fogFar=e.fogFar==null?1e3:e.fogFar},w.prototype._create=function(){},w.prototype._createSkybox=function(e,t,n,i,o){var o=o?s.TextureModes.Projected:s.TextureModes.Chromeball,u=new r(t,[],o,i),a=this._skybox=v.createTypicalEntity(e.world,u.meshData,u.materials[0],u.transform);a.name="Skybox_"+t,a.isSkybox=!0,a.transformComponent.updateWorldTransform(),a.meshRendererComponent.hidden=!0,e.world.getSystem("RenderSystem").added(a)},w.prototype._updateSkybox=function(e,s){if(e){var o=e.shape.toLowerCase(),u=e.rotation*i.DEG_TO_RAD,a=e.imageUrls,f=this._skybox?this._skybox.name.split("_")[1]:null;if(!o||f!==o||f==="sphere"&&e.environmentType!==this._skyboxGeographic)this._skybox&&this.world.getSystem("RenderSystem").removed(this._skybox),this._createSkybox(this.world.gooRunner,o,a,u,e.environmentType),this._skyboxTexture=null,f=o,this._skyboxGeographic=e.environmentType;var l=0;f===r.SPHERE&&(l=e.environmentType?Math.PI/2:Math.PI),this._skybox.transformComponent.transform.rotation.fromAngles(l,u,0),this._skybox.transformComponent.updateTransform(),this._skybox.transformComponent.updateWorldTransform();var h=this._skybox,p=h.meshRendererComponent.materials[0],v=this._skyboxTexture,g=!v;!g&&s&&s.skybox&&s.skybox.reload&&(g=!0);if(!g)if(v.image.data)for(var y=0;y<a.length;y++){var b=v.image.data[y];if(b&&b.getAttribute("data-ref")!==a[y]){g=!0;break}}else v.image&&v.image.getAttribute("data-ref")!==a[0]&&(g=!0);c.ENVIRONMENT_TYPE=e.environmentType?1:0;if(!g)return n.createDummyPromise();var w=[];for(var y=0;y<a.length;y++)a[y]&&a[y]!==""&&w.push(this.getConfig(a[y]));if(!w.length)return h.meshRendererComponent.hidden=!0,p.setTexture("DIFFUSE_MAP",null),c.SKYSPHERE=null,n.createDummyPromise();var E=this;return h.removeFromWorld(),t.all(w).then(function(t){var n=function(){h.meshRendererComponent.hidden=!0,p.setTexture("DIFFUSE_MAP",null),c.SKYSPHERE=null};if(f===r.SPHERE){if(a[0]===""){m.emit("goo.error.skybox",{type:"Sphere",message:"The skysphere needs an image to display."}),c.SKYSPHERE=null;return}t=t[0],t.setAttribute("data-ref",a[0])}else{if(t[0]===""){m.emit("goo.error.skybox",{type:"Box",message:"The skybox needs an image to display."}),n();return}var i=t[0].width,s=t[0].height;for(var o=0;o<6;o++){var u=t[o]=t[o]||t[0];if(u.width!==u.height){m.emit("goo.error.skybox",{type:"Box",message:"The skybox needs square images to display"}),n();return}if(i!==u.width||s!==u.height){m.emit("goo.error.skybox",{type:"Box",message:"The skybox needs six images of the same size to display"}),n();return}u.setAttribute("data-ref",a[o])}}v||(v=E._skyboxTexture=new d(null,{flipY:!1}),f===r.BOX&&(v.variant="CUBE")),v.setImage(t),f===r.BOX&&t.length&&(v.image.width=t[0].width,v.image.height=t[0].height,v.image.dataReady=!0),v.setNeedsUpdate();if(f===r.BOX&&t.length||t)p.setTexture("DIFFUSE_MAP",v),f===r.BOX?(c.SKYBOX=v,c.SKYSPHERE=null):(c.SKYSPHERE=v,c.ENVIRONMENT_TYPE=e.environmentType?1:0),h.meshRendererComponent.hidden=!1})}},w.prototype._updateEntities=function(e){var r=this,i=[];if(e.entityRefs&&Array.isArray(e.entityRefs)&&e.entityRefs.length>0){var s=function(e){return i.push(r.getConfig(e).then(function(t){return r.updateObject(e,t,r.options)}))};for(var o=0;o<e.entityRefs.length;o++)s(e.entityRefs[o]);return t.all(i).then(function(e){for(var t=0;t<e.length;t++){var n=e[t];(r.options.beforeAdd==null||r.options.beforeAdd.apply==null||r.options.beforeAdd(n))&&!(r.world.entityManager.containsEntity(n)||r.world._addedEntities.filter(function(e){return e.id===n.id}).length>0)&&n.addToWorld()}}).then(null,function(e){return console.error("Error updating entities: "+e)})}return console.warn("No entity refs in project"),n.createDummyPromise(e)},w.prototype._updatePosteffects=function(e){var r=this,i=[],s=r.world.getSystem("RenderSystem");if(e.posteffectRefs&&Array.isArray(e.posteffectRefs)&&e.posteffectRefs.length>0){var o=function(e){return r.getConfig(e).then(function(t){return r.updateObject(e,t,r.options)})};for(var f=0;f<e.posteffectRefs.length;f++)e.posteffectRefs[f]&&i.push(o(e.posteffectRefs[f]));return t.all(i).then(function(e){var t=!1;for(var n=0;n<e.length;n++){if(!e[n])continue;var i=e[n];i.enabled&&!t&&(t=!0)}if(t){var o,f,c;if(!r._composer){o=r._composer=new u,f=new a(s.renderList);var c=new h(p.clone(l.copy));c.renderToScreen=!0}else o=r._composer,f=o.passes[0],c=o.passes[o.passes.length-1];o.passes=[],o.addPass(f);for(var n=0;n<e.length;n++){if(!e[n])continue;var i=e[n];i.enabled&&o.addPass(i)}o.addPass(c),s.composers.indexOf(o)===-1&&s.composers.push(o)}else r._composer&&g.remove(s.composers,r._composer)}).then(null,function(e){return console.error("Error updating posteffects: "+e)})}return s.composers.length=0,n.createDummyPromise(e)},w.weatherHandlers={snow:{update:function(e,t){e.enabled?t.snow&&t.snow.enabled?(t.snow.snow.setEmissionVelocity(e.velocity),t.snow.snow.setReleaseRatePerSecond(e.rate),t.snow.snow.setEmissionHeight(e.height)):(t.snow=t.snow||{},t.snow.enabled=!0,t.snow.snow=new b(this.world.gooRunner)):t.snow&&t.snow.enabled&&(t.snow.snow.remove(),t.snow.enabled=!1,delete t.snow.snow)},remove:function(e){e.snow.snow&&(e.snow.snow.remove(),e.snow.enabled=!1,delete e.snow.snow)}}},w.prototype._updateWeather=function(e){for(var t in e)w.weatherHandlers[t].update.bind(this)(e[t],this.weatherState)},w.prototype._removeWeather=function(){for(var e in this.weatherState)w.weatherHandlers[e].remove.bind(this)(this.weatherState)},w.prototype.update=function(e,n,r){var i=this;this._prepare(n);var s=[];return s.push(this._updateSkybox(n.skybox,r)),(!r||!r.shallow)&&s.push(this._updateEntities(n)),s.push(this._updatePosteffects(n)),n.weather?this._updateWeather(n.weather):this._removeWeather(),t.all(s).then(function(e){var t=i.world.gooRunner.renderer;return t.setClearColor.apply(t,n.backgroundColor),i._composer&&i._composer.setClearColor(n.backgroundColor),c.GLOBAL_AMBIENT=n.globalAmbient,c.USE_FOG=n.useFog,c.FOG_SETTINGS=[n.fogNear,n.fogFar],c.FOG_COLOR=n.fogColor,e})},w.prototype.remove=function(){this._skybox&&this.world.getSystem("RenderSystem").removed(this._skybox),this._skybox=null},w}),define("goo/loaders/handlers/ScriptComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/entities/components/ScriptComponent","goo/util/rsvp","goo/util/PromiseUtil"],function(e,t,n,r){function i(){e.apply(this,arguments)}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,e._registerClass("script",i),i.prototype._prepare=function(){},i.prototype._create=function(e){var n=new t;return e.setComponent(n),n},i.prototype.update=function(t,i){function u(e){return s.getConfig(e).then(function(t){return s.updateObject(e,t)})}var s=this,o=[],a=e.prototype.update.call(this,t,i);if(i.scriptRefs&&i.scriptRefs.length){var f=i.scriptRefs;for(var l=0;l<f.length;l++)o.push(u(f[l]))}return o.length>0?n.all(o).then(function(e){e[0]?a.scripts=e:a.scripts=[]}):r.createDummyPromise(a)},i}),define("goo/scripts/OrbitCamControlScript",["goo/math/Vector2","goo/math/Vector3","goo/math/MathUtils"],function(e,t,n){function i(n){n=n||{};for(var i in r)typeof r[i]=="boolean"?this[i]=n[i]!==undefined?n[i]===!0:r[i]:isNaN(r[i])?r[i]instanceof t?this[i]=n[i]?new t(n[i]):(new t).set(r[i]):this[i]=n[i]||r[i]:this[i]=isNaN(n[i])?r[i]:n[i];this.name="OrbitCamControlScript",this.timeSamples=[0,0,0,0,0],this.xSamples=[0,0,0,0,0],this.ySamples=[0,0,0,0,0],this.sample=0,this.velocity=new e(0,0),this.targetSpherical=new t(this.spherical),this.cartesian=new t,this.dirty=!0,this.detailZoom=n.detailZoom||.15,this.zoomDistanceFactor=n.zoomDistanceFactor||.035,this.mouseState={buttonDown:!1,lastX:NaN,lastY:NaN},this.domElement&&this.setupMouseControls(),n.demoMode&&(this.demoMode=!0,this.moveInterval=n.moveInterval,this.lastTimeMoved=Date.now()+(n.moveInitialDelay-this.moveInterval))}function s(e,t,r){var i=(t+r)/2+(r>t?Math.PI:0),s=n.moduloPositive(e-i,n.TWO_PI),o=n.moduloPositive(t-i,n.TWO_PI),u=n.moduloPositive(r-i,n.TWO_PI);return e<0&&t>0?t-=n.TWO_PI:e>0&&t<0&&(t+=n.TWO_PI),e>n.TWO_PI&&r<n.TWO_PI&&(r+=n.TWO_PI),s<o?t:s>u?r:e}var r={domElement:null,turnSpeedHorizontal:.005,turnSpeedVertical:.005,zoomSpeed:.2,dragOnly:!0,dragButton:-1,worldUpVector:new t(0,1,0),baseDistance:15,minZoomDistance:1,maxZoomDistance:1e3,minAscent:-89.95*n.DEG_TO_RAD,maxAscent:89.95*n.DEG_TO_RAD,clampAzimuth:!1,minAzimuth:90*n.DEG_TO_RAD,maxAzimuth:270*n.DEG_TO_RAD,releaseVelocity:!0,invertedX:!1,invertedY:!1,invertedWheel:!0,drag:5,maxSampleTimeMS:200,lookAtPoint:new t(0,0,0),spherical:new t(15,0,0),interpolationSpeed:7,onRun:null};return i.prototype.updateButtonState=function(e,t){this.domElement!==document&&this.domElement.focus(),this.dragOnly&&(this.dragButton===-1||this.dragButton===e)&&(this.mouseState.buttonDown=t,t?(this.mouseState.lastX=NaN,this.mouseState.lastY=NaN,this.velocity.set(0,0),this.spherical.y=n.moduloPositive(this.spherical.y,n.TWO_PI),this.targetSpherical.copy(this.spherical)):this.applyReleaseDrift())},i.prototype.updateDeltas=function(e,t){var n=0,r=0;isNaN(this.mouseState.lastX)||isNaN(this.mouseState.lastY)?(this.mouseState.lastX=e,this.mouseState.lastY=t):(n=-(e-this.mouseState.lastX),r=t-this.mouseState.lastY,this.mouseState.lastX=e,this.mouseState.lastY=t);if(this.dragOnly&&!this.mouseState.buttonDown||n===0&&r===0)return;this.timeSamples[this.sample]=Date.now(),this.xSamples[this.sample]=n,this.ySamples[this.sample]=r,this.sample++,this.sample>this.timeSamples.length-1&&(this.sample=0),this.velocity.set(0,0),this.move(this.turnSpeedHorizontal*n,this.turnSpeedVertical*r)},i.prototype.move=function(e,t){var r=this.invertedX?-e:e,i=this.invertedY?-t:t;this.clampAzimuth?this.targetSpherical.y=s(this.targetSpherical.y-r,this.minAzimuth,this.maxAzimuth):this.targetSpherical.y=this.targetSpherical.y-r,this.targetSpherical.z=n.clamp(this.targetSpherical.z+i,this.minAscent,this.maxAscent),this.dirty=!0},i.prototype.applyWheel=function(e){var t=(this.invertedWheel?-1:1)*Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));t*=this.zoomDistanceFactor*this.targetSpherical.x,this.zoom(this.zoomSpeed*t)},i.prototype.zoom=function(e){var t=e*this.baseDistance;this.targetSpherical.x=n.clamp(this.targetSpherical.x+t,this.minZoomDistance,this.maxZoomDistance),this.dirty=!0},i.prototype.applyReleaseDrift=function(){var e=Date.now(),t=0,n=0,r=!1;for(var i=0,s=this.timeSamples.length;i<s;i++)e-this.timeSamples[i]<this.maxSampleTimeMS&&(t+=this.xSamples[i],n+=this.ySamples[i],r=!0);r?this.velocity.set(t*this.turnSpeedHorizontal/this.timeSamples.length,n*this.turnSpeedVertical/this.timeSamples.length):this.velocity.set(0,0)},i.prototype.setupMouseControls=function(){var e=this;this.domElement.addEventListener("mousedown",function(t){e.updateButtonState(t.button,!0)},!1),document.addEventListener("mouseup",function(t){e.updateButtonState(t.button,!1)},!1),document.addEventListener("mousemove",function(t){e.updateDeltas(t.clientX,t.clientY),e.lastTimeMoved=Date.now()},!1),this.domElement.addEventListener("mousewheel",function(t){e.applyWheel(t),e.lastTimeMoved=Date.now()},!1),this.domElement.addEventListener("DOMMouseScroll",function(t){e.applyWheel(t)},!1),this.domElement.addEventListener("dragstart",function(e){e.preventDefault()},!1),this.domElement.oncontextmenu=function(){return!1};var t=0;this.domElement.addEventListener("touchstart",function(){e.updateButtonState(0,!0)}),this.domElement.addEventListener("touchend",function(){e.updateButtonState(0,!1),t=0}),this.domElement.addEventListener("touchmove",function(n){var r,i,s,o=n.targetTouches,u=o[0].clientX,a=o[0].clientY;if(o.length===2){var f=o[1].clientX,l=o[1].clientY;r=(u+f)/2,i=(a+l)/2,s=(u-f)*(u-f)+(a-l)*(a-l)}else r=u,i=a,e.updateDeltas(r,i);var c=(s-t)/Math.max(e.domElement.height,e.domElement.width);c/=3,t===0?t=s:o.length===2&&Math.abs(c)>.3&&(e.applyWheel({wheelDelta:c}),t=s)})},i.prototype.updateVelocity=function(e){this.velocity.lengthSquared()>1e-6?(this.move(this.velocity.x,this.velocity.y),this.velocity.mul(n.clamp(n.lerp(e,1,1-this.drag),0,1)),this.dirty=!0):this.velocity.set(0,0,0)},i.prototype.run=function(e,t,r){if(this.demoMode){var i=Date.now();i-this.lastTimeMoved>this.moveInterval&&(this.lastTimeMoved=i,this.move(Math.round(Math.random())-.5,Math.round(Math.random())-.5))}r&&!this.domElement&&r.domElement&&(this.domElement=r.domElement,this.setupMouseControls());var s=e.transformComponent;if(!s)return;var o=s.transform;this.releaseVelocity&&this.updateVelocity(e._world.tpf);if(!this.dirty)return;var u=n.clamp(this.interpolationSpeed*e._world.tpf,0,1);this.clampAzimuth?this.spherical.y=n.lerp(u,this.spherical.y,this.targetSpherical.y):this.spherical.y=n.lerp(u,this.spherical.y,this.targetSpherical.y),this.spherical.x=n.lerp(u,this.spherical.x,this.targetSpherical.x),this.spherical.z=n.lerp(u,this.spherical.z,this.targetSpherical.z),n.sphericalToCartesian(this.spherical.x,this.spherical.y,this.spherical.z,this.cartesian),o.translation.set(this.cartesian.add(this.lookAtPoint)),o.translation.equals(this.lookAtPoint)||o.lookAt(this.lookAtPoint,this.worldUpVector),this.spherical.distanceSquared(this.targetSpherical)<1e-6&&(this.dirty=!1,this.spherical.y=n.moduloPositive(this.spherical.y,n.TWO_PI),this.targetSpherical.copy(this.spherical)),s.setUpdated()},i}),define("goo/scripts/OrbitNPanControlScript",["goo/scripts/OrbitCamControlScript","goo/renderer/Renderer","goo/math/Vector3","goo/math/MathUtils"],function(e,t,n,r){function s(t){t=t||{},e.call(this,t),this.name="OrbitNPanControlScript",this.panState={buttonDown:!1,lastX:NaN,lastY:NaN,lastPos:new n},this.viewportWidth=0,this.viewportHeight=0,this.shiftKey=!1,this.altKey=!1,this.goingToLookAt=(new n).setv(this.lookAtPoint)}var i={LEFT:0,MIDDLE:1,RIGHT:2};return s.prototype=Object.create(e.prototype),s.prototype.setupMouseControls=function(){var e=this;this.domElement.addEventListener("mousedown",function(t){e.shiftKey=t.shiftKey,e.altKey=t.altKey,e.updateButtonState(t.button,!0,t)},!1),document.addEventListener("mouseup",function(t){e.updateButtonState(t.button,!1,t)},!1),document.addEventListener("mousemove",function(t){e.updateDeltas(t.clientX,t.clientY)},!1),this.domElement.addEventListener("mousewheel",function(t){e.shiftKey=t.shiftKey,e.applyWheel(t.wheelDelta||-t.detail)},!1),this.domElement.addEventListener("DOMMouseScroll",function(t){e.shiftKey=t.shiftKey,e.applyWheel(t.wheelDelta||-t.detail)},!1),this.domElement.addEventListener("dragstart",function(e){e.preventDefault()},!1),this.domElement.oncontextmenu=function(){return!1},this.domElement.addEventListener("touchstart",function(t){var n=t.targetTouches.length===2,r=t.targetTouches.length===1;e.updateButtonState(i.MIDDLE,n),e.updateButtonState(i.RIGHT,r)}),this.domElement.addEventListener("touchend",function(t){var n=t.targetTouches.length===2,r=t.targetTouches.length===1;e.updateButtonState(i.MIDDLE,n),e.updateButtonState(i.RIGHT,r)});var t=0;this.domElement.addEventListener("touchmove",function(n){var r,i,s,o=n.targetTouches,u=o[0].clientX,a=o[0].clientY;if(o.length===2){var f=o[1].clientX,l=o[1].clientY;r=(u+f)/2,i=(a+l)/2,s=(u-f)*(u-f)+(a-l)*(a-l)}else r=u,i=a;e.updateDeltas(r,i);var c=(s-t)/Math.max(e.domElement.height,e.domElement.width);c/=3,o.length===2&&Math.abs(c)>.3&&(e.applyWheel(e.zoomSpeed*c),t=s)})},s.prototype.updateButtonState=function(t,n){if(t===i.RIGHT||t===i.LEFT&&this.altKey)e.prototype.updateButtonState.call(this,0,n);else if(t===1||t===0&&this.shiftKey)this.panState.buttonDown=n,n&&(this.panState.lastX=NaN,this.panState.lastY=NaN,this.panState.lastPos.setv(this.lookAtPoint))},s.prototype.resetLookAt=function(e,t,n,i){this.goingToLookAt.setv(e),this.lookAtPoint.setv(e),this.panState.lastX=NaN,this.panState.lastY=NaN,this.panState.lastPos.setv(e),this.velocity.set(0),r.cartesianToSpherical(t,n,i,this.spherical),this.targetSpherical.setv(this.spherical),r.sphericalToCartesian(this.spherical.x,this.spherical.y,this.spherical.z,this.cartesian)},s.prototype.updateDeltas=function(r,i){e.prototype.updateDeltas.call(this,r,i);var s=new n,o=new n;if(isNaN(this.panState.lastX)||isNaN(this.panState.lastY))this.panState.lastX=r,this.panState.lastY=i;if(this.panState.buttonDown){var u=t.mainCamera;if(!u)return;u.getScreenCoordinates(this.panState.lastPos,1,1,o),o.x-=(r-this.panState.lastX)/this.viewportWidth,o.y+=(i-this.panState.lastY)/this.viewportHeight,u.getWorldCoordinates(o.x,o.y,1,1,o.z,s),this.lookAtPoint.setv(s),this.goingToLookAt.setv(this.lookAtPoint),this.dirty=!0}},s.prototype.applyWheel=function(e){var e=(this.invertedWheel?-1:1)*r.clamp(e,-1,1);this.shiftKey&&(e*=this.detailZoom),e*=this.zoomDistanceFactor*this.targetSpherical.x,this.zoom(this.zoomSpeed*e)},s.prototype.run=function(t,n,r){if(!this.goingToLookAt.equals(this.lookAtPoint)){var i=n*7;this.lookAtPoint.lerp(this.goingToLookAt,i),this.dirty=!0}e.prototype.run.call(this,t,n,r),r&&(this.viewportWidth=r.viewportWidth,this.viewportHeight=r.viewportHeight)},s}),define("goo/scripts/FlyControlScript",["goo/math/Vector3","goo/math/Matrix3x3","goo/math/MathUtils"],function(e,t,n){function r(r){r=r||{},this.name="FlyControlScript",this.domElement=r.domElement||null,this.turnSpeedHorizontal=isNaN(r.turnSpeedHorizontal)?.005:r.turnSpeedHorizontal,this.turnSpeedVertical=isNaN(r.turnSpeedVertical)?.005:r.turnSpeedVertical,this.dragOnly=r.dragOnly!==undefined?r.dragOnly===!0:!0,this.dragButton=isNaN(r.dragButton)?2:r.dragButton,this.worldUpVector=new e(r.worldUpVector)||new e(0,1,0),this.localLeftVector=new e(r.localLeftVector)||new e(-1,0,0),this.onRun=r.onRun,this.maxAscent=r.maxAscent!==undefined?r.maxAscent:89.95*n.DEG_TO_RAD,this.minAscent=r.minAscent!==undefined?r.minAscent:-89.95*n.DEG_TO_RAD,this.calcVector=new e,this.calcMat1=new t,this.calcMat2=new t,this.rotX=0,this.rotY=0,this.walkSpeed=isNaN(r.walkSpeed)?400:r.walkSpeed,this.crawlSpeed=isNaN(r.crawlSpeed)?40:r.crawlSpeed,this.fwdVector=r.fwdVector||new e(0,0,-1),this.leftVector=r.leftVector||new e(-1,0,0),this.crawlKey=isNaN(r.crawlKey)?16:r.crawlKey,this.forwardKey=isNaN(r.forwardKey)?87:r.forwardKey,this.backKey=isNaN(r.backKey)?83:r.backKey,this.strafeLeftKey=isNaN(r.strafeLeftKey)?65:r.strafeLeftKey,this.strafeRightKey=isNaN(r.strafeRightKey)?68:r.strafeRightKey,this.XZ=r.XZ||!1,this.maxSpeed=r.maxSpeed||30,this.onRun=r.onRun,this.moveState={strafeLeft:0,strafeRight:0,forward:0,back:0,crawling:!1},this.moveVector=new e(0,0,0),this.calcVector=new e,this.baseMultiplier=1,this.movementMultiplier=this.baseMultiplier,this.domElement&&this.setupKeyControls(),this.resetMouseState(),this.domElement&&this.setupMouseControls()}r.prototype.updateMovementVector=function(){this.moveVector.x=this.moveState.strafeLeft-this.moveState.strafeRight,this.moveVector.z=this.moveState.forward-this.moveState.back},r.prototype.updateKeys=function(e,t){if(e.altKey)return;if(this.dragOnly&&!this.mouseState.buttonDown){this.movementMultiplier=this.baseMultiplier,this.moveState.forward=0,this.moveState.back=0,this.moveState.strafeLeft=0,this.moveState.strafeRight=0,this.updateMovementVector();return}var n=!1;switch(e.keyCode){case this.crawlKey:this.moveState.crawling=t;break;case this.forwardKey:this.moveState.forward=t?1:0,n=!0;break;case this.backKey:this.moveState.back=t?1:0,n=!0;break;case this.strafeLeftKey:this.moveState.strafeLeft=t?1:0,n=!0;break;case this.strafeRightKey:this.moveState.strafeRight=t?1:0,n=!0}n&&this.updateMovementVector()},r.prototype.resetMouseState=function(){this.mouseState={buttonDown:!1,lastX:NaN,lastY:NaN,dX:0,dY:0}},r.prototype.updateButtonState=function(e,t){this.dragOnly&&(this.dragButton===-1||this.dragButton===e.button)&&(this.mouseState.buttonDown=t,e.preventDefault())},r.prototype.updateDeltas=function(e){isNaN(this.mouseState.lastX)||isNaN(this.mouseState.lastY)?(this.mouseState.dX=0,this.mouseState.dY=0,this.mouseState.lastX=e.clientX,this.mouseState.lastY=e.clientY):(this.mouseState.dX=e.clientX-this.mouseState.lastX,this.mouseState.dY=e.clientY-this.mouseState.lastY,this.mouseState.lastX=e.clientX,this.mouseState.lastY=e.clientY)};var i=function(e){this.updateKeys(e,!0)},s=function(e){this.updateKeys(e,!1)};r.prototype.setupKeyControls=function(){this.domElement.setAttribute("tabindex",-1),this.keydown||(this.keydown=i.bind(this)),this.keyup||(this.keyup=s.bind(this)),this.domElement.addEventListener("keydown",this.keydown,!1),this.domElement.addEventListener("keyup",this.keyup,!1)},r.prototype.tearDownKeyControls=function(){this.domElement.removeEventListener("keydown",this.keydown,!1),this.domElement.removeEventListener("keyup",this.keyup,!1)};var o=function(e){this.setupKeyControls(),this.domElement.focus(),this.resetMouseState(),this.updateButtonState(e,!0)},u=function(e){this.updateDeltas(e)},a=function(e){this.updateButtonState(e,!1),this.tearDownKeyControls()};return r.prototype.setupMouseControls=function(){var e=o.bind(this),t=u.bind(this),n=a.bind(this);this.domElement.addEventListener("mousedown",e,!1),this.domElement.addEventListener("mousemove",t,!1),this.domElement.addEventListener("mouseup",n,!1),this.domElement.addEventListener("mouseout",n,!1),this.domElement.addEventListener("dragstart",function(e){e.preventDefault()},!1),this.domElement.oncontextmenu=function(){return!1}},r.prototype.run=function(e,t,n){n&&!this.domElement&&n.domElement&&(this.domElement=n.domElement,this.setupMouseControls());var r=e.transformComponent;if(!r)return;var i=r.transform,s=i.rotation;s.toAngles(this.calcVector),this.rotY=this.calcVector.x,this.rotX=this.calcVector.y;if(this.dragOnly&&!this.mouseState.buttonDown){this.mouseState.dX=0,this.mouseState.dY=0,this.movementMultiplier=this.baseMultiplier,this.moveState.forward=0,this.moveState.back=0,this.moveState.strafeLeft=0,this.moveState.strafeRight=0,this.updateMovementVector();return}this.moveVector.x!==0||this.moveVector.z!==0?(this.movementMultiplier+=t*this.movementMultiplier*1,this.movementMultiplier=Math.min(this.movementMultiplier,this.maxSpeed)):this.movementMultiplier=this.baseMultiplier;var o=this.turnSpeedHorizontal,u=this.turnSpeedVertical;this.mouseState.dX!==0&&(this.rotX-=o*this.mouseState.dX),this.mouseState.dY!==0&&(this.rotY-=u*this.mouseState.dY,this.rotY>this.maxAscent?this.rotY=this.maxAscent:this.rotY<this.minAscent&&(this.rotY=this.minAscent)),i.rotation.fromAngles(this.rotY,this.rotX,0),this.calcVector.set(this.fwdVector.x*this.moveVector.z+this.leftVector.x*this.moveVector.x,this.fwdVector.y*this.moveVector.z+this.leftVector.y*this.moveVector.x,this.fwdVector.z*this.moveVector.z+this.leftVector.z*this.moveVector.x),this.calcVector.normalize();var a=(this.moveState.crawling?this.crawlSpeed:this.walkSpeed)*this.movementMultiplier,f=e._world.tpf*a;this.calcVector.mul(f);var s=i.rotation;s.applyPost(this.calcVector),this.XZ&&(this.calcVector.data[1]=0),i.translation.add(this.calcVector),r.setUpdated(),this.mouseState.dX=0,this.mouseState.dY=0},r}),define("goo/scripts/WASDControlScript",["goo/math/Vector","goo/math/Vector3"],function(e,t){function n(e){e=e||{},this.name="WASDControlScript",this.domElement=e.domElement||null,this.walkSpeed=isNaN(e.walkSpeed)?100:e.walkSpeed,this.crawlSpeed=isNaN(e.crawlSpeed)?10:e.crawlSpeed,this.fwdVector=e.fwdVector||new t(0,0,-1),this.leftVector=e.leftVector||new t(-1,0,0),this.crawlKey=isNaN(e.crawlKey)?16:e.crawlKey,this.forwardKey=isNaN(e.forwardKey)?87:e.forwardKey,this.backKey=isNaN(e.backKey)?83:e.backKey,this.strafeLeftKey=isNaN(e.strafeLeftKey)?65:e.strafeLeftKey,this.strafeRightKey=isNaN(e.strafeRightKey)?68:e.strafeRightKey,this.XZ=e.XZ||!1,this.onRun=e.onRun,this.moveState={strafeLeft:0,strafeRight:0,forward:0,back:0,crawling:!1},this.moveVector=new t(0,0,0),this.calcVector=new t,this.domElement&&this.setupKeyControls()}return n.prototype.updateMovementVector=function(){this.moveVector.x=this.moveState.strafeLeft-this.moveState.strafeRight,this.moveVector.z=this.moveState.forward-this.moveState.back},n.prototype.updateKeys=function(e,t){if(e.altKey)return;var n=!1;switch(e.keyCode){case this.crawlKey:this.moveState.crawling=t;break;case this.forwardKey:this.moveState.forward=t?1:0,n=!0;break;case this.backKey:this.moveState.back=t?1:0,n=!0;break;case this.strafeLeftKey:this.moveState.strafeLeft=t?1:0,n=!0;break;case this.strafeRightKey:this.moveState.strafeRight=t?1:0,n=!0}n&&this.updateMovementVector()},n.prototype.setupKeyControls=function(){var e=this;this.domElement.setAttribute("tabindex",-1),this.domElement.addEventListener("keydown",function(t){e.updateKeys(t,!0)},!1),this.domElement.addEventListener("keyup",function(t){e.updateKeys(t,!1)},!1)},n.prototype.run=function(n,r,i){i&&!this.domElement&&i.domElement&&(this.domElement=i.domElement,this.setupKeyControls());var s=n.transformComponent,o=s.transform;if(e.equals(this.moveVector,t.ZERO))return;this.calcVector.set(this.fwdVector.x*this.moveVector.z+this.leftVector.x*this.moveVector.x,this.fwdVector.y*this.moveVector.z+this.leftVector.y*this.moveVector.x,this.fwdVector.z*this.moveVector.z+this.leftVector.z*this.moveVector.x),this.calcVector.normalize();var u=n._world.tpf*(this.moveState.crawling?this.crawlSpeed:this.walkSpeed);this.calcVector.mul(u);var a=o.rotation;a.applyPost(this.calcVector),this.XZ&&(this.calcVector.data[1]=0),o.translation.add(this.calcVector),s.setUpdated()},n}),define("goo/scripts/BasicControlScript",["goo/math/Vector3","goo/math/Matrix3x3"],function(e,t){function n(n){n=n||{},this.domElement=n.domElement===undefined?null:n.domElement.domElement||n.domElement,this.name="BasicControlScript",this.movementSpeed=10,this.rollSpeed=2,this.movementSpeedMultiplier=1,this.mouseStatus=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new e(0,0,0),this.rotationVector=new e(0,0,0),this.multiplier=new e(1,1,1),this.rotationMatrix=new t,this.tmpVec=new e,this.handleEvent=function(e){typeof this[e.type]=="function"&&this[e.type](e)},this.keydown=function(e){if(e.altKey)return;switch(e.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()},this.keyup=function(e){switch(e.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},this.mousedown=function(e){this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e=e.touches&&e.touches.length===1?e.touches[0]:e,this.mouseDownX=e.pageX,this.mouseDownY=e.pageY,this.mouseStatus=1,document.addEventListener("mousemove",this.mousemove,!1),document.addEventListener("mouseup",this.mouseup,!1),document.addEventListener("touchmove",this.mousemove,!1),document.addEventListener("touchend",this.mouseup,!1)}.bind(this),this.mousemove=function(e){this.mouseStatus>0&&(e=e.touches&&e.touches.length===1?e.touches[0]:e,this.moveState.yawLeft=e.pageX-this.mouseDownX,this.moveState.pitchDown=e.pageY-this.mouseDownY,this.updateRotationVector(),this.mouseDownX=e.pageX,this.mouseDownY=e.pageY)}.bind(this),this.mouseup=function(e){if(!this.mouseStatus)return;e.preventDefault(),this.mouseStatus=0,this.moveState.yawLeft=this.moveState.pitchDown=0,this.updateRotationVector(),document.removeEventListener("mousemove",this.mousemove),document.removeEventListener("mouseup",this.mouseup),document.removeEventListener("touchmove",this.mousemove),document.removeEventListener("touchend",this.mouseup)}.bind(this),this.updateMovementVector=function(){var e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!==document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.domElement&&this.setupMouseControls(),this.updateMovementVector(),this.updateRotationVector()}return n.prototype.setupMouseControls=function(){this.domElement.setAttribute("tabindex",-1),this.domElement.addEventListener("mousedown",this.mousedown,!1),this.domElement.addEventListener("touchstart",this.mousedown,!1),this.domElement.addEventListener("keydown",this.keydown.bind(this),!1),this.domElement.addEventListener("keyup",this.keyup.bind(this),!1)},n.prototype.externals=function(){return[{variable:"movementSpeed",type:"number"},{variable:"rollSpeed",type:"number"}]},n.prototype.run=function(t,n,r){r&&!this.domElement&&r.domElement&&(this.domElement=r.domElement,this.setupMouseControls());var i=t.transformComponent,s=i.transform,o=t._world.tpf,u=o*this.movementSpeed*this.movementSpeedMultiplier,a=o*this.rollSpeed*this.movementSpeedMultiplier;if(!this.moveVector.equals(e.ZERO)||!this.rotationVector.equals(e.ZERO)||this.mouseStatus>0)s.translation.x+=this.moveVector.x*u,s.translation.y+=this.moveVector.y*u,s.translation.z+=this.moveVector.z*u,this.tmpVec.x+=-this.rotationVector.x*a*this.multiplier.x,this.tmpVec.y+=this.rotationVector.y*a*this.multiplier.y,this.tmpVec.z+=this.rotationVector.z*a*this.multiplier.z,s.rotation.fromAngles(this.tmpVec.x,this.tmpVec.y,this.tmpVec.z),this.mouseStatus>0&&(this.moveState.yawLeft=0,this.moveState.pitchDown=0,this.updateRotationVector()),i.setUpdated()},n}),define("goo/loaders/handlers/ScriptHandler",["goo/loaders/handlers/ConfigHandler","goo/util/rsvp","goo/scripts/OrbitCamControlScript","goo/scripts/OrbitNPanControlScript","goo/scripts/FlyControlScript","goo/scripts/WASDControlScript","goo/scripts/BasicControlScript","goo/util/PromiseUtil"],function(e,t,n,r,i,s,o,u){function a(){e.apply(this,arguments)}return a.scripts={OrbitCamControlScript:n,OrbitNPanControlScript:r,FlyControlScript:i,WASDControlScript:s,BasicControlScript:o},a.prototype=Object.create(e.prototype),a.prototype.constructor=a,e._registerClass("script",a),a.prototype._prepare=function(){},a.prototype._create=function(){},a.prototype.update=function(e,t){var n=t.className,r=null;return a.scripts[n]instanceof Function&&(r=new a.scripts[n](t.options)),u.createDummyPromise(r)},a}),define("goo/addons/howler/components/HowlerComponent",["goo/entities/components/Component"],function(e){function t(){this.type="HowlerComponent",this.sounds=[]}return t.prototype=Object.create(e.prototype),t.prototype.addSound=function(e){this.sounds.indexOf(e)===-1&&this.sounds.push(e)},t.prototype.playSound=function(e,t,n){this.sounds[e].play(t,n)},t.prototype.getSound=function(e){return this.sounds[e]},t}),define("goo/loaders/handlers/SoundComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/addons/howler/components/HowlerComponent","goo/util/rsvp","goo/util/PromiseUtil"],function(e,t,n,r){function i(){e.apply(this,arguments)}return i.prototype=Object.create(e.prototype),e._registerClass("sound",i),i._type="howler",i.prototype.constructor=i,i.prototype._create=function(e){var n=new t;return e.setComponent(n),n},i.prototype.update=function(t,i){if(!window.Howl)throw new Error("Howler is missing");var s=e.prototype.update.call(this,t,i);for(var o=0;o<s.sounds.length;o++)s.sounds[o].stop();s.sounds=[];var u=i.soundRefs;if(u){var a=[];for(var o=0;o<u.length;o++)a.push(this._getSound(u[o]));return n.all(a).then(function(e){return s.sounds=e,s})}return r.createDummyPromise(s)},i.prototype._getSound=function(e){var t=this;return this.getConfig(e).then(function(n){return t.updateObject(e,n)})},i}),define("goo/loaders/handlers/SoundHandler",["goo/loaders/handlers/ConfigHandler","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil"],function(e,t,n,r){function i(){e.apply(this,arguments),this._objects={}}function s(e,t){var n=e.length;if(n!==t.length)return!1;while(n--)if(e[n]!==t[n])return!1;return!0}return i.prototype=Object.create(e.prototype),e._registerClass("sound",i),i.prototype.constructor=i,i.prototype._prepare=function(e){r.defaults(e,{loop:!1,urls:[],volume:1,name:"A Sound"})},i.prototype._create=function(e){var t=new window.Howl({});return t._loaded=!0,this._objects[e]=t},i.prototype.update=function(e,n){if(!window.Howl)throw new Error("Howler is missing");this._prepare(n);var r=this._objects[e]||this._create(e,n),i=[];for(var o in n){if(o==="urls")continue;r[o]instanceof Function&&r[o](n[o])}for(var u=0;u<n.urls.length;u++)i.push(this.getConfig(n.urls[u]));return t.all(i).then(function(n){if(!s(n,r._urls)){var i=new t.Promise;return r.on("load",function(){i.resolve(r)}),r.on("loaderror",function(t){i.reject("Error loading sound for "+e)}),r.urls(n),i}return r})},i.prototype.remove=function(e){this._objects[e]&&this._objects[e].stop(),delete this._objects[e]},i}),define("goo/renderer/pass/BloomPass",["goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/pass/RenderTarget","goo/renderer/Util","goo/renderer/shaders/ShaderLib"],function(e,t,n,r,i){function s(n){n=n||{},this.target=n.target!==undefined?n.target:null;var o=n.strength!==undefined?n.strength:0,u=n.sigma!==undefined?n.sigma:4,a=2*Math.ceil(u*3)+1;this.downsampleAmount=n.downsampleAmount!==undefined?Math.max(n.downsampleAmount,1):4;var f=window.innerWidth||1024,l=window.innerHeight||1024;this.updateSize({x:0,y:0,width:f,height:l}),this.renderable={meshData:t.quad,materials:[]},this.copyMaterial=e.createMaterial(i.copyPure),this.copyMaterial.uniforms.opacity=o,this.copyMaterial.blendState.blending="AdditiveBlending",this.convolutionShader=r.clone(i.convolution),this.convolutionShader.defines={KERNEL_SIZE_FLOAT:a.toFixed(1),KERNEL_SIZE_INT:a.toFixed(0)},this.convolutionMaterial=e.createMaterial(this.convolutionShader),this.convolutionMaterial.uniforms.uImageIncrement=s.blurX,this.convolutionMaterial.uniforms.cKernel=this.convolutionShader.buildKernel(u),this.bcMaterial=e.createMaterial(i.brightnesscontrast),this.bcMaterial.uniforms.brightness=0,this.bcMaterial.uniforms.contrast=0,this.enabled=!0,this.clear=!1,this.needsSwap=!1}return s.prototype.updateSize=function(e){var t=e.width/this.downsampleAmount,r=e.height/this.downsampleAmount;this.renderTargetX=new n(t,r),this.renderTargetY=new n(t,r)},s.prototype.render=function(e,n,r){this.renderable.materials[0]=this.bcMaterial,this.bcMaterial.setTexture("DIFFUSE_MAP",r),e.render(this.renderable,t.camera,[],this.renderTargetY,!0),this.renderable.materials[0]=this.convolutionMaterial,this.convolutionMaterial.setTexture("DIFFUSE_MAP",this.renderTargetY),this.convolutionMaterial.uniforms.uImageIncrement=s.blurY,e.render(this.renderable,t.camera,[],this.renderTargetX,!0),this.convolutionMaterial.setTexture("DIFFUSE_MAP",this.renderTargetX),this.convolutionMaterial.uniforms.uImageIncrement=s.blurX,e.render(this.renderable,t.camera,[],this.renderTargetY,!0),this.renderable.materials[0]=this.copyMaterial,this.copyMaterial.setTexture("DIFFUSE_MAP",this.renderTargetY),this.target!==null?e.render(this.renderable,t.camera,[],this.target,this.clear):e.render(this.renderable,t.camera,[],r,this.clear)},s.blurX=[.001953125,0],s.blurY=[0,.001953125],s}),define("goo/renderer/pass/BlurPass",["goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/pass/RenderTarget","goo/renderer/Util","goo/renderer/shaders/ShaderLib"],function(e,t,n,r,i){function s(n){n=n||{},this.target=n.target!==undefined?n.target:null;var s=n.strength!==undefined?n.strength:1,o=n.sigma!==undefined?n.sigma:4,u=2*Math.ceil(o*3)+1;this.downsampleAmount=n.downsampleAmount!==undefined?Math.max(n.downsampleAmount,1):4,this.blurX=[.001953125,0],this.blurY=[0,.001953125];var a=window.innerWidth||1024,f=window.innerHeight||1024;this.updateSize({x:0,y:0,width:a,height:f}),this.renderable={meshData:t.quad,materials:[]},this.copyMaterial=e.createMaterial(i.copyPure),this.copyMaterial.uniforms.opacity=s,this.copyMaterial.blendState.blending="CustomBlending",this.convolutionShader=r.clone(i.convolution),this.convolutionShader.defines={KERNEL_SIZE_FLOAT:u.toFixed(1),KERNEL_SIZE_INT:u.toFixed(0)},this.convolutionShader.uniforms.uImageIncrement=this.blurX,this.convolutionShader.uniforms.cKernel=this.convolutionShader.buildKernel(o),this.convolutionMaterial=e.createMaterial(this.convolutionShader),this.enabled=!0,this.clear=!1,this.needsSwap=!1}return s.prototype.updateSize=function(e){var t=e.width/this.downsampleAmount,r=e.height/this.downsampleAmount;this.renderTargetX=new n(t,r),this.renderTargetY=new n(t,r)},s.prototype.render=function(e,n,r){this.renderable.materials[0]=this.convolutionMaterial,this.convolutionMaterial.setTexture("DIFFUSE_MAP",r),this.convolutionMaterial.uniforms.uImageIncrement=this.blurY,e.render(this.renderable,t.camera,[],this.renderTargetX,!0),this.convolutionMaterial.setTexture("DIFFUSE_MAP",this.renderTargetX),this.convolutionMaterial.uniforms.uImageIncrement=this.blurX,e.render(this.renderable,t.camera,[],this.renderTargetY,!0),this.renderable.materials[0]=this.copyMaterial,this.copyMaterial.setTexture("DIFFUSE_MAP",this.renderTargetY),this.target!==null?e.render(this.renderable,t.camera,[],this.target,this.clear):e.render(this.renderable,t.camera,[],r,this.clear)},s}),define("goo/renderer/pass/PassLib",["goo/renderer/shaders/ShaderLib","goo/renderer/pass/FullscreenPass","goo/renderer/pass/BloomPass","goo/renderer/pass/BlurPass","goo/renderer/Util"],function(e,t,n,r,i){function s(){n.call(this,arguments)}function o(){r.call(this,arguments)}function u(){t.call(this,i.clone(e.vignette))}function a(){t.call(this,i.clone(e.sepia))}function f(){t.call(this,i.clone(e.film))}function l(){t.call(this,i.clone(e.noise))}function c(){t.call(this,i.clone(e.rgbshift))}function h(){t.call(this,i.clone(e.bleachbypass))}function p(){t.call(this,i.clone(e.hsb))}function d(){t.call(this,i.clone(e.colorify))}function v(){t.call(this,i.clone(e.hatch))}function m(){t.call(this,i.clone(e.dotscreen))}function g(){t.call(this,i.clone(e.brightnesscontrast))}return s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype.update=function(e){var t=e.options||{};t.opacity!==undefined&&(this.copyMaterial.uniforms.opacity=t.opacity/100),t.size!==undefined&&(this.convolutionMaterial.uniforms.size=t.size),t.brightness!==undefined&&(this.bcMaterial.uniforms.brightness=t.brightness/100),t.contrast!==undefined&&(this.bcMaterial.uniforms.contrast=t.contrast/100),e.enabled!==undefined&&(this.enabled=e.enabled)},s.label="Bloom",s.options=[{key:"opacity",name:"Opacity",type:"int",control:"slider",min:0,max:100,"default":100},{key:"size",name:"Size",type:"float",control:"slider",min:0,max:10,decimals:1,"default":2},{key:"brightness",name:"Gain",type:"int",control:"slider",min:-100,max:100,"default":0},{key:"contrast",name:"Intensity",type:"int",control:"slider",min:-100,max:100,"default":0}],o.prototype=Object.create(r.prototype),o.prototype.constructor=o,o.prototype.update=function(e){var t=e.options||{};t.opacity!==undefined&&(this.copyMaterial.uniforms.opacity=t.opacity/100),t.size!==undefined&&(this.blurX=[.001953125*t.size,0],this.blurY=[0,.001953125*t.size]),e.enabled!==undefined&&(this.enabled=e.enabled)},o.label="Blur",o.options=[{key:"opacity",name:"Amount",type:"int",control:"slider",min:0,max:100,"default":100},{key:"size",name:"Size",type:"float",control:"slider",min:0,max:5,decimals:1,"default":1}],u.prototype=Object.create(t.prototype),u.prototype.construcor=u,u.prototype.update=function(e){var t=e.options,n=this.material.shader;t.offset!==undefined&&(n.uniforms.offset=t.offset),t.darkness!==undefined&&(n.uniforms.darkness=t.darkness),e.enabled!==undefined&&(this.enabled=e.enabled)},u.label="Vignette",u.options=[{key:"offset",type:"float",control:"slider",name:"Offset",min:0,max:10,decimals:1,"default":1},{key:"darkness",type:"float",control:"slider",name:"Darkness",min:0,max:2,decimals:2,"default":1.5}],a.prototype=Object.create(t.prototype),a.prototype.constructor=a,a.prototype.update=function(e){var t=e.options;t.amount!==undefined&&(this.material.uniforms.amount=t.amount/100),e.enabled!==undefined&&(this.enabled=e.enabled)},a.label="Sepia",a.options=[{key:"amount",name:"Amount",type:"int",control:"slider",min:0,max:100,"default":100}],f.prototype=Object.create(t.prototype),f.prototype.constructor=f,f.prototype.update=function(e){var t=e.options,n=this.material.shader;t.nIntensity!==undefined&&(n.uniforms.nIntensity=t.nIntensity/100),t.sIntensity!==undefined&&(n.uniforms.sIntensity=t.sIntensity/100),t.sCount!==undefined&&(n.uniforms.sCount=t.sCount),e.enabled!==undefined&&(this.enabled=e.enabled)},f.label="Film Grain",f.options=[{key:"nIntensity",type:"int",control:"slider",name:"Noise",min:0,max:100,"default":50},{key:"sIntensity",type:"int",control:"slider",name:"Line Intensity",min:0,max:100,"default":50},{key:"sCount",type:"int",control:"slider",name:"Line Count",min:1,max:4096,"default":1024}],l.prototype=Object.create(t.prototype),l.prototype.constructor=l,l.prototype.update=function(e){var t=e.options,n=this.material.shader;t.nIntensity!==undefined&&(n.uniforms.nIntensity=t.nIntensity/100),e.enabled!==undefined&&(this.enabled=e.enabled)},l.label="Noise",l.options=[{key:"nIntensity",type:"int",control:"slider",name:"Noise",min:0,max:100,"default":50}],c.prototype=Object.create(t.prototype),c.prototype.constructor=c,c.prototype.update=function(e){var t=e.options,n=this.material.shader;t.amount!==undefined&&(n.uniforms.amount=t.amount),t.angle!==undefined&&(n.uniforms.angle=t.angle),e.enabled!==undefined&&(this.enabled=e.enabled)},c.label="RgbShift",c.options=[{key:"amount",type:"float",control:"slider",name:"Amount",min:0,max:.05,decimals:3,"default":.005},{key:"angle",type:"float",control:"slider",name:"Angle",min:0,max:6.28,decimals:1,"default":0}],h.prototype=Object.create(t.prototype),h.prototype.constructor=h,h.prototype.update=function(e){var t=e.options,n=this.material.shader;t.opacity!==undefined&&(n.uniforms.opacity=t.opacity),e.enabled!==undefined&&(this.enabled=e.enabled)},h.label="Bleach",h.options=[{key:"opacity",type:"float",control:"slider",name:"Opacity",min:0,max:1,decimals:2,"default":1}],p.prototype=Object.create(t.prototype),p.prototype.constructor=p,p.prototype.update=function(e){var t=e.options,n=this.material.shader;t.hue!==undefined&&(n.uniforms.hue=t.hue),t.saturation!==undefined&&(n.uniforms.saturation=t.saturation),t.brightness!==undefined&&(n.uniforms.brightness=t.brightness),e.enabled!==undefined&&(this.enabled=e.enabled)},p.label="HSB",p.options=[{key:"hue",type:"float",control:"slider",name:"Hue",min:-1,max:1,decimals:2,"default":0},{key:"saturation",type:"float",control:"slider",name:"Saturation",min:-1,max:1,decimals:2,"default":0},{key:"brightness",type:"float",control:"slider",name:"Brightness",min:-1,max:1,decimals:2,"default":0}],d.prototype=Object.create(t.prototype),d.prototype.constructor=d,d.prototype.update=function(e){var t=e.options,n=this.material.shader;t.color!==undefined&&(n.uniforms.color=t.color),t.amount!==undefined&&(n.uniforms.amount=t.amount),e.enabled!==undefined&&(this.enabled=e.enabled)},d.label="Tint",d.options=[{key:"color",type:"color",name:"Color","default":[1,1,1]},{key:"amount",type:"float",control:"slider",name:"Amount",min:0,max:1,decimals:2,"default":1}],v.prototype=Object.create(t.prototype),v.prototype.constructor=v,v.prototype.update=function(e){var t=e.options,n=this.material.shader;t.width!==undefined&&(n.uniforms.width=t.width),t.spread!==undefined&&(n.uniforms.spread=t.spread),e.enabled!==undefined&&(this.enabled=e.enabled)},v.label="Hatch",v.options=[{key:"width",type:"float",control:"slider",name:"Width",min:0,max:10,decimals:1,"default":2},{key:"spread",type:"int",control:"slider",name:"Spread",min:1,max:50,"default":8}],m.prototype=Object.create(t.prototype),m.prototype.constructor=m,m.prototype.update=function(e){var t=e.options,n=this.material.shader;t.angle!==undefined&&(n.uniforms.angle=t.angle),t.scale!==undefined&&(n.uniforms.scale=t.scale),t.sizex!==undefined&&(n.uniforms.tSize[0]=t.sizex),t.sizey!==undefined&&(n.uniforms.tSize[1]=t.sizey),e.enabled!==undefined&&(this.enabled=e.enabled)},m.label="Dot",m.options=[{key:"angle",type:"float",control:"slider",name:"Angle",min:0,max:10,decimals:2,"default":1.57},{key:"scale",type:"float",control:"slider",name:"Scale",min:0,max:10,decimals:2,"default":1},{key:"sizex",type:"int",control:"slider",name:"SizeX",min:0,max:1024,"default":256},{key:"sizey",type:"int",control:"slider",name:"SizeY",min:0,max:1024,"default":256}],g.prototype=Object.create(t.prototype),g.prototype.constructor=g,g.prototype.update=function(e){var t=e.options,n=this.material.shader;t.brightness!==undefined&&(n.uniforms.brightness=t.brightness),t.contrast!==undefined&&(n.uniforms.contrast=t.contrast),t.saturation!==undefined&&(n.uniforms.saturation=t.saturation),e.enabled!==undefined&&(this.enabled=e.enabled)},g.label="Contrast",g.options=[{key:"brightness",type:"float",control:"slider",name:"Brightness",min:-1,max:1,decimals:2,"default":0},{key:"contrast",type:"float",control:"slider",name:"Contrast",min:0,max:1,"default":0},{key:"saturation",type:"float",control:"slider",name:"Saturation",min:-1,max:1,decimals:2,"default":0}],{Bloom:s,Blur:o,Vignette:u,Sepia:a,Grain:f,Noise:l,RgbShift:c,Bleach:h,HSB:p,Colorify:d,Hatch:v,Dot:m,Contrast:g}}),define("goo/loaders/handlers/PosteffectHandler",["goo/loaders/handlers/ConfigHandler","goo/util/rsvp","goo/util/PromiseUtil","goo/renderer/Util","goo/renderer/pass/PassLib","goo/renderer/shaders/ShaderLib","goo/renderer/pass/FullscreenPass","goo/renderer/pass/BloomPass","goo/util/ObjectUtil"],function(e,t,n,r,i,s,o,u,a){function f(){e.apply(this,arguments),this._objects={}}return f.prototype=Object.create(e.prototype),f.prototype.constructor=f,e._registerClass("posteffect",f),f.prototype._prepare=function(e){if(!e.name||!i[e.name]){console.error("Unknown posteffect name: "+e.name);return}var t=i[e.name];a.defaults(e,{enabled:!0,options:{}}),e.label=t.label||e.name;var n=t.options;for(var r=0;r<n.length;r++){var s=n[r];e.options[s.key]===undefined&&(e.options[s.key]=s["default"])}},f.prototype._create=function(e,t){if(!t.name||!i[t.name]){console.error("Unknown posteffect name: "+t.name);return}return this._objects[e]=new i[t.name],this._objects[e]},f.prototype.update=function(e,t){if(!t.name||!i[t.name])return console.error("Unknown posteffect name: "+t.name),n.createDummyPromise();var r=this._objects[e]||this._create(e,t);return this._prepare(t),r.update(t),n.createDummyPromise(r)},f}),define("goo/loaders/DynamicLoader",["goo/loaders/handlers/ConfigHandler","goo/loaders/handlers/ComponentHandler","goo/util/Ajax","goo/renderer/TextureCreator","goo/util/rsvp","goo/util/StringUtil","goo/util/PromiseUtil","goo/util/ObjectUtil","goo/loaders/handlers/CameraComponentHandler","goo/loaders/handlers/EntityHandler","goo/loaders/handlers/LightComponentHandler","goo/loaders/handlers/MaterialHandler","goo/loaders/handlers/MeshDataComponentHandler","goo/loaders/handlers/MeshDataHandler","goo/loaders/handlers/MeshRendererComponentHandler","goo/loaders/handlers/SceneHandler","goo/loaders/handlers/ShaderHandler","goo/loaders/handlers/SkeletonHandler","goo/loaders/handlers/TextureHandler","goo/loaders/handlers/TransformComponentHandler","goo/loaders/handlers/AnimationComponentHandler","goo/loaders/handlers/AnimationStateHandler","goo/loaders/handlers/AnimationLayersHandler","goo/loaders/handlers/AnimationClipHandler","goo/loaders/handlers/ProjectHandler","goo/loaders/handlers/ScriptComponentHandler","goo/loaders/handlers/ScriptHandler","goo/loaders/handlers/SoundComponentHandler","goo/loaders/handlers/SoundHandler","goo/loaders/handlers/PosteffectHandler"],function(e,t,n,r,i,s,o,u){function v(e){this.options=e,this._objects={},u.defaults(this.options,{ajax:!0});if(!this.options.world)throw new Error("World argument cannot be null");this._world=this.options.world;if(!this.options.rootPath)throw new Error("parameters.rootPath must be defined");this.setRootPath(this.options.rootPath),this._configs={},this.options.ajax&&(this._ajax=new n)}var a=["shader","script","entity","material","scene","mesh","texture","skeleton","animation","clip","bundle","project","posteffect","animstate","sound"],f=u.keys(e.getHandler("texture").loaders),l=["jpg","jpeg","png","gif"],c=["dat","bin"],h=["mp3","wav"],p=f.concat(l,c,h),d=e.getHandler("material").ENGINE_SHADER_PREFIX;return v.prototype.preloadCache=function(e,t){return t==null&&(t=!1),t?this._configs=e:u.extend(this._configs,e)},v.prototype.loadFromConfig=function(e,t,n){n==null&&(n={}),u.defaults(n,this.options),t!=null&&(n.noCache?this._configs=t:u.extend(this._configs,t));if(this._configs[e])throw new Error(""+e+" not found in the supplied configs Available keys: \n"+u.keys(this._configs).join("\n"));return this.load(e,n)},v.prototype.loadFromBundle=function(e,t,n){var r=this;n==null&&(n={}),u.defaults(n,this.options);var i=r._loadRef(t).then(function(i){n.noCache?r._configs=i:u.extend(r._configs,i);if(r._configs[e]==null)throw new Error(e+" not found in bundle "+t+". Available keys: \n"+u.keys(r._configs).join("\n"));return n.preloadBinaries===!0?r._preloadBinariesFromRef(e,n).then(function(){return n.preloadBinaries=!1,r.load(e,n)}):r.load(e,n)});return i},v.prototype.load=function(e,t){var n=this;if(t==null)t={};else if(t.preloadBinaries===!0)return this._preloadBinariesFromRef(e,t).then(function(){return n.update(e,null,t)});return this.update(e,null,t)},v.prototype._loadBinariesFromRefs=function(e,t){var n=this,r=[],s=0,o=function(e){return n._loadRef(e).then(function(){s++,typeof t.progressCallback=="function"&&t.progressCallback(s,r.length)})},u=function(e){var t=[],s=[],o=function(e){var i=n._loadRef(e).then(function(e){var i=n._getRefsFromConfig(e);for(var s=0,u=i.length;s<u;s++){var a=i[s];v.isAssetRef(a)?r.indexOf(a)===-1&&r.push(a):v.isJSONRef(a)&&t.indexOf(a)===-1&&(o(a),t.push(a))}});s.push(i)};return o(e),i.all(s)},a=[];for(var f=0,l=e.length;f<l;f++)a.push(u(e[f]));return i.all(a).then(function(){var e=[];for(var t=0,n=r.length;t<n;t++)e.push(o(r[t]));return i.all(e)})},v.prototype._preloadBinariesFromRef=function(e,t){u.defaults(t,this.options);var n=this;return n._loadRef(e).then(function(r){var i;if(e==="project.project"){i=r.entityRefs;if(i.length===0)return console.warn("No entity refs in project:",r),o.createDummyPromise(null)}else i=n._getRefsFromConfig(r);return n._loadBinariesFromRefs(i,t)})},v.prototype.update=function(t,n,r){var s=this;return r==null&&(r={}),u.defaults(r,this.options,{recursive:!0}),n&&(this._configs[t]=n),delete this._objects[t],this._loadRef(t).then(function(n){var o=0,u=[];if(r.recursive&&e.getHandler(v.getTypeForRef(t))){var a=s._getRefsFromConfig(n),f=function(e){return u.push(s._loadRef(e).then(function(t){return o++,r.progressCallback&&r.progressCallback.call&&r.progressCallback.call(null,o,u.length),s._handle(e,t,r)}))};for(var l=0;l<a.length;l++)f(a[l])}return i.all(u.concat(s._handle(t,n,r)))}).then(function(){return s._configs}).then(null,function(e){return console.error("Error updating "+t+" "+e)})},v.prototype.remove=function(e){return delete this._objects[e],this._handle(e,null)},v.prototype._handle=function(t,n,r){var s=this,a,f,l;r==null&&(r={});var c=this._objects[t];if(!c||!!c.isRejected)return l=v.getTypeForRef(t),f=e.getHandler(l),f?(this._handlers==null&&(this._handlers={}),a=this._handlers[l],a?u.extend(a,{world:this._world,getConfig:this._loadRef.bind(this),updateObject:this._handle.bind(this),options:u.clone(r)}):a=this._handlers[l]=new f(this._world,this._loadRef.bind(this),this._handle.bind(this),r),n!=null?this._objects[t]=a.update(t,n,r).then(function(e){return s._objects[t]=e}):(a.remove(t),o.createDummyPromise(null))):(console.warn("No handler for type "+l),o.createDummyPromise(null));if(c instanceof i.Promise)return this._objects[t];if(!r.noCache)return o.createDummyPromise(this._objects[t])},v.prototype._loadRef=function(e,t){var r,i,s=this;e.indexOf(d)===0&&(r=o.createDummyPromise(null),this._configs[e]=r),t==null&&(t=!1);if(this._configs[e]){if(this._configs[e].then)return this._configs[e];if(!t)return o.createDummyPromise(this._configs[e])}return this._ajax?(i=this._rootPath+window.escape(e),v.isImageRef(e)?r=this._ajax.loadImage(i):v.isBinaryRef(e)?r=this._ajax.load(i,n.ARRAY_BUFFER):v.isAudioRef(e)?r=o.createDummyPromise(i):r=this._ajax.load(i),r=r.then(function(t){return v.isJSONRef(e)?s._configs[e]=JSON.parse(t):s._configs[e]=t}).then(null,function(t){return delete s._configs[e],t}),this._configs[e]=r,r):o.createDummyPromise(null)},v.prototype._getRefsFromConfig=function(e){var t=[],n=function(e,r){var i;if(/(^url|[\S]+ref)s?|Urls$/i.test(e))r!==null&&r!==undefined&&(t=t.concat(r));else if(r instanceof Object)for(i in r){if(!r.hasOwnProperty(i))continue;n(i,r[i])}};return n("",e),t},v.getTypeForRef=function(e){return e.split(".").pop().toLowerCase()},v.registerJSON=function(e){a.indexOf(e)===-1&&a.push(e)},v.isJSONRef=function(e){var t=v.getTypeForRef(e);return u.indexOf(a,t)>=0},v.isAssetRef=function(e){var t=v.getTypeForRef(e);return u.indexOf(p,t)>=0},v.isImageRef=function(e){var t=v.getTypeForRef(e);return u.indexOf(l,t)>=0},v.isBinaryRef=function(e){var t=v.getTypeForRef(e);return u.indexOf(f,t)>=0||u.indexOf(c,t)>=0},v.isAudioRef=function(e){var t=v.getTypeForRef(e);return u.indexOf(h,t)>=0},v.prototype.getCachedObjectForRef=function(e){return this._objects?this._objects[e]:undefined},v.prototype.setRootPath=function(e){this._rootPath=e,e.length>1&&e.charAt(e.length-1)!=="/"&&(this._rootPath+="/")},v}),define("goo/util/combine/EntityCombiner",["goo/entities/EntityUtils","goo/util/MeshBuilder","goo/math/Transform","goo/math/Vector3","goo/renderer/bounds/BoundingBox","goo/renderer/bounds/BoundingSphere"],function(e,t,n,r,i,s){function o(e,t){this.world=e,this.gridCount=t||1}function u(){var e=[],t=[];return{put:function(n,r){var i=e.indexOf(n);i===-1?(e.push(n),t.push(r)):t[i]=r},get:function(n){return t[e.indexOf(n)]},getKeys:function(){return e},getValues:function(){return t}}}return o.prototype.combine=function(){this.world.process();var e=this.world.entityManager.getTopEntities();this.gridSize=this._calculateBounds(e)/this.gridCount,this._combineList(e)},o.prototype._combineList=function(e){var t=!0,n=this.world.createEntity("root");n.addToWorld();for(var r=0;r<e.length;r++)n.attachChild(e[r]);var i=new u;this._buildSubs(n,i);var s=i.getKeys();for(var r=0;r<s.length;r++){var o=s[r],a=i.get(o);this._combine(o,a,t)}},o.prototype._buildSubs=function(e,t,n){if(e.hidden||e.skip||e.animationComponent||e.particleComponent)return;if(!n||e.scriptComponent||e.fSMComponent)n=[],t.put(e,n);e.meshDataComponent&&e.meshRendererComponent&&e.meshRendererComponent.worldBound&&n.push(e);for(var r=0;r<e.transformComponent.children.length;r++){var i=e.transformComponent.children[r];this._buildSubs(i.entity,t,n)}},o.prototype._combine=function(e,r,i){var s=e.transformComponent.worldTransform,o=new n,a=new n;s.invert(o);var f=new u;for(var l=0;l<r.length;l++){var c=r[l],h=c.meshRendererComponent.materials[0],p=c.meshDataComponent.meshData.attributeMap,d=Object.keys(p);d.sort(),d=d.join("_");var v=c.meshRendererComponent.worldBound.center.x/this.gridSize,m=c.meshRendererComponent.worldBound.center.z/this.gridSize;d=d+"_"+Math.round(v)+"_"+Math.round(m);var g=f.get(h);g||(g=new u,f.put(h,g));var y=g.get(d);y||(y=[],g.put(d,y)),y.push(c)}var b=f.getKeys();for(var l=0;l<b.length;l++){var w=b[l],E=f.get(w),S=E.getKeys();for(var x=0;x<S.length;x++){var T=E.get(S[x]);if(T.length===1)continue;var N=new t;for(var C=0;C<T.length;C++){var c=T[C];e!==c?a.multiply(o,c.transformComponent.worldTransform):a.setIdentity(),N.addMeshData(c.meshDataComponent.meshData,a),i?c._components.length===3&&c.transformComponent.children.length===0?c.removeFromWorld():(c.clearComponent("meshDataComponent"),c.clearComponent("meshRendererComponent")):(c.skip=!0,c.hidden=!0)}var k=N.build();for(var h in k){var c=this.world.createEntity(k[h],w);c.addToWorld(),e.attachChild(c)}}}},o.prototype._calculateBounds=function(t){var n=!0,o=new i;for(var u=0;u<t.length;u++){var a=t[u];e.traverse(a,function(e){if(e.meshRendererComponent&&!e.particleComponent)if(n){var t=e.meshRendererComponent.worldBound;t instanceof i?t.clone(o):t instanceof s?(o.center.setv(t.center),o.xExtent=o.yExtent=o.zExtent=t.radius):(o.center.setv(r.ZERO),o.xExtent=o.yExtent=o.zExtent=10),n=!1}else o.merge(e.meshRendererComponent.worldBound)})}return Math.max(o.xExtent,o.zExtent)*2},o}),define("3d/addons/Forrest",["goo/renderer/Material","goo/renderer/Camera","goo/math/Vector3","goo/math/Transform","goo/renderer/TextureCreator","goo/renderer/Texture","goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/light/DirectionalLight","goo/util/CanvasUtils","goo/util/Ajax","goo/util/MeshBuilder","goo/noise/Noise","goo/noise/ValueNoise","goo/shapes/TerrainSurface","goo/shapes/ShapeCreator","goo/loaders/DynamicLoader","goo/entities/EntityUtils","goo/util/combine/EntityCombiner","goo/util/TangentGenerator","goo/entities/components/ScriptComponent","goo/renderer/shaders/ShaderBuilder","goo/util/rsvp"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S){function x(){this.startX=20,this.startZ=20}x.prototype.init=function(e,t,i){var s=new S.Promise,o=new m({world:e.world,rootPath:i+"/tree1"});return o.loadFromBundle("project.project","root.bundle",{recursive:!1,preloadBinaries:!0,noEnvironment:!0}).then(function(i){e.world.process();var u=o.getCachedObjectForRef("entities/Veg_T01_aspenM_LOD2-Whole_root.entity"),a=e.world.createEntity("newroot"),f=new n,l=new r,c=15;while(c>0){var h=Math.random()*2-1,p=Math.random()*2-1;f.setd(h,0,p),f.normalize();var d=Math.random()*15+10;f.muld(d,d,d),f.x+=this.startX,f.z+=this.startZ,h=f.x,p=f.z,f.y=10;var v=t.getTerrainHeightAt(f.data),m=t.getTerrainNormalAt(f.data),b=m.dot(n.UNIT_Y);if(b<.9)continue;var w=(Math.random()*.6+.7)*.03;l.scale.setd(w,w,w),l.translation.setd(0,0,0);var E=Math.random()*Math.PI*.5,S=Math.sin(E),x=Math.cos(E);l.lookAt(new n(S,0,x),n.UNIT_Y),l.translation.setd(h,v,p),l.update();var T=g.clone(e.world,u);T.transformComponent.transform.copy(l),a.attachChild(T),c--}u.removeFromWorld(),a.addToWorld(),e.world.process();var N=new y(e.world,1);console.time("combine"),N._combineList(a),console.timeEnd("combine"),this.loadLODTrees(e,t).then(function(){s.resolve()})}.bind(this)).then(null,function(e){console.error("Failed to load scene: "+e)}),s},x.prototype.loadLODTrees=function(t,s){var o=new S.Promise,u=[];for(var a=0;a<T.length;a++){var f=this.createBase(T[a]);u[a]=f}var l=new c,h=new n,p=new r,d=500;for(var v=0;v<d;v++){var m=Math.random()*2-1,g=Math.random()*2-1;h.setd(m,0,g),h.normalize();var y=Math.random()*30+30;h.muld(y,y,y),h.x+=this.startX,h.z+=this.startZ,m=h.x,g=h.z,h.y=10;var b=s.getTerrainHeightAt(h.data);b===null&&(b=0);var w=s.getTerrainNormalAt(h.data);w===null&&(w=new n(0,1,0));var E=w.dot(n.UNIT_Y);if(E<.9||b>13)continue;var x=Math.random()*.4+.8;p.scale.setd(x,x,x),p.translation.setd(0,0,0),h.x-=32,h.y=0,h.z-=32,h.normalize(),p.lookAt(h,n.UNIT_Y),p.translation.setd(m,b,g),p.update();var f=u[Math.floor(Math.random()*u.length)];l.addMeshData(f,p)}var C=l.build(),k=e.createMaterial(N,"vegetation"),L=(new i).loadTexture2D(window.hunterResources+"/veg_treeImpostors_full_alpha_0_dif_small.dds",null,function(){o.resolve()});k.setTexture("DIFFUSE_MAP",L);var L=(new i).loadTexture2D(window.hunterResources+"/veg_treeImpostors_0_nrm_small.dds");k.setTexture("NORMAL_MAP",L),k.uniforms.discardThreshold=.6,k.blendState.blending="CustomBlending",k.uniforms.materialAmbient=[.3,.3,.3,1],k.uniforms.materialSpecular=[0,0,0,1],k.renderQueue=3e3;for(var A in C){var O=t.world.createEntity(C[A],k);O.addToWorld()}return o};var T=[{w:7,h:7,tx:0,ty:.75,tw:.25,th:.25},{w:7,h:7,tx:.25,ty:.5,tw:.25,th:.25},{w:7,h:7,tx:.5,ty:.25,tw:.25,th:.25}];x.prototype.createBase=function(e){var t=v.createQuad(e.w,e.h,1,1);t.attributeMap.BASE=o.createAttribute(1,"Float"),t.rebuildData(t.vertexCount,t.indexCount,!0),b.addTangentBuffer(t),t.getAttributeBuffer(o.TEXCOORD0).set([e.tx,e.ty,e.tx,e.ty+e.th,e.tx+e.tw,e.ty+e.th,e.tx+e.tw,e.ty]),t.getAttributeBuffer("BASE").set([0,1*e.h,1*e.h,0]);var n=new c,i=new r;i.translation.y=e.h*.5-e.h*.2,i.update(),n.addMeshData(t,i);var s=n.build();return s[0]};var N={processors:[E.light.processor],attributes:{vertexPosition:o.POSITION,vertexTangent:o.TANGENT,vertexNormal:o.NORMAL,vertexUV0:o.TEXCOORD0,base:"BASE"},uniforms:{viewProjectionMatrix:u.VIEW_PROJECTION_MATRIX,worldMatrix:u.WORLD_MATRIX,normalMatrix:u.NORMAL_MATRIX,cameraPosition:u.CAMERA,diffuseMap:u.DIFFUSE_MAP,normalMap:u.NORMAL_MAP,discardThreshold:-0.01,time:u.TIME},builder:function(e,t){E.light.builder(e,t)},vshader:function(){return["attribute vec3 vertexPosition;","attribute vec4 vertexTangent;","attribute vec3 vertexNormal;","attribute vec2 vertexUV0;","attribute float base;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform mat4 normalMatrix;","uniform vec3 cameraPosition;","uniform float time;",E.light.prevertex,"varying vec3 normal;","varying vec3 binormal;","varying vec3 tangent;","varying vec3 vWorldPos;","varying vec3 viewPosition;","varying vec2 texCoord0;","void main(void) {","mat4 nMatrix = normalMatrix;","vec3 swayPos = vertexPosition;","swayPos.x += sin(time * 0.5 + swayPos.x * 0.4) * base * sin(time * 1.5 + swayPos.y * 0.4) * 0.02 + 0.01;","	vec4 worldPos = worldMatrix * vec4(swayPos, 1.0);","	vWorldPos = worldPos.xyz;","	gl_Position = viewProjectionMatrix * worldPos;",E.light.vertex,"	normal = normalize((nMatrix * vec4(vertexNormal, 0.0)).xyz);","	tangent = normalize((nMatrix * vec4(vertexTangent.xyz, 0.0)).xyz);","	binormal = cross(normal, tangent) * vec3(vertexTangent.w);","	texCoord0 = vertexUV0;","	viewPosition = cameraPosition - worldPos.xyz;","}"].join("\n")},fshader:function(){return["uniform sampler2D diffuseMap;","uniform sampler2D normalMap;","uniform float discardThreshold;",E.light.prefragment,"varying vec3 normal;","varying vec3 binormal;","varying vec3 tangent;","varying vec3 vWorldPos;","varying vec3 viewPosition;","varying vec2 texCoord0;","void main(void)","{","	vec4 final_color = texture2D(diffuseMap, texCoord0);","if (final_color.a < discardThreshold) discard;","mat3 tangentToWorld = mat3(tangent, binormal, normal);","vec3 tangentNormal = texture2D(normalMap, texCoord0).xyz * vec3(2.0) - vec3(1.0);","vec3 worldNormal = (tangentToWorld * tangentNormal);","vec3 N = normalize(worldNormal);",E.light.fragment,"	gl_FragColor = final_color;","}"].join("\n")}};return x}),define("3d/addons/Terrain",["goo/renderer/Material","goo/renderer/Camera","goo/math/Vector3","goo/renderer/TextureCreator","goo/renderer/Texture","goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/light/DirectionalLight","goo/util/CanvasUtils","goo/util/Ajax","goo/noise/Noise","goo/noise/ValueNoise","goo/shapes/TerrainSurface","goo/renderer/shaders/ShaderBuilder","goo/renderer/shaders/ShaderFragment","goo/addons/water/FlatWaterRenderer","goo/entities/EntityUtils","goo/scripts/WorldFittedTerrainScript","goo/renderer/shaders/ShaderLib","3d/addons/Vegetation","3d/addons/Forrest","goo/util/rsvp","physics/PhysicalWorld","3d/Colorer"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x){function T(){this.material=null,this.paintable=null,this.colorTx=null}var N="resources/images/terrain",C="resources/images/tiles/striperock.png",k="resources/images/tiles/grass.png",L="resources/images/tiles/darkrock.png",A="resources/images/tiles/mud.png",O="resources/images/tiles/detail.png",M="resources/images/tiles/crackstile.png",_="resources/images/tiles/striperock.png",D="resources/images/tiles/grass.png",P="resources/images/tiles/slabs.png",H="resources/images/tiles/mud.png";T.prototype.buildCanvasTexture=function(e,t){var n=document.createElement("canvas"),r=n.getContext("2d"),s=new Image;console.log("MAKE TERRAIN MATERIAL",e);var o=function(e){var r=new i(n,null,e.width,e.height);t(r,s,n)};s.onload=function(){console.log("TERRAIN MATERIAL IMAGE LOADED",s),n.width=s.width,n.height=s.height,r.drawImage(s,0,0,s.width,s.height),n.dataReady=!0,o(n)},s.src=e},T.prototype.init=function(e,t,n,r,i,s){var o=new E.Promise,u=new a;return u.loadCanvasFromPath(t,function(t){var a=u.getMatrixFromCanvas(t);this._buildMesh(e,N,a,n,128,128,i,s);var f=r.addHeightData(a,n);o.resolve()}.bind(this)),o},T.prototype.getPaintable=function(){return this.paintable},T.prototype._buildMesh=function(t,n,i,s,o,u,a,f){var l=s.maxX-s.minX,c=s.maxY-s.minY,p=s.maxZ-s.minZ,d=new h(i,l,c,p),v=e.createMaterial(B,"Terrain");S.addPhysicalWorldMesh(d,s.minX,s.minY,s.minZ),v.uniforms.materialAmbient=[0,0,0,1],v.uniforms.materialDiffuse=[1.5,1.5,1.5,1];var g=(new r).loadTexture2D(n+"/start_norm.png");v.setTexture("NORMAL_MAP2",g);var y=4,b=(new r).loadTexture2D(k,{anisotropy:y}),w=(new r).loadTexture2D(L,{anisotropy:y}),E=(new r).loadTexture2D(A,{anisotropy:y}),T=(new r).loadTexture2D(C,{anisotropy:y}),N=(new r).loadTexture2D(O,{anisotropy:y}),j=(new r).loadTexture2D(M,{anisotropy:y}),F=this,I=function(e,n,i){F.paintable=x.registerCanvasTexture("terrain_canvas",e,n,i),v.setTexture("GROUND_MAP1",T),v.setTexture("GROUND_MAP2",w),v.setTexture("GROUND_MAP3",E),v.setTexture("GROUND_MAP4",b),v.setTexture("GROUND_MAP5",N),v.setTexture("GROUND_MAP6",j),v.setTexture("GROUND_MAP7",e);var o=(new r).loadTexture2D(D,{anisotropy:y}),u=(new r).loadTexture2D(P,{anisotropy:y}),a=(new r).loadTexture2D(H,{anisotropy:y}),l=(new r).loadTexture2D(_,{anisotropy:y});v.setTexture("GROUND_MAP1_NORMALS",l),v.setTexture("GROUND_MAP2_NORMALS",u),v.setTexture("GROUND_MAP3_NORMALS",a),v.setTexture("GROUND_MAP4_NORMALS",o);var c=m.createTypicalEntity(t.world,"Terrain",d,v);c.transformComponent.transform.translation.setd(s.minX,s.minY,s.minZ),c.transformComponent.setUpdated(),c.addToWorld(),c.meshRendererComponent.cullMode="Never",f()};this.buildCanvasTexture(a,I)};var B={processors:[p.uber.processor,p.light.processor,p.animation.processor],attributes:{vertexPosition:s.POSITION,vertexNormal:s.NORMAL,vertexTangent:s.TANGENT,vertexColor:s.COLOR,vertexUV0:s.TEXCOORD0,vertexUV1:s.TEXCOORD1,vertexJointIDs:s.JOINTIDS,vertexWeights:s.WEIGHTS},uniforms:{viewProjectionMatrix:o.VIEW_PROJECTION_MATRIX,worldMatrix:o.WORLD_MATRIX,normalMatrix:o.NORMAL_MATRIX,cameraTranslation:o.CAMERA_TRANSLATION,cameraPosition:o.CAMERA,normalMap2:"NORMAL_MAP2",groundMap1:"GROUND_MAP1",groundMap2:"GROUND_MAP2",groundMap3:"GROUND_MAP3",groundMap4:"GROUND_MAP4",groundMap5:"GROUND_MAP5",groundMap6:"GROUND_MAP6",groundMap7:"GROUND_MAP7",groundMapN1:"GROUND_MAP1_NORMALS",groundMapN2:"GROUND_MAP2_NORMALS",groundMapN3:"GROUND_MAP3_NORMALS",groundMapN4:"GROUND_MAP4_NORMALS",diffuseMap:o.DIFFUSE_MAP,offsetRepeat:[0,0,1,1],normalMap:o.NORMAL_MAP,normalMultiplier:1,specularMap:o.SPECULAR_MAP,emissiveMap:o.EMISSIVE_MAP,aoMap:o.AO_MAP,lightMap:o.LIGHT_MAP,environmentCube:"ENVIRONMENT_CUBE",environmentSphere:"ENVIRONMENT_SPHERE",reflectionMap:"REFLECTION_MAP",transparencyMap:"TRANSPARENCY_MAP",opacity:1,reflectivity:0,refractivity:0,etaRatio:0,fresnel:0,discardThreshold:-0.01,fogSettings:[0,1e4],fogColor:[1,1,1],shadowDarkness:.5},builder:function(e,t){p.light.builder(e,t)},vshader:function(){return["attribute vec3 vertexPosition;","#ifdef NORMAL","attribute vec3 vertexNormal;","#endif","#ifdef TANGENT","attribute vec4 vertexTangent;","#endif","#ifdef COLOR","attribute vec4 vertexColor;","#endif","#ifdef TEXCOORD0","attribute vec2 vertexUV0;","uniform vec4 offsetRepeat;","varying vec2 texCoord0;","#endif","#ifdef TEXCOORD1","attribute vec2 vertexUV1;","varying vec2 texCoord1;","#endif","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform mat4 normalMatrix;","uniform vec3 cameraPosition;","uniform vec3 cameraTranslation;","varying vec3 vWorldPos;","varying vec3 viewPosition;","#ifdef NORMAL","varying vec3 normal;","#endif","#ifdef TANGENT","varying vec3 binormal;","varying vec3 tangent;","#endif","#ifdef COLOR","varying vec4 color;","#endif","varying float noise;","varying float noise2;",p.light.prevertex,"void main(void) {","mat4 wMatrix = worldMatrix;","#ifdef NORMAL","mat4 nMatrix = normalMatrix;","#endif","vec4 worldPos = wMatrix * vec4(vertexPosition, 1.0);","vWorldPos = worldPos.xyz;","gl_Position = viewProjectionMatrix * worldPos;","viewPosition = worldPos.xyz;","#ifdef NORMAL","	normal = normalize((nMatrix * vec4(vertexNormal, 0.0)).xyz);","#endif","#ifdef TANGENT","	tangent = normalize((nMatrix * vec4(vertexTangent.xyz, 0.0)).xyz);","	binormal = cross(normal, tangent) * vec3(vertexTangent.w);","#endif","#ifdef COLOR","	color = vertexColor;","#endif","#ifdef TEXCOORD0","	texCoord0 = vertexUV0 * offsetRepeat.zw * 1.0 + offsetRepeat.xy;","#endif","#ifdef TEXCOORD1","	texCoord1 = vertexUV1;","#endif",p.light.vertex,"noise = (sin(texCoord0.x * 9450.0) + sin(texCoord0.y * 9450.0))*0.25+0.5;","noise2 = 0.0;","}"].join("\n")},fshader:function(){return["uniform sampler2D normalMap2;","uniform sampler2D groundMap1;","uniform sampler2D groundMap2;","uniform sampler2D groundMap3;","uniform sampler2D groundMap4;","uniform sampler2D groundMap5;","uniform sampler2D groundMap6;","uniform sampler2D groundMap7;","uniform sampler2D groundMapN1;","uniform sampler2D groundMapN2;","uniform sampler2D groundMapN3;","uniform sampler2D groundMapN4;","#ifdef SPECULAR_MAP","uniform sampler2D specularMap;","#endif","#ifdef FOG","uniform vec2 fogSettings;","uniform vec3 fogColor;","#endif","varying vec3 vWorldPos;","varying vec3 viewPosition;","#ifdef NORMAL","varying vec3 normal;","#endif","#ifdef TANGENT","varying vec3 binormal;","varying vec3 tangent;","#endif","#ifdef TEXCOORD0","varying vec2 texCoord0;","#endif","#ifdef TEXCOORD1","varying vec2 texCoord1; //Use for lightmap","#endif","varying float noise;","varying float noise2;",p.light.prefragment,d.noise2d,"void main(void)","{","vec4 final_color = vec4(1.0);","vec2 coord  = texCoord0 * vec2(16.0);","vec2 coord1 = texCoord0 * vec2(40.0);","vec2 coord2 = texCoord0 * vec2(78.5);","vec2 coord3 = texCoord0 * vec2(124.0);","vec2 coord4 = texCoord0 * vec2(420.0);","vec2 coord5 = texCoord0 * vec2(1124.0);","vec3 landNormal = (texture2D(normalMap2, texCoord0).xyz * vec3(2.0) - vec3(1.0)).xzy;","landNormal.y = 0.5;","landNormal = normalize(landNormal);","vec3 landTangent = vec3(1.0, 0.0, 0.0);","vec3 landBinormal = cross(landNormal, landTangent);","mat3 tangentToWorld = mat3(landTangent, landBinormal, landNormal);","float slope = clamp(1.0 - dot(landNormal, vec3(0.0, 1.0, 0.0)), 0.0, 1.0);","slope = smoothstep(0.0, 0.5, slope);","const float NMUL = 1.2;","vec3 mountainN = texture2D(groundMapN1, coord1).xyz * vec3(1.0) - vec3(1.0);","mountainN.z = NMUL;","vec3 n1 = texture2D(groundMapN2, coord2).xyz * vec3(0.5) - vec3(1.0);","n1.z = NMUL;","vec3 n2 = texture2D(groundMapN3, coord3).xyz * vec3(2.0) - vec3(1.0);","n2.z = NMUL;","vec3 tangentNormal = mix(n1, n2, smoothstep(0.0, 1.0, noise));","tangentNormal = mix(tangentNormal, mountainN, slope);","vec3 worldNormal = (tangentToWorld * tangentNormal);","vec3 N = normalize(worldNormal);","vec4 mountain = texture2D(groundMap1, coord1);","vec4 g1 = texture2D(groundMap2, coord2);","vec4 g2 = texture2D(groundMap3, coord3);","vec4 g3 = texture2D(groundMap4, coord4);","vec4 detail = texture2D(groundMap5, coord);","vec4 detail2 = texture2D(groundMap6, coord5);","vec4 colors = texture2D(groundMap7, texCoord0);","final_color = mix(mountain, g1, clamp(((landNormal.y+noise*0.6)*1.2) - 0.7, 0.0, 1.0));","final_color = mix(final_color, g2, clamp(((landNormal.y-noise*0.13)*16.2) - 10.6, 0.0, 1.0));","final_color = mix(final_color, g3, clamp((landNormal.y*31.0-noise*6.1) - 21.0, 0.0, 1.0));","final_color = mix(final_color, colors, colors.a);","final_color = mix(final_color, detail, detail.a * final_color.r );","final_color = mix(final_color, detail2, detail2.a * (final_color.r - (final_color.r * final_color.g * final_color.b)));",p.light.fragment,"#ifdef FOG","float d = pow(smoothstep(fogSettings.x, fogSettings.y, length(viewPosition)), 1.0);","final_color.rgb = mix(final_color.rgb, fogColor, d);","#endif","gl_FragColor = final_color;","}"].join("\n")}};return T}),define("3d/HeightmapManager",["application/EventManager","game/GameUtil","game/GameConfiguration","goo/math/Vector3","goo/shapes/TerrainSurface","goo/entities/EntityUtils","goo/scripts/WorldFittedTerrainScript","goo/util/CanvasUtils","3d/TerrainColorer","physics/PhysicalWorld","3d/Colorer","3d/addons/Terrain"],function(e,t,n,r,i,s,o,u,a,f,l,c){function d(e,t,n,r,i){var s={minX:t.pos[0],minZ:t.pos[2],minY:t.pos[1],maxX:t.pos[0]+t.width,maxZ:t.pos[2]+t.depth,maxY:t.pos[1]+t.height},o=function(){p[n]={dimensions:s,id:"terrain_"+n,zoneData:t,terrain:u},console.log("BUILT HEIGHT MAPS: ",p),r()};console.log("ADD HEIGHTMAP: ",n);var u=new c,a=u.init(e,t.heightData,s,h,t.texture1,i);a.resolve=o}var h=new o,p={},v=function(e,t){var n=e.terrain.getPaintable(),r=e.dimensions,i=n.width,s=n.height,o=(r.maxX-r.minX)/i,u=(t[0]-r.minX)/o,a=(t[2]-r.minZ)/o;return[u,s-a,o]},m=function(e,t,n){var r=p[E(e)];if(!r)return;var i=v(r,e);l.paintPaintable(r.terrain.getPaintable(),n,[i[0],i[1],t*i[2],t*i[2]])},g=function(e){var t=p[E(e)];if(!t)return;return l.getPaintableCanvasData(t.terrain.getPaintable())},y=function(e,t){var n=p[E(t)];if(!n)return;var r=v(n,t);return e[(Math.floor(r[1])*n.terrain.getPaintable().width+Math.floor(r[0]))*4+3]/255},b=function(e){var t=p[E(e)];if(!t)return 1;var n=t.terrain.getPaintable(),r=v(t,e);return l.getPaintableRGBA(t.terrain.getPaintable(),[Math.floor(r[0]),Math.floor(r[1])])},w=1,E=function(e){for(var t in p){var n=p[t].dimensions;if(e[0]<=n.maxX&&e[0]>=n.minX&&e[1]<n.maxY+w&&e[1]>n.minY-w&&e[2]<=n.maxZ&&e[2]>=n.minZ)return t}},S=function(e){return h.getTerrainHeightAt(e)},x=function(e){var t=h.getTerrainHeightAt(e),n=1e5;return t&&(n=e[1]-t),n},T=function(e){return h.getTerrainNormalAt(e)},N=function(){return p},C=function(e){return e==null?0:1-Math.abs(e.data[1])};return{getHeightAt:S,getGroundSlope:C,getGroundNormal:T,addHeightMap:d,getTerrainData:N,paintTerrainPoint:m,getCanvasRGBAAtPos:b,getTerrainCanvasDataAtPos:g,readTerrainCanvasAlphaAtPos:y,getHeightAboveGroundAtPos:x}}),define("game/EntityModel",["goo/math/Vector3","goo/math/Matrix3x3"],function(e,t){var n={},r=0,i=function(e){var t=n[e];return t},s=function(e){o(e),e.removeFromWorld()},o=function(e){if(!e.transformComponent)return;for(var t=0;t<e.transformComponent.children.length;t++){var n=e.transformComponent.children[t];s(n.entity)}e.removeFromWorld()},u=function(e){if(n[e].geometries){var t=n[e];for(var r=0;r<t.geometries.length;r++){var i=t.geometries[r];o(i)}}delete n[e]},a=function(e){return n[e.id]=e,n[e.id]},f=function(n,r,i,s){n.controls={collision_mode:{value:1,controlState:0},collision_lights:{value:1,controlState:0},taxi_mode:{value:1,controlState:0},taxi_lights:{value:1,controlState:0},position_mode:{value:1,controlState:0},position_lights:{value:1,controlState:0},formation_mode:{value:1,controlState:0},formation_lights:{value:.3,controlState:0},cockpit_mode:{value:1,controlState:0},cockpit_lights:{value:.5,controlState:0},screen_intensity:{value:.5,controlState:0},hud_intensity:{value:.5,controlState:0},hdd_intensity:{value:.5,controlState:0},debug_mechanics:{value:0,controlState:0},cannons:{value:0,controlState:0},elevator:{value:0,controlState:0},aeilrons:{value:0,controlState:0},rudder:{value:0,controlState:0},trim_elevator:{value:0,controlState:0},trim_aeilrons:{value:0,controlState:0},trim_rudder:{value:0,controlState:0},auto_trim:{value:0,controlState:0},wing_smoke:{value:0,controlState:0},wing_sweep:{value:0,controlState:0},reset_trim:{value:0,controlState:0},throttle:{value:0,controlState:0},breaks:{value:0,controlState:0},hook:{value:0,controlState:0},gears:{value:0,controlState:0},doors:{value:0,controlState:0},canopy:{value:0,controlState:0},eject:{value:0,controlState:0},flaps:{value:0,controlState:0},forward:{value:0,controlState:0},back:{value:0,controlState:0},turnleft:{value:0,controlState:0},turnright:{value:0,controlState:0},mouseturn:{value:0,controlState:0},mouseforward:{value:0,controlState:0},strafe:{value:0,controlState:0},jump:{value:0,controlState:0}},n.spatial={pos:new e(0,0,0),visualPos:new e(0,0,0),visualRot:new t,rot:new t,dir:s||[0,0,0],acc:new e([0,0,0]),axisAttitudes:new e([0,0,0]),velocity:new e([0,1e-6,0]),audioVel:new e([0,1e-6,0]),angularVelocity:new e([0,0,0]),speed:0,state:"stop",angle:0,lastFrame:(new Date).getTime()},n.forces={lift:new e([0,1,0]),wingLiftLeft:{mag:new e([0,0,0]),poa:new e([0,0,0])},wingLiftRight:{mag:new e([0,0,0]),poa:new e([0,0,0])},rudderYaw:{mag:new e([0,0,0]),poa:new e([0,0,0])},elevatorLift:{mag:new e([0,0,0]),poa:new e([0,0,0])},buoyancy:new e([0,0,0]),drag:new e([0,0,1]),weight:new e([0,1,0]),thrust:new e([0,0,0]),torque:new e([0,0,0]),g:new e([0,0,0])},n.combat={hitPoints:1,damageTaken:0,isAlive:!0},n.geometries=[]},l=function(){r+=1;var e="cl"+r+"";return e},c=function(e){if(!e)var e=l();var t={};return t.id=e,t.isSelected=!1,a(t),f(t),t},h=function(e,t){e.hideDelay=setTimeout(function(){e.removedFromWorld=!0,e.geometries[0].removeFromWorld();for(var t=0;t<e.geometries[0].transformComponent.children.length;t++);},t)},p=function(e){clearTimeout(e.hideDelay),e.hideDelay=null;if(!e.removedFromWorld)return;e.geometries[0].addToWorld(),e.removedFromWorld=!1;for(var t=0;t<e.geometries[0].transformComponent.children.length;t++);},d=function(e){if(e.hideDelay)return;if(e.removedFromWorld)return;h(e,5e3)};return{getEntityById:i,createClientEntity:c,deleteClientEntity:u,hideEntityGeometry:d,showEntityGeometry:p}}),define("game/EntityController",["application/EventManager","game/EntityModel","goo/math/Vector3"],function(e,t,n){var r=function(e){return t.getEntityById(e)},i=function(e){return t.createClientEntity(e)},s=function(e){t.deleteClientEntity(e)},o=function(t){var n=i(e.eventArgs(t).entityId);e.eventArgs(t).callback(n)},u=function(t){s(e.eventArgs(t).entityId)},a=function(t){var i=r(e.eventArgs(t).entityId),s=e.eventArgs(t).modelDefinition,o=function(r){i.spatial.velocity.lengthSquared()>0&&(i.spatial.rot.lookAt(i.spatial.velocity,n.UNIT_Y),r.transformComponent.transform.rotation=i.spatial.rot),i.geometries.push(r),r.gameSpatial=i.spatial,e.eventArgs(t).callback(i)};alert("Happens?"),e.fireEvent(e.list().BUILD_GOO_GAMEPIECE,{modelPath:i.pieceData.modelPath,pieceData:s,callback:o})},f=function(e){t.hideEntityGeometry(e)},l=function(e){t.showEntityGeometry(e)};return e.registerListener(e.list().REMOVE_GAME_ENTITY,u),e.registerListener(e.list().ADD_GAME_ENTITY,o),e.registerListener(e.list().ADD_ENTITY_MODEL,a),{getEntityById:r,hideEntity:f,showEntity:l}}),define("game/world/PhysicalWorld",["goo/math/Vector3","game/EntityController","game/GameUtil","3d/HeightmapManager","physics/PhysicalWorld"],function(e,t,n,r,i){var s=new e,o=new e,u={},a=function(e){u[e.id]=e},f=function(e,t){for(var r=0;r<t.pieceData.physicalShapes.length;r++){var i=t.pieceData.physicalShapes[r];s.seta(i.posOffset);var o=n.applyRotationToVelocity(t.geometries[0],s);o.addv(t.spatial.pos);var u=o.subv(e),a=Math.sqrt(u.lengthSquared());if(a<i.radius)return{part:i,entity:t,pos:[e.data[0],e.data[1],e.data[2]]}}},l=function(e,t){for(var n in u)if(e.originatorId!=n&&e.id!=n){var r=u[n],i=r.pieceData.physicalRadius,o=s.setv(r.spatial.pos);o.data==undefined&&console.log(n,r);var a=o.subv(t),l=Math.sqrt(a.lengthSquared());if(l<i){var c=f(t,r);if(c)return c}}},c=function(e,t){var n=e.spatial.pos,s=t,u,a=i.physicsRayRange(e.spatial.pos,[e.spatial.pos[0]+e.spatial.velocity[0]*s,e.spatial.pos[1]+e.spatial.velocity[1]*s,e.spatial.pos[2]+e.spatial.velocity[2]*s]);if(a){var f=o.set(e.spatial.pos[0]+e.spatial.velocity[0]*a.fraction*s,e.spatial.pos[1]+e.spatial.velocity[1]*a.fraction*s,e.spatial.pos[2]+e.spatial.velocity[2]*a.fraction*s);return u=l(e,f),console.log("hit: ",u),u?u:{part:"mesh",entity:null,pos:f}}var c=r.getHeightAboveGroundAtPos(n.data);return c<.5?{part:"ground",entity:null,pos:[n.data[0],n.data[1],n.data[2]]}:n.data[1]<0?{part:"water",entity:null,pos:[n.data[0],n.data[1],n.data[2]]}:!1},h=function(e){var t=e.spatial.pos,n={entities:[]},i=r.getHeightAboveGroundAtPos(t.data);return n.ground=i,n},p=function(e){r.paintTerrainPoint(e,2,{color:[.1*Math.random(),.1*Math.random(),.1*Math.random(),.1]}),r.paintTerrainPoint(e,1,{color:[.1*Math.random(),.1*Math.random(),.1*Math.random(),.2]}),r.paintTerrainPoint(e,.4,{color:[.1*Math.random(),.1*Math.random(),.1*Math.random(),.3]})},d=function(e){delete u[e]};return{registerPhysicalEntity:a,getRangesToNearbyConflics:h,checkHitAgainstPhysicalShape:f,checkSpatialConflict:c,renderGroundHitEffect:p,removePhysical:d}}),define("game/parts/WheelPart",["application/EventManager","3d/GooJointAnimator","game/GameUtil","3d/HeightmapManager","physics/PhysicalWorld","game/world/PhysicalWorld","goo/math/Vector3","goo/math/Matrix3x3"],function(e,t,n,r,i,s,o,u){function h(e,t){this.wheelId=e,this.controlId=t.control,this.controlAxis=t.axis||[1,0,0],this.pos=new o(t.pos),this.worldPos=new o,this.angle=0,this.forceVector=new o,this.dragCoeff=t.drag,this.breakMax=t.breakMax,this.radius=t.radius,this.suspBone=t.suspension.boneId,this.suspRange=t.suspension.range,this.suspStiffness=t.suspension.stiffness,this.suspAxis=t.suspension.axis,this.compressionLoss=0,this.stage=1,this.springCompression=0,this.wheelSpeed=0,this.wheelRot=0}var a,f=new o,l=new o,c=new u,p=function(e,n,r){var i=e.pieceData.boneMap[n];if(i==undefined)return;var s=e.animationChannels[i];t.rotateBone(s,r,0,0)},d=function(e,n,r){var i=e.pieceData.boneMap[n];if(i==undefined)return;var s=e.animationChannels[i];t.addRotationToBone(s,r,0,0)},v=function(e,n,r,i){var s=e.pieceData.boneMap[n];if(s==undefined)return;var o=e.animationChannels[s];t.translateBone(o,[i[0]*-r,i[1]*-r,i[2]*-r])};h.prototype.updateWheelRotation=function(e,t){this.springCompression?this.wheelSpeed=t/this.radius:this.wheelSpeed*=.995+Math.random()*.003,this.wheelRot+=this.wheelSpeed,p(e,this.wheelId,this.wheelRot)},h.prototype.compressedSuspensionForce=function(e,t,n,r){var i=0,s=e.systems.breaks.currentState*this.breakMax;e.systems.breaks.currentState>.2&&t<.02&&(e.spatial.velocity.mul(.958),e.spatial.angularVelocity.data[1]*.98),i=-r*7e4,f=e.spatial.rot.toAngles(),f.dot(g),this.forceVector.data[0]=this.forceVector.data[0]*.5-e.spatial.axisAttitudes.data[0]*this.breakMax*t*10+i*e.spatial.axisAttitudes.data[2]*t,this.forceVector.data[1]=n*this.suspStiffness*this.stage,this.forceVector.data[2]=this.forceVector.data[2]*.95-s*e.spatial.axisAttitudes.data[2]*t/(t+1.95/s)-s*t,this.forceVector.dot(f)},h.prototype.calcWheelForceVector=function(e){var t=0,n=this.springCompression+this.compressionLoss;v(e,this.suspBone,this.suspRange-n,this.suspAxis);var r=e.spatial.speed+e.spatial.angularVelocity.data[1]*(this.pos.data[2]-this.pos.data[0]),i=0;if(this.controlId){var i=this.controlAxis[0]*e.surfaces[this.controlId].currentState*.2;i/=Math.max(r*2,.25),p(e,this.suspBone,i*1.2)}return n?(this.compressedSuspensionForce(e,r,n,-i),e.spatial.angularVelocity.data[0]*=.98,e.spatial.angularVelocity.data[1]*=.97,e.spatial.angularVelocity.data[2]*=.98,e.forces.torque.mul(.98)):this.forceVector.set(0,0,0),r};var m,g=new o;return h.prototype.calcSpringCompression=function(e){f.set(this.pos),this.worldPos.set(e.spatial.pos);var t=n.applyRotationToVelocity(e.geometries[0],f);this.worldPos.add(t),f.set(this.worldPos),f.data[1]+=1,l.set(this.worldPos),l.data[1]-=this.suspRange;var o=i.physicsRayRange(f.data,l.data);if(o){f.sub(l),a=o.fraction*Math.sqrt(f.lengthSquared())-1,g.set(o.normal.getX(),o.normal.getY(),o.normal.getZ());var u=s.checkSpatialConflict(e,100);e.cable?e.cable.updateHookedPlane(e):u.entity&&(e.groundEntity=u.entity,u.part.partId=="cable"&&(e.spatial.velocity.mul(.95),console.log(u.part.partId,u),u.entity.cables[u.part.cableNr].catchPlane(e)))}else e.groundEntity=null,a=r.getHeightAboveGroundAtPos(this.worldPos.data),a<100&&g.set(r.getGroundNormal(this.worldPos.data)),a||(a=100);var c=this.suspRange-Math.min(a,this.suspRange);this.compressionLoss=c-this.springCompression*1.2,this.retraction=0,this.springCompression=c,this.springCompression-this.suspRange>0&&(this.stage=5)},h.prototype.updateForceVector=function(e){this.calcSpringCompression(e);var t=this.calcWheelForceVector(e);this.updateWheelRotation(e,t)},h}),define("game/controls/GearController",["application/EventManager","3d/GooJointAnimator","game/parts/WheelPart"],function(e,t,n){var r=function(e){var t=[];for(var r in e)t.push(new n(r,e[r]));return t},i=function(e,t,n){var i={doors:t.controls.doors,stands:t.controls.stands,lights:t.controls.lights,wheels:r(t.wheels),speed:t.speed,targetState:n,currentState:n,locked:!1};return i},s=function(e,t){console.log("Toggle Gear Target State - >",e,t);var n=1;t||(n=0),e.systems.gears.targetState=n,e.systems.gears.locked=!1},o=function(n){var r=n.systems.gears;if(r.currentState==1&&r.locked)return;var i=n.pieceData.systems.gears.controls,s=r.speed;r.targetState<r.currentState&&(s=-s);var o=r.currentState+s;Math.abs(o-r.targetState)<=r.speed&&(o=r.targetState,r.currentState=o,r.locked=!0),n.isPlayer&&e.fireEvent(e.list().PLAYER_CONTROL_STATE_UPDATE,{control:"gears",currentState:o});var u=i.doors,a=i.stands;if(i.lights)for(var f=0;f<i.lights.length;f++)n.lights[i.lights[f]].setIntensity(o);var l=function(e,r,s){for(var o in e){var u=n.pieceData.boneMap[o],a=n.animationChannels[u],f=i[r][o];t.rotateBone(a,s*f[0],s*f[1],s*f[2])}};l(u,"doors",Math.min(o*1.6,1)),l(a,"stands",Math.max(1.6*o-.6,0)),r.currentState=o};return{processControlState:o,setEntityGearTargetState:s,buildSystem:i}}),define("game/controls/DriveController",["application/EventManager","3d/GooJointAnimator","game/parts/WheelPart"],function(e,t,n){var r=function(e){var t=[];for(var r in e)t.push(new n(r,e[r]));return t},i=function(e,t,n){var i={wheels:r(t.wheels)};return i},s=function(e,t){};return{processControlState:s,buildSystem:i}}),define("game/controls/CanopyController",["game/GameConfiguration","application/EventManager","3d/GooJointAnimator"],function(e,t,n){var r=function(e,t,n){var r=0;n&&(r=1);var i={targetState:r,currentState:r,doors:t.controls.doors,type:t.type,speed:t.speed,locked:!1};return i},i=function(e,t){console.log("Toggle Canopy Target State - >",e,t),e.systems.canopy.targetState=t,e.systems.canopy.locked=!1},s=function(e){var t=e.systems.canopy;t.targetState=1.5,t.speed=t.speed*4,t.locked=!1},o=function(e,t,r,i,s){var o=e.pieceData.boneMap[t],t=e.animationChannels[o];s=="rotate"?n.rotateBone(t,i[0]*-r,i[1]*-r,i[2]*-r):n.translateBone(t,[i[0]*-r,i[1]*-r,i[2]*-r])},u=function(n){var r=n.systems.canopy;if(r.locked)return;var i=n.pieceData.systems.canopy.controls,s=r.speed;r.targetState<r.currentState&&(s=-s);var u=r.currentState+s;Math.abs(u-r.targetState)<=r.speed&&(u=r.targetState*1,r.locked=!0,console.log("Lock Canopy",u)),n.isPlayer&&(t.fireEvent(t.list().MIX_CHANNEL_VALUE,{channelId:e.MIX_TRACKS.game.id,valueId:"tuneGain",amount:.5+Math.sin(1.68*u)*.5}),t.fireEvent(t.list().MIX_CHANNEL_VALUE,{channelId:e.MIX_TRACKS.game.id,valueId:"tuneFilterFreq",amount:.01+Math.sin(1.68*u)}),t.fireEvent(t.list().MIX_CHANNEL_VALUE,{channelId:e.MIX_TRACKS.game.id,valueId:"tuneFilterQ",amount:.01+u*u*.04}),t.fireEvent(t.list().PLAYER_CONTROL_STATE_UPDATE,{control:"canopy",currentState:u}));var a=i.doors,f=function(e,t,r,s){for(var u in e)o(n,u,r,i[t][u],s)};f(a,"doors",u,i.xform),r.currentState=u};return{processControlState:u,fireCanopyEject:s,setEntityCanopyTargetState:i,buildSystem:r}}),define("game/controls/EjectionSeatController",["application/EventManager","3d/GooJointAnimator"],function(e,t){var n=function(e,t,n){var r=0;n&&(r=1);var i={targetState:r,currentState:r,seats:t.controls.seats,speed:t.speed,locked:!0};return i},r=function(t){t.systems.canopy.targetState=1.2,t.systems.canopy.locked=!1;var n=function(){t.systems.seat.ejectionTime=(new Date).getTime(),t.systems.seat.locked=!1};e.fireEvent(e.list().SEQUENCE_CALLBACK,{wait:800,callback:n})},i=function(e,n){return;var r,i,s,o,u,a,f};return{fireEjectionSeat:r,processControlState:i,buildSystem:n}}),define("game/weapons/FireDamage",["application/EventManager","game/GameUtil","goo/math/Vector3"],function(e,t,n){var r=new n,i=0,s=[],o=function(e,t,n){i+=1,this.age=0,this.id="fire_"+i,this.entity=e,this.intensity=n.intensity,this.size=n.size,this.posOffset=t.posOffset,this.partSize=t.radius,s.push(this)},u=function(e,t){return[e.data[0]+t*Math.random()-.5,e.data[1]+t*.5*Math.random()-.5,e.data[2]+t*Math.random()-.5]};o.prototype.updateFire=function(n){this.age+=n;if(Math.random()<this.intensity){var i=this.entity.spatial.pos;r.set(this.posOffset);var s=t.applyRotationToVelocity(this.entity.geometries[0],r);s.addv(i),s.add_d(this.partSize*(Math.random()-.5),this.partSize*.3+this.partSize*Math.random()*.2,this.partSize*(Math.random()-.5)),Math.random()<this.intensity*.5&&(e.fireEvent(e.list().DAMAGE_ENTITY,{entity:this.entity,damage:5}),e.fireEvent(e.list().FLASH_MUZZLE_FIRE,{pos:u(s,this.size),count:1,dir:[Math.random()-.5,1+Math.random(),Math.random()-.5]}),Math.random()<this.intensity*.5&&e.fireEvent(e.list().PUFF_BLACK_SMOKE,{pos:u(s,this.size),count:1,dir:[Math.random()-.5,1+Math.random(),Math.random()-.5]})),this.age<500&&e.fireEvent(e.list().FLASH_SPARKS,{pos:u(s,this.size),count:1,dir:[Math.random()-.5,1+Math.random(),Math.random()-.5]}),this.age<8500&&Math.random()<this.intensity&&e.fireEvent(e.list().FLASH_MUZZLE_FIRE,{pos:u(s,this.size),count:1,dir:[Math.random()-.5,1+Math.random(),Math.random()-.5]}),this.age<2500&&e.fireEvent(e.list().FLASH_MUZZLE_FIRE,{pos:u(s,this.size),count:1,dir:[Math.random()-.5,1+Math.random(),Math.random()-.5]})}this.age>15e3&&this.remove()},o.prototype.remove=function(){var e=s.indexOf(this);s.splice(e,1),delete this};var a=function(e){for(var t=0;t<s.length;t++)s[t].updateFire(e)},f=function(t){var n=e.eventArgs(t).frameTime;a(n)};return e.registerListener(e.list().UPDATE_ACTIVE_ENTITIES,f),o}),define("3d/GooEffectController",["application/EventManager","goo/entities/EntityUtils","goo/renderer/light/DirectionalLight","goo/math/Vector3","goo/entities/components/ScriptComponent","goo/entities/components/LightComponent","goo/renderer/shaders/ShaderBuilder"],function(e,t,n,r,i,s,o){function k(e){u=e,console.log("SET GOO: ",u)}function L(e){N.color.setd(e[0]*(1+Math.random()*.03),e[1]*(1+Math.random()*.02),e[2]*(1+Math.random()*.05),1)}function A(e){o.GLOBAL_AMBIENT=e}function O(e){o.FOG_COLOR=e}function M(e,t){_(w*e,E*t)}function _(e,t){o.FOG_SETTINGS=[e,t],o.USE_FOG=!0}function D(e){a.set(-e[2],-e[1],-e[0]),T.transformComponent.transform.rotation.lookAt(a,r.UNIT_Y),T.transformComponent.setUpdated()}function H(t){a.set(e.eventArgs(t).pos),a.add(d),T.transformComponent.transform.translation.set(a),T.lightComponent.light.translation.set(a),a.set(e.eventArgs(t).pos),T.transformComponent.transform.lookAt(a,r.UNIT_Y),T.transformComponent.setUpdated()}function B(t,n,r){q()[t].fx[n]=r,e.fireEvent(e.list().ANALYTICS_EVENT,{category:"CONFIG_EFFECT",action:t,labels:JSON.stringify(r),value:0})}function j(t,n,r){z()[t].fx[n]=r,e.fireEvent(e.list().ANALYTICS_EVENT,{category:"CONFIG_OPTION",action:t,labels:JSON.stringify(r),value:0})}function F(t){B(e.eventArgs(t).effect,e.eventArgs(t).parameter,e.eventArgs(t).value)}function I(){return u.renderSystem.composers[0].passes}function q(){return{Shadows:{fx:C.light,param:"shadowCaster"},Sepia:{fx:I()[1],param:"enabled"},Bloom:{fx:I()[2],param:"enabled"},Grain:{fx:I()[3],param:"enabled"},Contrast:{fx:I()[4],param:"enabled"},"RGB Shift":{fx:I()[5],param:"enabled"},Vignette:{fx:I()[6],param:"enabled"},Bleach:{fx:I()[7],param:"enabled"}}}function z(){return{"Dense Particles":{fx:U.particles,param:"highDensity"},"Visible Bullets":{fx:U.bullets,param:"visible"},"Fancy Water":{fx:U.water,param:"fancy"},"Lots of Trees":{fx:U.nature,param:"manyTrees"}}}function W(e,t){return U[e][t]}var u,a=new r,f=128,l=3.2,c=25,h=27,p="basic",d=new r(3.5,8,-2.1),v=[.5,.5,.6],m=[.3,.3,.4],g=[137/255,170/255,220/255],y=[.3,.3,.4],b=[2e3,2e4],w=2e3,E=2e4,S=[.9,.85,.52],x=[.5,.3,.2],T,N,C;o.USE_FOG=!0;var P=function(){return console.log("Setup Main Light"),T=u.world.createEntity("Light1"),N=new n,N.color.setd(1,.95,.85,1),N.specularIntensity=1.8,N.intensity=1,C=new s(N),C.light.shadowCaster=!1,C.light.shadowSettings.darkness=.9,C.light.shadowSettings.near=l,C.light.shadowSettings.far=h,C.light.shadowSettings.size=c,C.light.shadowSettings.shadowType=p,C.light.shadowSettings.resolution=[f,f],console.log("lightComp ---- ",C),T.setComponent(C),T.transformComponent.transform.translation.setd(0,0,0),T.transformComponent.transform.lookAt(new r(-0.5,-0.4,.43),r.UNIT_Y),T.addToWorld(),T},R=function(){q().Bloom.fx.enabled=!0,U.water.fancy&&(q().Shadows.fx.shadowCaster=!0),L(S),A(v),O(g),_(100,3e4)},U={particles:{highDensity:1},bullets:{visible:1},water:{fancy:1},nature:{manyTrees:0}};return e.registerListener(e.list().SET_EFFECT_PARAMETER,F),e.registerListener(e.list().MOVE_AUDIO_LISTENER,H),e.registerListener(e.list().SCENARIO_LOADED,R),{setGoo:k,getEffects:q,getSettingParam:W,getSettings:z,setSettingParamToValue:j,setEffectParamToValue:B,setSunlightColor:L,setSunlightDirection:D,setAmbientColor:A,setFogColor:O,scaleFogNearFar:M,setupMainLight:P}}),define("game/weapons/Bullet",["game/weapons/WeaponData","game/weapons/FireDamage","game/GameConfiguration","game/ModelDefinitions","application/EventManager","goo/math/Matrix3x3","goo/math/Vector3","game/world/PhysicalWorld","3d/GooEffectController"],function(e,t,n,r,i,s,o,u,a){var f=[],l=0,c=function(e,t,r){l+=1;if(r){var s=function(n){n.transformComponent.transform.scale.data[0]=t*.1,n.transformComponent.transform.scale.data[1]=t*.1,e.entity.geometries[0]=n,i.fireEvent(i.list().REGISTER_ACTIVE_ENTITY,{entity:e.entity}),i.fireEvent(i.list().ACTIVATE_GOO_ENTITY,{gooEntity:n,gameEntity:e})},o=function(t){e.id=t.id,e.entity=t,t.spatial=e.spatial,t.pieceData=e.bulletData,i.fireEvent(i.list().BUILD_GOO_GAMEPIECE,{projPath:n.GOO_PROJECTS.bullet_20.projectPath,modelPath:t.pieceData.modelPath,callback:s})};i.fireEvent(i.list().ADD_GAME_ENTITY,{entityId:"bullet_"+l,callback:o})}else{var o=function(t){e.id=t.id,e.entity=t,t.spatial=e.spatial,t.pieceData=e.bulletData,i.fireEvent(i.list().REGISTER_ACTIVE_ENTITY,{entity:e.entity})};i.fireEvent(i.list().ADD_GAME_ENTITY,{entityId:"bullet_"+l,callback:o})}f.push(e)},h=function(e,t,n,r,i,u){var f=new s;this.visible=a.getSettings()["Visible Bullets"].fx.visible,e.add(t),this.originatorId=u,this.onHitEffects=n.onHitEffects,this.bulletData=n,this.spatial={visualPos:new o(0,0,0),pos:e,rot:f,velocity:t,audioVel:new o([0,1e-6,0])},this.caliber=r.caliber,this.lifetime=r.lifetime,this.age=0,this.lifeTime=2e4,this.hitCallback=i,c(this,this.caliber,this.visible)};h.prototype.remove=function(){var e=f.indexOf(this);f.splice(e,1),i.fireEvent(i.list().REMOVE_GAME_ENTITY,{entityId:this.id}),delete this},h.prototype.disappear=function(){this.hitCallback(this.spatial,"nothing"),this.remove()};var p=function(e,n){for(var r in n)r=="fire"&&new t(e.entity,e.part,n[r]),r=="kinetic"&&i.fireEvent(i.list().DAMAGE_ENTITY,{entity:e.entity,damage:n[r].points})};h.prototype.playHitSound=function(e){var t=Math.floor(Math.random()*this.bulletData.onHitSounds.length);i.fireEvent(i.list().ONESHOT_AMBIENT_SOUND,{soundData:i.sound()[this.bulletData.onHitSounds[t]],pos:e.pos,dir:[Math.random()-.5,Math.random()-.5,Math.random()-.5]})},h.prototype.waterSplash=function(e){var t=Math.round(Math.random()*this.caliber*.15),n=[e[0],.6,e[2]];i.fireEvent(i.list().SPLASH_WATER,{pos:n,count:1+t,dir:[0,2+t,0]}),Math.random()<.2*t&&i.fireEvent(i.list().SPLASH_RINGLET,{pos:n,count:1,dir:[0,0,0]}),Math.random()<.05*t&&i.fireEvent(i.list().SPLASH_FOAM,{pos:n,count:1,dir:[0,0,0]})},h.prototype.hit=function(e){this.hitCallback(this.spatial,e);var t=e.pos;if(e.part=="water"){this.waterSplash(t);return}var n=this.spatial.velocity.data;for(var r in this.onHitEffects)i.fireEvent(i.list()[r],{pos:t,count:this.onHitEffects[r].count,dir:[-n[0]*.1+.3*(Math.random()-.5),-n[1]*.3+.3*(Math.random()-.5),-n[2]*.1+.3*(Math.random()-.5)]});if(e.entity)for(var s=0;s<this.bulletData.damageEffects.length;s++)p(e,this.bulletData.damageEffects[s]);else u.renderGroundHitEffect(t);this.playHitSound(e)},h.prototype.updatePosition=function(e){this.age+=e;var t=u.checkSpatialConflict(this,e);if(t){this.hit(t),this.remove();return}if(this.spatial.pos.data[1]<=0){this.hitCallback(this.spatial,"water"),this.remove();return}this.visible&&(this.entity.geometries[0].transformComponent.transform.scale.data[2]=this.spatial.speed*1.2),Math.random()<.15*(1/(1+this.age/1e3))&&i.fireEvent(i.list().PUFF_SMALL_WHITE,{pos:this.spatial.pos.data,count:1,dir:this.spatial.velocity.data}),this.age>this.lifeTime&&this.disappear()};var d=function(e){for(var t=0;t<f.length;t++)f[t].updatePosition(e)},v=function(e){var t=i.eventArgs(e).frameTime;d(t)};return i.registerListener(i.list().UPDATE_ACTIVE_ENTITIES,v),h}),define("game/weapons/PlaneCannon",["game/GameConfiguration","game/weapons/Bullet","application/EventManager","game/GameUtil","goo/math/Vector3"],function(e,t,n,r,i){var s=function(e,t){console.log(e,t),this.planeEntity=e,this.name=t.data.name,this.data=t.data,this.bulletData=t.bulletData,this.posOffset=t.posOffset,this.elevation=48,this.currentState=0,this.cooldownTime=1e3/this.data.rateOfFire,this.targetState=0,this.firing=!1,this.flameEffect=null,this.smokeEffect=null,this.fireSounds={},this.lastBulletVelocity=new i};return s.prototype.playFireParticles=function(){this.flameEffect.enabled=!0;for(var e=0;e<this.flameEffect.emitters.length;e++)this.flameEffect.emitters[e].enabled=!0;var t=function(){for(var e=0;e<this.flameEffect.emitters.length;e++)this.flameEffect.emitters[e].enabled=!1}.bind(this);n.fireEvent(n.list().SEQUENCE_CALLBACK,{callback:t,wait:120})},s.prototype.playSmokeParticles=function(){this.smokeEffect.enabled=!0;for(var e=0;e<this.smokeEffect.emitters.length;e++)this.smokeEffect.emitters[e].enabled=!0;var t=function(){for(var e=0;e<this.smokeEffect.emitters.length;e++)this.smokeEffect.emitters[e].enabled=!1}.bind(this);n.fireEvent(n.list().SEQUENCE_CALLBACK,{callback:t,wait:120})},s.prototype.playFireSound=function(e,t){var r=Math.floor(Math.random()*this.data.onFireSounds.length);n.fireEvent(n.list().ONESHOT_AMBIENT_SOUND,{soundData:n.sound()[this.data.onFireSounds[r]],pos:e,vel:this.planeEntity.spatial.velocity.data,dir:t.data})},s.prototype.addMuzzleFlame=function(){var t=this.posOffset,r=this.planeEntity,i=this.lastBulletVelocity,s=function(){return i},o=function(){return r},u=function(e){var n=Math.random()-.5;return e.position.seta(t),e.position.add_d(.25*(Math.random()-.5),.25*(Math.random()-.5),n*.7),e.position},a=this.planeEntity.spatial,f=function(t){return t.velocity.set(s()),t.velocity.mul(.07+.08*Math.random()),t.velocity.add(o().spatial.velocity),t.velocity.mul(e.RENDER_SETUP.physicsFPS),t.velocity},l={velocity:f,position:u},c=function(e){this.flameEffect=e.particleComponent;var t=0;for(var n=0;n<this.flameEffect.emitters.length;n++)t+=this.flameEffect.emitters[n].releaseRatePerSecond;this.flameEffect.maxReleaseRate=t}.bind(this);n.fireEvent(n.list().BUILD_GOO_PARTICLES,{parentGooEntity:this.planeEntity.geometries[0],systemParams:this.data.flameEffect,emitFunctions:l,callback:c})},s.prototype.addMuzzleSmoke=function(){var t=this.posOffset,r=this.planeEntity,i=function(){return r},s=function(e){return e.position.seta(t),e.position.add_d(.45*(Math.random()-.5),.45*(Math.random()-.5),5.3*(Math.random()-.5)),e.position},o=this.lastBulletVelocity,u=function(){return o},a=function(t){return t.velocity.set(u()),t.velocity.mul((.25+Math.random()*2.51)*(1/e.RENDER_SETUP.physicsFPS)),t.velocity.add(i().spatial.velocity),t.velocity.add(.05*(Math.random()-.5),.05*(Math.random()-.5),.1*(Math.random()-.5)),t.velocity.mul(e.RENDER_SETUP.physicsFPS),t.velocity},f={velocity:a,position:s},l=function(e){this.smokeEffect=e.particleComponent;var t=0;for(var n=0;n<this.smokeEffect.emitters.length;n++)t+=this.smokeEffect.emitters[n].releaseRatePerSecond;this.smokeEffect.maxReleaseRate=t}.bind(this);n.fireEvent(n.list().BUILD_GOO_PARTICLES,{parentGooEntity:this.planeEntity.geometries[0],systemParams:this.data.smokeEffect,emitFunctions:f,callback:l})},s.prototype.createBullet=function(){var n=new i;n.setv(this.planeEntity.spatial.visualPos);var s=r.applyRotationToVelocity(this.planeEntity.geometries[0],new i(this.posOffset));n.addv(s);var o=new i(0,this.elevation*(1/e.RENDER_SETUP.physicsFPS),this.data.exitVelocity*(1/e.RENDER_SETUP.physicsFPS));o=r.applyRotationToVelocity(this.planeEntity.geometries[0],o),o.addv(this.planeEntity.spatial.velocity);var u=function(e,t){};this.lastBulletVelocity.set(o),new t(n,o,this.bulletData,this.data,u,this.planeEntity.id),this.playFireSound(n,o)},s.prototype.fire=function(){this.createBullet(),this.playFireParticles(),this.playSmokeParticles(),this.currentState==1&&this.sequenceShot(this.cooldownTime)},s.prototype.sequenceShot=function(e){var t=function(){this.fire()}.bind(this);n.fireEvent(n.list().SEQUENCE_CALLBACK,{callback:t,wait:e})},s.prototype.updateTriggerState=function(e,t,n){this.flameEffect||(this.addMuzzleFlame(),this.addMuzzleSmoke()),this.currentState=e;if(!e)return 0;var r=t*this.cooldownTime/n;return this.sequenceShot(r),this.currentState},s}),define("game/controls/WeaponsController",["application/EventManager","3d/GooJointAnimator","game/weapons/PlaneCannon"],function(e,t,n){var r=function(e,t,r){if(t=="cannons")var i=new n(e,r);return i},i=function(e,t,n){var i=[];for(var s in t.controls)for(var o=0;o<t[s].length;o++)i.push(r(e,s,t[s][o],n));return i},s=function(e,n,r){for(var i=0;i<n.length;i++)for(var s in n[i]){var o=e.pieceData.boneMap[s],u=e.animationChannels[o];t.rotateBone(u,n[i][s]*r)}},o=function(e,t,n){console.log("Trigger lights: ",t,n);for(var r=0;r<t.length;r++)var i=e.lights[t[r]].setIntensity(n)},u=function(e,t){t==undefined&&(t=0);for(var n in e.pieceData.systems.weapons.controls){var r=e.pieceData.systems.weapons.controls[n];for(var i in r)i=="bones"&&s(e,r[i],t),i=="lights"&&o(e,r[i],t)}var n=e.systems.weapons;for(var u=0;u<n.length;u++){var r=n[u];r.currentState==t&&(t=0),t=r.updateTriggerState(t,u,n.length)}return t},a=function(t,n){var r=t.systems.weapons;for(var i=0;i<r.length;i++){var s=r[i].currentState,o=r[i];o.updateThrust(t.air.density)}if(s==o.currentState)return;t.isPlayer&&e.fireEvent(e.list().PLAYER_CONTROL_STATE_UPDATE,{control:"weapons",currentState:s})},f=function(){};return{processControlState:f,applyControlStateToWeapons:u,updateWeaponState:a,buildSystem:i}}),define("game/controls/TrimController",[],function(){var e=function(e,t,n){var r={};return r},t=function(){};return{buildSystem:e,processControlState:t}}),define("game/planes/Contrails",["application/EventManager","game/GameUtil","goo/math/Vector3"],function(e,t,n){function i(n,i){r.set(i),t.applyRotationToVelocity(n.geometries[0],r),r.addv(n.spatial.pos),e.fireEvent(e.list().ACROBATIC_SMOKE,{pos:[r.data[0],r.data[1],r.data[2]],count:1,dir:[6*(Math.random()-.5),6*(Math.random()-.5),6*(Math.random()-.5)]})}function s(e){var t=e.pieceData.wing_smoke;for(var n=0;n<t.length;n++)i(e,t[n])}var r=new n;return{puffWingSmoke:s}}),define("game/ControlsController",["application/EventManager","game/controls/SurfaceController","game/controls/FlapsController","game/controls/BreaksController","game/controls/EngineController","game/controls/GearController","game/controls/DriveController","game/controls/CanopyController","game/controls/EjectionSeatController","game/controls/WeaponsController","game/controls/TrimController","game/planes/Contrails","game/GameConfiguration"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p={auto_trim:l,engines:i,drive:o,gears:s,canopy:u,seat:a,breaks:r,weapons:f},d=function(e,t,n){e.systems={},console.log("SYSTEM CONTROLLERS: ",p);for(var r in t)console.log("ADD SYSTEM: ",r,t[r]),e.systems[r]=p[r].buildSystem(e,t[r],n)},v=function(e,n){e.surfaces={};for(var r in n)console.log("ADD SURFACE: ",r,n[r]),e.surfaces[r]=t.buildSurface(n[r])},m=function(e,t,n){var r=0;n&&(r=1),e.pieceData=t,d(e,t.systems,r),v(e,t.surfaces),console.log("------>> Build Piece: ",e)},g=function(e){var t={},n=function(e){if(!e.getChildren)return;var t=e.getChildren();for(var n=0;n<t.length;n++)r(e.children[n])},r=function(e){e.name&&(t[e.name]=e),e.baseRotMatrix=e.getRotMatrix(),e.basePos=[parseFloat(e.getLocX()),parseFloat(e.getLocY()),parseFloat(e.getLocZ())],n(e)};n(e.collada),e.pieceData.bones=t,console.log(t)},y=function(n,o,l){switch(o){case"trim_elevator":l=t.applyTrimStateToSurface(n,l,"elevator");break;case"trim_rudder":l=t.applyTrimStateToSurface(n,l,"rudder");break;case"trim_aeilrons":l=t.applyTrimStateToSurface(n,l,"aeilrons");break;case"elevator":case"rudder":case"aeilrons":case"flaps":case"wing_sweep":l=t.applyControlStateToSurface(n,l,o);break;case"breaks":l=r.applyControlStateToBreaks(n,l),l=t.applyControlStateToSurface(n,l,o);break;case"throttle":l=i.applyControlStateToEngines(n,l);break;case"cannons":l=f.applyControlStateToWeapons(n,l),e.fireEvent(e.list().PLAYER_CONTROL_STATE_UPDATE,{control:"cannons",currentState:l});break;case"gears":l&&s.setEntityGearTargetState(n,!n.systems.gears.targetState);break;case"canopy":l&&u.setEntityCanopyTargetState(n,!n.systems.canopy.targetState);break;case"eject":l&&a.fireEjectionSeat(n);break;case"auto_trim":n.controls[o].value==l&&(l=0),e.fireEvent(e.list().PLAYER_CONTROL_STATE_UPDATE,{control:o,currentState:l});break;case"reset_trim":t.zeroSurfaceTrimState(n,"aeilrons"),t.zeroSurfaceTrimState(n,"elevator"),t.zeroSurfaceTrimState(n,"rudder");break;case"screen_intensity":n.screenSystem.setMasterIntensity(l);break;case"hud_intensity":n.screenSystem.displays.hud.setIntensity(l);break;case"hdd_intensity":for(var c in n.screenSystem.displays)c!="hud"&&n.screenSystem.displays[c].setIntensity(l);break;case"cockpit_lights":n.lightSystems.cockpit.setMasterIntensity(l);break;case"cockpit_mode":n.lightSystems.cockpit.setMode(l);break;case"formation_lights":n.lightSystems.formation.setMasterIntensity(l);break;case"formation_mode":n.lightSystems.formation.setMode(l);break;case"position_lights":n.lightSystems.position.setMasterIntensity(l);break;case"position_mode":n.lightSystems.position.setMode(l);break;case"taxi_lights":n.lightSystems.taxi.setMasterIntensity(l);break;case"taxi_mode":n.lightSystems.taxi.setMode(l);break;case"collision_lights":n.lightSystems.collision.setMasterIntensity(l);break;case"collision_mode":n.lightSystems.collision.setMode(l);break;default:n.controls[o].value==1&&(l=0),e.fireEvent(e.list().PLAYER_CONTROL_STATE_UPDATE,{control:o,currentState:l})}n.controls[o].value=l},b=function(e,n){if(e.controls.auto_trim.value&&!e.pieceInput.elevator.value){var r=e.forces.torque[0]*h.RENDER_SETUP.physicsFPS*n,i=r*Math.abs(Math.max(0,1-e.surfaces.elevator.currentState*.5));t.applyTrimStateToSurface(e,i,"elevator")}},w=function(e,t,n){for(var r in e.pieceInput)e.pieceInput[r].update&&y(e,r,e.pieceInput[r].value),e.pieceInput[r].update=!1,r=="wing_smoke"&&e.controls[r].value==1&&c.puffWingSmoke(e);b(e,t),E(e,t,n)},E=function(e,n,r){t.processControlState(e);for(var i in e.systems)p[i].processControlState(e,r)};return{changeControlState:y,buildPieceControls:m,configurePlaneBones:g,applyInputStateToControls:w}}),define("3d/GooLayerAnimator",[],function(){var e=function(e){e.geometries[0].animationComponent||(alert("No Animation on entity: "+gameentity.id),console.log(e.geometries[0]));var t=e.geometries[0].animationComponent.layers,n={};for(var r=0;r<t.length;r++){var i=t[0];for(var s in i._steadyStates)n[i._steadyStates[s]._name]=s}e.animStateMap=n,console.log("print animation layers: ",e)};return{printEntityLayerMap:e}}),define("game/piece/PieceBuilder",["application/EventManager","game/piece/PieceInputHandler","game/planes/PlaneWing","game/ControlsController","3d/GooLayerAnimator"],function(e,t,n,r,i){var s=function(e,n,r){t.buildPieceInput(e),i.printEntityLayerMap(e)},o=function(e,i,s,o){r.buildPieceControls(e,i,s),t.buildPieceInput(e),e.wings={},e.air={density:1};for(var u in i.wings){e.wings[u]=new n(e,i.wings[u],u);for(var a in i.wings[u].controls)e.wings[u].setAoAControl(a,i.wings[u].controls[a])}e.forces.weight.setd(0,i.dimensions.massEmpty,0)},u=function(e,n){r.buildPieceControls(e,n),t.buildPieceInput(e)};return{buildHuman:s,buildBoatPiece:u,buildPiece:o}}),define("game/instruments/Instrument",[],function(){var e=function(e,t,n,r,i){this.id=e,this.curve=r,this.sample=n,this.boneName=i,this.axisAmp=t,this.value=null};return e.prototype.setValue=function(e){this.value=e},e.prototype.getValue=function(){return this.value},e.prototype.applyVector=function(e){return[e.data[this.axisAmp[0][0]]*this.axisAmp[0][1],e.data[this.axisAmp[1][0]]*this.axisAmp[1][1],e.data[this.axisAmp[2][0]]*this.axisAmp[2][1]]},e.prototype.getBoneName=function(){return this.boneName},e}),define("game/player/PlayerInstruments",["application/EventManager","goo/math/Vector3","3d/GooJointAnimator","game/GameConfiguration","game/GameUtil","game/instruments/Instrument"],function(e,t,n,r,i,s){var o;require(["game/player/PlayerController"],function(e){o=e});var u=0,a=0,f,l=new t,c=new t,h=r.RENDER_SETUP.physicsFPS,p={speed:0,g:0},d=function(t,n,r){t.measurements.throttle&&e.fireEvent(e.list().PLAYER_VALUE_UPDATE,{value:"throttle",amount:f.systems.engines[0].thrust*.001}),t.measurements.speed&&e.fireEvent(e.list().PLAYER_VALUE_UPDATE,{value:"speed",amount:3.6*p.speed*n}),t.measurements.altitude&&e.fireEvent(e.list().PLAYER_VALUE_UPDATE,{value:"altitude",amount:f.spatial.pos[1]}),t.measurements.airflowx&&e.fireEvent(e.list().PLAYER_VALUE_UPDATE,{value:"airflowx",amount:90*f.spatial.axisAttitudes.data[0]}),t.measurements.airflowy&&e.fireEvent(e.list().PLAYER_VALUE_UPDATE,{value:"airflowy",amount:90*f.spatial.axisAttitudes.data[1]}),t.measurements.airflowz&&e.fireEvent(e.list().PLAYER_VALUE_UPDATE,{value:"airflowz",amount:90*f.spatial.axisAttitudes.data[2]}),t.measurements.gForce&&e.fireEvent(e.list().PLAYER_VALUE_UPDATE,{value:"gForce",amount:1+p.g*9.81/(r*.001)}),u=0,a=0,p.speed=0,p.g=0},v=function(e,t){var r=f.animationChannels[f.pieceData.boneMap[e]];r&&n.rotateBone(r,t)},m=function(e,t){var r=f.animationChannels[f.pieceData.boneMap[e]];r&&n.translateBone(r,t)},g=function(e){return Math.atan2(e.spatial.velocity.data[0],-e.spatial.velocity.data[2])},y=function(e,t,n){return t[n][1]+(e-t[n][0])/(t[n+1][0]-t[n][0])*(t[n+1][1]-t[n][1])},b=function(e,t){for(var n=0;n<t.length;n++)if(t[n+1][0]>e)return y(e,t,n);return 0},w,E=function(e,t,n){c.set(t);var r=g(e),i=Math.atan2(c.data[0],c.data[1]);w={rotVec:t,xyHeading:r,rollAng:i,pitch:t.data[2],altitude:e.spatial.pos[1],speed:Math.sqrt(e.spatial.audioVel.lengthSquared()),g:e.forces.g.data[1]*n,acc:e.forces.g,aoa:e.spatial.axisAttitudes.data[1],climbRate:e.spatial.velocity.data[1]*n,rpm:e.systems.engines[0].rpm,temp:e.systems.engines[0].temp}},S=function(e){return w[e]},x=function(e,t,n){if(e.systems==undefined)return;E(e,t,n);var r;for(var s in e.instruments)e.instruments[s].sample&&(e.instruments[s].setValue(S(e.instruments[s].sample)),e.instruments[s].axisAmp.length?(r=e.instruments[s].applyVector(e.instruments[s].getValue()),m(e.instruments[s].getBoneName(),r)):(r=e.instruments[s].getValue(),e.instruments[s].curve&&(r=i.fitValueInCurve(r,e.instruments[s].curve)),v(e.instruments[s].getBoneName(),e.instruments[s].axisAmp*r)))},T=function(){f=o.getPlayerEntity(),l.setd(0,1,0),f.spatial.rot.applyPre(l),x(f,l,h)},N=function(t){f=o.getPlayerEntity();if(!f)return;var n=e.eventArgs(t).frameTime;l.set(0,0,1),f.spatial.rot.applyPost(l),e.fireEvent(e.list().MOVE_AUDIO_LISTENER,{pos:f.spatial.pos.data,rot:l.data,vel:f.spatial.audioVel.data}),u+=n,a+=1,p.speed+=f.spatial.speed,p.g+=f.forces.g.data[1];var r=250,i=1e3/u;u>=r&&d(f,i,u),T()},C=function(e,t,n){e.instruments[t]=new s(t,n.axisAmp,n.sample,n.curve,n.boneName)},k=function(e){e.instruments={};for(var t in e.pieceData.instruments)C(e,t,e.pieceData.instruments[t]);e.measurements=e.pieceData.measurements},L=function(t){k(t),e.registerListener(e.list().UPDATE_ACTIVE_ENTITIES,N)};return{initInstruments:L}}),define("game/player/PlayerInputSystem",["application/EventManager","goo/math/Vector3","3d/GooJointAnimator","game/GameConfiguration","game/planes/PlaneData","game/piece/PieceBuilder","game/piece/PieceInputHandler","game/player/PlayerUtils","io/PointerInputHandler"],function(e,t,n,r,i,s,o,u,a){var f;require(["game/player/PlayerController"],function(e){f=e});var l="playerId",c=function(e){contrails.updateAcrobaticSmokeState(f.getPlayerEntity(),e)},h=function(t){var n=f.getPlayerEntity(),r=e.eventArgs(t);n.state=r.movestate},p=function(e,t){var r=f.getPlayerEntity(),i=r.pieceData.systems;if(i[e])var s=i[e];else var s=r.pieceData.surfaces[e];if(!s)return;if(s.inputBehavior.inputAnim){var o=s.inputBehavior.inputAnim,u=o.bone,a=r.pieceData.boneMap[u],l=r.animationChannels[a],c=o.rot;u=="stick"?n.rotateBone(l,r.surfaces.aeilrons.currentState*c[0],t*c[1],t*c[2]):n.rotateBone(l,t*c[0],t*c[1],t*c[2])}},d=function(e,t){e=="debug_mechanics"&&u.handleDebugState(t),p(e,t)},v=function(e){var t=f.getPlayerEntity();o.resamplePieceInputState(t,e)},m=function(e,t){var n=f.getPlayerEntity();o.setPieceInputState(n,e,t)},g=function(t){m(e.eventArgs(t).control,e.eventArgs(t).value),e.eventArgs(t).control=="jump"&&console.log(f.getPlayerEntity().spatial.pos.data)},y=function(t){d(e.eventArgs(t).control,e.eventArgs(t).currentState)},b=0,w=0,E=function(t){function n(e){m("mouseturn",e[0]*30),w=e[0]}b&&e.fireEvent(e.list().FETCH_DRAG_DELTA,{callback:n})},S=function(t){var n=e.eventArgs(t).action;m("mouseforward",n[0]*n[1]),v("forward"),m("mouseturn",0),b!=n[1]&&m("strafe",n[1]),b=n[1]},x=function(){e.registerListener(e.list().PLAYER_CONTROL_EVENT,g),e.registerListener(e.list().PLAYER_CONTROL_STATE_UPDATE,y),e.registerListener(e.list().RENDER_TICK,E),e.registerListener(e.list().MOUSE_ACTION,S)};return{ready:x}}),define("game/player/PlayerUiHandler",["application/EventManager"],function(e){var t=function(t){console.log("LOAD TEMPLATE: ",t),e.fireEvent(e.list().LOAD_UI_TEMPLATE,{templateId:t})},n=function(t){e.fireEvent(e.list().UNLOAD_UI_TEMPLATE,{templateId:t})};return{loadPlayerUi:t,unloadPlayerUi:n}}),define("game/player/PlayerPieceHandler",["application/EventManager","goo/math/Vector3","3d/GooJointAnimator","game/GameConfiguration","game/piece/PieceBuilder","game/piece/PieceInputHandler","game/player/PlayerInstruments","game/player/PlayerInputSystem","game/player/PlayerUiHandler","physics/PhysicalWorld"],function(e,t,n,r,i,s,o,u,a,f){var l;require(["game/player/PlayerController"],function(e){l=e});var c="playerId",h,p=function(t){if(!t.systems)return;e.fireEvent(e.list().INIT_PLAYER_CONTROL_STATE,{control:"engines",controlState:t.systems.engines[0].currentState}),e.fireEvent(e.list().INIT_PLAYER_CONTROL_STATE,{control:"breaks",controlState:t.systems.breaks.currentState}),e.fireEvent(e.list().INIT_PLAYER_CONTROL_STATE,{control:"flaps",controlState:t.controls.flaps.controlState}),e.fireEvent(e.list().INIT_PLAYER_CONTROL_STATE,{control:"canopy",controlState:t.systems.canopy.currentState}),e.fireEvent(e.list().INIT_PLAYER_CONTROL_STATE,{control:"gears",controlState:t.systems.gears.currentState})},d=function(t){t.isPlayer=!0,console.log("SET PLAYER ENTITY: ",t),e.fireEvent(e.list().ADD_KEYBINDINGS,{bindings:t.pieceData.keyBindings}),t.moveSphere&&f.activateAmmoComponent(t.moveSphere.ammoComponent,t.spatial.pos.data,t.spatial.velocity.data,t.pieceData.dimensions.mobRadius),setTimeout(function(){if(!t.systems)return;t.systems.engines&&p(t)},500);for(var n=0;n<t.pieceData.uiPages.length;n++)a.loadPlayerUi(t.pieceData.uiPages[n]);return o.initInstruments(t),u.ready(),console.log("--------->>>>> playerEntity: ",t),t},v=function(e){for(var t=0;t<e.pieceData.uiPages.length;t++)a.unloadPlayerUi(e.pieceData.uiPages[t])},m=function(t){console.log("REMOVE CONTROLS FROM: ",t),t.isPlayer=!1,e.fireEvent(e.list().CLEAR_KEYBINDINGS,{bindings:t.pieceData.keyBindings}),t.moveSphere&&f.removeAmmoComponent(e.moveSphere.ammoComponent),v(t)};return{removePlayerControlFrom:m,unloadControledEntityUi:v,setPlayerControlledEntity:d}}),define("3d/cameras/WalkMode",["physics/PhysicalWorld","goo/math/Vector2","goo/math/Vector3","goo/math/Matrix3x3","goo/math/MathUtils"],function(e,t,n,r,i){function g(e){l=e}function y(e){f=e}function b(e){p=e}function w(){return p}function E(){return.8}function S(t){s.set(t),l.rot.applyPost(s),s.add(l.pos),u.set(l.pos),u.add(c);var n=e.physicsRayRange(u.data,s.data);return n&&t.mul(n.fraction),t.mul(.5),t}function x(e){c.set(f),o.set(e),o.add(f),s.set(S(o)),s.add(f),h.set(s)}function T(e,t){var n=e.transformComponent,r=n.transform;r.translation.set(h),s.set(h),s.sub(c),r.rotation.lookAt(s,v),t.y=i.lerp(.1,t.y,Math.PI*1.5)}function N(e){}function C(e){e.y=Math.PI*1.5}function k(e){m=e}function L(){}var s=new n,o=new n,u=new n,a=new r,f=new n(0,1.75,0),l,c=new n,h=new n,p=6,d=.4,v=new n(0,1,0),m;return{setCamera:k,adjustFov:L,pointerAction:C,releaseDrift:N,setTargetSpatial:g,setTargetOffset:y,setCamDistance:b,getCamDistance:w,calcCamPos:x,calcCamRot:T}}),define("game/player/PlayerController",["application/EventManager","game/player/PlayerUtils","game/player/PlayerPieceHandler","game/planes/PlaneData","3d/cameras/WalkMode"],function(e,t,n,r,i){function a(){var e=u+1;return o[e%o.length]}function f(e){s=e}function l(){return s}var s,o=["PILOT_1","TUNNAN_1","DRAKEN_3","PV_9031_1"],u,c=function(e){u=o.indexOf(e.id),f(n.setPlayerControlledEntity(e));var t=e;e.pilot&&(t=e.pilot),e.isPilot=!1},h=function(t){var n=e.eventArgs(t).entity;c(n)},p=function(){var t=l().pilot,r=l().spatial.pos.data,i=l().spatial.rot.toAngles(),s=l().spatial.velocity.data;n.removePlayerControlFrom(l());if(!t){var o=function(t){console.log("SWITCH TO: ",t),t.spatial.pos.set(r),t.spatial.velocity.set(s),e.fireEvent(e.list().FETCH_LEVEL_ENTITY,{entityId:t.id,callback:c})};setTimeout(function(){e.fireEvent(e.list().SPAWN_PHYSICAL,{pos:r,callback:o})},300)}else{l().pilot=null;var o=function(t,n){console.log("SWITCH TO: ",t),t.spatial.pos.set(n),t.spatial.rot.fromAngles(0,i.data[1],0),c(t),e.fireEvent(e.list().SET_CAMERA_TARGET,{spatial:t.spatial,geometry:t.geometries[0],controlScript:"walkCam"})};setTimeout(function(){o(t,r)},300)}},d=function(){console.log("POP Sphere"),e.fireEvent(e.list().SPAWN_PHYSICAL,{pos:l().spatial.pos.data})};return e.registerListener(e.list().SET_PLAYER_CONTROLLED_ENTITY,h),e.registerListener(e.list().EXIT_CONTROLLED_ENTITY,p),e.registerListener(e.list().POP_SPHERE,d),{getPlayerEntity:l}}),define("view/dynamic/KeyBindingsPage",["application/EventManager","view/DomUtils","io/InputSettersGetters","game/GameConfiguration","game/player/PlayerController"],function(e,t,n,r,i){function s(e){var t=[];t[192]="~",t[109]="-",t[107]="+",t[219]="{",t[221]="}",t[220]="|",t[59]=":",t[222]='"',t[188]="<",t[190]=">",t[191]="?",t[32]="Space",t[38]="Down",t[40]="Up",t[37]="Left",t[39]="Right";var n=t[e];return n||(n=String.fromCharCode(e)),n}var o=function(e){var r=t.createDivElement(e,e.id+"_keyList","","key_list"),o=i.getPlayerEntity(),u=n.getBoundKeys();console.log(u);var a=function(e,n,r){var i=t.createDivElement(e,e.id+"_"+r,s(n),"bound_key")};for(var f in o.pieceData.keyBindings){var l=0,c=t.createDivElement(r,r.id+"_header","","menu_list_item");t.createDivElement(c,c.id+"_"+f,f,"key_control");var h=t.createDivElement(c,c.id+"_"+f+"_keys","","menu_list_entry");for(var p in u)u[p]==f&&a(h,p,l),l+=1}},u=function(e,n){var r=t.getElementById(n);switch(e){case"KEY_BINDINGS":KeyBidingsPage.buildPage(r),o(r);break;case"SOUND_MENU":r.innerHTML="Sound setup here"}};return{buildKeyBindingsPage:o}}),define("view/dynamic/SoundMenuPage",["application/EventManager","view/DomUtils","io/InputSettersGetters","game/GameConfiguration","game/player/PlayerController","sound/ChannelMixer"],function(e,t,n,r,i,s){var o=function(n){var r=t.createDivElement(n,n.id+"_keyList","","key_list"),i=s.getChannels(),o=function(n,r,i){var s=t.createDivElement(n,n.id+"_on",i,"toggle_sound"),o=function(e){var t=r.getChannelGain(),n="#3e5",i="#fff";if(!t){n="#b25";var i="#700"}e.style.color=i,e.style.backgroundColor=n},u=function(){var t=1-r.getChannelGain();e.fireEvent(e.list().ANALYTICS_EVENT,{category:"CONFIG_SOUND",action:r.channelId,labels:JSON.stringify(t),value:0}),r.setChannelGain(t),o(s)};t.addElementClickFunction(s,u),o(s)};for(var u in i){var a=t.createDivElement(r,r.id+"_header","","menu_list_item");t.createDivElement(a,a.id+"_"+u,u,"key_control");var f=t.createDivElement(a,a.id+"_"+u+"_keys","","menu_list_entry");o(f,i[u],"on")}};return{buildSoundMenuPage:o}}),define("view/dynamic/VisualEffectsPage",["application/EventManager","view/DomUtils","3d/GooEffectController"],function(e,t,n){var r=function(e){var r=t.createDivElement(e,e.id+"_keyList","","key_list"),i=n.getEffects(),s=function(e,r,i,s){var o=t.createDivElement(e,e.id+"_on",s,"toggle_sound"),u=function(e){var t=n.getEffects()[r].fx[i],s="#3e5",o="#fff";if(!t){s="#b25";var o="#700"}e.style.color=o,e.style.backgroundColor=s},a=function(){n.setEffectParamToValue(r,i,!n.getEffects()[r].fx[i]),u(o)};t.addElementClickFunction(o,a),u(o)};for(var o in i){var u=t.createDivElement(r,r.id+"_header","","menu_list_item");t.createDivElement(u,u.id+"_"+o,o,"key_control");var a=t.createDivElement(u,u.id+"_"+o+"_keys","","menu_list_entry");s(a,o,i[o].param,"on")}};return{buildVFXMenuPage:r}}),define("view/dynamic/SettingOptionsPage",["application/EventManager","view/DomUtils","3d/GooEffectController"],function(e,t,n){var r=function(e){var r=t.createDivElement(e,e.id+"_keyList","","key_list"),i=n.getSettings(),s=function(e,r,i,s){var o=t.createDivElement(e,e.id+"_on",s,"toggle_sound"),u=function(e){var t=n.getSettings()[r].fx[i],s="#3e5",o="#fff";if(!t){s="#b25";var o="#700"}e.style.color=o,e.style.backgroundColor=s},a=function(){n.setSettingParamToValue(r,i,!n.getSettings()[r].fx[i]),u(o)};t.addElementClickFunction(o,a),u(o),o.style.pointerEvents="auto"};for(var o in i){var u=t.createDivElement(r,r.id+"_header","","menu_list_item");t.createDivElement(u,u.id+"_"+o,o,"option_control");var a=t.createDivElement(u,u.id+"_"+o+"_keys","","menu_list_entry");s(a,o,i[o].param,"on")}};return{buildOptionsMenuPage:r}}),define("view/DynamicPages",["application/EventManager","view/dynamic/KeyBindingsPage","view/dynamic/SoundMenuPage","view/dynamic/VisualEffectsPage","view/dynamic/SettingOptionsPage","view/DomUtils"],function(e,t,n,r,i,s){var o=function(e,o){var u=s.getElementById(o);switch(e){case"KEY_BINDINGS":t.buildKeyBindingsPage(u);break;case"SOUND_MENU":n.buildSoundMenuPage(u);break;case"VFX_MENU":r.buildVFXMenuPage(u);break;case"OPTIONS_MENU":i.buildOptionsMenuPage(u)}};return{buildPage:o}}),define("navigation/NavigationHandler",["navigation/Pages","view/PageOpener","application/EventManager","view/DomUtils","view/DynamicPages"],function(e,t,n,r,i){var s,o,u={},a=function(e){n.registerListener(n.list().MENU_NAVIGATE,f),n.registerListener(n.list().OPEN_UI_PAGE,l),n.registerListener(n.list().CLOSE_OVERLAY,c),n.registerListener(n.list().SLIDE_OVERLAY_UP,p),n.registerListener(n.list().SLIDE_OVERLAY_IN,h),setTimeout(function(){e()},50)},f=function(i){s&&(t.removeRenderable(s),o&&r.removeElementClass(o,"setting_active"));var u=n.eventArgs(i).destination;o=r.getElementById(n.eventArgs(i).elementId),console.log(n.eventArgs(i).elementId),r.addElementClass(o,"setting_active"),s=t.open(e[u]),console.log(s)},l=function(e){var t=n.eventArgs(e).page,r=n.eventArgs(e).parentId;setTimeout(function(){i.buildPage(t,r)},1)},c=function(e){t.closeOverlay()},h=function(e){n.fireEvent(n.list().PAUSE_UPDATES,{});var t=n.eventArgs(e).elementId;r.quickShowElement(document.getElementById(t))},p=function(e){n.fireEvent(n.list().UNPAUSE_UPDATES,{});var t=n.eventArgs(e).elementId;r.quickHideElement(document.getElementById(t))},d=function(r){var i=n.eventArgs(r).templateId;u[i]=t.open(e[i])},v=function(e){var r=n.eventArgs(e).templateId;t.removeRenderable(u[r])};return n.registerListener(n.list().LOAD_UI_TEMPLATE,d),n.registerListener(n.list().UNLOAD_UI_TEMPLATE,v),{initNavigation:a,addOverlayPage:l}}),define("view/ClientViewManager",["navigation/NavigationHandler"],function(e){var t=function(t){e.initNavigation(t),console.log("init view")};return{initiateView:t}}),define("application/Sequencer",["application/EventManager"],function(e){var t,n=[],r=function(e,t){n.push({wait:t,callback:e})},i=function(e){for(var t=0;t<n.length;t++){var r=n[t];r.wait-=e,r.wait<=0&&(r.callback(),n.splice(t,1))}},s=function(t){var n=e.eventArgs(t),i=n.callback,s=n.wait;r(i,s)},o=function(){for(var e=0;e<n.length;e++){var t=n[e];console.log(t)}n=[]};e.registerListener(e.list().SEQUENCE_CALLBACK,s);var u=function(e,n){t=e,i(n)};return{tick:u}}),define("feedback/IntroController",["game/GameConfiguration","application/EventManager","view/DomUtils"],function(e,t,n){var r=e.INTRO,i=function(){var e=r.containerId;n.getElementById(e).style.display="none"},s=function(e){var t=r.stages[e].id;n.getElementById(t).style.display="none",e<r.stages.length-1?o(e+1):i()},o=function(e){var n=r.stages[e].time;t.fireEvent(t.list().SEQUENCE_CALLBACK,{callback:function(){s(e)},wait:n})},u=function(){o(0)},a=function(){};return{startIntro:u,skipIntro:a}}),require(["application/EventManager"],function(e){function a(e,n,r){r(n),t[e]&&console.log("already loaded, "+e),t[e]=n}function f(t,r,i){if(n[t]){i(n[t]),console.log("goo json already loaded, "+t);return}i(r),n[t]=r,e.fireEvent(e.list().REGISTER_GOO_MESH,{mesh:r,url:t})}function l(t,n,r){if(o[t]){r(o[t]),console.log("goo json already loaded, "+t);return}r(n),o[t]=n,e.fireEvent(e.list().REGISTER_GOO_SKELETON,{skeleton:n,url:t})}function c(t,n,r){if(u[t]){r(u[t]),console.log("goo json already loaded, "+t);return}r(n),u[t]=n,e.fireEvent(e.list().REGISTER_GOO_ANIMATION,{animation:n,url:t})}function h(t,n,i){if(r[t]){i(r[t]),console.log("goo json already loaded, "+t);return}i(n),r[t]=n,e.fireEvent(e.list().REGISTER_GOO_MATERIAL,{material:n,url:t})}function p(t,n,r){if(i[t]){r(i[t]),console.log("goo json already loaded, "+t);return}r(n),i[t]=n,e.fireEvent(e.list().REGISTER_GOO_TEXTURE,{texture:n,url:t})}function d(t,n,r,i){if(s[t]){console.log("goo json already loaded, "+t);return}s[t]=i,e.fireEvent(e.list().REGISTER_GOO_SHADER,{shaderId:n,type:r,data:i})}function v(e,t){var n=new GLGE.Collada;n.setDocument(e,window.location.href),n.loadedCallback=function(){a(e,n,t)}}function m(t,r){if(n[t]){r(n[t]);return}var i=function(e){f(t,e,r)};e.fireEvent(e.list().LOAD_JSON,{url:t,callback:i})}function g(t,n){if(r[t]){n(r[t]);return}var i=function(e){h(t,e,n)};e.fireEvent(e.list().LOAD_JSON,{url:t,callback:i})}function y(t,n){if(o[t]){n(o[t]);return}var r=function(e){l(t,e,n)};e.fireEvent(e.list().LOAD_JSON,{url:t,callback:r})}function b(t,n){if(u[t]){n(u[t]);return}var r=function(e){c(t,e,n)};e.fireEvent(e.list().LOAD_JSON,{url:t,callback:r})}function w(e,t){if(i[e]){console.log("goo json already loaded, "+e);return}var n=new Image;n.src=e,n.onload=function(){p(e,n,t)}}var t={},n={},r={},i={},s={},o={},u={},E=function(t,n,r){var i=0,s=function(s,o){var u=function(e){i-=1,d(t[o],n,o,e),i==0&&r()};e.fireEvent(e.list().LOAD_JSON,{url:s,callback:u})};for(var o in t)i+=1,s(t[o],o)},S=function(t){v(e.eventArgs(t).modelUrl,e.eventArgs(t).callback)},x=function(t){m(e.eventArgs(t).modelUrl,e.eventArgs(t).callback)},T=function(t){g(e.eventArgs(t).materialUrl,e.eventArgs(t).callback)},N=function(t){w(e.eventArgs(t).textureUrl,e.eventArgs(t).callback)},C=function(t){E(e.eventArgs(t).shaderFiles,e.eventArgs(t).shaderId,e.eventArgs(t).callback)},k=function(t){y(e.eventArgs(t).skeletonUrl,e.eventArgs(t).callback)},L=function(t){b(e.eventArgs(t).animationUrl,e.eventArgs(t).callback)};e.registerListener(e.list().LOAD_MODEL_URL,S),e.registerListener(e.list().LOAD_GOO_MESH,x),e.registerListener(e.list().LOAD_GOO_SKELETON,k),e.registerListener(e.list().LOAD_GOO_ANIMATION,L),e.registerListener(e.list().LOAD_GOO_MATERIAL,T),e.registerListener(e.list().LOAD_GOO_TEXTURE,N),e.registerListener(e.list().LOAD_GOO_SHADER,C)}),define("3d/ModelDataManager",function(){}),define("3d/SceneController",["application/EventManager","3d/ModelDataManager"],function(e){function r(){setTimeout(function(){e.registerListener(e.list().RENDER_TICK,n)},0)}var t=function(t){e.fireEvent(e.list().UPDATE_ACTIVE_ENTITIES,{frameTime:t})},n=function(n){var r=e.eventArgs(n).lastFrameDuration;t(r)};e.registerListener(e.list().SCENARIO_LOADED,r)}),define("physics/ForceProcessor",["goo/math/Vector3"],function(e){var t=new e,n=function(e,t){t.addv(e)},r=function(e,n,r){t.setv(n),r.addv(t.cross(e))};return{addForceToAcc:n,addForceToTorque:r}}),define("game/planes/PlaneController",["game/EntityController","game/planes/PlaneWing","game/ControlsController"],function(e,t,n){var r=function(e){var t=!e.systems.gears.targetState;console.log("Toggle Gears"),e.controls.gears.value=t},i=function(e){var t=1,n=e.systems.canopy;n.targetState==1&&(t=0),e.controls.canopy.value=1},s=function(e){e.controls.eject.value=1},o=6.5,u=3,a=function(e,t){var r=0,i=e.spatial.speed;i>o?(r=1,e.surfaces.flaps.currentState!=0&&n.changeControlState(e,"flaps",0)):i>(u+o)*.5?(r=.6,e.surfaces.flaps.currentState!=0&&n.changeControlState(e,"flaps",0)):i>u&&(r=.3,e.surfaces.flaps.currentState!=0&&n.changeControlState(e,"flaps",0));if(t.currentState!=r){n.changeControlState(e,"wing_sweep",r);if(t.lights)for(var s=0;s<t.lights.length;s++)e.lights[t.lights[s]].setIntensity(r)}},f=function(e,t,r){e.surfaces.wing_sweep&&a(e,e.surfaces.wing_sweep),n.applyInputStateToControls(e,t,r)};return{updatePlaneControlState:f,toggleGears:r,toggleCanopy:i,fireEject:s}}),define("game/world/VideoBroadcasts",["application/EventManager","game/GameConfiguration"],function(e,t){function i(t,n){e.fireEvent(e.list().BROADCAST_VIDEO,{source:t,channel:n})}function s(){setTimeout(function(){},24300+Math.random()*12400)}function o(){var e=n.cats.funnyCat,t="hud";for(var r in n)if(Math.random()<.2){t=r;for(var o in n[t])Math.random()<.5&&(e=n[t][o])}i(e,t),s()}var n=t.VIDEOS.sources,r=t.VIDEOS.channels;return{broadcastVideo:i,playRandom:o}}),define("game/ships/Boat",["game/world/PhysicalWorld","application/EventManager","goo/math/Vector3","game/player/PlayerPieceHandler","game/GameConfiguration","game/ModelDefinitions","game/world/LevelController","3d/GooJointAnimator","game/GameUtil"],function(e,t,n,r,i,s,o,u,a){var f=new n,l=function(n,r){this.wakes=r.wakes;var i=this;this.passengers={};var s=function(n){i.entity=n,n.pieceData=r,e.registerPhysicalEntity(n),n.combat.hitPoints=r.hitPoints,n.combat.destroyed=function(e){};var s=function(e){n.geometries[0]=e,e.animationComponent&&u.printClipInitialTransform(n),n.spatial.velocity.data[2]=.3*(Math.random()-.5),n.spatial.velocity.data[0]=.3*(Math.random()-.5)};t.fireEvent(t.list().BUILD_GOO_GAMEPIECE,{projPath:"bundles",modelPath:r.piecePath,callback:s})};t.fireEvent(t.list().ADD_GAME_ENTITY,{entityId:n,callback:s})};return l.prototype.setHostileTarget=function(e){for(var t=0;t<this.entity.turrets.length;t++)this.entity.turrets[t].setTargetEntity(e)},l.prototype.abandonShip=function(){for(var e=0;e<this.entity.turrets.length;e++)this.entity.turrets[e].disengageTurret();for(var t in this.chimneys)this.chimneys[t].setChimneyIntensity(0);for(t in this.radars)this.radars[t].stopRadar()},l.prototype.pushWakes=function(){var e=this.entity.spatial.speed,n=this.entity.spatial.pos;for(var r in this.wakes)if(Math.random()+.03<e*.5){f.set(this.wakes[r].posOffset);var i=Math.random()*this.wakes[r].spread;f.data[2]+=f.data[2]*i,f.data[0]+=f.data[0]*-i;var s=a.applyRotationToVelocity(this.entity.geometries[0],f);s.addv(n),r==0||r==1?(t.fireEvent(t.list().SPLASH_RINGLET,{pos:[s.data[0],s.data[1]+1.4,s.data[2]],count:1,dir:[0,0,0]}),t.fireEvent(t.list().SPLASH_FOAM,{pos:[s.data[0]+(Math.random()-.5)*15,s.data[1]+1.4,s.data[2]+(Math.random()-.5)*15],count:1,dir:[(Math.random()-.5)*.6,0,(Math.random()-.5)*.6]})):t.fireEvent(t.list().SPLASH_WATER,{pos:[s.data[0],s.data[1],s.data[2]],count:1,dir:[Math.random()-.5,-1.2+Math.random(),Math.random()-.5]})}},l.prototype.setPassengerParkingLot=function(e,t){var r=new n(t.posOffset);e.spatial.pos.data[1]=t.posOffset[1],e.spatial.rot.fromAngles(t.rot[0],t.rot[1],t.rot[2]),this.passengers[e.id]={entity:e,posOffset:r,rot:new n(t.rot)}},l.prototype.removeCatapultThrustFromPlane=function(e){for(var t=0;t<e.systems.engines.length;t++)e.systems.engines[t].maxThrust*=.5},l.prototype.applyCatapultThrustToPlane=function(e){for(var t=0;t<e.systems.engines.length;t++)e.systems.engines[t].maxThrust*=2;e.spatial.velocity.normalize(),e.spatial.velocity.mul(.2);var n=this;setTimeout(function(){n.removeCatapultThrustFromPlane(e)},8e3)},l.prototype.catapultPlane=function(e){var t=this.checkCatapultForLaunch(e),n=this;t?(delete this.passengers[e.id],this.applyCatapultThrustToPlane(e)):(console.log("No launch yet"),setTimeout(function(){n.catapultPlane(e)},3e3))},l.prototype.checkCatapultForLaunch=function(e){return e.systems.engines[0].thrust*1.05>e.systems.engines[0].maxThrust&&e.systems.breaks.currentState<.01?!0:!1},l.prototype.launchPlane=function(e){t.fireEvent(t.list().PILOT_VEHICLE,{pilot:this.entity.pilot,vehicle:e}),this.entity.pilot=null;var n=this;setTimeout(function(){n.catapultPlane(e)},3e3)},l.prototype.setPassengerToReady=function(e){this.setPassengerParkingLot(e,this.entity.pieceData.parkingLots.launch);var t=this;setTimeout(function(){t.launchPlane(e)},3e3)},l.prototype.attachPassenger=function(e,n){this.setPassengerParkingLot(e,n),console.log("Attach passenger:",e.id),e.spatial.velocity.mul(.2);var i=e.pilot,s=this.entity,o=this;r.removePlayerControlFrom(e),setTimeout(function(){},500),setTimeout(function(){t.fireEvent(t.list().PILOT_VEHICLE,{pilot:i,vehicle:o.entity}),e.pilot=null,setTimeout(function(){o.setPassengerToReady(e)},6e3)},2500)},l.prototype.updatePassenger=function(e){f.set(e.posOffset),this.entity.spatial.rot.applyPost(f),f.add(this.entity.spatial.pos),e.entity.spatial.pos.data[0]=f.data[0],e.entity.spatial.pos.data[2]=f.data[2];var t=this.entity.spatial.rot.toAngles();t.add(e.rot),e.entity.spatial.rot.fromAngles(e.rot.data[0],t.data[1],e.rot.data[2])},l.prototype.updateBoat=function(){var e=this.entity;for(var t in e.turrets)u.updateEntityBoneRotX(e,e.turrets[t].pivotBoneId,e.turrets[t].direction),u.updateEntityBoneRotX(e,e.turrets[t].elevateJointId,e.turrets[t].elevation),e.turrets[t].updateTurretState();for(t in e.chimneys)e.chimneys[t].updateChimney();for(t in e.radars)e.radars[t].updateRadar();for(t in e.flags)e.flags[t].updateFlag();for(t in this.passengers)this.updatePassenger(this.passengers[t]);this.helmsman.updateHelmsman(),this.pushWakes()},l}),define("game/ships/Helmsman",["application/EventManager","game/GameUtil","goo/math/Vector3","goo/math/Matrix3x3"],function(e,t,n,r){var i=new n,s=new n,o=function(e,t){this.boat=e,this.entity=e.entity,this.navPoint=new n(this.entity.spatial.pos),this.nextNavPoint=new n(this.entity.spatial.pos),this.steerMat=new r,this.targetSpeed=new n(0,0,.1)};return o.prototype.setNavPoint=function(e){this.nextNavPoint.data[0]==0&&this.nextNavPoint.data[2]==0&&this.navPoint.set(e),this.nextNavPoint.set(e)},o.prototype.checkNavPointSwitch=function(){i.set(this.navPoint),i.sub(this.entity.spatial.pos),i.lengthSquared()<1e5&&(console.log("switchNavPoint",this.entity.id,this.nextNavPoint.data,this.navPoint.data),this.navPoint.set(this.nextNavPoint))},o.prototype.updateHelmsman=function(){this.checkNavPointSwitch(),i.set(this.entity.spatial.pos),i.sub(this.navPoint),this.steerMat.lookAt(i,n.UNIT_Y),s.set(this.targetSpeed),this.steerMat.applyPost(s),this.entity.spatial.velocity.lerp(s,5e-4)},o}),define("game/ships/ShipsCaptain",["application/EventManager"],function(e){var t;require(["game/world/LevelController"],function(e){t=e});var n=function(e){this.boat=e,this.target={},this.navIndex=0,this.updateCaptainsOrders()};n.prototype.setTargetEntity=function(e){this.target=e,this.boat.setHostileTarget(e)},n.prototype.orderClearTargets=function(){this.target=null,this.boat.setHostileTarget(this.target)},n.prototype.orderAbandonShip=function(){this.boat.abandonShip()},n.prototype.determineTargets=function(){this.updateCaptainsOrders();var e=t.getBoats();for(var n in e)if(e[n].entity.id!=this.boat.entity.id){if(e[n].entity.id==this.target.id)return;if(e[n].entity.combat.isAlive==0){this.orderClearTargets();return}this.setTargetEntity(e[n].entity);return}};var r=[[5600,0,1e3],[5200,0,4e3],[7600,0,5e3],[6600,0,100],[8100,0,1e3],[8100,0,4e3],[7100,0,1500],[7100,0,3e3]];return n.prototype.updateNavPoint=function(){var e=Math.floor(Math.random()*r.length);if(e==this.navIndex){this.updateNavPoint();return}this.navIndex=e,this.boat.helmsman.setNavPoint(r[e])},n.prototype.updateCaptainsOrders=function(){if(this.boat.entity.combat.isAlive==0){this.orderAbandonShip();return}this.updateNavPoint();var e=this;setTimeout(function(){e.determineTargets()},28e3+Math.random()*12e3)},n}),define("game/weapons/ShipCannon",["game/GameConfiguration","game/weapons/Bullet","game/GameUtil","application/EventManager","goo/math/Vector3"],function(e,t,n,r,i){var s=function(e,t,n,r){console.log(t),this.boatEntity=e,this.name=t.name,this.data=t,this.posOffset=n,this.bulletData=r,this.currentState=0,this.cooldownTime=1e3/this.data.rateOfFire,this.targetState=0,this.firing=!1,this.flameEffect=null,this.smokeEffect=null,this.fireSounds={},this.turretRot=this.boatEntity.geometries[0].transformComponent.transform.rotation.clone()};return s.prototype.playFireSound=function(e,t){var n=Math.floor(Math.random()*this.data.onFireSounds.length);r.fireEvent(r.list().ONESHOT_AMBIENT_SOUND,{soundData:r.sound()[this.data.onFireSounds[n]],pos:e,vel:this.boatEntity.spatial.velocity.data,dir:t.data})},s.prototype.createBullet=function(s,o,u){var a=new i;a.setv(this.boatEntity.spatial.visualPos);var f=n.applyRotationToVelocity(this.boatEntity.geometries[0],new i(this.posOffset));a.addv(f);var l=new i(0,0,this.data.exitVelocity*(1/e.RENDER_SETUP.physicsFPS));this.turretRot.copy(this.boatEntity.spatial.rot),this.turretRot.rotateY(s),this.turretRot.rotateX(-o),l=this.turretRot.applyPost(l),new t(a,l,this.bulletData,this.data,u,this.boatEntity.id),this.playFireSound(a.data,l);for(var c in this.data.onFireEffects)r.fireEvent(r.list()[c],{pos:[a.data[0],a.data[1],a.data[2]],count:this.data.onFireEffects[c].count,dir:[l.data[0],l.data[1],l.data[2]]})},s.prototype.fire=function(e,t,n){this.createBullet(e,t,n)},s.prototype.sequenceShot=function(e){var t=function(){this.fire()}.bind(this);r.fireEvent(r.list().SEQUENCE_CALLBACK,{callback:t,wait:e})},s}),define("physics/TrajectoryPhysics",["game/GameConfiguration"],function(e){var t=-e.WORLD_PROPERTIES.gravity[1],n=function(e,n,r){var i=e,s=n,o=r,u=.5*Math.asin(t*s/(i*i));return u},r=function(e,n){return n*n*Math.sin(2*e)/t},i=function(e,n,r){var i=n,s=e,o=r;if(s>Math.PI/2||s<0||i<0)return!1;var u=t,a=i*Math.cos(s),f=i*Math.sin(s),l=o+f*f/(2*u);if(l<0)return!1;var c=f/u,h=Math.sqrt(2*l/u),p=a*(c+h),d=c+h,v=Math.sqrt(u*h*u*h+a*a);return p};return{calcDistanceAtElevationVelocityAndHeight:i,calcDistanceAtElevationAndVelocity:r,calcElevationForTrajectory:n}}),define("game/weapons/Turret",["application/EventManager","goo/math/Vector3","game/GameConfiguration","game/weapons/ShipCannon","game/weapons/WeaponData","physics/TrajectoryPhysics","game/GameUtil"],function(e,t,n,r,i,s,o){var u=function(e,n){this.calcVec=new t,this.targets=n.targets,this.baseRot=n.baseRot,this.basePos=n.posOffset,this.shipEntity=e,this.pivotBoneId=n.bonePivot,this.elevateJointId=n.boneElevate,this.swivel=n.swivel,this.speed=n.speed,this.direction=0,this.elevation=0,this.ready=!0,this.cannon=new r(this.shipEntity,n.cannonData,n.posOffset,n.bulletData),this.targetEntity=null,this.lastDiff=[0,0,0],this.lastAimDelta=[0,0,0],this.targetAimDelta=[0,0,0],this.elevationReady=!1,this.swivelReady=!1,this.aimParams={sidewaysness:0,boostElevation:0,targetDistance:1e3,shotRange:1e3,hitDistance:1e3,newElevation:0,newSwivel:0},this.states={idle:"idle",loading:"loading",waiting:"waiting",aiming:"aiming",ready:"ready"},this.currentState=this.states.idle};return u.prototype.loadTurret=function(){var t=this,n=function(){t.currentState=t.states.aiming};e.fireEvent(e.list().SEQUENCE_CALLBACK,{callback:n,wait:1e3/this.cannon.data.rateOfFire+Math.random()*200/this.cannon.data.rateOfFire})},u.prototype.handleTurretStateUpdate=function(){if(!this.shipEntity.combat.isAlive)return;this.targetEntity?this.targetEntity.combat.isAlive||this.disengageTurret():this.disengageTurret();switch(this.currentState){case this.states.idle:this.aimParams.newElevation=.4,this.aimParams.newSwivel=0,Math.round(this.direction*2e3)!=Math.round(this.aimParams.newSwivel*2e3)?(this.adjustSwivelAngle(),this.swivelReady=!1):(this.swivelReady=!0,Math.round(this.elevation*2e3)!=Math.round(this.aimParams.newElevation*2e3)?(this.adjustElevationAngle(),this.elevationReady=!1):this.elevationReady=!0);break;case this.states.loading:this.loadTurret(),this.currentState=this.states.waiting;break;case this.states.waiting:this.aimTurret();break;case this.states.aiming:if(Math.abs(this.aimParams.newSwivel)>Math.abs(this.swivel)&&Math.abs(this.aimParams.newSwivel-2*Math.PI)>Math.abs(this.swivel)){console.log("Out of angle");var t=this,n=function(){t.currentState=t.states.aiming};e.fireEvent(e.list().SEQUENCE_CALLBACK,{callback:n,wait:5e3}),this.currentState=this.states.waiting;return}Math.round(this.direction*2e3)!=Math.round(this.aimParams.newSwivel*2e3)?(this.adjustSwivelAngle(),this.swivelReady=!1):(this.swivelReady=!0,Math.round(this.elevation*2e3)!=Math.round(this.aimParams.newElevation*2e3)?(this.adjustElevationAngle(),this.elevationReady=!1):this.elevationReady=!0),this.elevationReady&&this.swivelReady&&(this.currentState=this.states.ready);break;case this.states.ready:this.fireTurret()}},u.prototype.adjustElevationAngle=function(){var e=this.aimParams.newElevation-this.elevation;this.setElevationAngle(this.elevation+e*.08)},u.prototype.adjustSwivelAngle=function(){var e=this.aimParams.newSwivel-this.direction;this.setPivotAngle(this.direction+e*.06)},u.prototype.setPivotAngle=function(e){this.direction=e},u.prototype.setElevationAngle=function(e){this.elevation=e},u.prototype.setTargetEntity=function(e){e?(this.currentState=this.states.loading,this.targetEntity=e):this.disengageTurret()},u.prototype.disengageTurret=function(){this.currentState=this.states.idle,this.targetEntity=null},u.prototype.fireTurret=function(){var e=this,t=function(e,t){var n=e.pos;switch(t){case"water":break;case"nothing":}};this.cannon.fire(this.direction+this.baseRot,this.elevation,t),this.currentState=this.states.loading},u.prototype.aimTurret=function(){var e=.2*Math.random(),t=this,n=this.targetEntity.spatial.pos,r=this.shipEntity.spatial.pos,i=this.shipEntity.spatial.rot.toAngles(),u=this.calcVec.setv(n),a=this.basePos;u.subv(r);var f=Math.sqrt(u.lengthSquared()),l=s.calcElevationForTrajectory(t.cannon.data.exitVelocity,f,n.data[1]-r.data[1])+e*(Math.random()-.5);if(isNaN(l))return;t.aimParams.newSwivel=o.determineYAngleFromPosAndRotToPos(r.data,[i.data[0]+e*(Math.random()-.5),i.data[1]+t.baseRot+e*(Math.random()-.5),i.data[2]+e*(Math.random()-.5)],n.data),t.aimParams.newElevation=l},u.prototype.updateTurretState=function(){this.handleTurretStateUpdate()},u}),define("game/ships/Chimney",["application/EventManager","game/GameUtil","goo/math/Vector3"],function(e,t,n){var r=new n,i=function(e,t){this.boat=e,this.puffIntensity=.01,this.posOffset=t.posOffset};return i.prototype.setChimneyIntensity=function(e){this.puffIntensity=e},i.prototype.updateChimney=function(){if(Math.random()<this.puffIntensity){var n=this.boat.spatial.pos;r.set(this.posOffset);var i=t.applyRotationToVelocity(this.boat.geometries[0],r);i.addv(n),e.fireEvent(e.list().PUFF_BLACK_SMOKE,{pos:[i.data[0],i.data[1],i.data[2]],count:1,dir:[Math.random()-.5,1+Math.random(),Math.random()-.5]})}},i}),define("game/ships/Radar",["3d/GooJointAnimator"],function(e){var t=function(e,t){this.boat=e,this.pivotBoneId=t.bonePivot,this.rotVel=t.rotVel,this.direction=0};return t.prototype.stopRadar=function(){this.rotVel=0},t.prototype.updateRadar=function(){this.direction+=this.rotVel,e.updateEntityBoneRotX(this.boat,this.pivotBoneId,this.direction)},t}),define("game/ships/Flag",["3d/GooJointAnimator"],function(e){var t=function(e,t){this.boat=e,this.baseBone=t.baseBone,this.flapBone=t.flapBone,this.flapFreq=t.flapFreq,this.direction=0,this.posY=0};return t.prototype.updateFlag=function(){this.direction+=this.flapFreq*.02,e.updateEntityBoneRotX(this.boat,this.baseBone,.3*Math.sin(this.direction+Math.cos(this.direction*.5))),e.updateEntityBoneRotX(this.boat,this.flapBone,.6*Math.sin(this.direction+(.5+Math.cos(this.direction*.4)*.4)))},t}),define("game/ships/BoatFactory",["application/EventManager","game/ships/Boat","game/ships/Helmsman","game/ships/ShipsCaptain","game/weapons/Turret","game/ships/Chimney","game/ships/Radar","game/ships/CarrierCable","game/ships/Flag"],function(e,t,n,r,i,s,o,u,a){var f=function(e,t){e.turrets=[];for(var n=0;n<t.turrets.length;n++)e.turrets.push(new i(e,t.turrets[n]))},l=function(e,t){e.chimneys=[];for(var n=0;n<t.chimneys.length;n++)e.chimneys.push(new s(e,t.chimneys[n]))},c=function(e,t){e.radars=[];for(var n=0;n<t.radars.length;n++)e.radars.push(new o(e,t.radars[n]))},h=function(e,t){e.flags=[];for(var n=0;n<t.flags.length;n++)e.flags.push(new a(e,t.flags[n]))},p=function(e,t){e.helmsman=new n(e)},d=function(e,t){var n={};for(var r=0;r<t.physicalShapes.length;r++)t.physicalShapes[r].partId=="cable"&&(n[t.physicalShapes[r].cableNr]=new u(e,t.physicalShapes[r].cableNr));e.entity.cables=n},v=function(e,n){var i=new t(e,n);return f(i.entity,n),l(i.entity,n),c(i.entity,n),h(i.entity,n),p(i,n),d(i,n),new r(i),i};return{buildShip:v}}),define("game/parts/Display",["application/EventManager","goo/renderer/Texture"],function(e,t){var n=function(e,t,n){return this.id=e,this.mapcoords=t,this.materialMap=n,this.intensity=1,this.instruments={},this};return n.prototype.setIntensity=function(e){this.intensity=e},n.prototype.attenuate=function(e){var t=this.mapcoords,n=this.materialMap.ctx,r=1-(this.intensity*e+Math.random()*.03);n.fillStyle="rgba(0, 0, 0, "+r+")",n.globalCompositeOperation="source-over",n.fillRect(t[0]-t[2]*.5,t[1]-t[3]*.5,t[2],t[3]),this.materialMap.emissiveMap.setNeedsUpdate()},n.prototype.registerInstrument=function(e,t){this.instruments[e]=t},n.prototype.updateInstruments=function(){for(var e in this.instruments)this.instruments[e].updateInstrument()},n}),define("game/parts/ScreenSystem",["application/EventManager","goo/renderer/Texture"],function(e,t){var n=function(e){this.entity=e,this.displays={},this.masterIntensity=1};return n.prototype.addDisplay=function(e){if(this.displays[e.id])return;this.displays[e.id]=e},n.prototype.setMasterIntensity=function(e){this.masterIntensity=e},n.prototype.attenuateIntensity=function(){for(var e in this.displays)this.displays[e].attenuate(this.masterIntensity)},n.prototype.updateDisplays=function(){for(var e in this.displays)this.displays[e].updateInstruments()},n}),define("game/instruments/HudLadder",[],function(){function t(e,t){var n=t.txcoords,r=t.display.materialMap.emitImg,i=t.display.materialMap.ctx;i.globalCompositeOperation="lighter";var s=n[0],o=n[1],u=e.instruments.horizon.getValue();if(!u)return;var a=e.instruments.roll_indicator.getValue()*e.instruments.roll_indicator.axisAmp;i.translate(s,o),i.rotate(a);var f=200,l=16,c=f*u.data[2],h=5,p=Math.ceil(c/(l*.5));for(var d=p;d<h+p;d++){var v=c-l*(d-h*.5),m=c-l*(d+p*.5-h*.5);if(Math.abs(m)<l*.5)var g=t.sources.flat;else if(m<0)var g=t.sources.up;else var g=t.sources.down;var y=c+v;i.drawImage(r,g[0],g[1],g[2],g[3],-g[2]*.5,y-g[3]*.5,g[2],g[3])}i.rotate(-a),i.translate(-s,-o);var g=t.sources.origin;i.drawImage(r,g[0],g[1],g[2],g[3],s-g[2]*.5,o-3-g[3]*.5,g[2],g[3])}var e=function(e,t,n){return this.entity=e,this.display=t,this.txcoords=n.txcoords,this.sources=n.sources,this};return e.prototype.updateInstrument=function(){t(this.entity,this)},e}),define("game/instruments/VdiLadder",[],function(){function t(e,t){var n=t.txcoords,r=t.display,i=t.display.materialMap.emitImg,s=t.display.materialMap.ctx,o=.15+Math.random()*.25,u=35+Math.random()*10;s.fillStyle="rgba(5, "+Math.floor(u)+", 5, "+o+")",s.globalCompositeOperation="source-over",s.fillRect(n[0]-n[2]*.5,n[1]-n[3]*.5,n[2],n[3]),s.globalCompositeOperation="lighter";var a=n[0],f=n[1],l=e.instruments.horizon.getValue();if(!l)return;var c=e.instruments.roll_indicator.getValue()*e.instruments.roll_indicator.axisAmp;s.translate(a,f),s.rotate(c);var h=200,p=35,d=h*l.data[2],v=7,m=Math.ceil(d/(p*.5)),g=!0;for(var y=m;y<v+m;y++){var b=d-p*(y-v*.5),w=d-p*(y+m*.5-v*.5),E=d+b;if(Math.abs(w)<p*.5){var S=t.sources.flat;s.fillStyle="rgba(0, 15, 0, 0.55)";var E=d+b,x=[n[0]-n[2]*.5,n[1]+n[3]*.5,n[2],n[3]];s.fillRect(-x[2]*.5-30,-x[3]*.5-.5,x[2]+60,x[3]*.5+E*1),s.globalCompositeOperation="lighter",s.drawImage(i,S[0],S[1],S[2],S[3],-S[2]*.8,E-S[3]-.5,S[2]*1.6,S[3]),g=!1}else if(w<0){var S=t.sources.up;s.drawImage(i,S[0],S[1],S[2],S[3],-S[2]*.5,E-S[3]*.5,S[2],S[3])}else{g=!1;var S=t.sources.down;s.drawImage(i,S[0],S[1],S[2],S[3],-S[2]*.5,E-S[3]*.5,S[2],S[3])}}s.rotate(-c),s.translate(-a,-f),S=t.sources.origin,s.drawImage(i,S[0],S[1],S[2],S[3],a-S[2]*.5,f+5-S[3]*.5,S[2],S[3]),S=t.sources.o_line,s.drawImage(i,S[0],S[1],S[2],S[3],a-n[2]*.5+18,f+4-S[3]*.5,S[2],S[3]),s.drawImage(i,S[0],S[1],S[2],S[3],a+n[2]*.5-40,f+4-S[3]*.5,S[2],S[3]),g&&(s.fillRect(n[0]-n[2]*.5,n[1]-n[3]*.5,n[2],n[3]),s.globalCompositeOperation="lighter")}var e=function(e,t,n){return this.entity=e,this.display=t,this.txcoords=n.txcoords,this.sources=n.sources,this};return e.prototype.updateInstrument=function(){t(this.entity,this)},e}),define("game/parts/CanvasDigit",[],function(){function i(r,i,s){e=r,t=i,n=s}function s(t){return e[t]}function o(e,i,o){for(var u=0;u<e.length;u++)r=s(e[u]),n.drawImage(t,r[0],r[1],r[2],r[3],u*6+i-r[2]*.5,-3+o-r[3]-.5,r[2],r[3])}var e,t,n,r;return{setSourceData:i,drawNumberToContextCoordinate:o}}),define("game/instruments/CompassTape",["game/parts/CanvasDigit"],function(e){var t=function(e,t,n){return this.entity=e,this.display=t,this.data=n,this.txcoords=n.txcoords,this.sources=n.sources,this.coordX=this.data.txcoords[0],this.coordY=this.data.txcoords[1],this.img=this.display.materialMap.emitImg,this.ctx=this.display.materialMap.ctx,this};return t.prototype.updateInstrument=function(){this.updateCompassTape(this.entity.instruments.gyro_compass.getValue())},t.prototype.updateCompassTape=function(t){var n=115,r=24,i=n*-t,s=this.data.lines,o=Math.ceil(i/(r*.5));e.setSourceData(this.sources,this.img,this.ctx);var u=0;for(var a=o;a<s+o;a++){var f=i-r*(a-s*.5),l=i-r*(a+o*.5-s*.5),c=this.sources.dots,h=i+f;this.ctx.drawImage(this.img,c[0],c[1],c[2],c[3],this.coordX+h-c[2]*.5,this.coordY-c[3]-.5,c[2],c[3]);var p=""+Math.abs(Math.round(l*3)*10);u<s-1&&u!=0&&(p=="0"&&(p="00"),e.drawNumberToContextCoordinate([p[0],p[1]],this.coordX-4+h,-3+this.coordY)),u+=1}},t}),define("game/instruments/HsiRotation",[],function(){function t(e,t){var n=t.data.txcoords,r=t.display.materialMap.emitImg,i=t.display.materialMap.ctx,s=.15+Math.random()*.25,o=35+Math.random()*10;i.fillStyle="rgba(5, "+Math.floor(o)+", 5, "+s+")",i.globalCompositeOperation="source-over",i.fillRect(n[0]-n[2]*.5,n[1]-n[3]*.5,n[2],n[3]),i.globalCompositeOperation="lighter";var u=n[0],a=n[1];i.translate(u,a);var f=t.data.sources.circles;i.drawImage(r,f[0],f[1],f[2],f[3],-f[2]*.5,-f[3]*.5,f[2],f[3]),i.translate(-u,-a)}var e=function(e,t,n){return this.entity=e,this.display=t,this.data=n,this.txcoords=n.txcoords,this.sources=n.sources,this};return e.prototype.updateInstrument=function(){t(this.entity,this)},e}),define("game/instruments/ScreenDigits",["game/parts/CanvasDigit"],function(e){var t=function(e,t,n){return this.entity=e,this.display=t,this.data=n,this.txcoords=n.txcoords,this.coordX=this.data.txcoords[0],this.coordY=this.data.txcoords[1],this.sources=n.sources,this.img=this.display.materialMap.emitImg,this.ctx=this.display.materialMap.ctx,this};return t.prototype.sampleSourceValue=function(){return this.entity.instruments[this.data.sourceValue].getValue()},t.prototype.updateScreenDigits=function(t){if(t<1)return;e.setSourceData(this.data.sources,this.img,this.ctx),e.drawNumberToContextCoordinate(""+Math.round(t),this.coordX,this.coordY)},t.prototype.updateInstrument=function(){this.updateScreenDigits(this.sampleSourceValue())},t}),define("game/instruments/RulerGauge",[],function(){function t(e,t){var n=e.data.txcoords,r=e.display.materialMap.emitImg,i=e.display.materialMap.ctx,s=n[0],o=n[1],u=e.data.scaleFactor,a=u*-t,f=e.data.sources.ruler;i.drawImage(r,f[0],f[1],f[2],f[3],s-f[2]*.5,o-f[3]*.5,f[2],f[3]);var l=a,c=e.data.sources.arrow;i.drawImage(r,c[0],c[1],c[2],c[3],s+e.data.xOffset-c[2]*.5,o+l-c[3]*.5,c[2],c[3])}var e=function(e,t,n){return this.entity=e,this.display=t,this.data=n,this.txcoords=n.txcoords,this.sources=n.sources,this};return e.prototype.sampleSourceValue=function(){return this.entity.instruments[this.data.sourceValue].getValue()},e.prototype.updateInstrument=function(){t(this,this.sampleSourceValue())},e}),define("game/instruments/VideoPlayer",["application/EventManager"],function(e){function n(e){var t=e.data.txcoords,n=e.video,r=e.display.materialMap.ctx,i=t[0],s=t[1],o=e.data.sources.video,u=n.videoWidth,a=n.videoHeight,f=u/a,l=i-t[2]*.5,c=s-t[3]*.5,h=t[2],p=t[3]/f,d=t[3]-p;c+=d*.5,r.drawImage(n,o[0],o[1],u,a,l,c,h,p)}var t=function(t,n,r){this.entity=t,this.display=n,this.data=r,this.txcoords=r.txcoords,this.sources=r.sources;var i=function(t){e.eventArgs(t).channel==this.data.channel&&this.streamVideoSource(e.eventArgs(t).source)}.bind(this);return e.registerListener(e.list().BROADCAST_VIDEO,i),this};return t.prototype.streamVideoSource=function(e){this.active&&this.stopVideo();var t=document.createElement("video");t.width=128,t.height=128;var n=function(){this.stopVideo()}.bind(this);t.addEventListener("ended",function(){n()}),this.video=t,this.active=!0,this.video.src=e,this.video.play(),this.video.volume=.01},t.prototype.stopVideo=function(){this.active=!1,this.video.pause(),this.video=null},t.prototype.sampleSourceValue=function(){return this.entity.instruments[this.data.sourceValue].getValue()},t.prototype.updateInstrument=function(){this.active?n(this):Math.random()<.004&&this.streamVideoSource(this.data.video)},t}),define("game/instruments/InstrumentScripts",["game/instruments/HudLadder","game/instruments/VdiLadder","game/instruments/CompassTape","game/instruments/HsiRotation","game/instruments/ScreenDigits","game/instruments/RulerGauge","game/instruments/VideoPlayer"],function(e,t,n,r,i,s,o){var u=function(t,n,r){return new e(t,n,r)},a=function(e,n,r){return new t(e,n,r)},f=function(e,t,r){return new n(e,t,r)},l=function(e,t,n){return new r(e,t,n)},c=function(e,t,n){return new i(e,t,n)},h=function(e,t,n){return new s(e,t,n)},p=function(e,t,n){return new o(e,t,n)};return{HudLadder:u,VdiLadder:a,CompassTape:f,HsiRotation:l,ScreenDigits:c,RulerGauge:h,VideoPlayer:p}}),define("game/parts/Screens",["application/EventManager","goo/renderer/Texture","game/parts/Display","game/parts/ScreenSystem","game/instruments/InstrumentScripts"],function(e,t,n,r,i){function l(e,t){var o={};e.screens=o,e.screenMaterialMap=c(e,t),e.screenSystem=new r(e),console.log("Register entity screens: ",e,t);for(var a in t.displays){s+=1;if(!e.screenSystem.displays[a]){var f=new n(a,t.displays[a].mapcoords,e.screenMaterialMap);u[a]=f;for(var l in t.displays[a].instruments){var h=t.displays[a].instruments[l];h.script&&f.registerInstrument(l,i[h.script](e,f,h))}e.screenSystem.addDisplay(f)}}}function c(e,n){var r=e.geometries[0].transformComponent.children;for(var i=0;i<r.length;i++){var s=r[i].entity;for(var o=0;o<n.meshData.length;o++)if(s.name==n.meshData[o].meshEntityName){var u=s.meshRendererComponent.materials;for(var a=0;a<u.length;a++)if(u[a]._textureMaps.EMISSIVE_MAP&&u[a]._textureMaps.EMISSIVE_MAP.image){console.log(u[a].name);var f,l,c;e.lights&&e.lightsMaterialMap.meshEntity.name==s.name&&(l=e.lightsMaterialMap.canvas,f=e.lightsMaterialMap.emitImg,c=e.lightsMaterialMap.emissiveMap),l||(f=u[a]._textureMaps.EMISSIVE_MAP.image,l=document.createElement("canvas"),l.id=s.name+"_canvas",l.width=f.naturalWidth,l.height=f.naturalHeight,l.dataReady=!0,c=new t(l,null,l.width,l.height),u[a].setTexture("EMISSIVE_MAP",c));var h={meshRef:s.name,meshEntity:s,material:u[a],emissiveMap:c,diffuseMap:u[a]._textureMaps.DIFFUSE_MAP,emitImg:f,canvas:l,ctx:l.getContext("2d")};return h}}}}function h(e){if(!e.instruments)return;e.screenSystem.updateDisplays(),e.screenSystem.attenuateIntensity()}var s=0,o={},u={},a={},f=function(e){return u[e]};return{registerEntityScreens:l,getDisplay:f,updateEntityScreenState:h}}),define("game/parts/Vehicle",["game/world/PhysicalWorld","application/EventManager","game/parts/Lights","game/parts/Screens","3d/GooJointAnimator"],function(e,t,n,r,i){var s=function(s,o){var u=this,a=function(s){u.entity=s,s.pieceData=o,e.registerPhysicalEntity(s),s.combat.hitPoints=s.pieceData.hitPoints,s.combat.destroyed=function(e){};var a=function(e){s.geometries[0]=e,i.printClipInitialTransform(s),s.spatial.velocity.data[2]=.3*(Math.random()-.5),s.spatial.velocity.data[0]=.3*(Math.random()-.5),o.lights&&n.registerEntityLights(s,o.lights),o.screens&&r.registerEntityScreens(s,o.screens)};t.fireEvent(t.list().BUILD_GOO_GAMEPIECE,{projPath:s.pieceData.gooProjectUrl,modelPath:s.pieceData.piecePath,callback:a})};t.fireEvent(t.list().ADD_GAME_ENTITY,{entityId:s,callback:a})};return s}),define("game/planes/Plane",["game/parts/Vehicle"],function(e){var t=function(t,n){return new e(t,n)};return t}),define("game/planes/PlaneFactory",["game/planes/Plane"],function(e){var t=function(t,n){var r=new e(t,n);return console.log("BUILD PLANE:",r),r};return{buildPlane:t}}),define("game/movement/sphereMovement",["goo/math/Vector3"],function(e){function n(){this.jumpPower=8,this.jumpImpulse=this.jumpPower,this.modRun=4,this.modBack=2,this.modStrafe=3,this.groundContact=!0,this.targetVelocity=new e,this.targetHeading=new e,this.acceleration=new e,this.torque=new e,this.groundHeight=0,this.groundNormal=new e,this.controlState={run:0,strafe:0,jump:0,yaw:0,roll:0,pitch:0}}var t=new e;n.prototype.applyForward=function(e){this.controlState.run=e},n.prototype.applyStrafe=function(e){this.controlState.strafe=e},n.prototype.applyJump=function(e){this.controlState.jump=e},n.prototype.applyTurn=function(e){this.controlState.yaw=e};var r;return n.prototype.applyJumpImpulse=function(e){var t=function(){this.jumpImpulse=this.jumpPower}.bind(this);return this.groundContact&&(this.controlState.jump?(clearTimeout(r),e=this.jumpImpulse,this.jumpImpulse=0,this.controlState.jump=0,this.groundContact=!1,r=setTimeout(function(){t()},200)):e=0),e},n.prototype.applyDirectionalModulation=function(e,t){return e*=this.modStrafe,t<0?t*=this.modBack:t*=this.modRun,[e,this.applyJumpImpulse(0),t]},n.prototype.updateTargetVectors=function(){this.targetVelocity.set(this.applyDirectionalModulation(this.controlState.strafe,this.controlState.run)),this.targetHeading.set(this.controlState.pitch,this.controlState.yaw,this.controlState.roll)},n.prototype.getTargetVelocity=function(){return this.targetVelocity},n.prototype.getTargetHeading=function(){return this.targetHeading},n}),define("game/movement/sphereSpatial",["game/movement/sphereMovement"],function(e){function t(t){this.torqueVector=new Ammo.btVector3(0,0,0),this.sphereEntity=t,this.ammoComponent=this.sphereEntity.ammoComponent,this.sphereMovement=new e,this.timeout}return t.prototype.applyMovementState=function(e){switch(e){case 1:this.sphereMovement.applyForward(Math.round(1-Math.random()*2));break;case 2:this.sphereMovement.applyStrafe(Math.round(1-Math.random()*2));break;case 3:this.sphereMovement.applyJump(1);break;case 4:this.sphereMovement.applyTurn(1-Math.random()*2)}},t.prototype.selectMovementState=function(){return Math.ceil(Math.random()*4)},t.prototype.remove=function(){clearTimeout(this.timeout)},t.prototype.walk=function(){this.applyMovementState(this.selectMovementState()),this.sphereMovement.updateTargetVectors();var e=this.sphereMovement.getTargetVelocity();this.torqueVector.setValue(0,0,0),this.ammoComponent.setAngularVelocity(this.torqueVector),this.torqueVector.setValue(e.data[0],e.data[1],e.data[2]),this.ammoComponent.clearForces(),this.ammoComponent.applyTorqueImpulse(this.torqueVector),e.data[1]!=0&&(this.torqueVector.setValue(0,e.data[1],0),this.ammoComponent.applyCentralImpulse(this.torqueVector)),this.ammoComponent.activate(),this.update()},t.prototype.setPos=function(e){this.ammoComponent.setTransform()},t.prototype.update=function(){function t(){e.walk()}var e=this;this.timeout=setTimeout(function(){t()},2e3)},t}),define("game/movement/MobileUnits",["goo/entities/EntityUtils","goo/shapes/ShapeCreator","goo/renderer/Material","goo/renderer/shaders/ShaderLib","game/movement/sphereSpatial","physics/PhysicalWorld"],function(e,t,n,r,i,s){function u(e){o=e,s.initPhysics()}function a(e){console.log("DELETE MOBILE UNIT: ",e),s.removeAmmoComponent(e.moveSphere.ammoComponent)}function f(i,u,a){if(a)var f=t.createSphere(16,16,i),l=n.createMaterial(r.simpleLit),c=e.createTypicalEntity(o,f,l);else var c=e.createTypicalEntity(o);return c.ammoComponent=s.createAmmoJSSphere(i,u),c.setComponent(s.createAmmoComponentScript()),c.addToWorld(),c}function l(t,n,r){r.moveSphere=t;var i=r.geometries[0],o=e.createTypicalEntity(n);o.sphereEntity=t,s.attachSphericalMovementScript(o,r),o.transformComponent.attachChild(i.transformComponent),o.transformComponent.transform.translation.set(0,-r.pieceData.dimensions.mobRadius,0),o.transformComponent.setUpdated(),o.addToWorld()}function c(e,t){l(t,o,e);var n=new i(t);t.spatialControl=n}var o;return{deleteMobileUnit:a,setWorld:u,sphericalMobile:f,attachEntityToMobileSphere:c}}),define("game/characters/Character",["game/world/PhysicalWorld","application/EventManager","3d/GooJointAnimator","game/movement/MobileUnits"],function(e,t,n,r){var i=function(i,s,o){var u=this,a=function(i){u.entity=i,console.log("SPHERE POS: ",o),i.pieceData=s,console.log(s),e.registerPhysicalEntity(i),i.combat.hitPoints=i.pieceData.hitPoints;var a=function(e){i.geometries[0]=e,n.printClipInitialTransform(i),i.spatial.pos.set(o),i.spatial.velocity.data[2]=.3*(Math.random()-.5),i.spatial.velocity.data[0]=.3*(Math.random()-.5),r.attachEntityToMobileSphere(i,r.sphericalMobile(s.dimensions.mobRadius,o,!1))};t.fireEvent(t.list().BUILD_GOO_GAMEPIECE,{projPath:i.pieceData.gooProject.projectPath,modelPath:i.pieceData.piecePath,callback:a})};t.fireEvent(t.list().ADD_GAME_ENTITY,{entityId:i,callback:a})};return i}),define("game/characters/CharacterFactory",["game/characters/Character","game/characters/CharacterData"],function(e,t){var n=function(n,r,i){r||(r=t.PILOT);var s=new e(n,r,i);return console.log("BUILD CHARACTER:",s),s};return{buildCharacter:n}}),define("game/cars/Car",["game/parts/Vehicle"],function(e){var t=function(t,n){return new e(t,n)};return t}),define("game/cars/CarFactory",["game/cars/Car"],function(e){var t=function(t,n){var r=new e(t,n);return console.log("BUILD CAR:",r),r};return{buildCar:t}}),define("game/piece/TargetFactory",["game/world/PhysicalWorld","application/EventManager","game/movement/MobileUnits","game/parts/Lights","game/parts/Screens"],function(e,t,n,r,i){var s=function(r,i,s){var o=this,a=function(e){e.spatial.rot.rotateX(Math.random()),e.spatial.rot.rotateY(Math.random()),e.spatial.rot.rotateZ(Math.random()),e.combat.isAlive&&(t.fireEvent(t.list().ANALYTICS_EVENT,{category:"TARGET RANGE",action:"destroyed",labels:r,value:1}),n.deleteMobileUnit(e),setTimeout(function(){o.remove()},500))},f=function(r){o.entity=r,r.pieceData=i,e.registerPhysicalEntity(r),r.combat.hitPoints=r.pieceData.hitPoints,r.combat.destroyed=a;var f=function(e){r.geometries[0]=e,r.spatial.velocity.data[2]=.3*(Math.random()-.5),r.spatial.velocity.data[0]=.3*(Math.random()-.5),console.log("ADD TARGET AT POS: ",s),n.attachEntityToMobileSphere(r,n.sphericalMobile(i.dimensions.mobRadius,s,!1)),i.screens&&u(r,i.screens)};t.fireEvent(t.list().BUILD_GOO_GAMEPIECE,{projPath:r.pieceData.gooProject.projectPath,modelPath:r.pieceData.piecePath,callback:f})};t.fireEvent(t.list().ADD_GAME_ENTITY,{entityId:r,callback:f})},o=function(e,t){console.log("ADD TARGET LIGHTS: ",e),r.registerEntityLights(e,t)},u=function(e,n){for(var r in n.displays){console.log(r,i.getDisplay(r));if(i.getDisplay(r)!=undefined)return}i.registerEntityScreens(e,n),console.log("ADD TARGET SCREENS: ",e),e.instruments="target";var s=function(){i.updateEntityScreenState(e)};t.registerListener(t.list().GOO_TICK,s)},a=function(e){};s.prototype.remove=function(){t.fireEvent(t.list().REMOVE_GAME_ENTITY,{entityId:this.entity.id}),delete this};var f=function(e,t,n){var r=new s(e,t,n);return console.log("BUILD TARGET:",r),r};return{buildTarget:f}}),define("game/world/SpawnSystem",["application/EventManager","game/ships/BoatFactory","game/piece/PieceBuilder","game/planes/PlaneFactory","game/characters/CharacterFactory","game/cars/CarFactory","game/piece/TargetFactory","physics/PhysicalWorld","game/movement/MobileUnits"],function(e,t,n,r,i,s,o,u,a){var f=0,l=0,c=0,h=0,p=0,d=function(t){e.fireEvent(e.list().REGISTER_ACTIVE_ENTITY,{entity:t}),e.fireEvent(e.list().ACTIVATE_GOO_ENTITY,{gooEntity:t.geometries[0],gameEntity:t})},v=function(e,r,i,s,o){l+=1;var a=t.buildShip(e+"_"+l,r);return a.entity.spatial.pos.set(i),a.entity.spatial.rot.fromAngles(s[0],s[1],s[2]),a.entity.spatial.velocity.set(o),n.buildBoatPiece(a.entity,r),d(a.entity),u.createAmmoShapeComponent(a.entity,a.entity.geometries[0]),a},m=function(e,t,r,i,o){c+=1;var u=s.buildCar(e+"_"+c,t);return u.entity.spatial.pos.set(r),u.entity.spatial.rot.fromAngles(i[0],i[1],i[2]),u.entity.spatial.velocity.set(o),n.buildPiece(u.entity,t,1),d(u.entity),u},g=function(e,t,r,i,s){h+=1;var u=o.buildTarget(e+"_"+h,t,r);return u.entity.spatial.rot.fromAngles(i[0],i[1],i[2]),u.entity.spatial.velocity.set(s),n.buildPiece(u.entity,t,1),d(u.entity),u},y=function(e,t,i,s,o,u){p+=1;var a=r.buildPlane(e+"_"+p,t);return a.entity.spatial.pos.set(i),a.entity.spatial.rot.fromAngles(o[0],o[1],o[2]),a.entity.spatial.velocity.set(s),n.buildPiece(a.entity,t,u),d(a.entity),a},b=function(e,t,r,s,o,u){f+=1;var a=i.buildCharacter(e+"_"+f,t,r);return a.entity.spatial.rot.fromAngles(o[0],o[1],o[2]),a.entity.spatial.velocity.set(s),n.buildHuman(a.entity,a.entity.pieceData,0),d(a.entity),a};return{spawnHuman:b,spawnBoat:v,spawnCar:m,spawnTarget:g,spawnPlane:y}}),define("game/planes/AiPilot",["application/EventManager","game/piece/PieceInputHandler","goo/math/Vector3","goo/math/Matrix3x3","game/GameConfiguration"],function(e,t,n,r,i){var s=new n,o,u=i.RENDER_SETUP.physicsFPS;require(["game/world/LevelController"],function(e){o=e});var a=function(e){this.plane=e,this.target={},this.navpoint=new n,this.targetOrientation=new r,this.virtualInstruments={horizon:new n,rollAngle:0,climbRate:0,speed:0},this.inputValues={headTowards:0,elevate:0,speed:0},this.updatePilot(),this.determineNavPoint()};return a.prototype.setTargetEntity=function(e){this.target=e},a.prototype.requestEject=function(){t.setPieceInputState(this.plane,"throttle",0),t.setPieceInputState(this.plane,"elevator",2*(Math.random()-.5)),t.setPieceInputState(this.plane,"aeilrons",2*(Math.random()-.5)),t.setPieceInputState(this.plane,"rudder",2*(Math.random()-.5))},a.prototype.updateVirtualInstruments=function(){s.setd(0,1,0),this.plane.spatial.rot.applyPre(s),this.virtualInstruments.rollAng=Math.atan2(s.data[0],s.data[1]),this.virtualInstruments.horizon.set(s),this.virtualInstruments.altitude=this.plane.spatial.pos.data[1],this.virtualInstruments.climbRate=this.plane.spatial.velocity.data[1]*u,this.virtualInstruments.speed=Math.sqrt(this.plane.spatial.velocity.lengthSquared())},a.prototype.determineNavPoint=function(){this.navpoint.set([-2e3,3e3,600])},a.prototype.climb=function(e){this.inputValues.speed=1,this.inputValues.elevate=e/1e3},a.prototype.dive=function(e){this.inputValues.speed=0,this.inputValues.elevate=e/1e4},a.prototype.determineSteering=function(){s.set(this.navpoint),s.sub(this.plane.spatial.pos),this.targetOrientation.lookAt(s,n.UNIT_Y),s.set(this.targetOrientation.toAngles()),s.sub(this.plane.spatial.rot.toAngles()),this.inputValues.headTowards=Math.atan2(s.data[0],s.data[2]),this.virtualInstruments.altitude<this.navpoint.data[1]?this.climb(this.virtualInstruments.altitude-this.navpoint.data[1]):this.dive(this.virtualInstruments.altitude-this.navpoint.data[1])},a.prototype.determineAction=function(){this.updateVirtualInstruments(),this.determineSteering(),t.setPieceInputState(this.plane,"throttle",this.inputValues.speed),t.setPieceInputState(this.plane,"elevator",this.inputValues.elevate),t.setPieceInputState(this.plane,"aeilrons",this.inputValues.headTowards*.1),this.updatePilot()},a.prototype.updatePilot=function(){if(this.plane.combat.isAlive==0){this.requestEject();return}var e=this;setTimeout(function(){e.determineAction()},150+Math.random()*250)},a}),define("game/world/LevelController",["application/EventManager","game/EntityModel","game/world/VideoBroadcasts","game/ships/BoatData","game/cars/CarData","game/piece/TargetData","game/planes/PlaneData","game/characters/CharacterData","game/world/ZoneData","game/world/SpawnSystem","game/planes/AiPilot"],function(e,t,n,r,i,s,o,u,a,f,l){function A(e){var t=Infinity,n;for(var r in p)for(var i in p[r]){var s=p[r][i].entity.spatial.pos.clone();s.set(e),s.sub(p[r][i].entity.spatial.pos),s.lengthSquared()<t&&s.lengthSquared()!=0&&(t=s.lengthSquared(),n=p[r][i].entity)}return console.log(p),n}function _(e){c=e}function D(){n.playRandom()}function P(){var t=function(t){e.fireEvent(e.list().SET_PLAYER_CONTROLLED_ENTITY,{entity:t}),e.fireEvent(e.list().SET_CAMERA_TARGET,{spatial:t.spatial,geometry:t.geometries[0],controlScript:"walkCam"}),D()};console.log("Player:",h),e.fireEvent(e.list().FETCH_LEVEL_ENTITY,{entityId:h,callback:t})}var c,h,p={boats:{},cars:{},planes:{},targets:{},humans:{}},d=function(e,t,n,r,i){var s=f.spawnBoat(e,t,n,r,i);return p.boats[s.entity.id]=s,s.entity},v=function(e,t,n,r,i){var s=f.spawnCar(e,t,n,r,i);return p.cars[s.entity.id]=s,s.entity},m=function(e,t,n,r,i,s){var o=f.spawnPlane(e,t,n,r,i,s);return p.planes[o.entity.id]=o,o.entity},g=function(e,t,n,r,i,s){var o=f.spawnTarget(e,t,n,r,i,s);return p.targets[o.entity.id]=o,o.entity},y=function(e,t,n,r,i,s){var o=f.spawnHuman(e,t,n,r,i,s);return p.humans[o.entity.id]=o,console.log("ADD HUMAN TO LEVEL: ",p),o.entity},b=function(e,t){for(var n in t)for(var i=0;i<t[n].length;i++){var s=t[n][i],o=[s.pos[0]+e[0],0,s.pos[2]+e[2]];d(n,r[n],o,s.rot,s.vel)}},w=function(e,t){for(var n in t)for(var r=0;r<t[n].length;r++){var s=t[n][r],o=[s.pos[0]+e[0],s.pos[1]+e[1],s.pos[2]+e[2]];v(n,i[n],o,s.rot,s.vel)}},E=function(e,t){for(var n in t)for(var r=0;r<t[n].length;r++){var i=t[n][r],o=[i.pos[0]+e[0],i.pos[1]+e[1],i.pos[2]+e[2]];g(n,s[n],o,i.rot,i.vel)}},S=function(e,t){for(var n in t)for(var r=0;r<t[n].length;r++){var i=t[n][r],s=[i.pos[0]+e[0],i.pos[1]+e[1],i.pos[2]+e[2]],u=m(n,o[n],s,i.vel,i.rot,i.state);i.state!=1&&new l(u)}},x=function(e,t){var n=e.pos;b(n,t.boats),w(n,t.cars),S(n,t.planes),E(n,t.targets)},T=function(){console.log(c);var e=c.loadPlayer.playerSpawn.car,t=c.loadPlayer.pos,n=[e.pos[0]+t[0],e.pos[1]+t[1],e.pos[2]+t[2]];return v(c.playerCar,i[c.playerCar],n,e.vel,e.rot,e.state)},N=function(){console.log(c);var e=c.loadPlayer.playerSpawn.plane,t=c.loadPlayer.pos,n=[e.pos[0]+t[0],e.pos[1]+t[1],e.pos[2]+t[2]];return m(c.playerVehicle,o[c.playerVehicle],n,e.vel,e.rot,e.state)},C=function(){console.log(c);var e=c.loadPlayer.playerSpawn.human,t=c.loadPlayer.pos,n=[e.pos[0]+t[0],e.pos[1]+t[1],e.pos[2]+t[2]];return y(c.playerCharacter,u[c.playerCharacter],n,e.vel,e.rot,e.state)},k=function(){c||alert("NO SCENARIO LOADED"),console.log("initLevel Scen",c);if(c.playerVehicle){var t=N(),n=C();h=n.id,e.fireEvent(e.list().PILOT_VEHICLE,{pilot:n,vehicle:t})}c.playerCharacter&&(h=C().id),c.playerCar&&(h=T().id);for(var r=0;r<c.loadZones.length;r++)for(var i=0;i<c.loadVehicles[r].length;i++)x(c.loadZones[r],c.loadVehicles[r][i])},L=function(){for(var e in p.boats)p.boats[e].updateBoat()},O=function(n){console.log("FETCH LEVEL ENTITY",p,n);var r=e.eventArgs(n).entityId,i=e.eventArgs(n).type,s=e.eventArgs(n).callback;if(r=="NEAREST"){s(A(e.eventArgs(n).pos));return}if(i)for(var o in p[i]){s(p[i][o].entity);return}if(r){s(t.getEntityById(r));return}for(o in p)for(var u in p[o]){s(p[o][u].entity);return}};e.registerListener(e.list().UPDATE_ACTIVE_ENTITIES,L),e.registerListener(e.list().FETCH_LEVEL_ENTITY,O),e.registerListener(e.list().SCENARIO_LOADED,k);var M=function(){return p.boats},H=function(e,t){t(y("PILOT",null,e,[0,0,0],[0,0,0],0))},B=function(t){H(e.eventArgs(t).pos,e.eventArgs(t).callback)};return e.registerListener(e.list().SPAWN_PHYSICAL,B),{getBoats:M,registerScenario:_,addPlayerToLevel:P}}),define("game/world/WorldEffects",["application/EventManager","game/ModelDefinitions"],function(e,t){var n=function(){for(var n in t.GOO_PARTICLES)e.fireEvent(e.list().BUILD_GOO_PARTICLES,{systemParams:t.GOO_PARTICLES[n]})};e.registerListener(e.list().SCENARIO_LOADED,n)}),define("game/world/Clouds",["application/EventManager"],function(e){var t=[],n=0,r=1400,i=function(e,n,i){var s=Math.floor(i*6),o=Math.floor(i*6);for(var u=0;u<s;u++)for(var a=0;a<o;a++){var f=e[0]-n[0]*.5+u*(n[0]/s)+2*n[0]/s*(Math.random()-.5),l=r+e[1]-n[1]*.5+Math.random()*Math.random()*n[1]*.3,c=e[2]-n[2]*.5+a*(n[2]/o)+2*n[2]/o*(Math.random()-.5);t.push([f,l,c,n[0]/s*.8,n[1]*1.8,n[2]/o*.8])}},s=function(t){i(e.eventArgs(t).pos,e.eventArgs(t).size,e.eventArgs(t).intensity)},o=function(n){e.fireEvent(e.list().PUFF_CLOUD_VAPOR,{pos:[t[n][0]+Math.random()*t[n][3],t[n][1]+Math.random()*t[n][4],t[n][2]+Math.random()*t[n][5]],count:1,dir:[38*(Math.random()-.5),65*(Math.random()-.1),38*(Math.random()-.5)]})},u=function(){if(Math.random()<.8)return;n+=1;if(n>=t.length){n=-1;return}o(n)};e.registerListener(e.list().SPAWN_CLOUDS,s),e.registerListener(e.list().UPDATE_ACTIVE_ENTITIES,u)}),define("game/world/Atmosphere",["game/GameConfiguration","game/world/WorldEffects","game/world/Clouds"],function(e,t,n){var r=function(t){var n=e.AERODYNAMICS.airMassDensity,r=.9*Math.max(0,1-t*.8*e.AERODYNAMICS.densityPerMeter);return r+=.1*Math.max(0,1-t*.14*e.AERODYNAMICS.densityPerMeter),t<0&&(r=1e3),r};return{getAirDensity:r}}),define("game/AerodynamicController",["game/GameConfiguration","game/world/Atmosphere","goo/math/Vector3"],function(e,t,n){var r=new n,i=function(e){var t=new n,r=new n;r.setv(e.spatial.velocity),r.div(Math.sqrt(e.spatial.velocity.lengthSquared())),t.setv(r),e.spatial.rot.applyPre(t),e.spatial.axisAttitudes=t},s=function(e,t,n,r){e.updateWingForces(t,n,r)},o=function(e,n){for(var i in e.wings){var o=e.wings[i];r.set(0,0,0);var u=r;u.setv(o.pos),e.spatial.rot.applyPost(u),u.addv(e.spatial.pos);var a=u.data[1],f=t.getAirDensity(a);s(o,f,u,n)}},u=function(e,n){e.air.density=t.getAirDensity(e.spatial.pos.data[1]),o(e,n)},a=function(e,t){i(e),u(e,t)};return{updateAerodynamicInfluences:a}}),define("game/movement/CharacterMovement",["goo/math/Vector3","game/characters/CharacterAnimator"],function(e,t){function o(e,t,r){return e.rotateY(r.data[1]),n.set(t.data[2],t.data[1],t.data[0]),e.applyPost(n),n}function u(e,t){t.mouseforward&&(t.forward=t.mouseforward),e.applyForward(t.forward-t.back),t.strafe?(e.applyStrafe(t.turnright-t.turnleft),e.applyTurn(t.mouseturn)):(e.applyStrafe(0),e.applyTurn(.05*(t.turnleft-t.turnright))),e.applyJump(t.jump),t.jump=0,e.updateTargetVectors()}function a(e,t){var n=e.moveSphere.ammoComponent;r.setValue(0,0,0),n.setAngularVelocity(r),r.setValue(n.getLinearVelocity().getX()*.5,n.getLinearVelocity().getY(),n.getLinearVelocity().getZ()*.5),t.lengthSquared()<1&&(r.setValue(n.getLinearVelocity().getX()*.5,n.getLinearVelocity().getY(),n.getLinearVelocity().getZ()*.5),n.setLinearVelocity(r)),r.setValue(t.data[0],t.data[1],t.data[2]),n.clearForces(),n.applyTorqueImpulse(r),t.data[1]!=0&&(r.setValue(0,t.data[1],0),n.applyCentralImpulse(r)),n.activate()}function f(e,n){u(e.moveSphere.spatialControl.sphereMovement,n),t.updateCharacterMovementAnimation(e,n)}function l(e){return{vel:e.getTargetVelocity(),rot:e.getTargetHeading()}}function c(e){var t=l(e.moveSphere.spatialControl.sphereMovement),n=o(e.spatial.rot,t.vel,t.rot);a(e,n),t.vel.data[1]&&(t.vel.data[1]=0)}function h(e,t){t==undefined&&(t=0),i[e]=t,s=!0}function d(e){for(var t in i)e.pieceInput[t].update&&(h(t,e.pieceInput[t].value),e.pieceInput[t].update=!1);s&&(f(e,i),s=!1,clearTimeout(p),p=setTimeout(function(){s=!0},100)),c(e)}var n=new e,r=new Ammo.btVector3(0,0,0),i={forward:0,back:0,turnleft:0,turnright:0,mouseturn:0,mouseforward:0,strafe:0,jump:0},s=!1,p;return{updateCharacterControlState:d}}),define("game/PieceController",["goo/math/Vector3","goo/math/Matrix3x3","physics/ForceProcessor","game/world/PhysicalWorld","application/EventManager","game/GameConfiguration","game/planes/PlaneController","game/world/LevelController","game/player/PlayerController","game/AerodynamicController","game/movement/CharacterMovement","game/parts/Lights","game/parts/Screens","game/GameUtil","game/EntityController"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){var v={},m=new e,g=function(e){var t=i.eventArgs(e).entity;v[t.id]=t},y=function(e){r.removePhysical(e),delete v[e]},b=new t,w=new e,E=new e,S=function(e){e.spatial.pos.addv(e.spatial.velocity)},x=function(e,t){return e.applyPost(t)},T=function(e,t,n){var r=e.pieceData.dimensions.massEmpty;return t.div(r/n)},N=function(e){return 9.81*e},C=function(e){return-e.pieceData.dimensions.massEmpty},k=function(e,t){var n=T(e,e.spatial.acc,t);Math.sqrt(n.lengthSquared())>5&&(console.log("Over Acceleration damage",Math.sqrt(n.lengthSquared())),n.div(Math.sqrt(n.lengthSquared()))),e.forces.g.setv(n),e.spatial.velocity.addv(n)},L=function(e,t){var n=T(e,e.forces.torque,t);Math.sqrt(n.lengthSquared())>.5&&(console.log("Over Torque damage",Math.sqrt(n.lengthSquared())),n.div(Math.sqrt(n.lengthSquared())*2),e.spatial.angularVelocity.set(0,0,0)),e.spatial.angularVelocity.addv(n),e.spatial.rot.rotateX(e.spatial.angularVelocity[0]),e.spatial.rot.rotateY(e.spatial.angularVelocity[1]),e.spatial.rot.rotateZ(e.spatial.angularVelocity[2])},A=function(e,t){e.spatial.velocity.data[0]=e.spatial.velocity.data[0]*.9999,e.spatial.velocity.data[2]=e.spatial.velocity.data[2]*.9999,e.spatial.velocity.add_d(0,-6e-7,0),e.spatial.rot.rotateZ(9e-6*e.spatial.pos[1]),e.spatial.rot.rotateX(-0.000005*e.spatial.pos[1]),e.spatial.pos[0]=e.spatial.pos[0]-e.spatial.velocity.data[0],e.spatial.pos[2]=e.spatial.pos[2]-e.spatial.velocity.data[2],e.spatial.frameSpeed+=Math.sqrt(e.spatial.velocity.lengthSquared())},O=function(t,n){if(t.wings)k(t,n),L(t,n);else{if(t.combat&&t.combat.isAlive===!1){A(t,n);return}t.spatial.velocity.add_d(0,n*s.WORLD_PROPERTIES.gravity[1]/s.RENDER_SETUP.physicsFPS,0);if(!t.spatial.velocity.data)return;if(t.spatial.pos[1]<=0){var r=0-t.spatial.velocity.data[1],i=t.spatial.velocity.data[1]-r,o=i/t.spatial.velocity.data[1];t.spatial.velocity.data[1]=0,t.spatial.pos[0]=t.spatial.pos[0]-t.spatial.velocity.data[0]*o,t.spatial.pos[1]=0,t.spatial.pos[2]=t.spatial.pos[2]-t.spatial.velocity.data[2]*o}t.spatial.rot.lookAt(t.spatial.velocity,e.UNIT_Y)}t.spatial.frameSpeed+=Math.sqrt(t.spatial.velocity.lengthSquared())},M=function(e){e.spatial.acc.set(0,0,0),e.forces.buoyancy.data[1]=0,e.forces.drag.set(0,0,0),e.forces.lift.set(0,0,0)},_=function(e){w.set(0,0,0);for(var t in e.wings){var r=e.wings[t];n.addForceToAcc(r.force.mul(9.81),e.spatial.acc),n.addForceToTorque(r.force,r.pos,w)}e.forces.torque.lerp(w,.1)},D=function(e,t,r){for(var i=0;i<t.length;i++){var s=t[i];s.updateForceVector(e),n.addForceToAcc(s.forceVector.mul(r),e.spatial.acc),n.addForceToTorque(s.forceVector,s.pos,e.forces.torque)}},P=function(e,t){w.set(0,0,0);for(var r in e.systems.engines){var i=e.systems.engines[r];n.addForceToAcc(i.thrustVector.mul(t),e.spatial.acc),n.addForceToTorque(i.thrustVector,i.pos,w)}e.forces.torque.lerp(w,.1)},H=function(e,t){var n=N(t);e.spatial.acc.data[1]+=n*C(e)},B=function(e,t){if(e.wings){var n=r.getRangesToNearbyConflics(e),s=r.checkSpatialConflict(e,t);if(s)if(s.part=="water")e.spatial.velocity.mul(.99,.7,.99);else{e.spatial.velocity.set(1e-4,1e-4,.001);if(e.spatial.speed>.1){var o=e.spatial.pos.data;console.log("Loc: ",o[0],o[1],o[2]),i.fireEvent(i.list().ONESHOT_AMBIENT_SOUND,{soundData:i.sound().CANNON_20_0,pos:o,dir:[Math.random()-.5,Math.random()-.5,Math.random()-.5]}),i.fireEvent(i.list().ONESHOT_AMBIENT_SOUND,{soundData:i.sound().MAIN_HIT_0,pos:o,dir:[Math.random()-.5,Math.random()-.5,Math.random()-.5]}),i.fireEvent(i.list().PUFF_BLACK_SMOKE,{pos:o,count:20,dir:[Math.random()-.5,1+Math.random(),Math.random()-.5]}),i.fireEvent(i.list().FLASH_MUZZLE_FIRE,{pos:o,count:7,dir:[Math.random()-.5,1+Math.random(),Math.random()-.5]}),i.fireEvent(i.list().FLASH_MUZZLE_FIRE,{pos:o,count:3,dir:[Math.random()-.5,1+Math.random(),Math.random()-.5]}),i.fireEvent(i.list().FLASH_SPARKS,{pos:o,count:6,dir:[Math.random()-.5,1+Math.random(),Math.random()-.5]}),setTimeout(function(){i.fireEvent(i.list().ONESHOT_AMBIENT_SOUND,{soundData:i.sound().MAIN_GUN_0,pos:o,dir:[Math.random()-.5,Math.random()-.5,Math.random()-.5]}),i.fireEvent(i.list().FLASH_MUZZLE_FIRE,{pos:o,count:3,dir:[Math.random()-.5,1+Math.random(),Math.random()-.5]}),i.fireEvent(i.list().PUFF_BLACK_SMOKE,{pos:o,count:20,dir:[Math.random()-.5,1+Math.random(),Math.random()-.5]}),i.fireEvent(i.list().FLASH_MUZZLE_FIRE,{pos:o,count:3,dir:[Math.random()-.5,1+Math.random(),Math.random()-.5]}),i.fireEvent(i.list().FLASH_SPARKS,{pos:o,count:4,dir:[Math.random()-.5,1+Math.random(),Math.random()-.5]}),setTimeout(function(){i.fireEvent(i.list().ONESHOT_AMBIENT_SOUND,{soundData:i.sound().MAIN_HIT_2,pos:o,dir:[Math.random()-.5,Math.random()-.5,Math.random()-.5]}),i.fireEvent(i.list().FLASH_MUZZLE_FIRE,{pos:o,count:3,dir:[Math.random()-.5,1+Math.random(),Math.random()-.5]}),i.fireEvent(i.list().PUFF_BLACK_SMOKE,{pos:o,count:20,dir:[Math.random()-.5,1+Math.random(),Math.random()-.5]}),i.fireEvent(i.list().FLASH_MUZZLE_FIRE,{pos:o,count:3,dir:[Math.random()-.5,1+Math.random(),Math.random()-.5]}),i.fireEvent(i.list().FLASH_SPARKS,{pos:o,count:4,dir:[Math.random()-.5,1+Math.random(),Math.random()-.5]})},200)},200)}}else if(e.spatial.speed>.5)if(n.ground<30){var u=[e.spatial.pos.data[0]+.5*e.spatial.pos[1]*(Math.random()-.5),e.spatial.pos[1]-n.ground,e.spatial.pos.data[2]+.5*e.spatial.pos[1]*(Math.random()-.5)],a=function(){i.fireEvent(i.list().PUFF_WHITE_SMOKE,{pos:u,count:1,dir:[0,Math.random(),0]})};Math.random()<e.spatial.speed*.3&&setTimeout(function(){a()},n.ground*1.1+1*n.ground*Math.random())}else if(e.spatial.pos[1]<35&&e.spatial.speed>.5){var f=[e.spatial.pos.data[0]+.5*e.spatial.pos[1]*(Math.random()-.5),.1,e.spatial.pos.data[2]+.5*e.spatial.pos[1]*(Math.random()-.5)],l=function(){i.fireEvent(i.list().SPLASH_WATER,{pos:f,count:1,dir:[0,1,0]}),Math.random()<.1&&i.fireEvent(i.list().SPLASH_RINGLET,{pos:f,count:1,dir:[0,0,0]}),Math.random()<.02&&i.fireEvent(i.list().SPLASH_FOAM,{pos:f,count:1,dir:[0,0,0]})};setTimeout(function(){l()},e.spatial.pos[1]*12+8*e.spatial.pos[1]*(Math.random()-.5))}}return n.ground},j=function(e){w.set(e.spatial.visualPos),w.sub(m),w.lengthSquared()>1e3*e.pieceData.physicalRadius*e.pieceData.physicalRadius?d.hideEntity(e):d.showEntity(e)},F=function(e){var t=i.eventArgs(e).frameTime,n=1e3/t,r=1/n,u=s.RENDER_SETUP.physicsFPS,a=1/u,d=Math.round(r/a);for(var m in v){var g=v[m];j(g);if(g.moveSphere){g.spatial.audioVel.set(g.spatial.pos),g.spatial.audioVel.sub(g.spatial.visualPos),g.spatial.audioVel.mul(1/r);if(g.isPilot)continue;g.screenSystem?(g.spatial.visualPos.setv(g.spatial.pos),h.updateEntityScreenState(g)):g.spatial.visualPos.setv(g.spatial.pos),g.animStateMap?l.updateCharacterControlState(g):g.moveSphere.deactivate()}else{if(g.wings){var y=B(g,u*r);o.updatePlaneControlState(g,r,y)}g.lights&&c.updateEntityLightState(g),g.screenSystem&&h.updateEntityScreenState(g),g.spatial.frameSpeed=0,g.spatial.frameTime=t;for(var b=0;b<d;b++){if(g.systems){M(g);var T=g.systems;T.engines&&P(g,a),T.gears&&T.gears.currentState!=0&&D(g,T.gears.wheels,a),T.drive&&D(g,T.drive.wheels,a)}g.wings&&(f.updateAerodynamicInfluences(g,y),_(g,a)),g.spatial.acc&&x(g.spatial.rot,g.spatial.acc),g.pieceData.dimensions&&H(g,a),O(g,a),S(g,a)}g.spatial.speed=g.spatial.frameSpeed,g.spatial.visualPos.setv(g.spatial.pos),w.set(g.spatial.velocity),w.mul(1/a),g.spatial.audioVel.set(w),g.pilot&&(g.pilot.spatial.rot.set(g.spatial.rot),w.set(g.pieceData.dimensions.pilotSeatPos),w=p.applyRotationToVelocity(g,w),w.add(g.spatial.visualPos),E.set(0,g.pilot.pieceData.dimensions.mobRadius,0),E.add(w),g.pilot.spatial.pos.set(E),g.pilot.spatial.visualPos.set(E))}}},I=function(e){y(i.eventArgs(e).entityId)},q=function(e){m.set(i.eventArgs(e).pos)};i.registerListener(i.list().UPDATE_ACTIVE_ENTITIES,F),i.registerListener(i.list().REGISTER_ACTIVE_ENTITY,g),i.registerListener(i.list().REMOVE_GAME_ENTITY,I),i.registerListener(i.list().MOVE_AUDIO_LISTENER,q)}),define("game/combat/CombatSystem",["application/EventManager","game/EntityController","game/GameUtil"],function(e,t,n){var r=function(e){e.combat.destroyed(e),e.combat.isAlive=!1},i=function(e,t){e.combat.damageTaken+=t,e.combat.damageTaken>=e.combat.hitPoints&&e.combat.isAlive&&r(e)},s=function(t){i(e.eventArgs(t).entity,e.eventArgs(t).damage)};e.registerListener(e.list().DAMAGE_ENTITY,s)}),define("game/GameController",["application/EventManager","application/Sequencer","feedback/IntroController","3d/SceneController","game/PieceController","game/EntityController","game/combat/CombatSystem"],function(e,t,n,r,i,s,o){var u=function(){},a=function(){},f=function(n){var r=e.eventArgs(n),i=r.frameTime,s=r.lastFrameDuration;t.tick(i,s)};return u.prototype.setupGame=function(){e.registerListener(e.list().RENDER_TICK,f),e.registerListener(e.list().CLIENT_SETUP_OK,a)},u}),define("application/UpdateLoop",["application/EventManager","game/GameConfiguration","application/DeviceHandler"],function(e,t,n){var r=n.getBrowser(),i=n.getVersion(),s=0,o=!1,u,a,f=(new Date).getTime(),l,c=0,h=0,p=t.RENDER_SETUP.targetFPS,d=10,v=20,m={slowFrameCount:0,worstFrameTime:0,cyclesOfTen:0,averageFrameTime:0,skipped:0},g=function(e,t){var n=1e3/p,r=n-1;return t>n*21&&(r=n/2),r},y=function(){clearTimeout(a),u&&(console.log("unpause",u),e.fireEvent(e.list().UNPAUSE_UPDATES,{})),u=!1,a=setTimeout(function(){u=!0,console.log("pause",u),e.fireEvent(e.list().PAUSE_UPDATES,{})},400)},b=0,w=function(t){f=e.eventArgs(t).tpf*1e3,y();var n=function(e){b=e,x()};e.fireEvent(e.list().FETCH_TIME,{callback:n})},E=function(){var t={avgT:Math.round(m.averageFrameTime*10)/10,slowFs:m.slowFrameCount,slowest:Math.round(m.worstFrameTime*10)/10,cycles:m.cyclesOfTen,mins:h,skipd:m.skipped};e.fireEvent(e.list().ANALYTICS_EVENT,{category:"PERFORMANCE",action:"STATS "+r,labels:JSON.stringify(t),value:Math.round(t.slowest)})},S=function(e){if(o||e>200){m.skipped+=1;return}m.slowFrameCount+=1,e>m.worstFrameTime&&(m.worstFrameTime=e),m.averageFrameTime=v/s,m.slowFrameCount>d&&(E(),m.slowFrameCount=0,m.cyclesOfTen+=1,m.worstFrameTime=0,d*=10)},x=function(){s+=1,l=f,isNaN(l)||(v+=l),N(b,l)},T=function(){c-=6e4,h+=1,E()},N=function(t,n){var r=1e3/p;n>r*1.5&&(S(n),n=r*1.5),c+=n,c>6e4&&T(),o||e.fireEvent(e.list().RENDER_TICK,{frameTime:t,lastFrameDuration:n})},C=function(){o=!0},k=function(){o=!1};e.registerListener(e.list().GOO_TICK,w),e.registerListener(e.list().PAUSE_UPDATES,C),e.registerListener(e.list().UNPAUSE_UPDATES,k)}),define("3d/WorldParticles",["application/EventManager","goo/math/Vector3","3d/GooEffectController"],function(e,t,n){var r=function(e,t,r,i){this.particleDensity=90*n.getSettingParam("particles","highDensity")+10,this.effectSpawnRules=r,this.particleDefinition=t,this.createEffect(e,t,i),this.points=[],this.velocities=[],this.endTimeout=null,this.particleEntity=null};return r.prototype.playEffect=function(e,t,n){var r=this,i=function(e,t,n){setTimeout(function(){r.startEmission(),r.addEffectPoint(e,t)},n)};for(var s=0;s<t;s++){var o=this.effectSpawnRules(e,n,s,t);i([o.p[0],o.p[1],o.p[2]],[o.d[0],o.d[1],o.d[2]],o.w)}},r.prototype.addEffectPoint=function(e,t){Math.random()*this.particleDensity<this.points.length&&(this.points.shift(),this.velocities.shift()),this.velocities.push(t),this.points.push({pos:e})},r.prototype.endEmission=function(){var e=this;for(var t=0;t<this.particleComp.emitters.length;t++)this.particleComp.emitters[t].enabled=!1;clearTimeout(this.endTimeout);var n=function(){this.particleComp.enabled=!1,this.particleEntity.removeFromWorld()}.bind(this);this.endTimeout=setTimeout(function(){n()},e.particleDefinition.emitters[0].maxLifetime*1500)},r.prototype.startEmission=function(){this.particleEntity.addToWorld(),clearTimeout(this.endTimeout),this.particleComp.enabled=!0;for(var e=0;e<this.particleComp.emitters.length;e++)this.particleComp.emitters[e].enabled=!0},r.prototype.getEmissionVelocity=function(e){var t=this.velocities.pop()||[0,0,0];return e.velocity.set(t[0],t[1],t[2]),e.velocity},r.prototype.getEmissionPosition=function(e,t){var n=e.position;if(this.points.length==0){var r=[0,-999,0];this.endEmission()}else var i=this.points.pop(),r=i.pos,s=i.size;return n.set(r[0],r[1],r[2]),n},r.prototype.createEffect=function(n,r,i){var s=this,o=function(e,t){return s.getEmissionVelocity(e,t)},u=function(e,t){return s.getEmissionPosition(e,t)},a={velocity:o,position:u};if(r.billboard){var f=new t(r.billboard.bbx),l=new t(r.billboard.bby),c=function(e,t){e.bbX.set(f),e.bbY.set(l)};a.orientation=c}var h=function(e){s.particleEntity=e,s.particleComp=e.particleComponent;var t=0;for(var n=0;n<s.particleComp.emitters.length;n++)t+=s.particleComp.emitters[n].releaseRatePerSecond;s.particleComp.maxReleaseRate=t,i()};setTimeout(function(){e.fireEvent(e.list().BUILD_GOO_PARTICLES,{parentGooEntity:n,systemParams:r,emitFunctions:a,callback:h})},0)},r}),define("3d/WorldParticleSystems",["application/EventManager","game/GameConfiguration","game/ModelDefinitions","3d/WorldParticles"],function(e,t,n,r){function i(t){var i=function(e,t){return 4*t*(.2*e+1)+5*(Math.random()-.5)},s=function(e,t,n,r){return{p:[e[0]+t[0]*(1+n)*.2,e[1]+t[1]*(1+n)*.2,e[2]+t[2]*(1+n)*.2],d:[i(n,t[0]),i(n,t[1]),i(n,t[2])],w:n*65}},o=function(t){a.playEffect(e.eventArgs(t).pos,e.eventArgs(t).count,e.eventArgs(t).dir)},u=function(){e.registerListener(e.list().PUFF_BLACK_SMOKE,o)},a=new r(t,n.GOO_PARTICLES.black_puff,s,u)}function s(t){var i=function(e,t,n,r){return{p:[e[0]+t[0]*(1+n)*.1,e[1]+t[1]*(1+n)*.1,e[2]+t[2]*(1+n)*.1],d:[5*t[0]*(1+n),5*t[1]*(1+n),5*t[2]*(1+n)],w:n*45}},s=function(t){u.playEffect(e.eventArgs(t).pos,e.eventArgs(t).count,e.eventArgs(t).dir)},o=function(){e.registerListener(e.list().PUFF_WHITE_SMOKE,s)},u=new r(t,n.GOO_PARTICLES.white_puff,i,o)}function o(t){var i=function(e){return 3*e+1*(Math.random()-.5)},s=function(e){return 5*e+3*(Math.random()-.5)},o=function(e,t,n,r){return{p:[e[0]+i(t[0]),e[1]+i(t[1]),e[2]+i(t[2])],d:[s(t[0]),s(t[1]),s(t[2])],w:0}},u=function(t){f.playEffect(e.eventArgs(t).pos,e.eventArgs(t).count,e.eventArgs(t).dir)},a=function(){e.registerListener(e.list().PUFF_SMALL_WHITE,u)},f=new r(t,n.GOO_PARTICLES.small_puff,o,a)}function u(t){var i=function(e,t,n,r){return{p:e,d:t,w:0}},s=function(t){u.playEffect(e.eventArgs(t).pos,e.eventArgs(t).count,e.eventArgs(t).dir)},o=function(){e.registerListener(e.list().PUFF_CLOUD_VAPOR,s)},u=new r(t,n.GOO_PARTICLES.cloud_puff,i,o)}function a(t){var i=function(e,t,n,r){return{p:[e[0]+Math.random()*-0.5*2,e[1]+Math.random()*-0.5*2,e[2]+Math.random()*-0.5*2],d:[t[0]*(1+n),t[1]*(1+n),t[2]*(1+n)],w:0}},s=function(t){u.playEffect(e.eventArgs(t).pos,e.eventArgs(t).count,e.eventArgs(t).dir)},o=function(){e.registerListener(e.list().ACROBATIC_SMOKE,s)},u=new r(t,n.GOO_PARTICLES.acrobatic_puff,i,o)}function f(t){var i=function(e,t){return 20*t*e+5*(Math.random()-.5)},s=function(e,t,n,r){return{p:[e[0]+t[0]*(1+n)*.5,e[1]+t[1]*(1+n)*.5,e[2]+t[2]*(1+n)*.5],d:[i(n,t[0]),i(n,t[1]),i(n,t[2])],w:n*25}},o=function(t){a.playEffect(e.eventArgs(t).pos,e.eventArgs(t).count,e.eventArgs(t).dir)},u=function(){e.registerListener(e.list().FLASH_MUZZLE_FIRE,o)},a=new r(t,n.GOO_PARTICLES.muzzle_flash,s,u)}function l(t){var i=function(e,t,n,r){return{p:e,d:t,w:n*35}},s=function(t){u.playEffect(e.eventArgs(t).pos,e.eventArgs(t).count,e.eventArgs(t).dir)},o=function(){e.registerListener(e.list().FLASH_SPARKS,s)},u=new r(t,n.GOO_PARTICLES.spark_flash,i,o)}function c(t){var i=function(e,t,n,r){return{p:e,d:t,w:n*5}},s=function(t){u.playEffect(e.eventArgs(t).pos,e.eventArgs(t).count,e.eventArgs(t).dir)},o=function(){e.registerListener(e.list().FLASH_SHOCKWAVE,s)},u=new r(t,n.GOO_PARTICLES.shockwave_hit,i,o)}function d(t){var n=Math.floor(Math.random()*4);Math.random()<h&&(e.fireEvent(e.list().ONESHOT_AMBIENT_SOUND,{soundData:e.sound()["SPLASH_"+n],pos:t,dir:[Math.random()-.5,Math.random()-.5,Math.random()-.5]}),h*=.5,clearTimeout(p),p=setTimeout(function(){h=1},200))}function v(t){var i=function(e,t,n,r){return{p:[e[0],e[1]+t[1]*n*(.7+Math.random()*.3),e[2]],d:[t[0],.01+.5*((n-1)*r*t[1]-.5*t[1]*(2*n-1)*r),t[2]],w:n*40}},s=function(t){d(e.eventArgs(t).pos),u.playEffect(e.eventArgs(t).pos,e.eventArgs(t).count,e.eventArgs(t).dir)},o=function(){e.registerListener(e.list().SPLASH_WATER,s)},u=new r(t,n.GOO_PARTICLES.water_splash,i,o)}function m(t){var i=function(e,t,n,r){return{p:e,d:t,w:0}},s=function(t){u.playEffect(e.eventArgs(t).pos,e.eventArgs(t).count,e.eventArgs(t).dir)},o=function(){e.registerListener(e.list().SPLASH_RINGLET,s)},u=new r(t,n.GOO_PARTICLES.water_ringlet,i,o)}function g(t){var i=function(e,t,n,r){return{p:e,d:t,w:0}},s=function(t){u.playEffect(e.eventArgs(t).pos,e.eventArgs(t).count,e.eventArgs(t).dir)},o=function(){e.registerListener(e.list().SPLASH_FOAM,s)},u=new r(t,n.GOO_PARTICLES.water_foam,i,o)}function y(t){var i=function(e,t,n,r){return{p:e,d:t,w:0}},s=function(t){u.playEffect(e.eventArgs(t).pos,e.eventArgs(t).count,e.eventArgs(t).dir)},o=function(){e.registerListener(e.list().PUFF_RAPID_WHITE,s)},u=new r(t,n.GOO_PARTICLES.rapid_puff,i,o)}function b(e){o(e),y(e),v(e),i(e),f(e),s(e),c(e),l(e),a(e),u(e),m(e),g(e)}var h=1,p;return{addWorldParticles:b}}),define("geometrypack/Surface",["goo/renderer/MeshData","goo/math/MathUtils"],function(e,t){function n(t,n,r){this.verts=t,this.vertsPerLine=n||2,this.verticallyClosed=!!r;var i=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]),s=this.verts.length/3,o=s/this.vertsPerLine;e.call(this,i,s,(o-1)*(this.vertsPerLine-1)*6),this.rebuild()}function r(e){var t=e[0],n=e[0],r=e[1],i=e[1];for(var s=3;s<e.length;s+=3)t=t<e[s+0]?t:e[s+0],n=n>e[s+0]?n:e[s+0],r=r<e[s+2]?r:e[s+2],i=i>e[s+2]?i:e[s+2];return{minX:t,maxX:n,minY:r,maxY:i}}return n.prototype=Object.create(e.prototype),n.prototype.rebuild=function(){this.getAttributeBuffer(e.POSITION).set(this.verts);var n=[],i=[],s=[],o=this.verts.length/3,u=o/this.vertsPerLine;for(var a=0;a<u-1;a++){for(var f=0;f<this.vertsPerLine-1;f++){var l=(a+0)*this.vertsPerLine+(f+0),c=(a+1)*this.vertsPerLine+(f+0),h=(a+1)*this.vertsPerLine+(f+1),p=(a+0)*this.vertsPerLine+(f+1);n.push(l,c,p,p,c,h),s=t.getTriangleNormal(this.verts[l*3+0],this.verts[l*3+1],this.verts[l*3+2],this.verts[c*3+0],this.verts[c*3+1],this.verts[c*3+2],this.verts[p*3+0],this.verts[p*3+1],this.verts[p*3+2]),i.push(s[0],s[1],s[2])}if(this.verticallyClosed){var l=(a+0)*this.vertsPerLine+0,c=(a+1)*this.vertsPerLine+0,p=(a+0)*this.vertsPerLine+1;s=t.getTriangleNormal(this.verts[l*3+0],this.verts[l*3+1],this.verts[l*3+2],this.verts[c*3+0],this.verts[c*3+1],this.verts[c*3+2],this.verts[p*3+0],this.verts[p*3+1],this.verts[p*3+2]),i.push(s[0],s[1],s[2])}else i.push(s[0],s[1],s[2])}a--;for(var f=0;f<this.vertsPerLine-1;f++){var l=(a+0)*this.vertsPerLine+(f+0),c=(a+1)*this.vertsPerLine+(f+0),p=(a+0)*this.vertsPerLine+(f+1);s=t.getTriangleNormal(this.verts[l*3+0],this.verts[l*3+1],this.verts[l*3+2],this.verts[c*3+0],this.verts[c*3+1],this.verts[c*3+2],this.verts[p*3+0],this.verts[p*3+1],this.verts[p*3+2]),i.push(s[0],s[1],s[2])}i.push(s[0],s[1],s[2]),this.getAttributeBuffer(e.NORMAL).set(i),this.getIndexBuffer().set(n);var d=[],v=r(this.verts),m=v.maxX-v.minX,g=v.maxY-v.minY;for(var a=0;a<this.verts.length;a+=3){var y=(this.verts[a+0]-v.minX)/m,b=(this.verts[a+2]-v.minY)/g;d.push(y,b)}return this.getAttributeBuffer(e.TEXCOORD0).set(d),this},n.createFromHeightMap=function(e,t,r,i){t=t||1,r=r||1,i=i||1;var s=[];for(var o=0;o<e.length;o++)for(var u=0;u<e[o].length;u++)s.push(o*t,e[o][u]*r,u*i);return s.reverse(),new n(s,e[0].length)},n.createTessellatedFlat=function(e,t,r,i){var s=[];for(var o=0;o<r;o++)for(var u=0;u<i;u++)s.push(o*e/r-e*.5,u*t/i-t*.5,0);var a=new n(s,r);return a},n}),define("game/world/StaticBatchBuilder",["application/EventManager","goo/shapes/ShapeCreator","goo/util/MeshBuilder","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","game/GameConfiguration","physics/PhysicalWorld"],function(e,t,n,r,i,s,o){function m(e,t){f[e].count==0&&h(e)}function g(e,t,n,r){console.log("Add TransformMesh: ",e,t,n),f[e]||alert("No batch queue registered for batchQueueId: "+e);var i=function(t,n){clearTimeout(f[e].addTimeout),f[e].materialBuilders[l[t].material.name].addMeshData(a[t].mesh,n),f[e].count-=1,f[e].materialBuilders[l[t].material.name].addMeshData(v,n),f[e].addTimeout=setTimeout(function(){m(e,t)},0)};p(e,t,n,r,i)}function y(e,t,n){f[e]={count:0,models:[],materialBuilders:{},material:null,physical:t,callback:n}}var u,a={},f={},l={},c=function(e,t){a[e]={mesh:t}},h=function(e){for(var t=0;t<f[e].models.length;t++){var n=f[e].materialBuilders[l[f[e].models[t]].material.name].build();for(var s in n){console.log("Add: ",n[s]);var a=u.world.createEntity(),c=new r(n[s]);f[e].physical&&o.addPhysicalWorldMesh(n[s],0,0,0),a.setComponent(c);var h=new i;h.materials.push(l[f[e].models[t]].material),h.castShadows=!1,h.isReflectable=!1,h.receiveShadows=!1,a.setComponent(h),a.addToWorld()}}var p=f[e].callback;setTimeout(function(){p()},150),delete f[e]},p=function(t,r,i,s,o){f[t].count+=1;if(!a[i]){l[i]={};var u=function(e){var r=e.transformComponent.children[0].entity.meshDataComponent.meshData;l[i].material=e.transformComponent.children[0].entity.meshRendererComponent.materials[0],c(i,r),f[t].models.push(i),f[t].materialBuilders[l[i].material.name]||(f[t].materialBuilders[l[i].material.name]=new n),console.log("StaticBatch:",t,a,l[i].material.name),o(i,s)};console.log(r,i),e.fireEvent(e.list().BUILD_GOO_GAMEPIECE,{projPath:r,modelPath:i,callback:u})}else f[t].material=l[i].material,o(i,s)},d,v=t.createQuad(.001,.001,1),b=function(t){u=e.eventArgs(t).goo};return e.registerListener(e.list().ENINGE_READY,b),{addTransformedMeshToBatchQueue:g,registerBatchQueue:y}}),define("game/world/NatureWorld",["application/EventManager","goo/math/Vector3","game/EntityController","game/GameUtil","3d/HeightmapManager","game/GameConfiguration","goo/util/MeshBuilder","goo/math/Transform","game/world/StaticBatchBuilder","3d/GooEffectController","3d/addons/Vegetation"],function(e,t,n,r,i,s,o,u,a,f,l){var c,h,p=[],d=function(t){var n=s.GOO_PROJECTS.nature.projectPath,r=s.GOO_PROJECTS.nature.refFile;e.fireEvent(e.list().LOAD_GOO_PROJECT,{projectPath:n,refFile:r,callback:t})},v=function(e,t,n){console.log("Add Vegetation: ",t);var r=[],s=function(e,t){return i.readTerrainCanvasAlphaAtPos(e,t)},o=function(e,t,n){y(e,9,t,n)};for(var u in t)r.push(new l(e,i,t[u]));var a=function(){r.length==0?n():f()},f=function(){var e=r.shift(),t=e.init(i,s,o);t.resolve=a};a()},m=function(e,t){var n=f.getSettings()["Lots of Trees"].fx.manyTrees*3+2;c=t,h=0;for(var r in e)h+=1,p.push([r,e[r].zoneData.tree_spread/n,e[r].dimensions]),console.log("Populate Terrain: ",r,e[r]);var i=function(){if(p.length==0)c();else{var e=p.pop();g(e[0],e[1],e[2],i),console.log("Populate Terrain next: ",e)}},s=function(){i()};d(s)},g=function(t,n,r,i){function s(){i(),e.fireEvent(e.list().LOAD_PROGRESS,{started:0,completed:1,errors:0,id:"add_trees_"+t})}e.fireEvent(e.list().LOAD_PROGRESS,{started:1,completed:0,errors:0,id:"add_trees_"+t});var o="trees_"+t;a.registerBatchQueue(o,!0,s),w(o,n,r)},y=function(e,t,n,r){for(var s=0;s<t;s++){var o=[e[0]+r*(Math.random()-.5)*Math.random(),e[1],e[2]+r*(Math.random()-.5)*Math.random()];i.paintTerrainPoint(o,n*Math.random(),{color:[.1*Math.random(),.1*Math.random(),.1*Math.random(),.12]}),i.paintTerrainPoint(o,n*.5+(Math.random()-.5),{color:[.1*Math.random(),.1*Math.random(),.1*Math.random(),.06]}),i.paintTerrainPoint(o,n*4*(Math.random()-.5),{color:[.1*Math.random(),.1*Math.random(),.1*Math.random(),.02]}),i.paintTerrainPoint(o,n*8*Math.random(),{color:[.1*Math.random(),.1*Math.random(),.1*Math.random(),.01]})}},b=function(e){var t=i.getCanvasRGBAAtPos(e);return t[3]/255},w=function(e,t,n){var r=[s.GOO_PROJECTS.nature.tree_leafy,s.GOO_PROJECTS.nature.tree_leafy,s.GOO_PROJECTS.nature.tree_leafy_small,s.GOO_PROJECTS.nature.tree_leafy_small,s.GOO_PROJECTS.nature.tree_leafy_small],o=n,u=o.minX+(o.maxX-o.minX)*.5,a=o.minZ+(o.maxZ-o.minZ)*.5,f=[u,o.minY+1,a],l=i.getTerrainCanvasDataAtPos(f),c=n.maxX-n.minX;for(var h=0;h<Math.floor(c/t);h++)for(var p=0;p<Math.floor(c/t);p++){var d=n.minX+(h*t+t*.5+t*Math.random()),v=n.minZ+(p*t+t*.5+t*Math.random()),m=i.getHeightAboveGroundAtPos([d,0,v]),g=i.readTerrainCanvasAlphaAtPos(l,[d,m,v]);if(m!==null&&g<.3){var b=i.getGroundNormal([d,0,v]);if(b!==null){var w=i.getGroundSlope(b);if(w<.09&&m<-3&&m>-455){var S=Math.floor(Math.random()*r.length),x=r[S];E(e,x,[d,-m,v],b),y([d,-m,v],35,2,30)}}}}},E=function(e,n,r,i){console.log("Push mesh:",r);var o=function(e){var n=new u,r=.5+1.8*Math.random()*Math.random();return n.translation.x=e[0],n.translation.y=e[1],n.translation.z=e[2],i.muld(1,1.5,1),n.rotation.lookAt(i,t.UNIT_Y),n.rotation.rotateY(.1*Math.random()*.2),n.rotation.rotateZ(.1-Math.random()*10.2),n.rotation.rotateX(.1*Math.random()*.2),n.scale.set(r+.2*Math.random(),r+.2*Math.random(),r+.2*Math.random()),n.update(),n},f=o(r);a.addTransformedMeshToBatchQueue(e,s.GOO_PROJECTS.nature.projectPath,n,f)};return{populateTrees:m,populateVegetation:v}}),define("game/world/BuiltWorld",["application/EventManager","goo/math/Vector3","game/EntityController","game/GameUtil","3d/HeightmapManager","game/GameConfiguration","goo/util/MeshBuilder","goo/math/Transform","game/world/StaticBatchBuilder"],function(e,t,n,r,i,s,o,u,a){var f,l=[],c={},h=function(t,n){for(var r=0;r<t.length;r++){console.log(c);for(var i=0;i<t[r].gooProjects.length;i++)c[t[r].gooProjects[i].refFile]=t[r].gooProjects[i].projectPath,console.log(c)}var s=0,o=function(){s-=1,console.log(s),s==0&&n()};for(var u in c)s+=1,e.fireEvent(e.list().LOAD_GOO_PROJECT,{projectPath:c[u],refFile:u,callback:o});s||n()},p=function(e,t,n){var r=function(){f=n;for(var r=0;r<e.length;r++){console.log("Load Level: ",r,e[r],e[r].zoneId,t,t[e[r].zoneId]);var i=[e[r],t[e[r].zoneId],e[r].zoneId+"_"+r];l.push(i)}var s=function(){if(l.length==0)f();else{var e=l.pop();d(e[0],e[1],e[2],s)}};s()};h(e,r)},d=function(t,n,r,i){function o(){e.fireEvent(e.list().LOAD_PROGRESS,{started:0,completed:1,errors:0,id:"add_building_"+r}),i()}console.log("BUILD BUILDINGS WORLD: ",t,n);var s=n.zoneData.pos;e.fireEvent(e.list().LOAD_PROGRESS,{started:1,completed:0,errors:0,id:"add_building_"+r}),a.registerBatchQueue(r,!0,o);for(var u=0;u<t.buildings.length;u++){var f=t.buildings[u].model;for(var l=0;l<t.buildings[u].entries.length;l++){var c=t.buildings[u].entries[l];v(r,f,[s[0]+c.pos[0],s[1]+c.pos[1],s[2]+c.pos[2]],c.rot)}}},v=function(e,t,n,r){console.log("ADD TO BATCH: ",e,t,n,r);var s=i.getHeightAboveGroundAtPos(n);n[1]-=s;if(s!==null){var o=i.getGroundNormal(n);m(e,t,n,r,o)}},m=function(e,n,r,i,o){var f=function(e){var n=new u;return n.translation.x=e[0],n.translation.y=e[1],n.translation.z=e[2],n.rotation.lookAt(o,t.UNIT_Y),n.rotation.rotateZ(i[1]),n.update(),n};console.log("ADD TO POS: ",e,r);var l=f(r);a.addTransformedMeshToBatchQueue(e,s.GOO_PROJECTS.nature.projectPath,n,l)};return{populateBuildings:p}}),define("game/world/ZoneBuilder",["application/EventManager","game/world/NatureWorld","game/world/BuiltWorld"],function(e,t,n){function r(e,r,i,s){console.log(r,i);var o=function(){s()},u=function(){t.populateVegetation(e,i,o)},a=function(){t.populateTrees(i,u)};n.populateBuildings(r,i,a)}return{buildTerrainZone:r}}),define("3d/DynamicSkysphere",["application/EventManager","3d/WorldParticleSystems","3d/HeightmapManager","game/world/ZoneData","game/GameConfiguration","load/ClientLoader","goo/renderer/Material","goo/entities/components/ScriptComponent","goo/shapes/ShapeCreator","geometrypack/Surface","goo/shapes/Sphere","goo/entities/EntityUtils","goo/renderer/shaders/ShaderLib","goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/TextureCreator","goo/addons/water/FlatWaterRenderer","goo/math/Plane","game/world/ZoneBuilder","3d/GooEffectController","goo/util/Skybox","goo/renderer/shaders/ShaderBuilder","goo/renderer/Texture"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S){var x,T,N,C,k=1,L=16,A="darker",O="source-over",M="lighter",_=function(e,t){return"rgba("+Math.floor(e[0]*255)+","+Math.floor(e[1]*255)+","+Math.floor(e[2]*255)+","+t+")"},D=function(e){return"rgb("+Math.floor(e[0]*255)+","+Math.floor(e[1]*255)+","+Math.floor(e[2]*255)+")"},P=function(){T=document.createElement("canvas"),T.id="sky_canvas",T.width=k,T.height=L,T.dataReady=!0,C=new S(T,null,T.width,T.height),N=T.getContext("2d")},H=function(e){x=e,P();var t=l.TextureModes.Linear,n=new w("sphere",[],t,0),r=c.createTypicalEntity(x.world,n.meshData,n.materials[0],n.transform);E.SKYSPHERE=C,n.materials[0].setTexture("DIFFUSE_MAP",C),r.addToWorld(),this.skybox=r};return H.prototype.setColor=function(e,t,n,r){var i=1-(r*5e-7+Math.random()*.01),s=N.createLinearGradient(0,0,0,L);s.addColorStop(.9,D([t[0]*n[0],t[1]*n[1],t[2]*n[2]])),s.addColorStop(.507+r*1e-6,D([n[0]*i,n[1]*i,n[2]*i])),s.addColorStop(.5,D([n[0]*(.5+Math.random()*.01)*i+e[0]*(.5+Math.random()*.01)*i*i,n[1]*.5*i+e[1]*(.5+Math.random()*.01)*i*i,n[2]*.5*i+e[2]*.5*i*i])),s.addColorStop(.5-(1-i),D(e)),s.addColorStop(.2,D(e)),s.addColorStop(0,D([t[0]*n[0],t[1]*n[1],t[2]*n[2]])),N.fillStyle=s,N.fillRect(0,0,k,L),C.setNeedsUpdate()},H.prototype.setFogColor=function(e,t){},H.prototype.makeSun=function(){var e=new l(20,20,500);this.sunmat=o.createMaterial(h.simpleColored,"sunsphere"),this.sunmat.shader.uniforms.color=[1,1,.98],this.sunmat.renderQueue=0,this.sun=x.world.createEntity(e,this.sunmat),this.sun.addToWorld()},H.prototype.setSunColor=function(e){this.sunmat.shader.uniforms.color=[Math.sqrt(e[0]),Math.sqrt(e[1]),Math.sqrt(e[2])]},H.prototype.setSunXYZ=function(e,t,n){this.sun.transformComponent.transform.translation.set(e,t,n),this.sun.transformComponent.setUpdated()},H}),define("3d/DynamicEnvironment",["application/EventManager","goo/math/Vector3"],function(e,t){var n=1e4,r,i,s,o={sunLight:new t,sunDir:new t,ambientLight:new t,skyColor:new t,fogColor:new t,fogDistance:new t},u=new t,a=[{sunLight:[.18,.15,.03],sunDir:[-0.8,.3,.2],ambientLight:[.1,.4,.2],skyColor:[.1,.4,.4],fogColor:[.4,.65,.44],fogDistance:[.001,.3,.5]},{sunLight:[.98,.75,.5],sunDir:[-0.5,.1,-0.2],ambientLight:[.1,.4,.4],skyColor:[.2,.6,.6],fogColor:[.6,.65,.64],fogDistance:[.002,.5,.5]},{sunLight:[.92,.98,.43],sunDir:[-0.6,-0.3,-0.3],ambientLight:[.4,.5,.76],skyColor:[.7,.65,.62],fogColor:[.5,.65,.75],fogDistance:[.005,.7,.5]},{sunLight:[1,1,.6],sunDir:[-0.4,-0.6,-0.4],ambientLight:[.4,.4,.75],skyColor:[.4,.65,.82],fogColor:[.6,.75,.75],fogDistance:[1e-4,.9,.5]},{sunLight:[1,1,.6],sunDir:[-0.2,-0.9,-0.4],ambientLight:[.4,.4,.75],skyColor:[.4,.62,.75],fogColor:[.64,.72,.72],fogDistance:[.07,1,.5]},{sunLight:[1,.9,.6],sunDir:[-0.2,-0.7,-0.4],ambientLight:[.4,.4,.75],skyColor:[.3,.45,.62],fogColor:[.5,.58,.68],fogDistance:[.5,.7,.5]},{sunLight:[.85,.85,.6],sunDir:[.4,-0.21,-0.4],ambientLight:[.7,.6,.3],skyColor:[.25,.35,.6],fogColor:[.5,.4,.6],fogDistance:[.02,.5,.5]},{sunLight:[.25,.1,.04],sunDir:[.5,.5,.2],ambientLight:[.7,.3,.4],skyColor:[.5,.3,.01],fogColor:[.5,.25,.1],fogDistance:[.001,.3,.5]},{sunLight:[.2,0,.2],sunDir:[.4,-0.3,.6],ambientLight:[.1,.1,.3],skyColor:[.1,0,.2],fogColor:[0,0,.1],fogDistance:[5e-4,.2,.5]},{sunLight:[0,.1,.1],sunDir:[-0.3,-0.6,.8],ambientLight:[.1,.01,.3],skyColor:[0,.1,.2],fogColor:[0,0,.1],fogDistance:[1e-4,.1,.5]}],f=function(e,t){s=e,n=t,r=n/a.length,i=0};return f.prototype.pushEnvironmentState=function(){e.fireEvent(e.list().SET_ENVIRONMENT,{fogColor:o.fogColor.data,sunLight:o.sunLight.data,ambientLight:o.ambientLight.data,sunDir:o.sunDir.data,skyColor:o.skyColor.data,fogDistance:o.fogDistance.data})},f.prototype.stepCycle=function(){s+=1,i=0,s==a.length&&(s=0)},f.prototype.advanceTime=function(e){i+=e;var t=e/r;i>=r&&this.stepCycle();var n=s+1;for(var f in a[s])u.set(a[s][f]),o[f].lerp(u,t);this.pushEnvironmentState()},f}),define("3d/EnvironmentController",["application/EventManager","3d/WorldParticleSystems","3d/HeightmapManager","3d/DynamicSkysphere","3d/DynamicEnvironment","game/world/ZoneData","game/GameConfiguration","load/ClientLoader","goo/renderer/Material","goo/entities/components/ScriptComponent","goo/shapes/ShapeCreator","geometrypack/Surface","goo/shapes/Sphere","goo/entities/EntityUtils","goo/renderer/shaders/ShaderLib","goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/TextureCreator","goo/addons/water/FlatWaterRenderer","goo/math/Plane","game/world/ZoneBuilder","3d/GooEffectController","goo/util/Skybox","goo/renderer/shaders/ShaderBuilder","goo/renderer/Texture"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T){function j(e){var t=a.createMaterial(d.uber,"water_colors"),n=(new g).loadTexture2D(e);return t.setTexture("DIFFUSE_MAP",n),t.materialState.ambient=[.11,.19,.26,1],t.materialState.diffuse=[.159,.129,.129,1],t.cullState.frontFace="CW",t.cullState.cullFace="Back",t.cullState.enabled=!1,t.materialState.specular=[.22,.216,.16,.3],t.materialState.emissive=[0,0,0,1],t.materialState.shininess=14.1,t}function F(){return O=new r(N),N.callbacksPreRender.push(function(){var e=C.transformComponent.worldTransform,t=O.skybox.transformComponent.worldTransform;t.translation.setv(e.translation),t.update()}),O.skybox}function I(e){_=p.createTypicalEntity(N.world),_.addToWorld(),e(_)}function q(){var e=E.getSettings()["Fancy Water"].fx.fancy,t;e?(t=j(P),A.meshRendererComponent.materials.push(t),H=new y({normalsUrl:"./resources/water/waternormals3.png"}),N.renderSystem.preRenderers.push(H),H.setWaterEntity(A),H.setSkyBox(L),N.world.world_root.transformComponent.attachChild(A.transformComponent),H.waterMaterial.shader.uniforms.fogColor=[137/255,170/255,220/255],H.waterMaterial.shader.uniforms.sunDirection=[-0.5,-0.1,.23],H.waterMaterial.shader.uniforms.sunColor=[184/255,143/255,50/255],H.waterMaterial.shader.uniforms.waterColor=[0,0,.03],H.waterMaterial.shader.uniforms.sunShininess=50,H.waterMaterial.shader.uniforms.sunSpecPower=.7,H.waterMaterial.shader.uniforms.fogStart=1e4,H.waterMaterial.shader.uniforms.waterScale=8,H.waterMaterial.shader.uniforms.distortionMultiplier=.04,H.waterMaterial.shader.uniforms.fogScale=5e4,H.waterMaterial.shader.uniforms.fresnelPow=1.3,H.waterMaterial.shader.uniforms.normalMultiplier=5,H.waterMaterial.shader.uniforms.fresnelMultiplier=.3):(t=j(P),A.meshRendererComponent.materials.push(t))}function R(){O.makeSun();var e=c.createTessellatedFlat(115e3,115e3,40,40);A=p.createTypicalEntity(N.world,e),A.transformComponent.transform.setRotationXYZ(-Math.PI/2,0,0),A.addToWorld()}function G(e,t,n,r){D=t,U(e,n,r),M=new i(1,124e3)}function Y(e){var t=function(){K(),e()};w.buildTerrainZone(N,D.loadLevels,n.getTerrainData(),t)}function Z(){A.transformComponent.transform.translation.data[0]=k.data[0],A.transformComponent.transform.translation.data[2]=k.data[2],A.transformComponent.setUpdated()}function et(e){H.waterMaterial.shader.uniforms.sunColor=e,E.setSunlightColor(e),O.setSunColor(e)}function tt(e){H.waterMaterial.shader.uniforms.sunDirection=[e[2],e[0],e[1]],O.setSunXYZ(k.data[0]-e[2]*33500,k.data[1]-e[1]*33500,k.data[2]-e[0]*33500),E.setSunlightDirection(e)}function nt(e){H.waterMaterial.shader.uniforms.fogColor=e,E.setFogColor(e),O.setFogColor(e)}function rt(e){H.waterMaterial.shader.uniforms.fogScale=5e4-k.data[1]*2,E.scaleFogNearFar(e[0],e[1])}function it(e){E.setAmbientColor(e)}function st(e,t,n){O.setColor(e,t,n,k.data[1])}function ot(t){e.eventArgs(t).sunDir&&tt(e.eventArgs(t).sunDir),e.eventArgs(t).fogColor&&e.eventArgs(t).ambientLight&&e.eventArgs(t).skyColor&&st(e.eventArgs(t).fogColor,e.eventArgs(t).ambientLight,e.eventArgs(t).skyColor),e.eventArgs(t).sunLight&&et(e.eventArgs(t).sunLight),e.eventArgs(t).fogColor&&nt(e.eventArgs(t).fogColor),e.eventArgs(t).ambientLight&&it(e.eventArgs(t).ambientLight),e.eventArgs(t).fogDistance&&rt(e.eventArgs(t).fogDistance)}var N,C,k,L,A,O,M,_,D,P="resources/water/watertile.png",H,B=function(e){C=e,k=C.transformComponent.worldTransform.translation},U=function(e,t,r){var i=D.loadZones,s=0,o=0,u=function(){s+=1,s==o&&t()};for(var a=0;a<i.length;a++)i[a].heightData&&(o+=1,n.addHeightMap(e,i[a],i[a].id,u,r)),o||r();o+=1,setTimeout(function(){u()},10)},z=function(t){e.fireEvent(e.list().SPAWN_CLOUDS,{pos:t.pos,size:[t.width,t.height,t.depth],intensity:t.clouds.intensity})},W=function(){e.fireEvent(e.list().LOAD_PROGRESS,{started:1,completed:0,errors:0,id:"load_sky"}),L=F();var t=function(t){$(t),e.fireEvent(e.list().LOAD_PROGRESS,{started:0,completed:1,errors:0,id:"load_sky"})},n=function(){I(t)};n()},X=function(t){N=e.eventArgs(t).goo,W(),R()},V=function(){Z(),M.advanceTime(10)},$=function(n){t.addWorldParticles(n),e.registerListener(e.list().MOVE_AUDIO_LISTENER,V)},J={},K=function(){var t=function(e){J[e.playId]=e};e.fireEvent(e.list().START_SOUND_LOOP,{soundData:e.sound().SEATOWN_AMB,loopId:"env_amb",callback:t}),e.fireEvent(e.list().START_SOUND_LOOP,{soundData:e.sound().DARK_SUSPENS,loopId:"susp_amb",callback:t})},Q=function(e){for(var t=0;t<D.loadZones.length;t++)z(D.loadZones[t])};return e.registerListener(e.list().ENINGE_READY,X),e.registerListener(e.list().SET_ENVIRONMENT,ot),{setCameraEntity:B,loadScenarioEnvironment:G,loadEnvironment:Y,loadWaterShader:q}}),define("game/scenario/ScenarioSelector",["load/ClientLoader","3d/EnvironmentController","application/EventManager","load/TrackProgress","game/world/LevelController"],function(e,t,n,r,i){function a(e){o=e,console.log("SET GOO: ",o)}function f(){n.removeListener(n.list().LOADING_ENDED)}function l(e){function a(){if(u)return;console.log("Track Progress says ",r.getLoadedCount()),r.getLoadedCount().started-r.getLoadedCount().finished<=1&&(u=!0,clearInterval(l),console.log("Track Progress says almostThere!"),t.loadWaterShader(),o.world.process(),setTimeout(function(){o.world.process(),setTimeout(function(){o.world.process(),n.fireEvent(n.list().SCENARIO_LOADED,{}),n.removeListener(n.list().SCENARIO_LOADED),i.addPlayerToLevel(),setTimeout(function(){o.startGameLoop(),o.world.process(),n.fireEvent(n.list().LOAD_PROGRESS,{started:0,completed:1,errors:0,id:"game_loop"})},100)},10)},10))}function c(){o.world.process(),n.fireEvent(n.list().LOAD_PROGRESS,{started:0,completed:1,errors:0,id:"load_env"})}function h(){console.log("Terrains image loaded callback"),n.fireEvent(n.list().LOAD_PROGRESS,{started:1,completed:0,errors:0,id:"load_env"}),t.loadEnvironment(c),n.fireEvent(n.list().LOAD_PROGRESS,{started:0,completed:1,errors:0,id:"game_loop"})}s=e;var u=!1,l=setInterval(function(){a()},200);i.registerScenario(s),n.fireEvent(n.list().LOAD_PROGRESS,{started:1,completed:0,errors:0,id:"scenario_init"}),n.registerListener(n.list().LOADING_ENDED,f);var p=function(){console.log("Terrains added callback"),n.removeListener(n.list().SCENARIO_SELECTED),n.fireEvent(n.list().ANALYTICS_EVENT,{category:"SCENARIO SELECT",action:s.IDENTITY.title,labels:s.IDENTITY.tagLine,value:1}),n.fireEvent(n.list().LOAD_PROGRESS,{started:1,completed:0,errors:0,id:"terrain_loaded"})};setTimeout(function(){t.loadScenarioEnvironment(o,s,p,h)},20)}function c(t){setTimeout(function(){l(n.eventArgs(t).scenario)},250),e.loadScenarioData(n.eventArgs(t).scenario)}function h(){e.clientLoaded(),n.fireEvent(n.list().LOAD_UI_TEMPLATE,{templateId:"UI_SCENARIOS"}),n.registerListener(n.list().SCENARIO_SELECTED,c)}function p(){n.fireEvent(n.list().UN_LOAD_3D,{})}var s,o,u=function(){};return u.prototype.setGoo=function(e){a(e)},u.prototype.openScenarioScreen=function(){return h()},n.registerListener(n.list().EXIT_SCENARIO,p),{ScenarioSelector:u,openScenarioScreen:h,setGoo:a}}),define("application/Client",["load/ClientLoader","io/InputSettersGetters","view/ClientViewManager","application/EventManager","game/GameController","game/GameConfiguration","application/UpdateLoop","application/DeviceHandler","game/scenario/ScenarioSelector"],function(e,t,n,r,i,s,o,u,a){var f=function(){};return f.prototype.initiateClient=function(t){this.scenarioSelector=new a.ScenarioSelector,this.gooController=t,this.clientLoader=new e.ClientLoader,this.gameController=new i,this.preload()},f.prototype.propagateGoo=function(e){this.gooController.propagateGoo(),this.scenarioSelector.setGoo(this.gooController.goo)},f.prototype.preload=function(){var e=function(){this.preloadCompleted(),this.propagateGoo()}.bind(this),t=function(){this.clientSetupCompleted()}.bind(this);r.registerListener(r.list().LOADING_COMPLETED,e),r.registerListener(r.list().CLIENT_SETUP_OK,t),this.clientLoader.preloadClientData(s.GAME_IDENTITY)},f.prototype.loadingCompleted=function(){r.removeListener(r.list().LOADING_COMPLETED),r.fireEvent(r.list().CLIENT_READY,{}),this.gameController.setupGame(),r.fireEvent(r.list().CLIENT_SETUP_OK,{})},f.prototype.clientSetupCompleted=function(){u.handleClientSetupDone(),this.clientLoader.clientLoaded()},f.prototype.preloadCompleted=function(){r.removeListener(r.list().LOADING_COMPLETED);var e=function(){this.loadingCompleted()}.bind(this);this.initiateView(),r.registerListener(r.list().LOADING_COMPLETED,e)},f.prototype.initiateView=function(){var e=function(){this.scenarioSelector.openScenarioScreen()}.bind(this);n.initiateView(e)},f}),define("3d/FlightCameraScript",["physics/PhysicalWorld","goo/math/Vector2","goo/math/Vector3","goo/math/Matrix3x3","goo/math/MathUtils"],function(e,t,n,r,i){function o(e){e=e||{};for(var r in s)typeof s[r]=="boolean"?this[r]=e[r]!==undefined?e[r]===!0:s[r]:isNaN(s[r])?s[r]instanceof n?this[r]=e[r]||(new n).copy(s[r]):this[r]=e[r]||s[r]:this[r]=isNaN(e[r])?s[r]:e[r];this.name="FlightCameraScript",this.timeSamples=[0,0,0,0,0],this.xSamples=[0,0,0,0,0],this.ySamples=[0,0,0,0,0],this.sample=0,this.velocity=new t,this.targetSpherical=new n(this.spherical),this.cartesian=new n,this.dirty=!0,this.mouseState={buttonDown:!1,lastX:NaN,lastY:NaN},this.domElement.oncontextmenu=function(){return!1}}function u(e,t,n){var r=(t+n)/2+(n>t?Math.PI:0),s=i.moduloPositive(e-r,i.TWO_PI),o=i.moduloPositive(t-r,i.TWO_PI),u=i.moduloPositive(n-r,i.TWO_PI);return e<0&&t>0?t-=i.TWO_PI:e>0&&t<0&&(t+=i.TWO_PI),e>i.TWO_PI&&n<i.TWO_PI&&(n+=i.TWO_PI),s<o?t:s>u?n:e}var s={domElement:document,turnSpeedHorizontal:.01,turnSpeedVertical:.01,zoomSpeed:.4,dragOnly:!0,dragButton:1,worldUpVector:new n(0,1,0),baseDistance:25,minZoomDistance:.01,maxZoomDistance:1e4,minAscent:-89.95*i.DEG_TO_RAD,maxAscent:89.95*i.DEG_TO_RAD,clampAzimuth:!1,minAzimuth:90*i.DEG_TO_RAD,maxAzimuth:270*i.DEG_TO_RAD,releaseVelocity:!0,invertedX:!1,invertedY:!1,invertedWheel:!0,drag:5,maxSampleTimeMS:200,lookAtPoint:new n(0,0,0),spherical:new n(15,0,0),interpolationSpeed:6,onRun:null};return o.prototype.setCamera=function(e){this.camera=e},o.prototype.updateDragState=function(e){this.mouseState.buttonDown=e,e?(this.mouseState.lastX=NaN,this.mouseState.lastY=NaN,this.velocity.set(0,0),this.spherical.y=i.moduloPositive(this.spherical.y,i.TWO_PI),this.targetSpherical.copy(this.spherical)):this.applyReleaseDrift()},o.prototype.updatePointerState=function(e){this.controlScript.pointerAction(this.targetSpherical,e)},o.prototype.updateDeltas=function(e,t){var n=0,r=0;isNaN(this.mouseState.lastX)||isNaN(this.mouseState.lastY)?(this.mouseState.lastX=e,this.mouseState.lastY=t):(n=-(e-this.mouseState.lastX),r=t-this.mouseState.lastY,this.mouseState.lastX=e,this.mouseState.lastY=t);if(this.dragOnly&&!this.mouseState.buttonDown||n===0&&r===0)return;this.timeSamples[this.sample]=Date.now(),this.xSamples[this.sample]=n,this.ySamples[this.sample]=r,this.sample++,this.sample>this.timeSamples.length-1&&(this.sample=0),this.velocity.set(0,0),this.move(this.turnSpeedHorizontal*n,this.turnSpeedVertical*r)},o.prototype.move=function(e,t){var n=this.invertedX?-e:e,r=this.invertedY?-t:t;this.clampAzimuth?this.targetSpherical.y=u(this.targetSpherical.y-n,this.minAzimuth,this.maxAzimuth):this.targetSpherical.y=this.targetSpherical.y-n,this.targetSpherical.z=i.clamp(this.targetSpherical.z+r,this.minAscent,this.maxAscent),this.dirty=!0},o.prototype.applyWheel=function(e){var e=(this.invertedWheel?-1:1)*e*this.targetSpherical.x*.3;this.zoom(this.zoomSpeed*e)},o.prototype.zoom=function(e){var t=e*this.baseDistance;this.controlScript.setCamDistance(i.clamp(this.targetSpherical.x+t,this.minZoomDistance,this.maxZoomDistance)),this.controlScript.adjustFov(e),this.dirty=!0},o.prototype.applyReleaseDrift=function(){this.controlScript.releaseDrift(this.targetSpherical);return},o.prototype.updateVelocity=function(e){this.velocity.lengthSquared()>1e-6?(this.move(this.velocity.x,this.velocity.y),this.velocity.mul(i.clamp(i.lerp(e,1,1-this.drag),0,1)),this.dirty=!0):this.velocity.set(0,0,0)},o.prototype.setControlScript=function(e){this.controlScript=e,this.controlScript.setCamera(this.camera)},o.prototype.setCameraTarget=function(e,t,n,r){console.log("Set camera target spatial: ",e),this.setControlScript(r),this.controlScript.setTargetSpatial(e),this.spherical.x=this.controlScript.getCamDistance(),this.spherical.y=this.targetSpherical.y,this.spherical.z=this.targetSpherical.z},o.prototype.calcFrameCartesian=function(e){this.targetSpherical.x=this.controlScript.getCamDistance(),this.releaseVelocity&&this.updateVelocity(e._world.tpf);var t=this.interpolationSpeed*e._world.tpf;this.clampAzimuth?this.spherical.y=i.lerp(t,this.spherical.y,this.targetSpherical.y):this.spherical.y=i.lerp(t,this.spherical.y,this.targetSpherical.y),this.spherical.x=i.lerp(t,this.spherical.x,this.targetSpherical.x),this.spherical.z=i.lerp(t,this.spherical.z,this.targetSpherical.z),i.sphericalToCartesian(this.spherical.x,this.spherical.y,this.spherical.z,this.cartesian)},o.prototype.frameUpdate=function(e){this.calcFrameCartesian(e),this.controlScript.calcCamPos(this.cartesian,e.transformComponent.transform),this.controlScript.calcCamRot(e,this.targetSpherical),this.spherical.distanceSquared(this.targetSpherical)<1e-6&&(this.dirty=!1,this.spherical.y=i.moduloPositive(this.spherical.y,i.TWO_PI),this.targetSpherical.copy(this.spherical))},o.prototype.update=function(e){this.frameUpdate(e),e.transformComponent.setUpdated()},o}),define("3d/cameras/TransitMode",["application/EventManager","physics/PhysicalWorld","goo/math/Vector2","goo/math/Vector3","goo/math/Matrix3x3","goo/math/MathUtils"],function(e,t,n,r,i,s){function C(e){v=e}function k(e){d=e}function L(e){w.setFrustumPerspective(e,null,null,null)}function A(){L(N[T].fov),y=N[T].distance}function O(e){A()}function M(e){T=e,A()}function _(e){O(e)}function D(e){}function P(){return y}function H(){return.8}function B(){return.5}function j(e){return a.set(e),v.rot.applyPost(a),a.add(v.pos),l.set(v.pos),l.add(m),e.add(a),e}function F(e){return a.set(d),v.rot.applyPost(a),a.add(e),g.set(v.pos),g.add(a),g}function I(e){var t=e.transformComponent,n=t.transform;return a.set(2,2,-2),v.rot.applyPost(a),g.add(a),n.translation.set(g),h.set(v.rot),h.invert(),a.set(b),l.set(g),l.sub(v.pos),n.rotation.lookAt(l,a),n}function q(e){}function U(e,t){}function z(e){w=e,M(x)}var o;require(["game/player/PlayerController"],function(e){o=e});var u,a=new r,f=new r,l=new r,c=new r,h=new i,p=new i,d=new r(0,1.52,3),v,m=new r,g=new r,y=.15,b=new r(0,1,0),w,E=45,S,x=0,T,N=[{fov:E-6,distance:7},{fov:E-8,distance:5},{fov:E+7,distance:75}],R;return{adjustFov:_,setCamera:z,pointerAction:U,releaseDrift:q,setTargetSpatial:C,setTargetOffset:k,setCamDistance:D,getCamDistance:P,calcCamPos:F,calcCamRot:I}}),define("3d/cameras/PilotMode",["application/EventManager","physics/PhysicalWorld","goo/math/Vector2","goo/math/Vector3","goo/math/Matrix3x3","goo/math/MathUtils"],function(e,t,n,r,i,s){function N(e){d=e}function C(e){p=e}function k(e){b.setFrustumPerspective(e,null,null,null)}function L(){k(T[x].fov),g=T[x].distance}function A(t){t<0?t=-1:t=1,x+=t,x<0&&(x=0);if(x>=T.length){x=S,e.fireEvent(e.list().SET_CAMERA_TARGET,{spatial:d,controlScript:"externalCam"});return}L()}function O(e){x=e,L()}function M(e){A(e)}function _(e){}function D(){return g}function P(){return.8}function H(){return.5}function B(e){a.set(e),d.rot.applyPost(a),a.add(d.pos),l.set(d.pos),l.add(v);var n=t.physicsRayRange(l.data,a.data);return n&&e.mul(n.fraction),e.mul(.5),e}function j(e){return v.set(p),m.set(p),a.set(p),a.add(d.pos),e.add(0,g*g*.5,0),a.add(e),f.set(d.pos),f.add(m),m.add(e),m}function F(e){var t=e.transformComponent,n=t.transform;n.translation.set(m),c.set(d.rot),c.invert(),a.set(y),c.applyPost(a),a.lerp(y,P()),a.add(u.spatial.angularVelocity),l.set(m),l.sub(v),n.rotation.lookAt(l,a);var r=Math.sqrt(u.spatial.velocity.lengthSquared());return n.rotation.rotateX(-u.spatial.angularVelocity.data[0]*5*r),n.rotation.rotateY(-u.spatial.angularVelocity.data[1]*5*r),n.rotation.rotateZ(-u.spatial.angularVelocity.data[2]*5*r),n}function I(e){e.y=Math.PI*1.5,e.z=-0.01+.02*Math.sqrt(e.x)}function q(e){e.y=Math.PI*1.5}function R(e){b=e,O(S),u=o.getPlayerEntity()}var o;require(["game/player/PlayerController"],function(e){o=e});var u,a=new r,f=new r,l=new r,c=new i,h=new i,p=new r(0,.82,0),d,v=new r,m=new r,g=.15,y=new r(0,1,0),b,w=45,E,S=3,x,T=[{fov:w-27,distance:.21},{fov:w-11,distance:.22},{fov:w+3,distance:.24},{fov:w+16,distance:.26},{fov:w+25,distance:.28}];return{adjustFov:M,setCamera:R,pointerAction:q,releaseDrift:I,setTargetSpatial:N,setTargetOffset:C,setCamDistance:_,getCamDistance:D,calcCamPos:j,calcCamRot:F}}),define("3d/cameras/ExternalCamera",["application/EventManager","physics/PhysicalWorld","goo/math/Vector2","goo/math/Vector3","goo/math/Matrix3x3","goo/math/MathUtils"],function(e,t,n,r,i,s){function k(e){v=e}function L(e){d.set(e)}function A(e){w.setFrustumPerspective(e,null,null,null)}function O(){A(C[T].fov),y=C[T].distance}function M(t){t<0?t=-1:t=1,T+=t;if(T<0){T=0,e.fireEvent(e.list().SET_CAMERA_TARGET,{spatial:v,geometry:u.pilot.geometries[0],controlScript:"pilotCam"});return}T>=C.length&&(T=C.length-1),O()}function _(e){T=e,O()}function D(e){M(e)}function P(e){}function H(){return y}function B(){return.8}function j(){return.5}function F(e){return a.set(e),v.rot.applyPost(a),a.add(v.pos),l.add(m),e.mul(.5),e}function I(e){a.set(d),g.set(v.pos),v.rot.applyPost(a),e.add(0,y*y*.5,0),a.add(e),l.set(v.pos),l.add(a);var n=t.physicsRayRange(v.pos,l.data);return n&&a.mul(n.fraction),g.add(a),g}function q(e){var t=e.transformComponent,n=t.transform;return n.translation.set(g),h.set(v.rot),h.invert(),a.set(b),h.applyPost(a),a.lerp(b,B()),a.add(u.spatial.angularVelocity),l.set(g),l.sub(v.pos),f.set(0,0,y*.002),c.lerp(f,.15),n.rotation.lookAt(l,a),n.rotation.rotateX(-u.spatial.angularVelocity.data[0]*3+c.data[2]),n.rotation.rotateY(-u.spatial.angularVelocity.data[1]*5+c.data[0]),n.rotation.rotateZ(-u.spatial.angularVelocity.data[2]*12+c.data[1]),n}function R(e){}function z(e,t){return}function W(e){w=e,_(x),u=o.getPlayerEntity(),N=u.pieceData.dimensions.length}var o;require(["game/player/PlayerController"],function(e){o=e});var u,a=new r,f=new r,l=new r,c=new r,h=new i,p=new i,d=new r(0,-0.52,-6),v,m=new r,g=new r,y=.15,b=new r(0,1,0),w,E=45,S,x=1,T,N=10,C=[{fov:E-12,distance:N*.5},{fov:E-8,distance:N*1.1},{fov:E,distance:N*3},{fov:E+7,distance:N*7},{fov:E+15,distance:N*12}],U;return{adjustFov:D,setCamera:W,pointerAction:z,releaseDrift:R,setTargetSpatial:k,setTargetOffset:L,setCamDistance:P,getCamDistance:H,calcCamPos:I,calcCamRot:q}}),require(["application/EventManager","3d/EnvironmentController","goo/renderer/Camera","goo/entities/components/CameraComponent","goo/entities/EntityUtils","goo/math/Vector3","goo/math/Matrix3x3","goo/entities/components/ScriptComponent","3d/FlightCameraScript","3d/cameras/TransitMode","3d/cameras/PilotMode","3d/cameras/WalkMode","3d/cameras/ExternalCamera"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p=new s(0,.82,0),d={pilotCam:l,transitCam:f,walkCam:c,externalCam:h},v,m,g,y=function(i){g=e.eventArgs(i).goo,console.log("Setup Goo Camera");var f=new n(45,1,.25,45e3);m=g.world.createEntity("ViewCameraEntity");var l=new r(f);m.setComponent(l),v=new a({domElement:g.renderer.domElement,spherical:new s([.55,0,0]),lookAtPoint:new s,worldUpVector:new s([0,1,0]),zoomSpeed:.312407560349,maxZoomDistance:1256,minZoomDistance:.05}),v.setCamera(f),v.setCameraTarget({pos:new s,rot:new o},p,null,d.transitCam),m.setComponent(new u(v)),m.addToWorld(),t.setCameraEntity(m),g.world.getSystem("RenderSystem").enableComposers(!0);var c=function(){v.update(m)};e.registerListener(e.list().POST_UPDATE,c)},b,w=function(e){b=e,e.transformComponent.attachChild(m.transformComponent)},E=function(t){var n=e.eventArgs(t).spatial;g.world.world_root.spatial=n;var r=e.eventArgs(t).geometry;r?w(r):b&&b.transformComponent&&b.transformComponent.detachChild(m.transformComponent),v.updateDragState(1),v.updatePointerState(11),setTimeout(function(){v.updateDragState(0),v.updatePointerState(0)},100),v.setCameraTarget(n,p,g.world.world_root.spatial,d[e.eventArgs(t).controlScript])},S=function(t){var n=e.eventArgs(t).xy;v.updateDeltas(n[0],n[1])},x,T=function(){v.updateDragState(1),x=!0},N=function(){v.updateDragState(0),x=!1},C=function(t){var n=e.eventArgs(t).delta;v.applyWheel(n),x||v.applyReleaseDrift()},k=function(){v.updatePointerState(0)},L=function(){v.updatePointerState(1)},A=function(t){console.log("Set camera analogs: ",e.eventArgs(t)),v.move(e.eventArgs(t).rotX*-0.05,e.eventArgs(t).rotY*-0.05)};e.registerListener(e.list().START_POINTER_DRAG,L),e.registerListener(e.list().START_CAMERA_DRAG,T),e.registerListener(e.list().STOP_CAMERA_DRAG,N),e.registerListener(e.list().MOUSE_POSITION_UPDATE,S),e.registerListener(e.list().MOUSE_WHEEL_UPDATE,C),e.registerListener(e.list().ENINGE_READY,y),e.registerListener(e.list().SET_CAMERA_TARGET,E),e.registerListener(e.list().SET_CAMERA_ANALOGS,A)}),define("3d/GooCameraController",function(){}),define("3d/GooEntityDataLoader",["application/EventManager","goo/util/rsvp","goo/loaders/DynamicLoader","goo/renderer/Util","goo/entities/EntityUtils"],function(e,t,n,r,i){function p(e){e["project.project"]&&e["project.project"].skybox&&console.log("DELETED SKYBOX:",e),console.log("SKIP SKYBOX:",e)}var s,o={},u={},a,f=function(e){s=e,a=new n({world:s.world,rootPath:"resources/goo/bundles",beforeAdd:function(){return!1}})},l={},c=function(e){for(var t=0;t<e.length;t++)e[t].entity.meshRendererComponent.isReflectable=!1},h=function(e,t){if(!l[t]){var n=o[e],r=t+"/entities/RootNode.entity";l[t]=n.getCachedObjectForRef(r)}var u=i.clone(s.world,l[t]);return t=="tre_kronor"||t=="battleship_skinned"||t=="carrier"?u.transformComponent.children[0].entity.meshRendererComponent.isReflectable=!1:c(u.transformComponent.children),u.animationComponent,u},d=function(e,r){var i=new t.Promise;if(r=="project.project"){var u=new n({world:s.world,rootPath:"resources/goo/"+e,beforeAdd:function(){return!1}});return o[e]=u,u.load(r).then(function(t){i.resolve(e)}.bind(this)).then(null,function(e){i.reject(e)}),u.promise=i,i}return o[e]=a,a.loadFromBundle("project.project",r).then(function(t){i.resolve(e)}.bind(this)).then(null,function(e){i.reject(e)}),i},v=function(e,t){u[e]||(u[e]=[]),u[e].push(t)},m=function(e,t){for(var n=0;n<u[e].length;n++)u[e][n](t);delete u[e]},g=function(t){var n=e.eventArgs(t).projectPath,r=e.eventArgs(t).refFile,i=e.eventArgs(t).callback;if(l[r]){i(n);return}if(u[r]){v(r,i);return}var s=d(n,r);v(r,i);var o=function(e){m(r,e)};s.resolve=o};return e.registerListener(e.list().LOAD_GOO_PROJECT,g),{cloneCachedEntity:h,setGoo:f}}),define("goo/entities/systems/ParticlesSystem",["goo/entities/systems/System"],function(e){function t(){e.call(this,"ParticlesSystem",["TransformComponent","MeshRendererComponent","MeshDataComponent","ParticleComponent"]),this.passive=!1}return t.prototype=Object.create(e.prototype),t.prototype.process=function(e,t){if(t>1)return;for(var n=0,r=e.length;n<r;n++){var i=e[n],s=i.particleComponent;s.enabled&&this.updateParticles(i,s,t)}},t.prototype.updateParticles=function(e,t,n){var r=0,i=-1,s,o=!1,u=!1;while(r<t.particleCount){while(s===undefined){i++;if(t.emitters.length>i){s=t.emitters[i];if(s.influences.length)for(var a=0,f=s.influences.length;a<f;a++)s.influences[a].prepare(e,s);if(!s.enabled){s=undefined;continue}s.totalParticlesToSpawn!==0&&(s.particlesWaitingToRelease+=s.releaseRatePerSecond*n,s.particlesWaitingToRelease=Math.max(s.particlesWaitingToRelease,0),u=!0);if(s.particlesWaitingToRelease<1){s=undefined;continue}}else s=null}var l=t.particles[r];if(l.alive&&l.emitter&&l.emitter.influences.length)for(var a=0,f=l.emitter.influences.length;a<f;a++)l.emitter.influences[a].enabled&&l.emitter.influences[a].apply(n,l,r);l.alive&&(l.update(n,e),o=!0,u=!0);if(!l.alive&&s){s.particlesWaitingToRelease--,s.totalParticlesToSpawn>=1&&s.totalParticlesToSpawn--,l.respawnParticle(s),s.getEmissionPoint(l,e),s.getEmissionVelocity(l,e);if(s.particlesWaitingToRelease<1||s.totalParticlesToSpawn===0)s=undefined}r++}o&&(t.meshData.vertexData._dataNeedsRefresh=!0,e.meshDataComponent.autoCompute=!0),u||(t.enabled=!1)},t}),"use strict",define("3d/ParticleSystemFactory",["application/EventManager","goo/renderer/Util","goo/shapes/ShapeCreator","goo/entities/EntityUtils","goo/renderer/Shader","goo/renderer/shaders/ShaderLib","goo/renderer/Material","goo/entities/components/ScriptComponent","goo/entities/World","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/loaders/Loader","goo/renderer/Texture","goo/renderer/shaders/ShaderBuilder","goo/entities/systems/ParticlesSystem","goo/entities/components/ParticleComponent","goo/particles/ParticleUtils","3d/GooEffectController"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){var y={},b={},w={},E,S=function(t){E=e.eventArgs(t).goo},x=function(e,t){if(!e.transformComponent)return console.log("SETUP ROT PARTICLE",e.transformComponent),t;var t=e.transformComponent.transform.rotation.applyPost(t);return t},T=function(e){if(!e)return;if(e.velocity)return function(t,n){return t.velocity=e.velocity(t),t.velocity}},N=function(e){if(!e)return;if(e.position)return function(t,n){return t.position=e.position(t),m.applyEntityTransformPoint(t.position,n)}},C=function(e){if(!e)return;if(e.orientation)return e.orientation},k=function(e,t,n){var r=[];for(var i=0;i<e.length;i++){var s=e[i];s.releaseRatePerSecond*=.8*n+.2,s.minLifetime*=.6+n*.4,s.maxLifetime*=.6+n*.4;var o={getEmissionPoint:N(t),getEmissionVelocity:T(t),getParticleBillboardVectors:C(t)};for(var u in s)o[u]=s[u];r.push(o)}return r},L=function(e){var t=0;for(var n=0;n<e.length;n++){var r=e[n];t+=r.releaseRatePerSecond*(r.maxLifetime*.65+r.minLifetime*.65)}return Math.ceil(t)},A=function(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n],i={};for(var s in r)i[s]=r[s];t.push(i)}return t},O=function(e,t){var n=null;return e.targetSpace=="parent"&&(n=t),e.targetSpace=="world"&&(n=t._world.world_root),n},M=function(e,t,n,r){var i=g.getSettingParam("particles","highDensity"),s=new v({parentEntity:O(n,t),timeline:A(n.timeline),emitters:k(n.emitters,r,i),particleCount:L(n.emitters,i)});e.setComponent(s);var o=new f(s.meshData);e.setComponent(o)},_=function(e,t,n,r){e.transformComponent.transform.translation.set(0,0,0);if(b[e.name])var i=b[e.name];else{var i=o.createMaterial(s.particles);i.setTexture("DIFFUSE_MAP",r),i.blendState=t.blendState,i.cullState.enabled=!1,i.depthState.write=!1,i.depthState.read=!0,i.renderQueue=2500,console.log("PARTICLE MATERIAL: ",i),r.wrapS="EdgeClamp",r.wrapT="EdgeClamp",r.generateMipmaps=!0,b[e.name]=i}var u=new l;return u.cullMode="Never",u.castShadows=!1,u.isReflectable=!1,u.receiveShadows=!1,console.log("PARTICLE MESH COMPONENT: ",u),u.materials.push(i),e.setComponent(u),e};return e.registerListener(e.list().ENINGE_READY,S),{buildParticleSystem:_,createParticleEmitters:M}}),"use strict",define("3d/GooCustomEntityCreator",["application/EventManager","goo/renderer/Util","goo/shapes/ShapeCreator","goo/entities/EntityUtils","goo/renderer/Shader","goo/renderer/shaders/ShaderLib","goo/renderer/Material","goo/entities/components/ScriptComponent","goo/entities/World","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/loaders/Loader","goo/loaders/DynamicLoader","goo/renderer/Texture","goo/renderer/shaders/ShaderBuilder","goo/entities/systems/ParticlesSystem","goo/entities/components/ParticleComponent","goo/particles/ParticleUtils","3d/ParticleSystemFactory"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){var b={},w={},E={},S={},x={},T={},N={},C={},k={},L={},A,O,M,_,D=function(e){O=e,A=O.world;var t={rootPath:"../client/resources/",world:A};M=new h(t),_=M},P=function(e,t){e.meshRendererComponent.materials.push(t)},H=function(e,t){e.meshRendererComponent.materials.push(material)},B=function(t,n){e.fireEvent(e.list().ANALYTICS_EVENT,{category:"3D INIT ERROR",action:n,labels:t,value:1}),alert("Some sort of loading error!: "+n)},j=function(e,t){var n=new f(t);e.setComponent(n);var r=new l;return e.setComponent(r),e},F=function(t){var n=JSON.parse(e.eventArgs(t).mesh);console.log(n),E[e.eventArgs(t).url]=n},I=function(t){var n=JSON.parse(e.eventArgs(t).skeleton),r=n.joints,i=e.eventArgs(t).url,s=[];console.log(r);for(var o=0;o<r.length;o++){var u=new Joint(r[o].name),a={data:r[o].inverseBindPose.matrix};u._inverseBindPose.matrix.copy(a),u._index=r[o].index,u._parentIndex=r[o].parentIndex,s.push(u)}var f=new Skeleton(i,s);S[i]=f,console.log(S)},q=function(t){var n=JSON.parse(e.eventArgs(t).animation);x[e.eventArgs(t).url]=n,console.log(x)},R=function(t){var n=e.eventArgs(t).texture,r=new p(n);C[e.eventArgs(t).url]=r},U=function(t){var n=JSON.parse(e.eventArgs(t).material);N[e.eventArgs(t).url]={data:n}},z=function(e,t,n){k[e]||(k[e]={});var r=n;t=="shader"&&(r=JSON.parse(n)),k[e][t]=r},W=function(e){k[e].shader||B("shader data incomplete ",e),k[e].vert||B("shader vert incomplete ",e),k[e].frag||B("shader frag incomplete ",e);var t=k[e].shader,n={attributes:t.attributes,uniforms:t.uniforms,vshader:k[e].vert,fshader:k[e].frag};t.defines&&(n.defines=t.defines);if(t.processors){n.processors=[];for(var r=0;r<t.processors.length;r++)n.processors.push(d[t.processors[r]].processor)}return L[e]=n,L[e].program=new i(e,n),L[e].program=new i("uber",s.uber),n},X=function(e,t,n){var r=e.data,i={};if(r.uniforms)for(var s in r.uniforms)i[s]=r.uniforms[s];var u=L[n];u||(u=W(n));var a=new o(r.name);a.shader=L[n].program,a.uniforms=r.uniforms,a.blendState.blending="CustomBlending",a.materialState={ambient:r.uniforms.materialAmbient,diffuse:r.uniforms.materialDiffuse,emissive:r.uniforms.materialEmissive,specular:r.uniforms.materialSpecular,shininess:r.uniforms.materialSpecularPower,transparency:r.uniforms.opacity},a.renderQueue=2200;for(var f in t)f=="TRANSPARENCY_MAP"&&(a.renderQueue=2100,a.depthState.write=!1,a.depthState.read=!0),C[t[f]]||B("textureId not loaded: ",t[f]),a.setTexture(f,C[t[f]]);return e.material=a,a},V=function(e,t,n,r,i){E[t]||B("Mesh not loaded: ",t),N[n]||B("Material not loaded: ",n),k[i]||B("shaderId not loaded: ",i);var s=j(e,E[t]),o=N[n].material;return o||(o=X(N[n],r,i)),P(s,o),s},$=function(e,t){if(w[e])var n=r.clone(O.world,w[e]);else{var n=A.createEntity(e);w[e]=n}n.addToWorld(),n.models={};for(var i in t){var s=t[i].mesh;if(w[s])var o=r.clone(O.world,w[s]);else{var u=t[i],o=A.createEntity("mesh_"+i);w[s]=o,V(o,u.mesh,u.material,u.textures,u.shaderId)}if(t[i].skeleton){var a=S[t[i].skeleton],f=new SkeletonPose(a),l=new AnimationComponent(f);console.log(a),console.log("Attach Skeleton to EntityHierarchy",e,f),console.log("Animation Component:",l,o)}n.transformComponent.attachChild(o.transformComponent),o.addToWorld(),n.models[s]=o}return n},J=function(e){var t=A.createEntity(e);return O.world.world_root.transformComponent.attachChild(t.transformComponent),t},K=function(e){var t=e._skeletonPose._localTransforms;t[3].setRotationXYZ(0,0,0),t[3].update(),e._skeletonPose.updateTransforms()},Q=function(t){var n=e.eventArgs(t).pieceData,r=e.eventArgs(t).modelPath,i=J("piece_root_"+r),s=$(r,n);i.gameModels=s,i.setComponent(new u({run:function(e){if(!e.gameSpatial)return;e.transformComponent.transform.rotation=e.gameSpatial.rot,e.transformComponent.transform.translation.setv(e.gameSpatial.visualPos),e.transformComponent.setUpdated()}})),console.log("Piece Root: ",i),s.transformComponent.transform.setRotationXYZ(-Math.PI/2,0,0),i.addToWorld(),i.transformComponent.attachChild(s.transformComponent),e.eventArgs(t).callback(i)},G=function(t){z(e.eventArgs(t).shaderId,e.eventArgs(t).type,e.eventArgs(t).data)},Y=function(t){var n=e.eventArgs(t).parentGooEntity,r=e.eventArgs(t).systemParams,i=e.eventArgs(t).emitFunctions,s=A.createEntity("particles_"+r.name),o={offset:[0,0],repeat:[1,1]},u=new p(C[r.textures.PARTICLE_TX].image,o);y.buildParticleSystem(s,r,i,u),y.createParticleEmitters(s,n,r,i),n&&(n.transformComponent.attachChild(s.transformComponent),s.addToWorld()),e.eventArgs(t).callback&&e.eventArgs(t).callback(s)};return e.registerListener(e.list().REGISTER_GOO_MESH,F),e.registerListener(e.list().REGISTER_GOO_SKELETON,I),e.registerListener(e.list().REGISTER_GOO_ANIMATION,q),e.registerListener(e.list().REGISTER_GOO_MATERIAL,U),e.registerListener(e.list().REGISTER_GOO_TEXTURE,R),e.registerListener(e.list().REGISTER_GOO_SHADER,G),e.registerListener(e.list().BUILD_GOO_PARTICLES,Y),{setGoo:D}}),"use strict",define("3d/GooEntityFactory",["application/EventManager","goo/entities/components/ScriptComponent","3d/GooEntityDataLoader","3d/GooCustomEntityCreator","goo/renderer/Material","goo/shapes/ShapeCreator","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/renderer/shaders/ShaderLib","game/movement/MobileUnits"],function(e,t,n,r,i,s,o,u,a,f){var l={},c={},h={},p={},d={},v={},m={},g={},y={},b={},w,E,S,x,T=function(e){E=e,w=E.world;var t={world:w};n.setGoo(E),r.setGoo(E),f.setWorld(E.world)},N=function(e,t){e.meshRendererComponent.materials.push(t)},C=function(e,t){e.meshRendererComponent.materials.push(material)},k=function(t,n){e.fireEvent(e.list().ANALYTICS_EVENT,{category:"3D INIT ERROR",action:n,labels:t,value:1}),alert("Some sort of loading error!: "+n)},L=function(e,t){var n=new o(t);e.setComponent(n);var r=new u;return e.setComponent(r),e},A=function(t){var n=JSON.parse(e.eventArgs(t).mesh);console.log(n),h[e.eventArgs(t).url]=S._parseMeshData(n,0);return;var r,i},O=function(t){var n=JSON.parse(e.eventArgs(t).skeleton),r=n.joints,i=e.eventArgs(t).url,s=[];console.log(r);for(var o=0;o<r.length;o++){var u=new Joint(r[o].name),a={data:r[o].inverseBindPose.matrix};u._inverseBindPose.matrix.copy(a),u._index=r[o].index,u._parentIndex=r[o].parentIndex,s.push(u)}var f=new Skeleton(i,s);p[i]=f,console.log(p)},M=function(t){var n=JSON.parse(e.eventArgs(t).animation);d[e.eventArgs(t).url]=n,console.log(d)},_=function(t){var n=e.eventArgs(t).texture,r=new Texture(n);g[e.eventArgs(t).url]=r},D=function(t){var n=JSON.parse(e.eventArgs(t).material);m[e.eventArgs(t).url]={data:n}},P=function(e,t,n){y[e]||(y[e]={});var r=n;t=="shader"&&(r=JSON.parse(n)),y[e][t]=r},H=function(e){y[e].shader||k("shader data incomplete ",e),y[e].vert||k("shader vert incomplete ",e),y[e].frag||k("shader frag incomplete ",e);var t=y[e].shader,n={attributes:t.attributes,uniforms:t.uniforms,vshader:y[e].vert,fshader:y[e].frag};t.defines&&(n.defines=t.defines);if(t.processors){n.processors=[];for(var r=0;r<t.processors.length;r++)n.processors.push(ShaderBuilder[t.processors[r]].processor)}return b[e]=n,b[e].program=new Shader(e,n),b[e].program=new Shader("uber",a.uber),n},B=function(e,t,n){var r=e.data,s={};if(r.uniforms)for(var o in r.uniforms)s[o]=r.uniforms[o];var u=b[n];u||(u=H(n));var a=new i(r.name);a.shader=b[n].program,a.uniforms=r.uniforms,a.blendState.blending="CustomBlending",a.materialState={ambient:r.uniforms.materialAmbient,diffuse:r.uniforms.materialDiffuse,emissive:r.uniforms.materialEmissive,specular:r.uniforms.materialSpecular,shininess:r.uniforms.materialSpecularPower,transparency:r.uniforms.opacity},a.renderQueue=2200;for(var f in t)f=="TRANSPARENCY_MAP"&&(a.renderQueue=2100,a.depthState.write=!1,a.depthState.read=!0),g[t[f]]||k("textureId not loaded: ",t[f]),a.setTexture(f,g[t[f]]);return e.material=a,a},j=function(e,t,n,r,i){h[t]||k("Mesh not loaded: ",t),m[n]||k("Material not loaded: ",n),y[i]||k("shaderId not loaded: ",i);var s=L(e,h[t]),o=m[n].material;return o||(o=B(m[n],r,i)),N(s,o),s},F=function(e,t){if(c[e])var n=EntityUtils.clone(E.world,c[e]);else{var n=w.createEntity(e);c[e]=n}n.addToWorld(),n.models={};for(var r in t){var i=t[r].mesh;if(c[i])var s=EntityUtils.clone(E.world,c[i]);else{var o=t[r],s=w.createEntity("mesh_"+r);c[i]=s,j(s,o.mesh,o.material,o.textures,o.shaderId)}if(t[r].skeleton){var u=p[t[r].skeleton],a=new SkeletonPose(u),f=new AnimationComponent(a);console.log(u),console.log("Attach Skeleton to EntityHierarchy",e,a),console.log("Animation Component:",f,s)}n.transformComponent.attachChild(s.transformComponent),s.addToWorld(),n.models[i]=s}return n},I=function(t){var n=e.eventArgs(t).parentGooEntity,r=e.eventArgs(t).pos.clone(),o=e.eventArgs(t).rot.toAngles(),u=e.eventArgs(t).size.clone(),f=e.eventArgs(t).shape,l=e.eventArgs(t).color,c=w.createEntity("primitive");switch(f){case"Box":var h=s.createBox(u.data[0],u.data[1],u.data[2]);break;case"Sphere":var h=s.createSphere(8,8,u.data[0]);break;case"Cylinder":var h=s.createBox(u.data[0],u.data[1],u.data[2])}var p=i.createMaterial(a.simpleColored,"PrimitiveMaterial");l!=undefined&&(p.uniforms.color=l),L(c,h),N(c,p),n.transformComponent.attachChild(c.transformComponent),c.meshRendererComponent.isReflectable=!1,c.addToWorld(),c.transformComponent.transform.translation.seta(r.data),c.transformComponent.transform.setRotationXYZ(o.data[0],o.data[1],o.data[2]),e.eventArgs(t).callback(c)},q=function(e){var t=w.createEntity(e);return E.world.world_root.transformComponent.attachChild(t.transformComponent),t},R=function(e){var t=e._skeletonPose._localTransforms;t[3].setRotationXYZ(0,0,0),t[3].update(),e._skeletonPose.updateTransforms()},U=function(t){P(e.eventArgs(t).shaderId,e.eventArgs(t).type,e.eventArgs(t).data)},z=function(t){var n=e.eventArgs(t).parentGooEntity,r=e.eventArgs(t).systemParams,i=e.eventArgs(t).emitFunctions,s=w.createEntity("particles_"+r.name),o={offset:[0,0],repeat:[1,1]},u=new Texture(g[r.textures.PARTICLE_TX].image,o);ParticleSystemFactory.buildParticleSystem(s,r,i,u),ParticleSystemFactory.createParticleEmitters(s,n,r,i),n&&(n.transformComponent.attachChild(s.transformComponent),s.addToWorld()),e.eventArgs(t).callback&&e.eventArgs(t).callback(s)},W=function(n){var r=e.eventArgs(n).gooEntity,i=e.eventArgs(n).gameEntity;r.gameSpatial=i.spatial,i.spatial||alert("ActiveEntity Needs gameSpatial to work  o.O"),r.scriptComponent.scripts.push(new t({run:function(e){e.transformComponent.transform.rotation=e.gameSpatial.rot,e.transformComponent.transform.translation.setv(e.gameSpatial.visualPos),e.transformComponent.setUpdated()}})),r.addToWorld()},X=function(r){var i=e.eventArgs(r).callback,s=e.eventArgs(r).modelPath,o=e.eventArgs(r).projPath,u=n.cloneCachedEntity(o,s);u.setComponent(new t),i(u)};return e.registerListener(e.list().BUILD_GOO_GAMEPIECE,X),e.registerListener(e.list().ACTIVATE_GOO_ENTITY,W),e.registerListener(e.list().BUILD_GOO_PRIMITIVE,I),{setGoo:T}}),define("goo/entities/systems/TransformSystem",["goo/entities/systems/System"],function(e){function t(){e.call(this,"TransformSystem",["TransformComponent"])}return t.prototype=Object.create(e.prototype),t.prototype.process=function(e){var t,n;for(t=0;t<e.length;t++)n=e[t].transformComponent,n._updated=!1,n._dirty&&n.updateTransform();for(t=0;t<e.length;t++)n=e[t].transformComponent,n._dirty&&this.updateWorldTransform(n)},t.prototype.updateWorldTransform=function(e){e.updateWorldTransform();for(var t=0;t<e.children.length;t++)this.updateWorldTransform(e.children[t])},t}),define("goo/renderer/SimplePartitioner",["goo/renderer/Camera"],function(e){function t(){}return t.prototype.added=function(){},t.prototype.removed=function(){},t.prototype.process=function(t,n,r){var i=0;for(var s=0;s<n.length;s++){var o=n[s];if(o.skip||o.meshRendererComponent.hidden)continue;if(o.meshRendererComponent.cullMode==="Never")r[i++]=o,o.isVisible=!0;else{var u=o.meshRendererComponent.worldBound,a=t.contains(u);a!==e.Outside?(r[i++]=o,o.isVisible=!0):o.isVisible=!1}}r.length=i},t}),define("goo/entities/systems/RenderSystem",["goo/entities/systems/System","goo/entities/SystemBus","goo/renderer/SimplePartitioner","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/renderer/Util"],function(e,t,n,r,i,s){function o(){e.call(this,"RenderSystem",["MeshRendererComponent","MeshDataComponent"]),this.entities=[],this.renderList=[],this.postRenderables=[],this.partitioner=new n,this.preRenderers=[],this.composers=[],this._composersActive=!0,this.doRender=!0,this._debugMaterials={},this.overrideMaterials=[],this.camera=null,this.lights=[],this.currentTpf=0;var r=this;t.addListener("goo.setCurrentCamera",function(e){r.camera=e.camera}),t.addListener("goo.setLights",function(e){r.lights=e}),this.picking={doPick:!1,x:0,y:0,pickingStore:{},pickingCallback:function(e,t){console.log(e,t)},skipUpdateBuffer:!1}}return o.prototype=Object.create(e.prototype),o.prototype.pick=function(e,t,n,r){this.picking.x=e,this.picking.y=t,this.picking.skipUpdateBuffer=r===undefined?!1:r,n&&(this.picking.pickingCallback=n),this.picking.doPick=!0},o.prototype.inserted=function(e){this.partitioner&&this.partitioner.added(e)},o.prototype.deleted=function(e){this.partitioner&&this.partitioner.removed(e)},o.prototype.process=function(e,t){this.entities=e,this.currentTpf=t},o.prototype.render=function(e){if(!this.doRender)return;if(this.camera){e.updateShadows(this.partitioner,this.entities,this.lights);for(var t=0;t<this.preRenderers.length;t++){var n=this.preRenderers[t];n.process(e,this.entities,this.partitioner,this.camera,this.lights)}this.partitioner.process(this.camera,this.entities,this.renderList);if(this.composers.length>0&&this._composersActive)for(var t=0;t<this.composers.length;t++){var r=this.composers[t];r.render(e,this.currentTpf,this.camera,this.lights,null,!0,this.overrideMaterials)}else e.render(this.renderList,this.camera,this.lights,null,{color:!1,depth:!0,stencil:!0},this.overrideMaterials)}},o.prototype.renderToPick=function(e,t){e.renderToPick(this.renderList,this.camera,!0,t)},o.prototype.enableComposers=function(e){this._composersActive=!!e},o.prototype._createDebugMaterial=function(e){if(e==="")return;var t;switch(e){case"wireframe":case"color":t=s.clone(i.simpleColored.fshader);break;case"lit":t=s.clone(i.simpleLit.fshader);break;case"texture":t=s.clone(i.textured.fshader);break;case"normals":t=s.clone(i.showNormals.fshader);break;case"simple":t=s.clone(i.simple.fshader)}var n=s.clone(i.uber);n.fshader=t,e!=="flat"?(this._debugMaterials[e]=r.createMaterial(n,e),e==="wireframe"&&(this._debugMaterials[e].wireframe=!0),e==="lit"&&(this._debugMaterials[e]._textureMaps={EMISSIVE_MAP:null,DIFFUSE_MAP:null,SPECULAR_MAP:null,NORMAL_MAP:null,AO_MAP:null,LIGHT_MAP:null,TRANSPARENCY_MAP:null})):(this._debugMaterials[e]=r.createEmptyMaterial(null,e),this._debugMaterials[e].flat=!0)},o.prototype.setDebugMaterial=function(e){if(!e||e===""){this.overrideMaterials=[];return}var t=e.split("+");this.overrideMaterials=[];for(var n=0;n<t.length;n++){var e=t[n];this._debugMaterials[e]||this._createDebugMaterial(e),e===""?this.overrideMaterials.push(null):this.overrideMaterials.push(this._debugMaterials[e])}},o}),define("goo/entities/systems/BoundingUpdateSystem",["goo/entities/systems/System","goo/renderer/bounds/BoundingBox"],function(e,t){function n(){e.call(this,"BoundingUpdateSystem",["TransformComponent","MeshRendererComponent","MeshDataComponent"]),this._worldBound=new t,this._computeWorldBound=null}return n.prototype=Object.create(e.prototype),n.prototype.process=function(e){for(var t=0;t<e.length;t++){var n=e[t],r=n.meshDataComponent,i=n.transformComponent,s=n.meshRendererComponent;r.autoCompute?(r.computeBoundFromPoints(),s.updateBounds(r.modelBound,i.worldTransform)):i._updated&&s.updateBounds(r.modelBound,i.worldTransform)}if(this._computeWorldBound&&this._computeWorldBound instanceof Function){if(e.length===0){this._computeWorldBound=null;return}for(var t=0;t<e.length;t++)if(!e[t].particleComponent){this._worldBound=e[t].meshRendererComponent.worldBound.clone();break}for(;t<e.length;t++)if(!e[t].particleComponent){var o=e[t].meshRendererComponent;this._worldBound=this._worldBound.merge(o.worldBound)}this._computeWorldBound(this._worldBound),this._computeWorldBound=null}},n.prototype.getWorldBound=function(e){this._computeWorldBound=e},n}),define("goo/entities/systems/ScriptSystem",["goo/entities/systems/System"],function(e){function t(t){e.call(this,"ScriptSystem",["ScriptComponent"]),this.renderer=t,this.environment={domElement:null,viewportWidth:0,viewportHeight:0},this.priority=500}return t.prototype=Object.create(e.prototype),t.prototype.process=function(e,t){this.environment.domElement=this.renderer.domElement,this.environment.viewportWidth=this.renderer.viewportWidth,this.environment.viewportHeight=this.renderer.viewportHeight;for(var n=0;n<e.length;n++){var r=e[n].scriptComponent;r.run(e[n],t,this.environment)}},t}),define("goo/entities/systems/LightingSystem",["goo/entities/systems/System","goo/entities/SystemBus"],function(e,t){function n(){e.call(this,"LightingSystem",["LightComponent","TransformComponent"]),this.overrideLights=null,this._needsUpdate=!0}return n.prototype=Object.create(e.prototype),n.prototype.setOverrideLights=function(e){this.overrideLights=e,t.emit("goo.setLights",this.overrideLights),this._needsUpdate=!0},n.prototype.clearOverrideLights=function(){this.overrideLights=undefined,this._needsUpdate=!0},n.prototype.process=function(e){if(!this.overrideLights){var n=[];for(var r=0;r<e.length;r++){var i=e[r],s=i.transformComponent,o=i.lightComponent;(s._updated||this._needsUpdate)&&o.updateLight(s.worldTransform),o.hidden||n.push(o.light)}this._needsUpdate=!1,t.emit("goo.setLights",n)}},n}),define("goo/entities/systems/CameraSystem",["goo/entities/systems/System","goo/entities/SystemBus","goo/renderer/Renderer"],function(e,t,n){function r(){e.call(this,"CameraSystem",["TransformComponent","CameraComponent"]),this.mainCamera=null}return r.prototype=Object.create(e.prototype),r.prototype.findMainCamera=function(){var e=null,r=null;for(var i=0;i<this._activeEntities.length;i++){var s=this._activeEntities[i].cameraComponent;if(!e||s.isMain)e=s.camera,r=this._activeEntities[i]}t.emit("goo.setCurrentCamera",{camera:e,entity:r}),n.mainCamera=e},r.prototype.inserted=function(){this.findMainCamera()},r.prototype.deleted=function(){this.findMainCamera()},r.prototype.process=function(e){for(var t=0;t<e.length;t++){var n=e[t],r=n.transformComponent,i=n.cameraComponent;r._updated&&i.updateCamera(r.worldTransform)}},r}),define("goo/util/Stats",[],function(){function e(){var e=Date.now(),t=e,n=e,r=0,i=Infinity,s=0,o=0,u=Infinity,a=0,f=0,l=0,c=document.createElement("div");c.id="stats",c.addEventListener("mousedown",function(e){e.preventDefault(),E(++l%2)},!1),c.style.cssText="width:80px;cursor:pointer;z-index:1000;-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;";var h=document.createElement("div");h.id="fps",h.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",c.appendChild(h);var p=document.createElement("div");p.id="fpsText",p.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px",p.innerHTML="FPS",h.appendChild(p);var d=document.createElement("div");d.id="fpsGraph",d.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",h.appendChild(d);while(d.children.length<74){var v=document.createElement("span");v.style.cssText="width:1px;height:30px;float:left;background-color:#113",d.appendChild(v)}var m=document.createElement("div");m.id="ms",m.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",c.appendChild(m);var g=document.createElement("div");g.id="msText",g.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px",g.innerHTML="MS",m.appendChild(g);var y=document.createElement("div");y.id="msGraph",y.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",m.appendChild(y);while(y.children.length<74){var v=document.createElement("span");v.style.cssText="width:1px;height:30px;float:left;background-color:#131",y.appendChild(v)}var b=document.createElement("div");b.id="info",b.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#200",c.appendChild(b);var w=document.createElement("div");w.id="infoText",w.style.cssText="color:#f66;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px",w.innerHTML="INFO",b.appendChild(w);var E=function(e){l=e;switch(l){case 0:h.style.display="block",m.style.display="none";break;case 1:h.style.display="none",m.style.display="block"}},S=function(e,t){var n=e.appendChild(e.firstChild);n.style.height=t+"px"};this.domElement=c,this.setMode=E,this.begin=function(){e=Date.now()},this.end=function(l){var c=Date.now();return c>n+100&&(r=c-e,i=Math.min(i,r),s=Math.max(s,r),g.textContent=r+" MS ("+i+"-"+s+")",S(y,Math.min(30,30-r/200*30)),n=c,l&&(w.innerHTML="Calls: "+l.calls+"<br>Vertices: "+l.vertices+"<br>Indices: "+l.indices)),f++,c>t+1e3&&(o=Math.round(f*1e3/(c-t)),u=Math.min(u,o),a=Math.max(a,o),p.textContent=o+" FPS ("+u+"-"+a+")",S(d,Math.min(30,30-o/(Math.min(500,a)+10)*30)),t=c,f=0),c},this.update=function(t){e=this.end(t)}}return e}),define("goo/entities/systems/CSSTransformSystem",["goo/entities/systems/System","goo/renderer/Renderer","goo/math/Matrix4x4","goo/math/MathUtils","goo/math/Vector3"],function(e,t,n,r,i){function s(t){e.call(this,"CSSTransformSystem",["TransformComponent","CSSTransformComponent"]),this.renderer=t,document.querySelector&&(this.viewDom=document.querySelector("#view"),this.containerDom=document.querySelector("#cam1"),this.containerDom2=document.querySelector("#cam2")),this.tmpMatrix=new n,this.tmpMatrix2=new n,this.tmpVector=new i}s.prototype=Object.create(e.prototype);var o=function(e){return Math.abs(e)<1e-6?0:e},u=["","-webkit-","-moz-","-ms-","-o-"],a=function(e,t,n){for(var r=0;r<u.length;r++)e.style[u[r]+t]=n},f=function(e){var t=e.data;return"matrix3d("+o(t[0])+","+o(-t[1])+","+o(t[2])+","+o(t[3])+","+o(t[4])+","+o(-t[5])+","+o(t[6])+","+o(t[7])+","+o(t[8])+","+o(-t[9])+","+o(t[10])+","+o(t[11])+","+o(t[12])+","+o(-t[13])+","+o(t[14])+","+o(t[15])+")"};return s.prototype.process=function(e){if(e.length===0)return;var n=t.mainCamera;if(!n)return;var s=.5/Math.tan(r.DEG_TO_RAD*n.fov*.5)*this.renderer.domElement.offsetHeight;a(this.viewDom,"perspective",s+"px"),this.tmpMatrix.copy(n.getViewInverseMatrix()),this.tmpMatrix2.copy(this.tmpMatrix),this.tmpMatrix.invert(),this.tmpMatrix.setTranslation(new i(0,0,s));var o=f(this.tmpMatrix);a(this.containerDom,"transform",o),this.tmpMatrix2.e03=-this.tmpMatrix2.e03,this.tmpMatrix2.e23=-this.tmpMatrix2.e23,this.tmpMatrix2.setRotationFromVector(new i(0,0,0)),o=f(this.tmpMatrix2),a(this.containerDom2,"transform",o);for(var u=0;u<e.length;u++){var l=e[u],c=l.getComponent("CSSTransformComponent"),h=c.domElement,p=c.scale;p=[p,-p,p].join(","),c.faceCamera?(l.transformComponent.worldTransform.matrix.getTranslation(this.tmpVector),this.tmpMatrix.copy(n.getViewInverseMatrix()),this.tmpMatrix.setTranslation(this.tmpVector)):this.tmpMatrix.copy(l.transformComponent.worldTransform.matrix),o="translate3d(-50%,-50%,0) "+f(this.tmpMatrix)+"scale3d("+p+")",a(h,"transform",o),h.parentNode!==this.containerDom2&&this.containerDom2.appendChild(h)}},s}),define("goo/entities/systems/AnimationSystem",["goo/entities/systems/System","goo/entities/World"],function(e,t){function n(){e.call(this,"AnimationSystem",["AnimationComponent"]),this.entities=[]}return n.prototype=Object.create(e.prototype),n.prototype.process=function(e){this.entities=e;for(var n=0;n<e.length;n++){var r=e[n],i=r.animationComponent;i.update(t.time),i.apply(r.transformComponent),i.postUpdate()}},n.prototype.pause=function(){this.passive=!0;var e=this.entities.length;while(e--)this.entities[e].animationComponent.pause()},n.prototype.stop=function(){this.passive=!0;for(var e=0;e<this.entities.length;e++){var t=this.entities[e];t.animationComponent.stop()}},n.prototype.resume=function(){this.passive=!1;for(var e=0;e<this.entities.length;e++){var t=this.entities[e];t.animationComponent.resume()}},n}),define("goo/debug/LightPointer",["goo/renderer/MeshData","goo/util/MeshBuilder","goo/math/Transform","goo/shapes/ShapeCreator","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/math/MathUtils","goo/renderer/light/PointLight","goo/renderer/light/DirectionalLight","goo/renderer/light/SpotLight"],function(e,t,n,r,i,s,o,u,a,f,l,c){function h(){}function p(t,n){t=t||1,n=n||8;var r=[],i=[],s=Math.PI*2/n;for(var o=0,u=0;o<n;o++,u+=s)r.push(Math.cos(u)*t,Math.sin(u)*t,0),i.push(o,o+1);i[i.length-1]=0;var a=new e(e.defaultMap([e.POSITION]),n,i.length);return a.getAttributeBuffer(e.POSITION).set(r),a.getIndexBuffer().set(i),a.indexLengths=null,a.indexModes=["Lines"],a}function d(e){e=e||1;var r=new t,i=128,s=p(e,i),o;o=new n,r.addMeshData(s,o),o=new n,o.rotation.fromAngles(0,Math.PI/2,0),o.update(),r.addMeshData(s,o),o=new n,o.rotation.fromAngles(Math.PI/2,Math.PI/2,0),o.update(),r.addMeshData(s,o);var u=r.build();return u[0]}function v(t){t=t||8;var n=[0,0,0],r=[],i=Math.PI*2/t;for(var s=0,o=0;s<t;s++,o+=i)n.push(Math.cos(o),Math.sin(o),1),r.push(0,s+1);var u=new e(e.defaultMap([e.POSITION]),t+1,r.length);return u.getAttributeBuffer(e.POSITION).set(n),u.getIndexBuffer().set(r),u.indexLengths=null,u.indexModes=["Lines"],u}function m(e,r){e=e||45,r=r||1;var i=new t,s=64,o=2,u=r/2,f=Math.tan(e*a.DEG_TO_RAD/2)*u;for(var l=1;l<=o;l++){var c=p(f*l,s),h=new n;h.translation.set(0,0,u*l),h.update(),i.addMeshData(c,h)}var d=v(4),h=new n;h.scale.set(f*o,f*o,u*o),h.update(),i.addMeshData(d,h);var m=i.build();return m[0]}function g(t){t=t||8;var n=[],r=[],i=Math.PI*2/t;for(var s=0,o=0;s<t;s++,o+=i)n.push(Math.cos(o),Math.sin(o),0),n.push(Math.cos(o),Math.sin(o),1),r.push(s*2,s*2+1);var u=new e(e.defaultMap([e.POSITION]),t*2,r.length);return u.getAttributeBuffer(e.POSITION).set(n),u.getIndexBuffer().set(r),u.indexLengths=null,u.indexModes=["Lines"],u}function y(){var e=new t,r=64,i=2,s=10,o=2;for(var u=0;u<i;u++){var a=p(o,r),f=new n;f.translation.set(0,0,s*u),f.update(),e.addMeshData(a,f)}var l=g(4),f=new n;f.scale.set(o,o,s*i),f.update(),e.addMeshData(l,f);var c=e.build();return c[0]}function b(e){var i=new t,s=new n,o=d(e.range),u=r.createSphere(8,8,.1);i.addMeshData(o,s),i.addMeshData(u,s);var a=i.build();return a[0]}function w(e){var i=new t,s=new n,o=m(e.angle,e.range),u=r.createSphere(8,8,.1);i.addMeshData(u,s),s.scale.setd(1,1,-1),s.update(),i.addMeshData(o,s);var a=i.build();return a[0]}function E(){var e=new t,i=new n;i.scale.setd(1,1,-1),i.update();var s=y(),o=r.createSphere(8,8,.1);e.addMeshData(s,i),e.addMeshData(o,i);var u=e.build();return u[0]}function S(e){if(e instanceof f)return b(e);if(e instanceof l)return E(e);if(e instanceof c)return w(e)}return h.getMeshData=function(e){var t=S(e);return t},h.attachPointer=function(e){var t=e.getComponent("lightComponent").light,n=S(t),r=new i(n);e.setComponent(r);var a=new s;e.setComponent(a);var f=o.createMaterial(u.simpleColored,"");return f.uniforms.color=[t.color.data[0],t.color.data[1],t.color.data[2]],e.meshRendererComponent.materials.push(f),e},h.removeMesh=function(e){return e.clearComponent("meshDataComponent"),e.clearComponent("meshRendererComponent"),e},h}),define("goo/entities/systems/LightDebugSystem",["goo/entities/systems/System","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/debug/LightPointer"],function(e,t,n,r,i,s){function o(){e.call(this,"LightDebugSystem",["LightDebugComponent"])}return o.prototype=Object.create(e.prototype),o.prototype.inserted=function(e){var o=e.lightComponent.light,u=s.getMeshData(o);e.setComponent(new t(u));var a=r.createMaterial(i.simpleColored,"");a.uniforms.color=[o.color.data[0],o.color.data[1],o.color.data[2]];var f=new n;f.materials.push(a),e.setComponent(f),f.updateBounds(e.meshDataComponent.modelBound,e.transformComponent.worldTransform)},o.prototype.process=function(e){for(var t=0;t<e.length;t++){var n=e[t],r=n.lightComponent.light;r.changedProperties&&(r.changedProperties=!1,n.meshDataComponent.meshData=s.getMeshData(r),n.meshRendererComponent.updateBounds(n.meshDataComponent.modelBound,n.transformComponent.worldTransform)),r.changedColor&&(r.changedColor=!1,n.meshRendererComponent.materials[0].uniforms.color=[r.color.data[0],r.color.data[1],r.color.data[2]])}},o.prototype.deleted=function(e){e.clearComponent("MeshDataComponent"),e.clearComponent("MeshRendererComponent")},o}),define("goo/debug/FrustumViewer",["goo/renderer/MeshData","goo/util/MeshBuilder","goo/math/Transform","goo/shapes/ShapeCreator","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/shapes/Box","goo/shapes/Cylinder"],function(e,t,n,r,i,s,o,u,a,f){function l(){}function c(t,n,r,i){var s=t*Math.PI/180/2,o=Math.tan(s),u,a,f,l;u={x:-o*i*n,y:o*i,z:-i},a={x:-o*i*n,y:-o*i,z:-i},f={x:o*i*n,y:-o*i,z:-i},l={x:o*i*n,y:o*i,z:-i};var c,h,p,d;c={x:-o*r*n,y:o*r,z:-r},h={x:-o*r*n,y:-o*r,z:-r},p={x:o*r*n,y:-o*r,z:-r},d={x:o*r*n,y:o*r,z:-r};var v=[];v.push(u.x,u.y,u.z),v.push(a.x,a.y,a.z),v.push(f.x,f.y,f.z),v.push(l.x,l.y,l.z),v.push(c.x,c.y,c.z),v.push(h.x,h.y,h.z),v.push(p.x,p.y,p.z),v.push(d.x,d.y,d.z);var m=[];m.push(0,1),m.push(1,2),m.push(2,3),m.push(3,0),m.push(4,5),m.push(5,6),m.push(6,7),m.push(7,4),m.push(0,4),m.push(1,5),m.push(2,6),m.push(3,7);var g=new e(e.defaultMap([e.POSITION]),8,24);return g.getAttributeBuffer(e.POSITION).set(v),g.getIndexBuffer().set(m),g.indexLengths=null,g.indexModes=["Lines"],g}function h(r){var i=new t,s=new n,o=c(r.fov,r.aspect,r.near,r.far);i.addMeshData(o,s);var u=new f(32,.6),l=new f(32,.6),h=new a(.3,1,1.6),p=new a(.2,.15,.7);p.applyFunction(e.POSITION,function(e){return[e.x+e.x/((e.z+1.1)*.3),e.y+e.y/((e.z+1.1)*.3),e.z]}),s.translation.setd(0,0,0),s.update(),i.addMeshData(p,s),s.translation.setd(0,0,1.3),s.update(),i.addMeshData(h,s),s.scale.setd(1,1,.5),s.setRotationXYZ(0,Math.PI/2,0),s.translation.setd(0,1.2,.6),s.update(),i.addMeshData(u,s),s.translation.setd(0,1.2,2),s.update(),i.addMeshData(l,s);var d=i.build();return d[0]}return l.getMeshData=function(e){var t=h(e);return t},l.attachGuide=function(e){var t=e.getComponent("CameraComponent").camera,n=c(t.fov,t.aspect,t.near,t.far-t.far/1e3),r=new i(n);e.setComponent(r);var a=new s,f=o.createMaterial(u.simpleColored,"");return f.uniforms.color=[.5,.7,1],a.materials.push(f),e.setComponent(a),e},l.removeMesh=function(e){return e.hasComponent("cameraComponent")&&(e.clearComponent("meshDataComponent"),e.clearComponent("meshRendererComponent")),e},l}),define("goo/entities/systems/CameraDebugSystem",["goo/entities/systems/System","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/debug/FrustumViewer"],function(e,t,n,r,i,s){function o(){e.call(this,"CameraDebugSystem",["CameraDebugComponent"])}return o.prototype=Object.create(e.prototype),o.prototype.inserted=function(e){var o=e.cameraComponent.camera,u=s.getMeshData(o);e.setComponent(new t(u));var a=r.createMaterial(i.simpleColored,"");a.uniforms.color=[.4,.7,1];var f=new n;f.materials.push(a),e.setComponent(f),f.updateBounds(e.meshDataComponent.modelBound,e.transformComponent.worldTransform)},o.prototype.process=function(e){for(var t=0;t<e.length;t++){var n=e[t],r=n.cameraComponent.camera;r.changedProperties&&(n.meshDataComponent.meshData=s.getMeshData(r),n.meshRendererComponent.updateBounds(n.meshDataComponent.modelBound,n.transformComponent.worldTransform),r.changedProperties=!1)}},o.prototype.deleted=function(e){e.clearComponent("MeshDataComponent"),e.clearComponent("MeshRendererComponent")},o}),define("goo/entities/systems/MovementSystem",["goo/entities/systems/System"],function(e){function t(){e.call(this,"MovementSystem",["MovementComponent"])}return t.prototype=Object.create(e.prototype),t.prototype.addVelocityToTransform=function(e,t,n){t.translation.add_d(e.data[0]*n,e.data[1]*n,e.data[2]*n)},t.prototype.addRotToTransform=function(e,t,n){t.rotation.rotateX(e.data[0]*n),t.rotation.rotateY(e.data[1]*n),t.rotation.rotateZ(e.data[2]*n)},t.prototype.applyMovementToEntity=function(e){var t=e._world.tpf,n=e.movementComponent.getRotationVelocity(),r=e.movementComponent.getVelocity(),i=e.transformComponent.transform;this.addVelocityToTransform(r,i,t),this.addRotToTransform(n,i,t),e.transformComponent.setUpdated()},t.prototype.process=function(e){var t,n;for(t=0;t<e.length;t++)n=e[t].movementComponent,this.applyMovementToEntity(e[t])},t}),define("goo/util/GameUtils",[],function(){function e(){}return e.supported={fullscreen:!0,pointerLock:!0},e.toggleFullScreen=function(){document.fullscreenElement?document.cancelFullScreen&&document.cancelFullScreen():document.documentElement.requestFullScreen&&document.documentElement.requestFullScreen()},e.requestPointerLock=function(){document.documentElement.requestPointerLock&&document.documentElement.requestPointerLock()},e.exitPointerLock=function(){document.exitPointerLock&&document.exitPointerLock()},e.togglePointerLock=function(){document.pointerLockElement?document.exitPointerLock&&document.exitPointerLock():document.documentElement.requestPointerLock&&document.documentElement.requestPointerLock()},e.addVisibilityChangeListener=function(e){if(typeof e!="function")return;var t=["","ms","moz","webkit"],n,r;for(var i=0;i<t.length;++i){var s=t[i]+(t[i].length===0?"hidden":"Hidden"),o=t[i]+"visibilitychange";if(typeof document[s]!="undefined"){n=s,r=o;break}}typeof document.addEventListener!="undefined"&&typeof n!="undefined"&&document.addEventListener(r,function(){document[n]?e(!0):e(!1)})},e.initAllShims=function(t){e.initWebGLShims(),e.initAnimationShims(),e.initFullscreenShims(t),e.initPointerLockShims(t)},e.initWebGLShims=function(){window.Uint8ClampedArray=window.Uint8ClampedArray||window.Uint8Array},e.initAnimationShims=function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame===undefined&&(window.requestAnimationFrame=function(t){var n=Date.now(),r=Math.max(0,16-(n-e)),i=window.setTimeout(function(){t(n+r)},r);return e=n+r,i}),window.cancelAnimationFrame===undefined&&(window.cancelAnimationFrame=function(e){clearTimeout(e)})},e.initFullscreenShims=function(t){function i(){var e=document.createEvent("CustomEvent");e.initCustomEvent("fullscreenchange",!0,!1,null),document.dispatchEvent(e)}function s(){var e=document.createEvent("CustomEvent");e.initCustomEvent("fullscreenerror",!0,!1,null),document.dispatchEvent(e)}t=t||window;var n=(t.HTMLElement||t.Element).prototype;if(!document.hasOwnProperty("fullscreenEnabled")){var r=function(){return"webkitIsFullScreen"in document?function(){return document.webkitFullscreenEnabled}:"mozFullScreenEnabled"in document?function(){return document.mozFullScreenEnabled}:(e.supported.fullscreen=!1,function(){return!1})}();Object.defineProperty(document,"fullscreenEnabled",{enumerable:!0,configurable:!1,writeable:!1,get:r})}if(!document.hasOwnProperty("fullscreenElement")){var r=function(){var e=["webkitCurrentFullScreenElement","webkitFullscreenElement","mozFullScreenElement"],t=function(t){return function(){return document[e[t]]}};for(var n=0;n<e.length;n++)if(e[n]in document)return t(n);return function(){return null}}();Object.defineProperty(document,"fullscreenElement",{enumerable:!0,configurable:!1,writeable:!1,get:r})}document.addEventListener("webkitfullscreenchange",i,!1),document.addEventListener("mozfullscreenchange",i,!1),document.addEventListener("webkitfullscreenerror",s,!1),document.addEventListener("mozfullscreenerror",s,!1),n.requestFullScreen||(n.requestFullScreen=function(){return n.webkitRequestFullScreen?function(){this.webkitRequestFullScreen(t.Element.ALLOW_KEYBOARD_INPUT)}:n.mozRequestFullScreen?function(){this.mozRequestFullScreen()}:function(){}}()),document.cancelFullScreen||(document.cancelFullScreen=function(){return document.webkitCancelFullScreen||document.mozCancelFullScreen||function(){}}())},e.initPointerLockShims=function(t){function i(){var e=document.createEvent("CustomEvent");e.initCustomEvent("pointerlockchange",!0,!1,null),document.dispatchEvent(e)}function s(){var e=document.createEvent("CustomEvent");e.initCustomEvent("pointerlockerror",!0,!1,null),document.dispatchEvent(e)}t=t||window;var n=(t.HTMLElement||t.Element).prototype;if(!t.MouseEvent)return;var r=t.MouseEvent.prototype;"movementX"in r||Object.defineProperty(r,"movementX",{enumerable:!0,configurable:!1,writeable:!1,get:function(){return this.webkitMovementX||this.mozMovementX||0}}),"movementY"in r||Object.defineProperty(r,"movementY",{enumerable:!0,configurable:!1,writeable:!1,get:function(){return this.webkitMovementY||this.mozMovementY||0}}),navigator.pointer||(navigator.pointer=navigator.webkitPointer||navigator.mozPointer),document.addEventListener("webkitpointerlockchange",i,!1),document.addEventListener("webkitpointerlocklost",i,!1),document.addEventListener("mozpointerlockchange",i,!1),document.addEventListener("mozpointerlocklost",i,!1),document.addEventListener("webkitpointerlockerror",s,!1),document.addEventListener("mozpointerlockerror",s,!1);if(!document.hasOwnProperty("pointerLockElement")){var o=function(){return"webkitPointerLockElement"in document?function(){return document.webkitPointerLockElement}:"mozPointerLockElement"in document?function(){return document.mozPointerLockElement}:function(){return null}}();Object.defineProperty(document,"pointerLockElement",{enumerable:!0,configurable:!1,writeable:!1,get:o})}n.requestPointerLock||(n.requestPointerLock=function(){return n.webkitRequestPointerLock?function(){this.webkitRequestPointerLock()}:n.mozRequestPointerLock?function(){this.mozRequestPointerLock()}:navigator.pointer?function(){var e=this;navigator.pointer.lock(e,i,s)}:(e.supported.pointerLock=!1,function(){})}()),document.exitPointerLock||(document.exitPointerLock=function(){return document.webkitExitPointerLock||document.mozExitPointerLock||function(){navigator.pointer&&navigator.pointer.unlock()}}())},e}),define("goo/util/Logo",[],function(){function e(){}e.blue="#2A3276",e.white="#FFFFFF";var t={color:e.white,shadow:!1};return e.getLogo=function(e){e=e||{};for(var n in t)e[n]===undefined&&(e[n]=t[n]);if(!document.createElementNS)return"";var r="http://www.w3.org/2000/svg",i=document.createElementNS(r,"svg");i.setAttribute("version","1.1"),i.setAttribute("xmlns",r),i.setAttribute("x","0px"),i.setAttribute("y","0px"),i.setAttribute("viewBox","0 0 396.603 277.343"),i.setAttribute("enable-background","new 0 0 396.603 277.343"),i.setAttribute("xml:space","preserve"),e.width&&i.setAttribute("width",e.width),e.height&&i.setAttribute("height",e.height);var s=document.createElementNS(r,"g");i.appendChild(s);var o=document.createElementNS(r,"filter");o.setAttribute("id","insetShadow");var u=document.createElementNS(r,"feGaussianBlur");u.setAttribute("in","SourceAlpha"),u.setAttribute("stdDeviation","0");var a=document.createElementNS(r,"feOffset");a.setAttribute("dx","0"),a.setAttribute("dy","-5"),a.setAttribute("result","offsetblur");var f=document.createElementNS(r,"feComponentTransfer"),l=document.createElementNS(r,"feFuncA");l.setAttribute("type","linear"),l.setAttribute("slope","0.5"),f.appendChild(l);var c=document.createElementNS(r,"feMerge"),h=document.createElementNS(r,"feMergeNode"),p=document.createElementNS(r,"feMergeNode");p.setAttribute("in","SourceGraphic"),c.appendChild(h),c.appendChild(p),o.appendChild(u),o.appendChild(a),o.appendChild(f),o.appendChild(c),s.appendChild(o);var d=document.createElementNS(r,"path");d.setAttribute("d","M303.337,46.286c-13.578,0-25.784,5.744-34.396,14.998c-9.86,10.59-26.319,10.59-36.172,0c-8.605-9.254-20.818-14.998-34.402-14.998c-25.936,0-46.971,21.034-46.971,46.978c0,25.936,21.035,46.972,46.971,46.972c13.584,0,25.797-5.744,34.402-14.998c9.853-10.598,26.325-10.598,36.172,0c8.612,9.254,20.818,14.998,34.396,14.998c25.941,0,46.977-21.036,46.977-46.972C350.313,67.32,329.278,46.286,303.337,46.286z M198.296,116.39c-12.785,0-23.146-10.359-23.146-23.144s10.361-23.151,23.146-23.151c12.795,0,23.156,10.367,23.156,23.151S211.091,116.39,198.296,116.39z M303.337,116.407c-12.785,0-23.146-10.36-23.146-23.144c0-12.784,10.36-23.151,23.146-23.151c12.795,0,23.156,10.367,23.156,23.151C326.493,106.047,316.132,116.407,303.337,116.407z M156.18,138.347c-14.087-3.23-22.316-17.482-18.068-31.305c3.704-12.072,2.568-25.511-4.22-37.256C120.927,47.323,92.22,39.63,69.766,52.587C47.317,65.552,39.624,94.26,52.581,116.713c6.795,11.761,17.853,19.462,30.17,22.282c14.084,3.235,22.314,17.497,18.074,31.317c-3.711,12.08-2.582,25.504,4.213,37.264c12.965,22.455,41.666,30.148,64.127,17.178c22.447-12.945,30.148-41.658,17.185-64.111C179.554,148.881,168.497,141.181,156.18,138.347z M104.802,113.287c-11.064,6.387-25.219,2.599-31.604-8.474c-6.397-11.07-2.604-25.225,8.474-31.609c11.057-6.398,25.22-2.598,31.611,8.46C119.673,92.741,115.872,106.897,104.802,113.287z M145.687,207.256c-12.785,0-23.145-10.361-23.145-23.145s10.359-23.15,23.145-23.15c12.797,0,23.156,10.367,23.156,23.15S158.483,207.256,145.687,207.256z"),d.setAttribute("fill",e.color),e.shadow&&(s.appendChild(o),d.setAttribute("style","filter:url(#insetShadow)")),s.appendChild(d);var v=new XMLSerializer,m=v.serializeToString(i);return m},e}),define("goo/entities/GooRunner",["goo/entities/World","goo/entities/systems/TransformSystem","goo/entities/systems/RenderSystem","goo/renderer/Renderer","goo/entities/systems/BoundingUpdateSystem","goo/entities/systems/ScriptSystem","goo/entities/systems/LightingSystem","goo/entities/systems/CameraSystem","goo/entities/systems/ParticlesSystem","goo/util/Stats","goo/entities/systems/CSSTransformSystem","goo/entities/systems/AnimationSystem","goo/entities/systems/LightDebugSystem","goo/entities/systems/CameraDebugSystem","goo/entities/systems/MovementSystem","goo/entities/components/TransformComponent","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/entities/components/CameraComponent","goo/entities/components/LightComponent","goo/entities/components/ScriptComponent","goo/util/GameUtils","goo/util/Logo"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S){function x(S){S=S||{},E.initAllShims(),this.world=new e(this),this.renderer=new r(S),this.world.setSystem(new s(this.renderer)),this.world.setSystem(new t),this.world.setSystem(new u),this.world.setSystem(new l(this.renderer)),this.world.setSystem(new a),this.world.setSystem(new i),this.world.setSystem(new o),this.world.setSystem(new c),this.world.setSystem(new h),this.world.setSystem(new p),this.world.setSystem(new d),this.renderSystem=new n,this.renderSystems=[this.renderSystem],this.world.setSystem(this.renderSystem),this.world.registerComponent(v),this.world.registerComponent(m),this.world.registerComponent(g),this.world.registerComponent(y),this.world.registerComponent(b),this.world.registerComponent(w),this.doProcess=!0,this.doRender=!0,this.tpfSmoothingCount=S.tpfSmoothingCount!==undefined?S.tpfSmoothingCount:10,S.showStats&&(this.stats=new f,this.stats.domElement.style.position="absolute",this.stats.domElement.style.left="10px",this.stats.domElement.style.top="10px",document.body.appendChild(this.stats.domElement));if(S.logo===undefined||S.logo){var x=this._buildLogo(S.logo);document.body.appendChild(x)}this.callbacks=[],this.callbacksPreProcess=[],this.callbacksPreRender=[],this._takeSnapshots=[];var T=this;this.start=-1,this.run=function(e){try{T._updateFrame(e)}catch(t){t instanceof Error?console.error(t.stack):console.error(t)}},this.animationId=0,S.manuallyStartGameLoop||this.startGameLoop(this.run),S.debugKeys&&this._addDebugKeys(),this._events={click:null,mousedown:null,mouseup:null,mousemove:null},this._eventListeners={click:[],mousedown:[],mouseup:[],mousemove:[]},this._eventTriggered={click:null,mousedown:null,mouseup:null,mousemove:null},E.addVisibilityChangeListener(function(e){e?this.stopGameLoop():this.startGameLoop()}.bind(this)),this._picking={x:0,y:0,skipUpdateBuffer:!1,doPick:!1,pickingCallback:null,pickingStore:{},clearColorStore:[]}}x.prototype.setRenderSystem=function(e,t){this.world.setSystem(e),t!==undefined?this.renderSystems.splice(t,0,e):this.renderSystems.push(e)};var T=[],N=0;return x.prototype._updateFrame=function(t){this.start<0&&(this.start=t);var n=(t-this.start)/1e3;if(n<0||n>1){this.start=t,this.animationId=window.requestAnimationFrame(this.run);return}n=Math.max(Math.min(n,.5),1e-4),T[N]=n,N=(N+1)%this.tpfSmoothingCount;var i=0;for(var s=0;s<T.length;s++)i+=T[s];i/=T.length,this.world.tpf=i,this.world.time+=this.world.tpf,e.time=this.world.time,e.tpf=this.world.tpf,this.start=t;for(var s=0;s<this.callbacksPreProcess.length;s++)this.callbacksPreProcess[s](this.world.tpf);this.doProcess&&this.world.process(),this.renderer.info.reset();if(this.doRender){this.renderer.checkResize(r.mainCamera),this.renderer.setRenderTarget(),this.renderer.clear();for(var s=0;s<this.callbacksPreRender.length;s++)this.callbacksPreRender[s](this.world.tpf);for(var s=0;s<this.renderSystems.length;s++)this.renderSystems[s].render(this.renderer);if(this._picking.doPick&&r.mainCamera){var o=this.renderer.clearColor.data;this._picking.clearColorStore[0]=o[0],this._picking.clearColorStore[1]=o[1],this._picking.clearColorStore[2]=o[2],this._picking.clearColorStore[3]=o[3],this.renderer.setClearColor(0,0,0,1);for(var s=0;s<this.renderSystems.length;s++)this.renderSystems[s].renderToPick&&this.renderSystems[s].renderToPick(this.renderer,this._picking.skipUpdateBuffer);this.renderer.pick(this._picking.x,this._picking.y,this._picking.pickingStore,r.mainCamera),this._picking.pickingCallback(this._picking.pickingStore.id,this._picking.pickingStore.depth),this._picking.doPick=!1,this.renderer.setClearColor.apply(this.renderer,this._picking.clearColorStore)}}for(var s=0;s<this.callbacks.length;s++)this.callbacks[s](this.world.tpf);this.stats&&this.stats.update(this.renderer.info);if(this._takeSnapshots.length){try{var u=this.renderer.domElement.toDataURL();for(var s=this._takeSnapshots.length-1;s>=0;s--)this._takeSnapshots[s](u)}catch(a){console.error("Failed to take snapshot",a.message)}this._takeSnapshots=[]}this.animationId=window.requestAnimationFrame(this.run)},x.prototype._buildLogo=function(e){var t=document.createElement("div"),n=S.getLogo({width:"70px",height:"50px",color:S.blue}),r='<span style="color: #EEE; font-family: Helvetica, sans-serif; font-size: 11px; display: inline-block; margin-top: 14px; margin-right: -3px; vertical-align: top;">Powered by</span>';return t.innerHTML='<a style="text-decoration: none;" href="http://www.gooengine.com" target="_blank">'+r+n+"</a>",t.style.position="absolute",t.style.zIndex="2000",e==="topright"?(t.style.top="10px",t.style.right="10px"):e==="topleft"?(t.style.top="10px",t.style.left="10px"):e==="bottomright"?(t.style.bottom="10px",t.style.right="10px"):e==="bottomleft"?(t.style.bottom="10px",t.style.left="10px"):(t.style.top="10px",t.style.right="10px"),t.id="goologo",t.style.webkitTouchCallout="none",t.style.webkitUserSelect="none",t.style.khtmlUserSelect="none",t.style.mozUserSelect="none",t.style.msUserSelect="none",t.style.userSelect="none",t.ondragstart=function(){return!1},t},x.prototype._addDebugKeys=function(){var e="shiftKey";document.addEventListener("keydown",function(t){t.which===32&&t[e]?E.toggleFullScreen():t.which===13&&t[e]?E.togglePointerLock():t.which===49&&t[e]?this.renderSystem.setDebugMaterial():t.which!==50&&t.which!==222||!t[e]?t.which===51&&t[e]?this.renderSystem.setDebugMaterial("lit"):t.which===52&&t[e]?this.renderSystem.setDebugMaterial("color"):t.which===53&&t[e]?this.renderSystem.setDebugMaterial("wireframe"):t.which===54&&t[e]?this.renderSystem.setDebugMaterial("flat"):t.which!==55&&t.which!==191||!t[e]?t.which===56&&t[e]&&this.renderSystem.setDebugMaterial("+wireframe"):this.renderSystem.setDebugMaterial("texture"):this.renderSystem.setDebugMaterial("normals")}.bind(this),!1),document.addEventListener("mousedown",function(t){if(t[e]){var n=t.clientX,r=t.clientY;this.pick(n,r,function(e,t){var n=this.world.entityManager.getEntityById(e);console.log("Picked entity:",n,"At depth:",t)}.bind(this))}}.bind(this),!1)},x.prototype.addEventListener=function(e,t){if(!this._eventListeners[e]||this._eventListeners[e].indexOf(t)>-1)return;typeof t=="function"&&(this._eventListeners[e].push(t),this._eventListeners[e].length===1&&this._enableEvent(e))},x.prototype.removeEventListener=function(e,t){if(!this._eventListeners[e])return;var n=this._eventListeners[e].indexOf(t);n>-1&&this._eventListeners[e].splice(n,1),this._eventListeners[e].length===0&&this._disableEvent(e)},x.prototype._dispatchEvent=function(e){for(var t in this._eventTriggered)if(this._eventTriggered[t]&&this._eventListeners[t]){var n={entity:e.entity,depth:e.depth,x:e.x,y:e.y,type:t,domEvent:this._eventTriggered[t],id:e.id};for(var r=0;r<this._eventListeners[t].length;r++)if(this._eventListeners[t][r](n)===!1)break;this._eventTriggered[t]=null}},x.prototype._enableEvent=function(e){if(this._events[e])return;var t=function(t){var n=t.offsetX!==undefined?t.offsetX:t.layerX,r=t.offsetY!==undefined?t.offsetY:t.layerY;this._eventTriggered[e]=t,this.pick(n,r,function(e,t){var i=this.world.entityManager.getEntityById(e);this._dispatchEvent({entity:i,depth:t,x:n,y:r,id:e})}.bind(this))}.bind(this);this.renderer.domElement.addEventListener(e,t),this._events[e]=t},x.prototype._disableEvent=function(e){this._events[e]&&this.renderer.domElement.removeEventListener(e,this._events[e]),this._events[e]=null},x.prototype.startGameLoop=function(){this.animationId||(this.start=-1,this.animationId=window.requestAnimationFrame(this.run))},x.prototype.stopGameLoop=function(){window.cancelAnimationFrame(this.animationId),this.animationId=0},x.prototype.takeSnapshot=function(e){this._takeSnapshots.push(e)},x.prototype.pick=function(e,t,n,r){this._picking.x=e,this._picking.y=t,this._picking.skipUpdateBuffer=r===undefined?!1:r,n&&(this._picking.pickingCallback=n),this._picking.doPick=!0},x}),"use strict",require.config({paths:{goo:"goo","goo/lib":"../lib"}}),define("3d/GooController",["application/EventManager","3d/GooCameraController","3d/GooEntityFactory","3d/GooEffectController","game/scenario/ScenarioSelector","goo/entities/components/ScriptComponent","goo/entities/GooRunner","goo/math/Vector3"],function(e,t,n,r,i,s,o,u){var a=function(){var t=[],n=new o({showStats:!0,debug:!1,manuallyStartGameLoop:!0,tpfSmoothingCount:1});this.goo=n,n.renderer.setClearColor(0,.1,.2,1),n.world.world_root=n.world.createEntity("world_root");var i=function(e){e.callbacksPreRender.push(function(e){a(e)})},a=function(e){for(var n=0;n<t.length;n++)t[n](e)};i(this.goo);var f=function(t){e.fireEvent(e.list().GOO_TICK,{tpf:t})};t.push(f),n.world.world_root.setComponent(new s({run:function(t,n){e.fireEvent(e.list().POST_UPDATE,{})}})),n.world.world_root.addToWorld(),n.world.world_root.spatial={pos:new u};var l=function(){console.log("Setup Goo Scene"),document.getElementById("game_window").appendChild(n.renderer.domElement);var t=r.setupMainLight();setTimeout(function(){e.fireEvent(e.list().ENINGE_READY,{goo:n,mainLight:t})},300)},c=function(){n.renderer.domElement.style.opacity=.4};e.registerListener(e.list().LOAD_3D,l),e.registerListener(e.list().UN_LOAD_3D,c)};return a.prototype.propagateGoo=function(){n.setGoo(this.goo),r.setGoo(this.goo)},a});var gameUtil;require(["application/AnalyticsWrapper","application/Client","3d/GooController"],function(e,t,n){var r=new t;r.initiateClient(new n)}),define("Main",function(){});